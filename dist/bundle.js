(()=>{"use strict";var e={291:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.astar=void 0,function(e){var t;!function(e){e[e.WALL=0]="WALL",e[e.OPEN=1]="OPEN"}(t=e.GraphNodeType||(e.GraphNodeType={}));var n=function(){function e(e){this.elements=e;for(var t,n,o=[],a=e.length,i=0;i<a;++i){n=(t=e[i]).length,o[i]=new Array(n);for(var l=0;l<n;++l)o[i][l]=new r(i,l,t[l])}this.nodes=o}return e.prototype.toString=function(){for(var e,t,n,r,o="\n",a=this.nodes,i=0,l=a.length;i<l;){for(e="",n=0,r=(t=a[i++]).length;n<r;)e+=t[n++].type+" ";o=o+e+"\n"}return o},e}();e.Graph=n;var r=function(){function e(e,t,n){this.data={},this.x=e,this.y=t,this.pos={x:e,y:t},this.type=n}return e.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},e.prototype.isWall=function(){return this.type==t.WALL},e}();e.GraphNode=r;var o=function(){function e(e){this.content=[],this.scoreFunction=e}return e.prototype.push=function(e){this.content.push(e),this.sinkDown(this.content.length-1)},e.prototype.pop=function(){var e=this.content[0],t=this.content.pop();return this.content.length>0&&(this.content[0]=t,this.bubbleUp(0)),e},e.prototype.remove=function(e){var t=this.content.indexOf(e),n=this.content.pop();t!==this.content.length-1&&(this.content[t]=n,this.scoreFunction(n)<this.scoreFunction(e)?this.sinkDown(t):this.bubbleUp(t))},e.prototype.size=function(){return this.content.length},e.prototype.rescoreElement=function(e){this.sinkDown(this.content.indexOf(e))},e.prototype.sinkDown=function(e){for(var t=this.content[e];e>0;){var n=(e+1>>1)-1,r=this.content[n];if(!(this.scoreFunction(t)<this.scoreFunction(r)))break;this.content[n]=t,this.content[e]=r,e=n}},e.prototype.bubbleUp=function(e){for(var t=this.content.length,n=this.content[e],r=this.scoreFunction(n);;){var o=e+1<<1,a=o-1,i=null;if(a<t){var l=this.content[a],s=this.scoreFunction(l);s<r&&(i=a)}if(o<t){var u=this.content[o];this.scoreFunction(u)<(null===i?r:s)&&(i=o)}if(null===i)break;this.content[e]=this.content[i],this.content[i]=n,e=i}},e}();e.BinaryHeap=o;var a=function(){function e(e,t,n){this.grid=[];for(var r=0,o=e.length;r<o;r++){this.grid[r]=[];for(var a=0,i=e[r].length;a<i;a++){var l=e[r][a].isSolid()?99999999:1;this.grid[r][a]={org:e[r][a],f:0,g:0,h:0,cost:l,visited:!1,closed:!1,pos:{x:r,y:a},parent:null}}}if(void 0!==t)for(var s=0;s<t.length;s++)this.grid[t[s].x][t[s].y].cost=99999999}return e.prototype.heap=function(){return new o((function(e){return e.f}))},e.prototype._find=function(e){for(var t=0;t<this.grid.length;t++)for(var n=0;n<this.grid[t].length;n++)if(this.grid[t][n].org==e)return this.grid[t][n]},e.prototype._search=function(t,n,r,o){o=o||this.manhattan,r=!!r;var a,i,l=this.heap();if(a=void 0!==t.x&&void 0!==t.y?this.grid[t.x][t.y]:this._find(t),i=void 0!==n.x&&void 0!==n.y?this.grid[n.x][n.y]:this._find(n),0==e.NO_CHECK_START_POINT&&a.cost<=0)return[];for(l.push(a);l.size()>0;){var s=l.pop();if(s===i){for(var u=s,c=[];u.parent;)c.push(u),u=u.parent;return c.reverse()}s.closed=!0;for(var h=this.neighbors(s,r),d=0,p=h.length;d<p;d++){var f=h[d];if(!(f.closed||f.cost<=0)){var m=s.g+f.cost,y=f.visited;(!y||m<f.g)&&(f.visited=!0,f.parent=s,f.h=f.h||o(f.pos,i.pos),f.g=m,f.f=f.g+f.h,y?l.rescoreElement(f):l.push(f))}}}return[]},e.search=function(t,n,r,o,a,i){return new e(t,o)._search(n,r,a,i)},e.prototype.manhattan=function(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)},e.prototype.neighbors=function(e,t){var n=this.grid,r=[],o=e.pos.x,a=e.pos.y;return n[o-1]&&n[o-1][a]&&r.push(n[o-1][a]),n[o+1]&&n[o+1][a]&&r.push(n[o+1][a]),n[o]&&n[o][a-1]&&r.push(n[o][a-1]),n[o]&&n[o][a+1]&&r.push(n[o][a+1]),t&&(n[o-1]&&n[o-1][a-1]&&r.push(n[o-1][a-1]),n[o+1]&&n[o+1][a-1]&&r.push(n[o+1][a-1]),n[o-1]&&n[o-1][a+1]&&r.push(n[o-1][a+1]),n[o+1]&&n[o+1][a+1]&&r.push(n[o+1][a+1])),r},e.NO_CHECK_START_POINT=!1,e}();e.AStar=a}(t.astar||(t.astar={}))},6779:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Drawable=void 0;t.Drawable=function(){this.drawableY=0,this.draw=function(){}}},6750:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Barrel=void 0;var a=n(1272),i=n(2967),l=n(2621),s=function(e){function t(t,n,r,o){var a=e.call(this,t,n,r,o)||this;return a.kill=function(){a.dead=!0,l.GenericParticle.spawnCluster(a.level,a.x+.5,a.y+.5,"#9badb7")},a.killNoBones=function(){a.kill()},a.draw=function(){a.dead||i.Game.drawObj(a.tileX,a.tileY,1,2,a.x-a.drawX,a.y-1-a.drawY,1,2,a.level.shadeColor,a.shadeAmount())},a.drawTopLayer=function(){a.drawableY=a.y-a.drawY,a.drawX+=-.5*a.drawX,a.drawY+=-.5*a.drawY},a.level=t,a.health=1,a.tileX=1,a.tileY=0,a.hasShadow=!1,a.pushable=!0,a}return o(t,e),t}(a.Enemy);t.Barrel=s},2725:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.ChargeEnemy=t.ChargeEnemyState=void 0;var a,i=n(1272),l=n(2967),s=n(8084),u=n(1978),c=n(9143),h=n(5654),d=n(2621);!function(e){e[e.IDLE=0]="IDLE",e[e.ALERTED=1]="ALERTED",e[e.CHARGING=2]="CHARGING"}(a=t.ChargeEnemyState||(t.ChargeEnemyState={}));var p=function(e){function t(t,n,r,o){var i=e.call(this,t,n,r,o)||this;return i.hit=function(){return.5},i.canMoveOver=function(e,t){for(var n=0,r=i.level.enemies;n<r.length;n++){var o=r[n];if(o!==i&&e===o.x&&t===o.y)return!1}var a=i.level.levelArray[e][t];return!(a.isSolid()||a instanceof c.Door||a instanceof h.BottomDoor)},i.tick=function(){if(!i.dead){if(i.skipNextTurns>0)return void i.skipNextTurns--;if(i.ticks++,i.seenPlayer||i.level.softVis[i.x][i.y]<1)if(i.seenPlayer=!0,i.state===a.IDLE){var e=!1,t=0,n=0;if(i.x===i.game.player.x){n=i.y<i.game.player.y?1:-1;for(var r=i.y;r!==i.game.player.y;r+=n)i.canMoveOver(i.x,r)||(e=!0)}else if(i.y===i.game.player.y){t=i.x<i.game.player.x?1:-1;for(var o=i.x;o!==i.game.player.x;o+=t)i.canMoveOver(o,i.y)||(e=!0)}if((0!==t||0!==n)&&!e)for(i.state=a.ALERTED,i.targetX=i.x,i.targetY=i.y;i.canMoveOver(i.targetX+t,i.targetY+n);)i.targetX+=t,i.targetY+=n,(i.targetX===i.game.player.x&&i.targetY===i.game.player.y||i.targetX===i.game.player.x-1&&i.targetY===i.game.player.y||i.targetX===i.game.player.x+1&&i.targetY===i.game.player.y||i.targetX===i.game.player.x&&i.targetY===i.game.player.y-1||i.targetX===i.game.player.x&&i.targetY===i.game.player.y+1)&&i.level.projectiles.push(new s.HitWarning(i.game,i.targetX,i.targetY))}else i.state===a.ALERTED?(i.state=a.CHARGING,(i.y===i.game.player.y&&(i.x<i.game.player.x&&i.game.player.x<=i.targetX||i.targetX<=i.game.player.x&&i.game.player.x<i.x)||i.x===i.game.player.x&&(i.y<i.game.player.y&&i.game.player.y<=i.targetY||i.targetY<=i.game.player.y&&i.game.player.y<i.y))&&i.game.player.hurt(.5),i.drawX=i.targetX-i.x,i.drawY=i.targetY-i.y,i.x=i.targetX,i.y=i.targetY):i.state===a.CHARGING&&(i.state=a.IDLE)}},i.draw=function(){i.dead||(i.frame+=.1,i.frame>=4&&(i.frame=0),(i.state===a.CHARGING&&Math.abs(i.drawX)>.1||Math.abs(i.drawY)>.1)&&(d.GenericParticle.spawnCluster(i.level,i.x-i.drawX+.5,i.y-i.drawY+.5,"black"),d.GenericParticle.spawnCluster(i.level,i.x-i.drawX+.5,i.y-i.drawY+.5,"white")),i.hasShadow&&l.Game.drawMob(0,0,1,1,i.x-i.drawX,i.y-i.drawY,1,1,i.level.shadeColor,i.shadeAmount()),l.Game.drawMob(i.tileX,i.tileY,1,2,i.x-i.drawX,i.y-1.5-i.drawY+(4===i.tileX?.1875:0),1,2,i.level.shadeColor,i.shadeAmount()))},i.dropLoot=function(){i.game.level.items.push(new u.Coin(i.level,i.x,i.y))},i.ticks=0,i.frame=0,i.health=1,i.maxHealth=1,i.tileX=17,i.tileY=8,i.seenPlayer=!0,i.deathParticleColor="#ffffff",i.state=a.IDLE,i}return o(t,e),t}(i.Enemy);t.ChargeEnemy=p},516:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Chest=void 0;var a=n(2967),i=n(1785),l=n(6309),s=n(8573),u=n(1272),c=n(7975),h=n(2621),d=n(1978),p=n(5958),f=function(e){function t(t,n,r,o){var u=e.call(this,t,n,r,o)||this;return u.kill=function(){switch(p.Sound.chest(),u.dead=!0,h.GenericParticle.spawnCluster(u.level,u.x+.5,u.y+.5,"#fbf236"),a.Game.randTable([1,1,1,2,2,3])){case 1:u.game.level.items.push(new d.Coin(u.level,u.x,u.y));break;case 2:u.game.level.items.push(new l.Heart(u.level,u.x,u.y));break;case 3:u.game.level.items.push(new c.GreenGem(u.level,u.x,u.y));break;case 3:u.game.level.items.push(new i.Key(u.level,u.x,u.y));break;case 4:u.game.level.items.push(new s.Armor(u.level,u.x,u.y))}},u.killNoBones=function(){u.kill()},u.draw=function(){u.dead||a.Game.drawObj(u.tileX,u.tileY,1,2,u.x-u.drawX,u.y-1-u.drawY,1,2,u.level.shadeColor,u.shadeAmount())},u.drawTopLayer=function(){u.drawableY=u.y},u.tileX=4,u.tileY=0,u.health=1,u}return o(t,e),t}(u.Enemy);t.Chest=f},8365:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.CoalResource=void 0;var a=n(8576),i=n(2621),l=n(9809),s=n(5958),u=function(e){function t(t,n,r,o){var a=e.call(this,t,n,r,o)||this;return a.hurtCallback=function(){i.GenericParticle.spawnCluster(a.level,a.x+.5,a.y+.5,"#ffffff"),s.Sound.mine()},a.kill=function(){s.Sound.breakRock(),a.dead=!0,a.game.level.items.push(new l.Coal(a.level,a.x,a.y))},a.killNoBones=function(){a.kill()},a.drawTopLayer=function(){a.drawableY=a.y},a.tileX=12,a.tileY=0,a.health=1,a}return o(t,e),t}(a.Resource);t.CoalResource=u},6061:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Crate=void 0;var a=n(1272),i=n(2967),l=n(2621),s=function(e){function t(t,n,r,o){var a=e.call(this,t,n,r,o)||this;return a.kill=function(){a.dead=!0,l.GenericParticle.spawnCluster(a.level,a.x+.5,a.y+.5,"#d9a066")},a.killNoBones=function(){a.kill()},a.draw=function(){a.dead||i.Game.drawObj(a.tileX,a.tileY,1,2,a.x-a.drawX,a.y-1-a.drawY,1,2,a.level.shadeColor,a.shadeAmount())},a.drawTopLayer=function(){a.drawableY=a.y-a.drawY,a.drawX+=-.5*a.drawX,a.drawY+=-.5*a.drawY},a.level=t,a.health=1,a.maxHealth=1,a.tileX=0,a.tileY=0,a.hasShadow=!1,a.pushable=!0,a}return o(t,e),t}(a.Enemy);t.Crate=s},9379:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.EmeraldResource=void 0;var a=n(7975),i=n(8576),l=n(2621),s=n(5958),u=function(e){function t(t,n,r,o){var i=e.call(this,t,n,r,o)||this;return i.hurtCallback=function(){l.GenericParticle.spawnCluster(i.level,i.x+.5,i.y+.5,"#fbf236"),s.Sound.mine()},i.kill=function(){s.Sound.breakRock(),i.dead=!0,i.game.level.items.push(new a.GreenGem(i.level,i.x,i.y))},i.killNoBones=function(){i.kill()},i.drawTopLayer=function(){i.drawableY=i.y},i.tileX=14,i.tileY=0,i.health=3,i}return o(t,e),t}(i.Resource);t.EmeraldResource=u},1272:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Enemy=t.EnemyDirection=void 0;var a,i=n(2967),l=n(5269),s=n(5440),u=n(9626),c=n(2621),h=n(3338),d=n(6779);!function(e){e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e[e.RIGHT=2]="RIGHT",e[e.LEFT=3]="LEFT"}(a=t.EnemyDirection||(t.EnemyDirection={}));var p=function(e){function t(t,n,r,o){var d=e.call(this)||this;return d.tryMove=function(e,t){for(var n=0,r=d.level.enemies;n<r.length;n++){var o=r[n];if(o!==d&&o.x===e&&o.y===t)return}d.game.player.x===e&&d.game.player.y===t||d.level.levelArray[e][t].isSolid()||(d.level.levelArray[e][t].onCollideEnemy(d),d.x=e,d.y=t)},d.hit=function(){return 0},d.hurtCallback=function(){},d.hurt=function(e){d.healthBar.hurt(),d.health-=e,d.health<=0?d.kill():d.hurtCallback()},d.interact=function(){},d.dropLoot=function(){},d.kill=function(){if(d.level.levelArray[d.x][d.y]instanceof u.Floor){var e=new l.Bones(d.level,d.x,d.y);e.skin=d.level.levelArray[d.x][d.y].skin,d.level.levelArray[d.x][d.y]=e}d.dead=!0,c.GenericParticle.spawnCluster(d.level,d.x+.5,d.y+.5,d.deathParticleColor),d.level.particles.push(new s.DeathParticle(d.x,d.y)),d.dropLoot()},d.killNoBones=function(){d.dead=!0,c.GenericParticle.spawnCluster(d.level,d.x+.5,d.y+.5,d.deathParticleColor),d.level.particles.push(new s.DeathParticle(d.x,d.y))},d.shadeAmount=function(){return d.level.softVis[d.x][d.y]},d.doneMoving=function(){return Math.abs(d.drawX)<.01&&Math.abs(d.drawY)<.01},d.seesPlayer=function(){return Math.abs(d.x-d.game.player.x)<=4&&Math.abs(d.y-d.game.player.y)<=4},d.facePlayer=function(){var e=d.game.player.x-d.x,t=d.game.player.y-d.y;Math.abs(e)===Math.abs(t)||(Math.abs(e)>Math.abs(t)?(e>0&&(d.direction=a.RIGHT),e<0&&(d.direction=a.LEFT)):(t>0&&(d.direction=a.DOWN),t<0&&(d.direction=a.UP)))},d.draw=function(){d.dead||(d.hasShadow&&i.Game.drawMob(0,0,1,1,d.x-d.drawX,d.y-d.drawY,1,1,d.level.shadeColor,d.shadeAmount()),i.Game.drawMob(d.tileX,d.tileY+2*d.direction,1,2,d.x-d.drawX,d.y-1.5-d.drawY,1,2,d.level.shadeColor,d.shadeAmount()))},d.tick=function(){},d.drawTopLayer=function(){d.drawableY=d.y-d.drawY,d.healthBar.draw(d.health,d.maxHealth,d.x,d.y,!0),d.drawX+=-.5*d.drawX,d.drawY+=-.5*d.drawY},d.level=t,d.x=r,d.y=o,d.w=1,d.h=1,d.game=n,d.drawX=0,d.drawY=0,d.health=1,d.maxHealth=1,d.tileX=0,d.tileY=0,d.hasShadow=!0,d.skipNextTurns=0,d.direction=a.DOWN,d.destroyable=!0,d.pushable=!1,d.chainPushable=!0,d.interactable=!1,d.deathParticleColor="#ff00ff",d.healthBar=new h.HealthBar,d}return o(t,e),t}(d.Drawable);t.Enemy=p},5377:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.GoldResource=void 0;var a=n(8576),i=n(2621),l=n(9825),s=n(5958),u=function(e){function t(t,n,r,o){var a=e.call(this,t,n,r,o)||this;return a.hurtCallback=function(){s.Sound.mine()},a.kill=function(){s.Sound.breakRock(),a.dead=!0,a.game.level.items.push(new l.Gold(a.level,a.x,a.y)),i.GenericParticle.spawnCluster(a.level,a.x+.5,a.y+.5,"#fbf236")},a.killNoBones=function(){a.kill()},a.drawTopLayer=function(){a.drawableY=a.y},a.tileX=13,a.tileY=0,a.health=2,a}return o(t,e),t}(a.Resource);t.GoldResource=u},3441:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.KnightEnemy=void 0;var a=n(1272),i=n(2967),l=n(291),s=n(8084),u=n(3280),c=n(1978),h=function(e){function t(t,n,r,o){var h=e.call(this,t,n,r,o)||this;return h.hit=function(){return 1},h.tick=function(){if(!h.dead){if(h.skipNextTurns>0)return void h.skipNextTurns--;if(h.ticks++,h.tileX=9,h.tileY=8,h.seenPlayer||h.seesPlayer())if(h.ticks%2==0){h.tileX=4,h.tileY=0,h.seenPlayer=!0;for(var e=h.x,t=h.y,n=Array(),r=0,o=h.level.enemies;r<o.length;r++){var i=o[r];i!==h&&n.push({x:i.x,y:i.y})}for(var c=h.x-1;c<=h.x+1;c++)for(var d=h.y-1;d<=h.y+1;d++)h.level.levelArray[c][d]instanceof u.SpikeTrap&&h.level.levelArray[c][d].on&&n.push({x:c,y:d});h.moves=l.astar.AStar.search(h.level.levelArray,h,h.game.player,n),h.moves.length>0&&(h.game.player.x===h.moves[0].pos.x&&h.game.player.y===h.moves[0].pos.y?(h.game.player.hurt(h.hit()),h.drawX=.5*(h.x-h.game.player.x),h.drawY=.5*(h.y-h.game.player.y),h.game.shakeScreen(10*h.drawX,10*h.drawY)):(h.tryMove(h.moves[0].pos.x,h.moves[0].pos.y),h.drawX=h.x-e,h.drawY=h.y-t,h.x>e?h.direction=a.EnemyDirection.RIGHT:h.x<e?h.direction=a.EnemyDirection.LEFT:h.y>t?h.direction=a.EnemyDirection.DOWN:h.y<t&&(h.direction=a.EnemyDirection.UP)))}else h.level.projectiles.push(new s.HitWarning(h.game,h.x-1,h.y)),h.level.projectiles.push(new s.HitWarning(h.game,h.x+1,h.y)),h.level.projectiles.push(new s.HitWarning(h.game,h.x,h.y-1)),h.level.projectiles.push(new s.HitWarning(h.game,h.x,h.y+1))}},h.draw=function(){h.dead||(h.frame+=.1,h.frame>=4&&(h.frame=0),h.doneMoving()&&h.game.player.doneMoving()&&h.facePlayer(),h.hasShadow&&i.Game.drawMob(0,0,1,1,h.x-h.drawX,h.y-h.drawY,1,1,h.level.shadeColor,h.shadeAmount()),i.Game.drawMob(h.tileX+(4===h.tileX?0:Math.floor(h.frame)),h.tileY+2*h.direction,1,2,h.x-h.drawX,h.y-1.5-h.drawY+(4===h.tileX?.1875:0),1,2,h.level.shadeColor,h.shadeAmount()))},h.dropLoot=function(){h.game.level.items.push(new c.Coin(h.level,h.x,h.y))},h.moves=new Array,h.ticks=0,h.frame=0,h.health=2,h.maxHealth=2,h.tileX=9,h.tileY=8,h.seenPlayer=!1,h.deathParticleColor="#ffffff",h}return o(t,e),t}(a.Enemy);t.KnightEnemy=h},9670:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.PottedPlant=void 0;var a=n(1272),i=n(2967),l=n(2621),s=function(e){function t(t,n,r,o){var a=e.call(this,t,n,r,o)||this;return a.kill=function(){a.dead=!0,l.GenericParticle.spawnCluster(a.level,a.x+.5,a.y+.5,"#ce736a")},a.killNoBones=function(){a.kill()},a.draw=function(){a.dead||(a.drawX+=-.5*a.drawX,a.drawY+=-.5*a.drawY,i.Game.drawObj(a.tileX,a.tileY,1,2,a.x-a.drawX,a.y-1-a.drawY,1,2,a.level.shadeColor,a.shadeAmount()))},a.drawTopLayer=function(){a.drawableY=a.y},a.level=t,a.health=1,a.tileX=3,a.tileY=0,a.hasShadow=!1,a.chainPushable=!1,a}return o(t,e),t}(a.Enemy);t.PottedPlant=s},8576:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Resource=void 0;var a=n(2967),i=function(e){function t(t,n,r,o){var i=e.call(this,t,n,r,o)||this;return i.kill=function(){i.dead=!0},i.killNoBones=function(){i.kill()},i.draw=function(){i.dead||a.Game.drawObj(i.tileX,i.tileY,1,2,i.x-i.drawX,i.y-1-i.drawY,1,2,i.level.shadeColor,i.shadeAmount())},i.drawTopLayer=function(){i.drawableY=i.y},i.tileX=12,i.tileY=0,i.health=1,i.chainPushable=!1,i}return o(t,e),t}(n(1272).Enemy);t.Resource=i},8498:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.SkullEnemy=void 0;var a=n(1272),i=n(2967),l=n(8084),s=n(2621),u=n(1978),c=n(5043),h=function(e){function t(t,n,r,o){var h=e.call(this,t,n,r,o)||this;return h.REGEN_TICKS=5,h.hit=function(){return 1},h.hurt=function(e){h.ticksSinceFirstHit=0,h.health-=e,h.healthBar.hurt(),h.health<=0?h.kill():s.GenericParticle.spawnCluster(h.level,h.x+.5,h.y+.5,h.deathParticleColor)},h.tick=function(){if(!h.dead){if(h.skipNextTurns>0)return void h.skipNextTurns--;if(h.health<=1)h.ticksSinceFirstHit++,h.ticksSinceFirstHit>=h.REGEN_TICKS&&(h.health=2);else if(h.seenPlayer||h.seesPlayer()){h.seenPlayer=!0;var e=h.x,t=h.y;h.game.player.x>h.x&&h.dx++,h.game.player.x<h.x&&h.dx--,h.game.player.y>h.y&&h.dy++,h.game.player.y<h.y&&h.dy--;var n=h.x,r=h.y;Math.abs(h.dx)>Math.abs(h.dy)||h.dx===h.dy&&Math.abs(h.game.player.x-h.x)>=Math.abs(h.game.player.y-h.y)?h.dx>0?(n++,h.dx--):h.dx<0&&(n--,h.dx++):h.dy>0?(r++,h.dy--):h.dy<0&&(r--,h.dy++),h.game.player.x===n&&h.game.player.y===r?(h.game.player.hurt(h.hit()),h.dx=0,h.dy=0,h.drawX=.5*(h.x-h.game.player.x),h.drawY=.5*(h.y-h.game.player.y),h.game.shakeScreen(10*h.drawX,10*h.drawY)):(h.tryMove(n,r),h.x===e&&h.y===t&&(h.dx=0,h.dy=0),h.drawX=h.x-e,h.drawY=h.y-t,h.x>e?h.direction=a.EnemyDirection.RIGHT:h.x<e?h.direction=a.EnemyDirection.LEFT:h.y>t?h.direction=a.EnemyDirection.DOWN:h.y<t&&(h.direction=a.EnemyDirection.UP)),h.level.projectiles.push(new l.HitWarning(h.game,h.x-1,h.y)),h.level.projectiles.push(new l.HitWarning(h.game,h.x+1,h.y)),h.level.projectiles.push(new l.HitWarning(h.game,h.x,h.y-1)),h.level.projectiles.push(new l.HitWarning(h.game,h.x,h.y+1))}}},h.draw=function(){h.dead||(h.tileX=5,h.tileY=8,h.health<=1&&(h.tileX=3,h.tileY=0,h.ticksSinceFirstHit>=3&&(h.flashingFrame+=.1,Math.floor(h.flashingFrame)%2==0&&(h.tileX=2))),h.frame+=.1,h.frame>=4&&(h.frame=0),h.health>1&&h.doneMoving()&&h.game.player.doneMoving()&&h.facePlayer(),h.hasShadow&&i.Game.drawMob(0,0,1,1,h.x-h.drawX,h.y-h.drawY,1,1,h.level.shadeColor,h.shadeAmount()),i.Game.drawMob(h.tileX+(5===h.tileX?Math.floor(h.frame):0),h.tileY+2*h.direction,1,2,h.x-h.drawX,h.y-1.5-h.drawY,1,2,h.level.shadeColor,h.shadeAmount()))},h.dropLoot=function(){Math.random()<.02?h.game.level.items.push(new c.RedGem(h.level,h.x,h.y)):h.game.level.items.push(new u.Coin(h.level,h.x,h.y))},h.ticks=0,h.frame=0,h.health=2,h.maxHealth=2,h.tileX=5,h.tileY=8,h.seenPlayer=!1,h.ticksSinceFirstHit=0,h.flashingFrame=0,h.dx=0,h.dy=0,h.deathParticleColor="#ffffff",h}return o(t,e),t}(a.Enemy);t.SkullEnemy=h},1241:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Spawner=void 0;var a=n(1272),i=n(2967),l=n(8498),s=n(209),u=n(8414),c=n(3441),h=n(5397),d=function(e){function t(t,n,r,o){var a=e.call(this,t,n,r,o)||this;return a.hit=function(){return 1},a.tick=function(){if(!a.dead){if(a.skipNextTurns>0)return void a.skipNextTurns--;if(a.tileX=6,(a.seenPlayer||a.level.softVis[a.x][a.y]>0)&&a.ticks%4==0){a.tileX=7,a.seenPlayer=!0;var e=i.Game.randTable([[-1,-1],[0,-1],[1,-1],[-1,0],[1,0],[-1,1],[0,1],[1,1]]),t=a.x+e[0],n=a.y+e[1],r=a.x+2*e[0],o=a.y+2*e[1],u=void 0;switch(a.enemySpawnType){case 1:u=new c.KnightEnemy(a.level,a.game,t,n);break;case 2:u=new l.SkullEnemy(a.level,a.game,t,n);break;case 3:u=new h.WizardEnemy(a.level,a.game,t,n)}a.level.projectiles.push(new s.EnemySpawnAnimation(a.level,u,t,n,r,o))}a.ticks++}},a.dropLoot=function(){a.game.level.items.push(new u.BlueGem(a.level,a.x,a.y))},a.ticks=0,a.health=4,a.maxHealth=4,a.tileX=6,a.tileY=4,a.seenPlayer=!0,a.enemySpawnType=i.Game.randTable([1,1,1,2,2,2,2,3]),a.deathParticleColor="#ffffff",a}return o(t,e),t}(a.Enemy);t.Spawner=d},6945:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.VendingMachine=void 0;var a=n(2967),i=n(1272),l=n(1978),s=n(7975),u=n(988),c=n(1656),h=n(8573),d=n(6309),p=n(3806),f=n(9825),m="white",y=function(e){function t(t,n,r,o,i){var y=e.call(this,t,n,r,o)||this;if(y.open=!1,y.openTime=0,y.isInf=!1,y.quantity=1,y.buyAnimAmount=0,y.interact=function(){(y.isInf||y.quantity>0)&&(y.open=!0,y.openTime=Date.now(),y.game.player.openVendingMachine&&y.game.player.openVendingMachine!==y&&y.game.player.openVendingMachine.close(),y.game.player.openVendingMachine=y)},y.close=function(){y.open=!1,y.game.player.openVendingMachine=null},y.space=function(){if(y.open){for(var e=0,t=y.costItems;e<t.length;e++){var n=t[e];if(!y.game.player.inventory.hasItemCount(n))return}for(var r=0,o=y.costItems;r<o.length;r++){var i=o[r];y.game.player.inventory.subtractItemCount(i)}var l=[y.x-1,y.x+1,y.x],s=[y.y,y.y,y.y+1],u=0;do{u=a.Game.rand(0,l.length-1)}while(l[u]===y.game.player.x&&s[u]===y.game.player.y);var c=new y.item.constructor;c=c.constructor(y.level,l[u],s[u]),y.level.items.push(c),console.log(c),y.isInf||(y.quantity--,y.quantity<=0&&y.close()),y.buyAnimAmount=.99,y.game.shakeScreen(0,4)}},y.draw=function(){var e=19;y.isInf||0!==y.quantity||(e=20),a.Game.drawObj(e,0,1,2,y.x,y.y-1,1,2,y.level.shadeColor,y.shadeAmount())},y.drawTopLayer=function(){if(y.drawableY=y.y-y.drawY,y.open){var e=Math.min(18,18*(Date.now()-y.openTime)/150),t=-2,n=(y.costItems.length+2)*(e+4+t)-t,r=e+4+t-t,o=(y.x+.5)*u.GameConstants.TILESIZE,i=(y.y-1.5)*u.GameConstants.TILESIZE;a.Game.ctx.fillStyle=m,a.Game.ctx.fillRect(Math.round(o-.5*n)-1,Math.round(i-.5*r)-1,Math.round(n+2),Math.round(r+2));for(var l=0;l<y.costItems.length+2;l++)a.Game.ctx.fillStyle="#292c36",a.Game.ctx.fillRect(Math.round(o-.5*n+l*(e+4+t)),Math.round(i-.5*r),Math.round(e+4),Math.round(e+4)),l!==y.costItems.length&&(a.Game.ctx.fillStyle="#5a595b",a.Game.ctx.fillRect(Math.round(o-.5*n+l*(e+4+t)+2),Math.round(i-.5*r+2),Math.round(e),Math.round(e)));if(Date.now()-y.openTime>=150)for(var s=0;s<y.costItems.length+2;s++){var c=Math.round(o-.5*n+s*(e+4+t)+2+Math.floor(.5*e)-.5*u.GameConstants.TILESIZE),h=Math.round(i-.5*r+2+Math.floor(.5*e)-.5*u.GameConstants.TILESIZE),d=c/u.GameConstants.TILESIZE,p=h/u.GameConstants.TILESIZE;if(s<y.costItems.length){var f=1;y.game.player.inventory.hasItemCount(y.costItems[s])||(f=.15),y.costItems[s].drawIcon(d,p,f)}else s===y.costItems.length?a.Game.drawFX(0,1,1,1,d,p,1,1):s===y.costItems.length+1&&y.item.drawIcon(d,p)}y.buyAnimAmount*=y.buyAnimAmount,a.Game.ctx.globalAlpha=y.buyAnimAmount,a.Game.ctx.fillStyle=m,a.Game.ctx.fillRect(Math.round(o-.5*n)-1,Math.round(i-.5*r)-1,Math.round(n+2),Math.round(r+2)),a.Game.ctx.globalAlpha=1}},y.destroyable=!1,y.pushable=!1,y.chainPushable=!1,y.interactable=!0,y.item=i,y.item instanceof c.Shotgun)(w=new s.GreenGem(t,0,0)).stackCount=a.Game.randTable([5,5,6,7]),y.costItems=[w];else if(y.item instanceof d.Heart){var v=new l.Coin(t,0,0);v.stackCount=10,y.costItems=[v],y.isInf=!0}else if(y.item instanceof p.Spear)(w=new s.GreenGem(t,0,0)).stackCount=a.Game.randTable([5,5,6,7]),y.costItems=[w];else if(y.item instanceof h.Armor){var w;(w=new f.Gold(t,0,0)).stackCount=a.Game.randTable([5,5,6,7]),y.costItems=[w]}return y}return o(t,e),t}(i.Enemy);t.VendingMachine=y},5397:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.WizardEnemy=void 0;var a,i=n(1272),l=n(2967),s=n(9626),u=n(5269),c=n(5440),h=n(4568),d=n(5363),p=n(1978),f=n(8414);!function(e){e[e.idle=0]="idle",e[e.attack=1]="attack",e[e.justAttacked=2]="justAttacked",e[e.teleport=3]="teleport"}(a||(a={}));var m=function(e){function t(t,n,r,o){var i=e.call(this,t,n,r,o)||this;return i.ATTACK_RADIUS=5,i.hit=function(){return 1},i.withinAttackingRangeOfPlayer=function(){return Math.pow(i.x-i.game.player.x,2)+Math.pow(i.y-i.game.player.y,2)<=Math.pow(i.ATTACK_RADIUS,2)},i.shuffle=function(e){var t,n,r;for(r=e.length-1;r>0;r--)t=Math.floor(Math.random()*(r+1)),n=e[r],e[r]=e[t],e[t]=n;return e},i.tick=function(){if(!i.dead){if(i.skipNextTurns>0)return void i.skipNextTurns--;if(i.seenPlayer||i.seesPlayer())switch(i.seenPlayer=!0,i.state){case a.attack:i.tileX=7,i.level.levelArray[i.x-1][i.y].isSolid()||(i.level.projectiles.push(new d.WizardFireball(i,i.x-1,i.y)),i.level.levelArray[i.x-2][i.y].isSolid()||i.level.projectiles.push(new d.WizardFireball(i,i.x-2,i.y))),i.level.levelArray[i.x+1][i.y].isSolid()||(i.level.projectiles.push(new d.WizardFireball(i,i.x+1,i.y)),i.level.levelArray[i.x+2][i.y].isSolid()||i.level.projectiles.push(new d.WizardFireball(i,i.x+2,i.y))),i.level.levelArray[i.x][i.y-1].isSolid()||(i.level.projectiles.push(new d.WizardFireball(i,i.x,i.y-1)),i.level.levelArray[i.x][i.y-2].isSolid()||i.level.projectiles.push(new d.WizardFireball(i,i.x,i.y-2))),i.level.levelArray[i.x][i.y+1].isSolid()||(i.level.projectiles.push(new d.WizardFireball(i,i.x,i.y+1)),i.level.levelArray[i.x][i.y+2].isSolid()||i.level.projectiles.push(new d.WizardFireball(i,i.x,i.y+2))),i.state=a.justAttacked;break;case a.justAttacked:i.tileX=6,i.state=a.idle;break;case a.teleport:for(var e=i.x,t=i.y,n=1e5,r=void 0,o=i.shuffle(i.level.getEmptyTiles()),s=l.Game.randTable([2,2,3,3,3,3,3]),u=0,c=o;u<c.length;u++){var p=c[u],f=Math.abs(p.x-i.game.player.x)+Math.abs(p.y-i.game.player.y);Math.abs(f-s)<Math.abs(n-s)&&(n=f,r=p)}i.tryMove(r.x,r.y),i.drawX=i.x-e,i.drawY=i.y-t,i.frame=0,i.level.particles.push(new h.WizardTeleportParticle(e,t)),i.withinAttackingRangeOfPlayer()?i.state=a.attack:i.state=a.idle;break;case a.idle:i.state=a.teleport}}},i.draw=function(){i.dead||(i.hasShadow&&l.Game.drawMob(0,0,1,1,i.x-i.drawX,i.y-i.drawY,1,1,i.level.shadeColor,i.shadeAmount()),i.frame>=0?(l.Game.drawMob(Math.floor(i.frame)+6,2,1,2,i.x,i.y-1.5,1,2,i.level.shadeColor,i.shadeAmount()),i.frame+=.4,i.frame>11&&(i.frame=-1)):l.Game.drawMob(i.tileX,i.tileY,1,2,i.x-i.drawX,i.y-1.5-i.drawY,1,2,i.level.shadeColor,i.shadeAmount()))},i.kill=function(){if(i.level.levelArray[i.x][i.y]instanceof s.Floor){var e=new u.Bones(i.level,i.x,i.y);e.skin=i.level.levelArray[i.x][i.y].skin,i.level.levelArray[i.x][i.y]=e}i.dead=!0,i.level.particles.push(new c.DeathParticle(i.x,i.y)),i.dropLoot()},i.dropLoot=function(){Math.random()<.02?i.game.level.items.push(new f.BlueGem(i.level,i.x,i.y)):i.game.level.items.push(new p.Coin(i.level,i.x,i.y))},i.ticks=0,i.health=1,i.tileX=6,i.tileY=0,i.frame=0,i.state=a.attack,i.seenPlayer=!1,i.deathParticleColor="#ffffff",i}return o(t,e),t}(i.Enemy);t.WizardEnemy=m},2967:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Game=t.LevelState=void 0;var r,o=n(988),a=n(663),i=n(5958),l=n(5742),s=n(569),u=n(5654),c=n(8835),h=n(9382),d=n(6882);!function(e){e[e.IN_LEVEL=0]="IN_LEVEL",e[e.TRANSITIONING=1]="TRANSITIONING",e[e.TRANSITIONING_LADDER=2]="TRANSITIONING_LADDER"}(r=t.LevelState||(t.LevelState={}));var p=function(){function e(){var t=this;this.changeLevel=function(e){t.level.exitLevel(),t.level=e,t.level.enterLevel()},this.changeLevelThroughLadder=function(e){t.levelState=r.TRANSITIONING_LADDER,t.transitionStartTime=Date.now(),t.transitioningLadder=e},this.changeLevelThroughDoor=function(e,n){t.levelState=r.TRANSITIONING,t.transitionStartTime=Date.now(),t.transitionX=t.player.x,t.transitionY=t.player.y,t.prevLevel=t.level,t.level.exitLevel(),t.level=e.level,t.level.enterLevelThroughDoor(e,n),t.transitionX=(t.player.x-t.transitionX)*o.GameConstants.TILESIZE,t.transitionY=(t.player.y-t.transitionY)*o.GameConstants.TILESIZE,t.upwardTransition=!1,t.sideTransition=!1,t.sideTransitionDirection=n,e instanceof d.SideDoor?t.sideTransition=!0:e instanceof u.BottomDoor&&(t.upwardTransition=!0)},this.run=function(){t.update(),t.draw()},this.update=function(){c.Input.checkIsTapHold(),0!==c.Input.lastPressTime&&Date.now()-c.Input.lastPressTime>o.GameConstants.KEY_REPEAT_TIME&&c.Input.onKeydown({repeat:!1,code:c.Input.lastPressKeyCode}),t.levelState===r.TRANSITIONING&&Date.now()-t.transitionStartTime>=l.LevelConstants.LEVEL_TRANSITION_TIME&&(t.levelState=r.IN_LEVEL),t.levelState===r.TRANSITIONING_LADDER&&Date.now()-t.transitionStartTime>=l.LevelConstants.LEVEL_TRANSITION_TIME_LADDER&&(t.levelState=r.IN_LEVEL),t.player.update(),t.level.update()},this.lerp=function(e,t,n){return(1-n)*e+n*t},this.onResize=function(){var t=Math.floor(window.innerWidth/o.GameConstants.DEFAULTWIDTH),n=Math.floor(window.innerHeight/o.GameConstants.DEFAULTHEIGHT);e.scale=Math.min(t,n),0===e.scale&&(t=window.innerWidth/o.GameConstants.DEFAULTWIDTH,n=window.innerHeight/o.GameConstants.DEFAULTHEIGHT),e.scale=Math.min(t,n),l.LevelConstants.SCREEN_W=Math.floor(window.innerWidth/e.scale/o.GameConstants.TILESIZE),l.LevelConstants.SCREEN_H=Math.floor(window.innerHeight/e.scale/o.GameConstants.TILESIZE),o.GameConstants.WIDTH=l.LevelConstants.SCREEN_W*o.GameConstants.TILESIZE,o.GameConstants.HEIGHT=l.LevelConstants.SCREEN_H*o.GameConstants.TILESIZE,e.ctx.canvas.setAttribute("width",""+o.GameConstants.WIDTH),e.ctx.canvas.setAttribute("height",""+o.GameConstants.HEIGHT),e.ctx.canvas.setAttribute("style","width: "+o.GameConstants.WIDTH*e.scale+"px; height: "+o.GameConstants.HEIGHT*e.scale+"px;\n    display: block;\n    margin: 0 auto;\n  \n    image-rendering: optimizeSpeed; /* Older versions of FF          */\n    image-rendering: -moz-crisp-edges; /* FF 6.0+                       */\n    image-rendering: -webkit-optimize-contrast; /* Safari                        */\n    image-rendering: -o-crisp-edges; /* OS X & Windows Opera (12.02+) */\n    image-rendering: pixelated; /* Awesome future-browsers       */\n  \n    -ms-interpolation-mode: nearest-neighbor;")},this.shakeScreen=function(e,n){t.screenShakeX=e,t.screenShakeY=n},this.draw=function(){if(e.ctx.globalAlpha=1,e.ctx.fillStyle=t.level.shadeColor,e.ctx.fillRect(0,0,o.GameConstants.WIDTH,o.GameConstants.HEIGHT),t.levelState===r.TRANSITIONING){var n=Math.floor(t.lerp((Date.now()-t.transitionStartTime)/l.LevelConstants.LEVEL_TRANSITION_TIME,0,-t.transitionX)),a=Math.floor(t.lerp((Date.now()-t.transitionStartTime)/l.LevelConstants.LEVEL_TRANSITION_TIME,0,-t.transitionY)),i=n-t.transitionX,s=a-t.transitionY,u=(t.player.x-t.player.drawX+.5)*o.GameConstants.TILESIZE,c=(t.player.y-t.player.drawY+.5)*o.GameConstants.TILESIZE;e.ctx.translate(-Math.round(u+i-.5*o.GameConstants.WIDTH),-Math.round(c+s-.5*o.GameConstants.HEIGHT));var d=Math.floor(t.lerp((Date.now()-t.transitionStartTime)/l.LevelConstants.LEVEL_TRANSITION_TIME,0,o.GameConstants.TILESIZE)),p=i,f=s;t.sideTransition?t.sideTransitionDirection>0?(n+=d,p+=d+o.GameConstants.TILESIZE):(n-=d,p-=d+o.GameConstants.TILESIZE):t.upwardTransition?(a-=d,f-=d+o.GameConstants.TILESIZE):(a+=d,f+=d+o.GameConstants.TILESIZE);var m=Math.floor(7*(Date.now()-t.transitionStartTime)/l.LevelConstants.LEVEL_TRANSITION_TIME);e.ctx.translate(n,a),t.prevLevel.draw(),t.prevLevel.drawEntitiesBehindPlayer(),t.prevLevel.drawEntitiesInFrontOfPlayer();for(var y=t.prevLevel.roomX-1;y<=t.prevLevel.roomX+t.prevLevel.width;y++)for(var v=t.prevLevel.roomY-1;v<=t.prevLevel.roomY+t.prevLevel.height;v++)e.drawFX(7-m,10,1,1,y,v,1,1);for(e.ctx.translate(-n,-a),e.ctx.translate(p,f),t.level.draw(),t.level.drawEntitiesBehindPlayer(),t.level.drawEntitiesInFrontOfPlayer(),y=t.level.roomX-1;y<=t.level.roomX+t.level.width;y++)for(v=t.level.roomY-1;v<=t.level.roomY+t.level.height;v++)e.drawFX(m,10,1,1,y,v,1,1);e.ctx.translate(-p,-f),e.ctx.translate(i,s),t.player.draw(),e.ctx.translate(-i,-s),e.ctx.translate(p,f),t.level.drawShade(),t.level.drawOverShade(),e.ctx.translate(-p,-f),e.ctx.translate(Math.round(u+i-.5*o.GameConstants.WIDTH),Math.round(c+s-.5*o.GameConstants.HEIGHT)),t.player.drawGUI(),t.player.updateDrawXY()}else if(t.levelState===r.TRANSITIONING_LADDER){if(u=(t.player.x-t.player.drawX+.5)*o.GameConstants.TILESIZE,c=(t.player.y-t.player.drawY+.5)*o.GameConstants.TILESIZE,e.ctx.translate(-Math.round(u-.5*o.GameConstants.WIDTH),-Math.round(c-.5*o.GameConstants.HEIGHT)),(m=Math.floor(20*(Date.now()-t.transitionStartTime)/l.LevelConstants.LEVEL_TRANSITION_TIME_LADDER))<7)for(t.level.draw(),t.level.drawEntitiesBehindPlayer(),t.player.draw(),t.level.drawEntitiesInFrontOfPlayer(),t.level.drawShade(),t.level.drawOverShade(),y=t.level.roomX-1;y<=t.level.roomX+t.level.width;y++)for(v=t.level.roomY-1;v<=t.level.roomY+t.level.height;v++)e.drawFX(7-m,10,1,1,y,v,1,1);else if(m>=13)for(t.transitioningLadder&&(t.prevLevel=t.level,t.level.exitLevel(),t.transitioningLadder instanceof h.DownLadder&&t.transitioningLadder.generate(),t.level=t.transitioningLadder.linkedLadder.level,t.level.enterLevelThroughLadder(t.transitioningLadder.linkedLadder),t.transitioningLadder=null),t.level.draw(),t.level.drawEntitiesBehindPlayer(),t.player.draw(),t.level.drawEntitiesInFrontOfPlayer(),t.level.drawShade(),t.level.drawOverShade(),y=t.level.roomX-1;y<=t.level.roomX+t.level.width;y++)for(v=t.level.roomY-1;v<=t.level.roomY+t.level.height;v++)e.drawFX(m-13,10,1,1,y,v,1,1);e.ctx.translate(Math.round(u-.5*o.GameConstants.WIDTH),Math.round(c-.5*o.GameConstants.HEIGHT)),t.player.drawGUI(),t.player.updateDrawXY()}else{t.screenShakeX*=-.8,t.screenShakeY*=-.8;var w=t.player.drawX,g=t.player.drawY;e.ctx.translate(-Math.round((t.player.x-w+.5)*o.GameConstants.TILESIZE-.5*o.GameConstants.WIDTH-t.screenShakeX),-Math.round((t.player.y-g+.5)*o.GameConstants.TILESIZE-.5*o.GameConstants.HEIGHT-t.screenShakeY)),t.level.draw(),t.level.drawEntitiesBehindPlayer(),t.player.draw(),t.level.drawEntitiesInFrontOfPlayer(),t.level.drawShade(),t.level.drawOverShade(),t.player.drawTopLayer(),e.ctx.translate(Math.round((t.player.x-w+.5)*o.GameConstants.TILESIZE-.5*o.GameConstants.WIDTH-t.screenShakeX),Math.round((t.player.y-g+.5)*o.GameConstants.TILESIZE-.5*o.GameConstants.HEIGHT-t.screenShakeY)),t.level.drawTopLayer(),t.player.drawGUI(),t.player.updateDrawXY()}e.ctx.globalAlpha=.1,e.ctx.fillStyle=l.LevelConstants.LEVEL_TEXT_COLOR,e.ctx.font=o.GameConstants.SCRIPT_FONT_SIZE+"px Script",e.ctx.textBaseline="top",e.fillText(o.GameConstants.VERSION,o.GameConstants.WIDTH-e.ctx.measureText(o.GameConstants.VERSION).width-1,-3),e.ctx.globalAlpha=1},this.drawSoftVis1x1=function(n,r,a,i,l,s,u,c,h){void 0===e.shImg&&(e.shImg=document.createElement("canvas"),e.shCtx=e.shImg.getContext("2d"),e.shImg.width=2*o.GameConstants.TILESIZE,e.shImg.height=2*o.GameConstants.TILESIZE),e.shCtx.clearRect(0,0,e.shImg.width,e.shImg.height),e.shCtx.globalCompositeOperation="source-over",e.shCtx.drawImage(n,Math.round(r*o.GameConstants.TILESIZE),Math.round(a*o.GameConstants.TILESIZE),Math.round(i*o.GameConstants.TILESIZE),Math.round(l*o.GameConstants.TILESIZE),0,0,o.GameConstants.TILESIZE,o.GameConstants.TILESIZE),e.shCtx.globalCompositeOperation="multiply",e.shCtx.fillStyle="black";for(var d=0;d<1;d+=.25)for(var p=0;p<1;p+=.25)e.shCtx.globalAlpha=(1-d)*(1-p)*.25*(t.level.softVis[c][h]+t.level.softVis[c-1][h]+t.level.softVis[c-1][h-1]+t.level.softVis[c][h-1])+d*(1-p)*.25*(t.level.softVis[c+1][h]+t.level.softVis[c][h]+t.level.softVis[c][h-1]+t.level.softVis[c+1][h-1])+(1-d)*p*.25*(t.level.softVis[c][h+1]+t.level.softVis[c-1][h+1]+t.level.softVis[c-1][h]+t.level.softVis[c][h])+d*p*.25*(t.level.softVis[c+1][h+1]+t.level.softVis[c][h+1]+t.level.softVis[c][h]+t.level.softVis[c+1][h]),e.shCtx.fillRect(d*o.GameConstants.TILESIZE,p*o.GameConstants.TILESIZE,.25*o.GameConstants.TILESIZE,.25*o.GameConstants.TILESIZE);e.shCtx.globalAlpha=1,e.shCtx.globalCompositeOperation="destination-in",e.shCtx.drawImage(n,Math.round(r*o.GameConstants.TILESIZE),Math.round(a*o.GameConstants.TILESIZE),Math.round(i*o.GameConstants.TILESIZE),Math.round(l*o.GameConstants.TILESIZE),0,0,o.GameConstants.TILESIZE,o.GameConstants.TILESIZE),e.ctx.drawImage(e.shImg,Math.round(s*o.GameConstants.TILESIZE),Math.round(u*o.GameConstants.TILESIZE))},window.addEventListener("load",(function(){var n=document.getElementById("gameCanvas");e.ctx=n.getContext("2d",{alpha:!1}),e.ctx.font=o.GameConstants.SCRIPT_FONT_SIZE+"px Script",e.ctx.textBaseline="top",e.tileset=new Image,e.tileset.src="res/tileset.png",e.objset=new Image,e.objset.src="res/objset.png",e.mobset=new Image,e.mobset.src="res/mobset.png",e.itemset=new Image,e.itemset.src="res/itemset.png",e.fxset=new Image,e.fxset.src="res/fxset.png",e.shopset=new Image,e.shopset.src="res/shopset.png",e.tilesetShadow=new Image,e.tilesetShadow.src="res/tilesetShadow.png",e.objsetShadow=new Image,e.objsetShadow.src="res/objsetShadow.png",e.mobsetShadow=new Image,e.mobsetShadow.src="res/mobsetShadow.png",e.scale=1,i.Sound.loadSounds(),i.Sound.playMusic(),t.player=new a.Player(t,0,0),t.levels=Array(),t.levelgen=new s.LevelGenerator,t.levelgen.generate(t,0),t.level=t.levels[0],t.level.enterLevel(),t.screenShakeX=0,t.screenShakeY=0,t.levelState=r.IN_LEVEL,setInterval(t.run,1e3/o.GameConstants.FPS),t.onResize(),window.addEventListener("resize",t.onResize),document.addEventListener("touchstart",(function(e){e.target==n&&e.preventDefault()}),!1),document.addEventListener("touchend",(function(e){e.target==n&&e.preventDefault()}),!1),document.addEventListener("touchmove",(function(e){e.target==n&&e.preventDefault()}),!1),document.addEventListener("touchstart",c.Input.handleTouchStart,{passive:!1}),document.addEventListener("touchmove",c.Input.handleTouchMove,{passive:!1}),document.addEventListener("touchend",c.Input.handleTouchEnd,{passive:!1})}))}return e.rand=function(e,t){return t<e?e:Math.floor(Math.random()*(t-e+1)+e)},e.randTable=function(t){return t[e.rand(0,t.length-1)]},e.fillText=function(t,n,r,o){e.ctx.fillText(t,Math.round(n),Math.round(r),o)},e.drawHelper=function(t,n,r,a,i,l,s,u,c,h,d){void 0===h&&(h="black"),void 0===d&&(d=0),d>0?(void 0===e.shImg&&(e.shImg=document.createElement("canvas"),e.shCtx=e.shImg.getContext("2d"),e.shImg.width=2*o.GameConstants.TILESIZE,e.shImg.height=2*o.GameConstants.TILESIZE),e.shCtx.clearRect(0,0,e.shImg.width,e.shImg.height),e.shCtx.globalCompositeOperation="source-over",e.shCtx.drawImage(t,Math.round(n*o.GameConstants.TILESIZE),Math.round(r*o.GameConstants.TILESIZE),Math.round(a*o.GameConstants.TILESIZE),Math.round(i*o.GameConstants.TILESIZE),0,0,Math.round(u*o.GameConstants.TILESIZE),Math.round(c*o.GameConstants.TILESIZE)),e.shCtx.globalAlpha=d,e.shCtx.fillStyle=h,e.shCtx.fillRect(0,0,e.shImg.width,e.shImg.height),e.shCtx.globalAlpha=1,e.shCtx.globalCompositeOperation="destination-in",e.shCtx.drawImage(t,Math.round(n*o.GameConstants.TILESIZE),Math.round(r*o.GameConstants.TILESIZE),Math.round(a*o.GameConstants.TILESIZE),Math.round(i*o.GameConstants.TILESIZE),0,0,Math.round(u*o.GameConstants.TILESIZE),Math.round(c*o.GameConstants.TILESIZE)),e.ctx.drawImage(e.shImg,Math.round(l*o.GameConstants.TILESIZE),Math.round(s*o.GameConstants.TILESIZE))):e.ctx.drawImage(t,Math.round(n*o.GameConstants.TILESIZE),Math.round(r*o.GameConstants.TILESIZE),Math.round(a*o.GameConstants.TILESIZE),Math.round(i*o.GameConstants.TILESIZE),Math.round(l*o.GameConstants.TILESIZE),Math.round(s*o.GameConstants.TILESIZE),Math.round(u*o.GameConstants.TILESIZE),Math.round(c*o.GameConstants.TILESIZE))},e.drawTile=function(t,n,r,a,i,l,s,u,c,h){void 0===c&&(c="black"),void 0===h&&(h=0),e.ctx.drawImage(e.tileset,Math.round(t*o.GameConstants.TILESIZE),Math.round(n*o.GameConstants.TILESIZE),Math.round(r*o.GameConstants.TILESIZE),Math.round(a*o.GameConstants.TILESIZE),Math.round(i*o.GameConstants.TILESIZE),Math.round(l*o.GameConstants.TILESIZE),Math.round(s*o.GameConstants.TILESIZE),Math.round(u*o.GameConstants.TILESIZE)),e.ctx.globalAlpha=h,e.ctx.fillStyle=c,e.ctx.fillRect(Math.round(i*o.GameConstants.TILESIZE),Math.round(l*o.GameConstants.TILESIZE),Math.round(s*o.GameConstants.TILESIZE),Math.round(u*o.GameConstants.TILESIZE)),e.ctx.globalAlpha=1},e.drawObj=function(t,n,r,o,a,i,l,s,u,c){void 0===u&&(u="black"),void 0===c&&(c=0),e.drawHelper(e.objset,t,n,r,o,a,i,l,s,u,c)},e.drawMob=function(t,n,r,o,a,i,l,s,u,c){void 0===u&&(u="black"),void 0===c&&(c=0),e.drawHelper(e.mobset,t,n,r,o,a,i,l,s,u,c)},e.drawShop=function(t,n,r,a,i,l,s,u){e.ctx.drawImage(e.shopset,Math.round(t*o.GameConstants.TILESIZE),Math.round(n*o.GameConstants.TILESIZE),Math.round(r*o.GameConstants.TILESIZE),Math.round(a*o.GameConstants.TILESIZE),Math.round(i*o.GameConstants.TILESIZE),Math.round(l*o.GameConstants.TILESIZE),Math.round(s*o.GameConstants.TILESIZE),Math.round(u*o.GameConstants.TILESIZE))},e.drawItem=function(t,n,r,o,a,i,l,s,u,c){void 0===u&&(u="black"),void 0===c&&(c=0),e.drawHelper(e.itemset,t,n,r,o,a,i,l,s,u,c)},e.drawFX=function(t,n,r,o,a,i,l,s,u,c){void 0===u&&(u="black"),void 0===c&&(c=0),e.drawHelper(e.fxset,t,n,r,o,a,i,l,s,u,c)},e}();t.Game=p,new p},988:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GameConstants=void 0;var r=n(5742),o=function(){function e(){}return e.VERSION="v0.4.10",e.FPS=60,e.TILESIZE=16,e.SCALE=2,e.SWIPE_THRESH=Math.pow(50,2),e.KEY_REPEAT_TIME=300,e.DEFAULTWIDTH=8.5*e.TILESIZE,e.DEFAULTHEIGHT=8.5*e.TILESIZE,e.WIDTH=r.LevelConstants.SCREEN_W*e.TILESIZE,e.HEIGHT=r.LevelConstants.SCREEN_H*e.TILESIZE,e.scrolling=!0,e.SCRIPT_FONT_SIZE=16,e.FONT_SIZE=10,e.BIG_FONT_SIZE=20,e.RED="#ac3232",e.GREEN="#6abe30",e.ARMOR_GREY="#9badb7",e.OUTLINE="#222034",e.HIT_ENEMY_TEXT_COLOR="#76428a",e.HEALTH_BUFF_COLOR="#d77bba",e.MISS_COLOR="#639bff",e}();t.GameConstants=o},3338:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HealthBar=void 0;var r=n(2967),o=n(5742);t.HealthBar=function(){var e=this;this.hurt=function(){e.hurtTimer=Date.now()},this.draw=function(t,n,a,i,l){var s=Date.now()-e.hurtTimer;if(s<=o.LevelConstants.HEALTH_BAR_TOTALTIME)for(var u=Math.floor(t),c=Math.ceil(t-u),h=Math.round(Math.min(9,Math.min(.05*(o.LevelConstants.HEALTH_BAR_TOTALTIME-s),.05*s))),d=Math.round(16*Math.min(.5,Math.min(.003*(o.LevelConstants.HEALTH_BAR_TOTALTIME-s),.003*s)))/16,p=.5+-(h*(n-1)+8)/16/2,f=0;f<Math.ceil(.5*n);f++){var m;m=l?f<u?0:f<u+c?.5:1:1.5;var y=h*f/16+p;r.Game.drawFX(m,8,.5,.5,a+y,i-1-d/2,.5,d),y+=9/16;var v=n-f-1;if(v!==f){var w;w=l?v<u?0:v<u+c?.5:1:1.5;var g=h*v/16+p;r.Game.drawFX(w,8,.5,.5,a+g,i-1-d/2,.5,d),g+=9/16}}},this.hurtTimer=0}},8835:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Input=void 0;var r=n(988),o=n(2967);t.Input={_pressed:{},isTapHold:!1,tapStartTime:null,IS_TAP_HOLD_THRESH:100,iListener:function(){},iUpListener:function(){},mListener:function(){},mUpListener:function(){},qListener:function(){},qUpListener:function(){},leftListener:function(){},rightListener:function(){},upListener:function(){},downListener:function(){},spaceListener:function(){},leftSwipeListener:function(){},rightSwipeListener:function(){},upSwipeListener:function(){},downSwipeListener:function(){},tapListener:function(){},mouseLeftClickListeners:[],mouseLeftClickListener:function(e,n){for(var r=0;r<t.Input.mouseLeftClickListeners.length;r++)t.Input.mouseLeftClickListeners[r](e,n)},mouseX:0,mouseY:0,lastPressTime:0,lastPressKeyCode:"",SPACE:"Space",LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown",W:"KeyW",A:"KeyA",S:"KeyS",D:"KeyD",M:"KeyM",N:"KeyN",I:"KeyI",Q:"KeyQ",isDown:function(e){return this._pressed[e]},onKeydown:function(e){if(!e.repeat)switch(t.Input.lastPressTime=Date.now(),t.Input.lastPressKeyCode=e.code,t.Input._pressed[e.code]=!0,e.code){case t.Input.A:case t.Input.LEFT:t.Input.leftListener();break;case t.Input.D:case t.Input.RIGHT:t.Input.rightListener();break;case t.Input.W:case t.Input.UP:t.Input.upListener();break;case t.Input.S:case t.Input.DOWN:t.Input.downListener();break;case t.Input.SPACE:t.Input.spaceListener();break;case t.Input.M:t.Input.mListener();break;case t.Input.I:t.Input.iListener();break;case t.Input.Q:t.Input.qListener()}},onKeyup:function(e){delete this._pressed[e.code],e.code===this.lastPressKeyCode&&(this.lastPressTime=0,this.lastPressKeyCode=0),e.code===t.Input.M&&t.Input.mUpListener(),e.code===t.Input.I&&t.Input.iUpListener(),e.code===t.Input.Q&&t.Input.qUpListener()},mouseClickListener:function(e){if(0===e.button){var n=window.document.getElementById("gameCanvas").getBoundingClientRect(),r=e.clientX-n.left,a=e.clientY-n.top;t.Input.mouseLeftClickListener(Math.floor(r/o.Game.scale),Math.floor(a/o.Game.scale))}},updateMousePos:function(e){var n=window.document.getElementById("gameCanvas").getBoundingClientRect(),r=e.clientX-n.left,a=e.clientY-n.top;t.Input.mouseX=Math.floor(r/o.Game.scale),t.Input.mouseY=Math.floor(a/o.Game.scale)},getTouches:function(e){return e.touches||e.originalEvent.touches},xDown:null,yDown:null,currentX:0,currentY:0,swiped:!1,handleTouchStart:function(e){e.preventDefault();var n=t.Input.getTouches(e)[0];t.Input.xDown=n.clientX,t.Input.yDown=n.clientY,t.Input.currentX=n.clientX,t.Input.currentY=n.clientY,t.Input.tapStartTime=Date.now(),t.Input.updateMousePos({clientX:t.Input.currentX,clientY:t.Input.currentY}),t.Input.swiped=!1},handleTouchMove:function(e){if(e.preventDefault(),t.Input.currentX=e.touches[0].clientX,t.Input.currentY=e.touches[0].clientY,t.Input.updateMousePos({clientX:t.Input.currentX,clientY:t.Input.currentY}),!t.Input.swiped){var n=t.Input.xDown-t.Input.currentX,o=t.Input.yDown-t.Input.currentY;Math.pow(n,2)+Math.pow(o,2)>=r.GameConstants.SWIPE_THRESH&&(Math.abs(n)>Math.abs(o)?(n>0?t.Input.leftSwipeListener():t.Input.rightSwipeListener(),t.Input.swiped=!0):(o>0?t.Input.upSwipeListener():t.Input.downSwipeListener(),t.Input.swiped=!0))}},handleTouchEnd:function(e){e.preventDefault(),t.Input.isTapHold||t.Input.swiped||t.Input.tapListener(),t.Input.isTapHold=!1,t.Input.tapStartTime=null,t.Input.swiped||(t.Input.mouseClickListener({button:0,clientX:t.Input.currentX,clientY:t.Input.currentY}),t.Input.updateMousePos({clientX:0,clientY:0}))},checkIsTapHold:function(){null!==t.Input.tapStartTime&&Date.now()>=t.Input.tapStartTime+t.Input.IS_TAP_HOLD_THRESH&&(t.Input.isTapHold=!0)}},window.addEventListener("keyup",(function(e){t.Input.onKeyup(e)}),!1),window.addEventListener("keydown",(function(e){t.Input.onKeydown(e)}),!1),window.document.getElementById("gameCanvas").addEventListener("click",(function(e){return t.Input.mouseClickListener(e)}),!1),window.document.getElementById("gameCanvas").addEventListener("mousemove",(function(e){return t.Input.updateMousePos(e)}))},7531:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Inventory=void 0;var r=n(5742),o=n(2967),a=n(988),i=n(8499),l=n(8573),s=n(1978),u=n(2091),c=n(6330),h=n(1802),d=n(1656),p=n(2920),f=n(1173),m=n(5895),y=n(282),v="#5a595b",w="#292c36",g="#85a8e6";t.Inventory=function(e){var t=this;this.rows=2,this.cols=5,this.selX=0,this.selY=0,this.open=function(){t.isOpen=!t.isOpen,t.isOpen&&(t.openTime=Date.now())},this.close=function(){t.isOpen=!1},this.left=function(){t.selX--,t.selX<0&&(t.selX=0)},this.right=function(){t.selX++,t.selX>t.cols-1&&(t.selX=t.cols-1)},this.up=function(){t.selY--,t.selY<0&&(t.selY=0)},this.down=function(){t.selY++,t.selY>t.rows-1&&(t.selY=t.rows-1)},this.space=function(){var e=t.selX+t.selY*t.cols;if(t.items[e]instanceof h.Usable&&(t.items[e].onUse(t.game.player),t.items.splice(e,1)),t.items[e]instanceof i.Equippable){var n=t.items[e];if(n.toggleEquip(),n instanceof u.Weapon&&(n.equipped?t.weapon=n:t.weapon=null),n.equipped)for(var r=0,o=t.items;r<o.length;r++){var a=o[r];a instanceof i.Equippable&&a!==n&&!n.coEquippable(a)&&(a.equipped=!1)}t.equipped=t.items.filter((function(e){return e instanceof i.Equippable&&e.equipped}))}},this.drop=function(){var e=t.selX+t.selY*t.cols;t.items.splice(e,1)},this.hasItem=function(e){for(var n=0,r=t.items;n<r.length;n++){var o=r[n];if(o instanceof e)return o}return null},this.hasItemCount=function(e){if(e instanceof s.Coin)return t.coinCount()>=e.stackCount;for(var n=0,r=t.items;n<r.length;n++){var o=r[n];if(o.constructor===e.constructor&&o.stackCount>=e.stackCount)return!0}return!1},this.subtractItemCount=function(e){if(e instanceof s.Coin)t.subtractCoins(e.stackCount);else for(var n=0,r=t.items;n<r.length;n++){var o=r[n];o.constructor===e.constructor&&(o.stackCount-=e.stackCount,o.stackCount<=0&&t.items.splice(t.items.indexOf(o),1))}},this.coinCount=function(){return t.coins},this.subtractCoins=function(e){t.coins-=e,t.coins<0&&(t.coins=0)},this.addCoins=function(e){t.coins+=e},this.isFull=function(){return t.items.length>=t.rows*t.cols},this.addItem=function(e){if(e instanceof s.Coin)return t.coins+=1,!0;if(e.stackable)for(var n=0,r=t.items;n<r.length;n++){var o=r[n];if(o.constructor===e.constructor)return o.stackCount++,!0}return!t.isFull()&&(t.items.push(e),!0)},this.removeItem=function(e){var n=t.items.indexOf(e);-1!==n&&t.items.splice(n,1)},this.getArmor=function(){for(var e=0,n=t.equipped;e<n.length;e++){var r=n[e];if(r instanceof l.Armor)return r}return null},this.hasWeapon=function(){return null!==t.weapon},this.getWeapon=function(){return t.weapon},this.tick=function(){for(var e=0,n=t.items;e<n.length;e++)n[e].tickInInventory()},this.textWrap=function(e,t,n,r){for(var a=e.split(" "),i="";a.length>0;)o.Game.ctx.measureText(i+a[0]).width>r?(o.Game.fillText(i,t,n),i="",n+=10):(""!==i&&(i+=" "),i+=a[0],a.splice(0,1));return" "!==i&&(o.Game.fillText(i,t,n),n+=10),n},this.drawCoins=function(){var e=r.LevelConstants.SCREEN_W-1,n=r.LevelConstants.SCREEN_H-1;o.Game.drawItem(19,0,1,2,e,n-1,1,2);var i=""+t.coins,l=4-o.Game.ctx.measureText(i).width;o.Game.ctx.fillStyle="black";for(var s=-1;s<=1;s++)for(var u=-1;u<=1;u++)o.Game.ctx.fillStyle=a.GameConstants.OUTLINE,o.Game.fillText(i,e*a.GameConstants.TILESIZE+l+s,n*a.GameConstants.TILESIZE-1+u);o.Game.ctx.fillStyle="white",o.Game.fillText(i,e*a.GameConstants.TILESIZE+l,n*a.GameConstants.TILESIZE-1)},this.draw=function(){if(t.drawCoins(),t.isOpen){for(var e=0;e<t.equipAnimAmount.length;e++)t.items[e]instanceof i.Equippable&&(t.items[e].equipped?t.equipAnimAmount[e]+=.2*(1-t.equipAnimAmount[e]):t.equipAnimAmount[e]+=.2*(0-t.equipAnimAmount[e]));o.Game.ctx.fillStyle="rgb(0, 0, 0, 0.8)",o.Game.ctx.fillRect(0,0,a.GameConstants.WIDTH,a.GameConstants.HEIGHT),t.items=t.items.filter((function(e){return!e.dead})),o.Game.ctx.globalAlpha=1;var n=Math.min(18,18*(Date.now()-t.openTime)/100),r=-2,l=3+Math.round(.5*Math.sin(.01*Date.now())+.5),s=t.cols*(n+4+r)-r,u=t.rows*(n+4+r)-r;o.Game.ctx.fillStyle="white",o.Game.ctx.fillRect(Math.round(.5*a.GameConstants.WIDTH-.5*s)-1,Math.round(.5*a.GameConstants.HEIGHT-.5*u)-1,Math.round(s+2),Math.round(u+2)),o.Game.ctx.fillRect(Math.round(.5*a.GameConstants.WIDTH-.5*s+t.selX*(n+4+r))-l-1,Math.round(.5*a.GameConstants.HEIGHT-.5*u+t.selY*(n+4+r))-l-1,Math.round(n+4+2*l)+2,Math.round(n+4+2*l)+2);for(var c=0;c<t.cols;c++)for(var d=0;d<t.rows;d++){o.Game.ctx.fillStyle=w,o.Game.ctx.fillRect(Math.round(.5*a.GameConstants.WIDTH-.5*s+c*(n+4+r)),Math.round(.5*a.GameConstants.HEIGHT-.5*u+d*(n+4+r)),Math.round(n+4),Math.round(n+4)),o.Game.ctx.fillStyle=v,o.Game.ctx.fillRect(Math.round(.5*a.GameConstants.WIDTH-.5*s+c*(n+4+r)+2),Math.round(.5*a.GameConstants.HEIGHT-.5*u+d*(n+4+r)+2),Math.round(n),Math.round(n));var p=c+d*t.cols;o.Game.ctx.fillStyle=g;var f=n*(1-t.equipAnimAmount[p]);o.Game.ctx.fillRect(Math.round(.5*a.GameConstants.WIDTH-.5*s+c*(n+4+r)+2),Math.round(.5*a.GameConstants.HEIGHT-.5*u+d*(n+4+r)+2+f),Math.round(n),Math.round(n-f))}if(Date.now()-t.openTime>=100){for(var m=0;m<t.items.length;m++){c=m%t.cols,d=Math.floor(m/t.cols);var y=Math.round(.5*a.GameConstants.WIDTH-.5*s+c*(n+4+r)+2+Math.floor(.5*n)-.5*a.GameConstants.TILESIZE),_=Math.round(.5*a.GameConstants.HEIGHT-.5*u+d*(n+4+r)+2+Math.floor(.5*n)-.5*a.GameConstants.TILESIZE),T=y/a.GameConstants.TILESIZE,E=_/a.GameConstants.TILESIZE;t.items[m].drawIcon(T,E)}o.Game.ctx.fillStyle=w,o.Game.ctx.fillRect(Math.round(.5*a.GameConstants.WIDTH-.5*s+t.selX*(n+4+r))-l,Math.round(.5*a.GameConstants.HEIGHT-.5*u+t.selY*(n+4+r))-l,Math.round(n+4+2*l),Math.round(n+4+2*l)),o.Game.ctx.fillStyle=v,o.Game.ctx.fillRect(Math.round(.5*a.GameConstants.WIDTH-.5*s+t.selX*(n+4+r)+2-l),Math.round(.5*a.GameConstants.HEIGHT-.5*u+t.selY*(n+4+r)+2-l),Math.round(n+2*l),Math.round(n+2*l));var x=t.selX+t.selY*t.cols;o.Game.ctx.fillStyle=g,f=(n+2*l)*(1-t.equipAnimAmount[x]),o.Game.ctx.fillRect(Math.round(.5*a.GameConstants.WIDTH-.5*s+t.selX*(n+4+r)+2-l),Math.round(.5*a.GameConstants.HEIGHT-.5*u+t.selY*(n+4+r)+2-l+f),Math.round(n+2*l),Math.round(n+2*l-f));var I=Math.round(.5*a.GameConstants.WIDTH-.5*s+t.selX*(n+4+r)+2+Math.floor(.5*n)-.5*a.GameConstants.TILESIZE),b=Math.round(.5*a.GameConstants.HEIGHT-.5*u+t.selY*(n+4+r)+2+Math.floor(.5*n)-.5*a.GameConstants.TILESIZE),G=I/a.GameConstants.TILESIZE,O=b/a.GameConstants.TILESIZE;x<t.items.length&&t.items[x].drawIcon(G,O)}var S=t.selX+t.selY*t.cols;if(S<t.items.length){o.Game.ctx.font=a.GameConstants.SCRIPT_FONT_SIZE+"px Script",o.Game.ctx.fillStyle="white";var C="";t.items[S]instanceof i.Equippable&&(C="[SPACE] to equip",t.items[S].equipped&&(C="[SPACE] to de-equip")),t.items[S]instanceof h.Usable&&(C="[SPACE] to use"),o.Game.ctx.font=a.GameConstants.SCRIPT_FONT_SIZE+"px Script",o.Game.ctx.fillStyle="white";var A=o.Game.ctx.measureText(C).width;o.Game.fillText(C,.5*(a.GameConstants.WIDTH-A),5);for(var L=t.items[S].getDescription().split("\n"),M=Math.round(.5*a.GameConstants.HEIGHT-.5*u+t.rows*(n+4+r)+2+2),P=0;P<L.length;P++)M=t.textWrap(L[P],5,M,a.GameConstants.WIDTH-5);o.Game.ctx.font=a.GameConstants.SCRIPT_FONT_SIZE+"px Script"}}},this.game=e,this.items=new Array,this.equipped=new Array,this.equipAnimAmount=[];for(var n=0;n<this.rows*this.cols;n++)this.equipAnimAmount[n]=0;this.coins=0,this.openTime=Date.now(),this.weapon=null,this.addItem(new c.Dagger({game:this.game},0,0)),this.addItem(new d.Shotgun({game:this.game},0,0)),this.addItem(new l.Armor({game:this.game},0,0)),this.addItem(new p.DualDagger({game:this.game},0,0)),this.addItem(new f.Candle({game:this.game},0,0)),this.addItem(new m.Torch({game:this.game},0,0)),this.addItem(new y.Lantern({game:this.game},0,0))}},8573:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Armor=void 0;var a=n(2967),i=n(5742),l=function(e){function t(n,r,o){var l=e.call(this,n,r,o)||this;return l.RECHARGE_TURNS=15,l.coEquippable=function(e){return!(e instanceof t)},l.getDescription=function(){return"ENCHANTED ARMOR\nA magic suit of armor. Absorbs one hit and regenerates after "+l.RECHARGE_TURNS+" turns."},l.tickInInventory=function(){l.rechargeTurnCounter>0&&(l.rechargeTurnCounter--,0===l.rechargeTurnCounter&&(l.rechargeTurnCounter=-1,l.health=1))},l.hurt=function(e){l.health<=0||(l.health-=e,l.rechargeTurnCounter=l.RECHARGE_TURNS+1)},l.drawGUI=function(e){-1===l.rechargeTurnCounter?a.Game.drawFX(5,2,1,1,e,i.LevelConstants.SCREEN_H-1,1,1):1-l.rechargeTurnCounter/l.RECHARGE_TURNS<.5?a.Game.drawFX(7,2,1,1,e,i.LevelConstants.SCREEN_H-1,1,1):a.Game.drawFX(8,2,1,1,e,i.LevelConstants.SCREEN_H-1,1,1)},l.health=1,l.rechargeTurnCounter=-1,l.tileX=5,l.tileY=0,l}return o(t,e),t}(n(8499).Equippable);t.Armor=l},8414:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.BlueGem=void 0;var a=function(e){function t(t,n,r){var o=e.call(this,t,n,r)||this;return o.getDescription=function(){return"SAPPHIRE"},o.tileX=13,o.tileY=0,o.stackable=!0,o}return o(t,e),t}(n(5234).Item);t.BlueGem=a},1173:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Candle=void 0;var a=n(8499),i=n(5895),l=n(282),s=function(e){function t(n,r,o){var a=e.call(this,n,r,o)||this;return a.coEquippable=function(e){return!(e instanceof t||e instanceof i.Torch||e instanceof l.Lantern)},a.toggleEquip=function(){a.equipped=!a.equipped,a.equipped?a.level.game.player.sightRadius=9:a.level.game.player.sightRadius=a.level.game.player.defaultSightRadius},a.getDescription=function(){return"CANDLE"},a.tileX=27,a.tileY=0,a}return o(t,e),t}(a.Equippable);t.Candle=s},9809:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Coal=void 0;var a=function(e){function t(t,n,r){var o=e.call(this,t,n,r)||this;return o.getDescription=function(){return"COAL\nA lump of coal."},o.tileX=17,o.tileY=0,o.stackable=!0,o}return o(t,e),t}(n(5234).Item);t.Coal=a},1978:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Coin=void 0;var a=n(5234),i=n(5958),l=function(e){function t(t,n,r){var o=e.call(this,t,n,r)||this;return o.pickupSound=function(){i.Sound.pickupCoin()},o.tileX=19,o.tileY=0,o.stackable=!0,o}return o(t,e),t}(a.Item);t.Coin=l},8499:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Equippable=void 0;var a=n(5234),i=n(2967),l=function(e){function t(t,n,r){var o=e.call(this,t,n,r)||this;return o.coEquippable=function(e){return!0},o.toggleEquip=function(){o.equipped=!o.equipped},o.drawEquipped=function(e,t){i.Game.drawItem(o.tileX,o.tileY,1,2,e,t-1,o.w,o.h)},o.equipped=!1,o}return o(t,e),t}(a.Item);t.Equippable=l},9825:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Gold=void 0;var a=function(e){function t(t,n,r){var o=e.call(this,t,n,r)||this;return o.getDescription=function(){return"GOLD\nA nugget of gold."},o.tileX=18,o.tileY=0,o.stackable=!0,o}return o(t,e),t}(n(5234).Item);t.Gold=a},1348:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.GoldenKey=void 0;var a=function(e){function t(t,n,r){var o=e.call(this,t,n,r)||this;return o.getDescription=function(){return"GOLD KEY\nA heavy gold key."},o.tileX=6,o.tileY=0,o}return o(t,e),t}(n(8499).Equippable);t.GoldenKey=a},7975:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.GreenGem=void 0;var a=function(e){function t(t,n,r){var o=e.call(this,t,n,r)||this;return o.getDescription=function(){return"EMERALD"},o.tileX=11,o.tileY=0,o.stackable=!0,o}return o(t,e),t}(n(5234).Item);t.GreenGem=a},6309:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Heart=void 0;var a=n(5958),i=function(e){function t(t,n,r){var o=e.call(this,t,n,r)||this;return o.onUse=function(e){e.health=Math.min(e.maxHealth,e.health+1),a.Sound.heal(),o.level.items=o.level.items.filter((function(e){return e!==o}))},o.getDescription=function(){return"HEALTH POTION\nRestores 1 heart"},o.tileX=8,o.tileY=0,o.offsetY=0,o}return o(t,e),t}(n(1802).Usable);t.Heart=i},5234:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Item=void 0;var a=n(2967),i=n(988),l=n(5958),s=function(e){function t(t,n,r){var o=e.call(this)||this;return o.tick=function(){},o.tickInInventory=function(){},o.getDescription=function(){return""},o.pickupSound=function(){l.Sound.genericPickup()},o.onPickup=function(e){o.pickedUp||(o.pickedUp=e.inventory.addItem(o),o.pickedUp&&o.pickupSound())},o.shadeAmount=function(){return o.level.softVis[o.x][o.y]},o.draw=function(){o.pickedUp||(o.scaleFactor<1?o.scaleFactor+=.04:o.scaleFactor=1,a.Game.drawItem(0,0,1,1,o.x,o.y,1,1),o.frame+=2*Math.PI/60,a.Game.drawItem(o.tileX,o.tileY,1,2,o.x+o.w*(-.5*o.scaleFactor+.5),o.y+.07*Math.sin(o.frame)-1+o.offsetY+o.h*(-.5*o.scaleFactor+.5),o.w*o.scaleFactor,o.h*o.scaleFactor,o.level.shadeColor,o.shadeAmount()))},o.drawTopLayer=function(){o.pickedUp&&(o.y-=.125,o.alpha-=.03,o.y<-1&&(o.level.items=o.level.items.filter((function(e){return e!==o}))),a.Game.ctx.globalAlpha=Math.max(0,o.alpha),a.Game.drawItem(o.tileX,o.tileY,1,2,o.x,o.y-1,o.w,o.h),a.Game.ctx.globalAlpha=1)},o.drawIcon=function(e,t,n){void 0===n&&(n=1),a.Game.ctx.globalAlpha=n,a.Game.drawItem(o.tileX,o.tileY,1,2,e,t-1,o.w,o.h),a.Game.ctx.globalAlpha=1;var r=o.stackCount<=1?"":""+o.stackCount,l=17-a.Game.ctx.measureText(r).width;a.Game.ctx.fillStyle="black";for(var s=-1;s<=1;s++)for(var u=-1;u<=1;u++)a.Game.ctx.fillStyle=i.GameConstants.OUTLINE,a.Game.fillText(r,e*i.GameConstants.TILESIZE+l+s,t*i.GameConstants.TILESIZE+4+u);a.Game.ctx.fillStyle="white",a.Game.fillText(r,e*i.GameConstants.TILESIZE+l,t*i.GameConstants.TILESIZE+4)},o.level=t,o.x=n,o.y=r,o.drawableY=r,o.w=1,o.h=2,o.tileX=0,o.tileY=0,o.frame=0,o.dead=!1,o.stackable=!1,o.stackCount=1,o.pickedUp=!1,o.alpha=1,o.scaleFactor=.2,o.offsetY=-.25,o}return o(t,e),t}(n(6779).Drawable);t.Item=s},1785:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Key=void 0;var a=function(e){function t(t,n,r){var o=e.call(this,t,n,r)||this;return o.getDescription=function(){return"KEY\nAn iron key."},o.tileX=1,o.tileY=0,o}return o(t,e),t}(n(8499).Equippable);t.Key=a},282:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Lantern=void 0;var a=n(8499),i=n(1173),l=n(5895),s=function(e){function t(n,r,o){var a=e.call(this,n,r,o)||this;return a.coEquippable=function(e){return!(e instanceof i.Candle||e instanceof l.Torch||e instanceof t)},a.toggleEquip=function(){a.equipped=!a.equipped,a.equipped?a.level.game.player.sightRadius=20:a.level.game.player.sightRadius=a.level.game.player.defaultSightRadius},a.getDescription=function(){return"LANTERN"},a.tileX=29,a.tileY=0,a}return o(t,e),t}(a.Equippable);t.Lantern=s},5043:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.RedGem=void 0;var a=function(e){function t(t,n,r){var o=e.call(this,t,n,r)||this;return o.getDescription=function(){return"RUBY"},o.tileX=12,o.tileY=0,o.stackable=!0,o}return o(t,e),t}(n(5234).Item);t.RedGem=a},5895:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Torch=void 0;var a=n(8499),i=n(1173),l=n(282),s=function(e){function t(n,r,o){var a=e.call(this,n,r,o)||this;return a.coEquippable=function(e){return!(e instanceof i.Candle||e instanceof t||e instanceof l.Lantern)},a.toggleEquip=function(){a.equipped=!a.equipped,a.equipped?a.level.game.player.sightRadius=12:a.level.game.player.sightRadius=a.level.game.player.defaultSightRadius},a.getDescription=function(){return"TORCH"},a.tileX=28,a.tileY=0,a}return o(t,e),t}(a.Equippable);t.Torch=s},1802:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Usable=void 0;var a=n(5234),i=n(5958),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onUse=function(e){e.health=Math.min(e.maxHealth,e.health+1),i.Sound.heal()},t}return o(t,e),t}(a.Item);t.Usable=l},3161:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Level=t.TurnState=t.RoomType=void 0;var r,o,a=n(312),i=n(5742),l=n(9626),s=n(2967),u=n(9143),c=n(5654),h=n(9732),d=n(1384),p=n(3441),f=n(1272),m=n(516),y=n(1348),v=n(953),w=n(5525),g=n(988),_=n(5397),T=n(8498),E=n(6750),x=n(6061),I=n(8573),b=n(3280),G=n(8341),O=n(5990),S=n(9670),C=n(7149),A=n(850),L=n(8084),M=n(6563),P=n(9382),k=n(8365),R=n(5377),D=n(9379),j=n(1902),X=n(1241),Y=n(6945),N=n(3400),H=n(2725),F=n(1656),W=n(6309),U=n(3806),Z=n(6882);!function(e){e[e.DUNGEON=0]="DUNGEON",e[e.BIGDUNGEON=1]="BIGDUNGEON",e[e.TREASURE=2]="TREASURE",e[e.FOUNTAIN=3]="FOUNTAIN",e[e.COFFIN=4]="COFFIN",e[e.GRASS=5]="GRASS",e[e.PUZZLE=6]="PUZZLE",e[e.KEYROOM=7]="KEYROOM",e[e.CHESSBOARD=8]="CHESSBOARD",e[e.MAZE=9]="MAZE",e[e.CORRIDOR=10]="CORRIDOR",e[e.SPIKECORRIDOR=11]="SPIKECORRIDOR",e[e.UPLADDER=12]="UPLADDER",e[e.DOWNLADDER=13]="DOWNLADDER",e[e.SHOP=14]="SHOP",e[e.BIGCAVE=15]="BIGCAVE",e[e.CAVE=16]="CAVE",e[e.SPAWNER=17]="SPAWNER",e[e.ROPEHOLE=18]="ROPEHOLE",e[e.ROPECAVE=19]="ROPECAVE"}(r=t.RoomType||(t.RoomType={})),function(e){e[e.playerTurn=0]="playerTurn",e[e.computerTurn=1]="computerTurn"}(o=t.TurnState||(t.TurnState={}));var V=function(){function e(e,t,n,h,p,m,v,w){var _=this;this.shadeColor="black",this.tileInside=function(e,t){return _.pointInside(e,t,_.roomX,_.roomY,_.width,_.height)},this.generateDungeon=function(){_.skin=d.SkinType.DUNGEON;var e=s.Game.rand(1,36);_.buildEmptyRoom(),e<30&&_.addWallBlocks(),e<26&&_.addFingers(),e%4==0&&_.addChasms(),_.fixWalls(),_.addTorches(s.Game.randTable([0,0,0,1,1,2,2,3,4])),e%3==0&&_.addPlants(s.Game.randTable([0,0,0,0,0,1,1,2,2,3,4])),e>15&&_.addSpikeTraps(s.Game.randTable([0,0,0,1,1,2,5]));var t=_.getEmptyTiles().length,n=Math.ceil(t*(.25*_.depth+.5)*s.Game.randTable([.01,.05,.05,.06,.07,.1]));_.addEnemies(n),n>0?_.addObstacles(n/s.Game.rand(1,2)):_.addObstacles(s.Game.randTable([0,0,1,1,2,3,5]))},this.generateBigDungeon=function(){_.skin=d.SkinType.DUNGEON,_.buildEmptyRoom(),1===s.Game.rand(1,4)&&_.addChasms(),_.fixWalls(),_.addTorches(s.Game.randTable([0,0,0,1,1,2,2,3,4])),1===s.Game.rand(1,4)&&_.addPlants(s.Game.randTable([0,0,0,0,0,1,1,2,2,3,4])),1===s.Game.rand(1,3)&&_.addSpikeTraps(s.Game.randTable([3,5,7,8]));var e=_.getEmptyTiles().length,t=Math.ceil(e*(.5*_.depth+.5)*s.Game.randTable([.05,.05,.06,.07,.1]));_.addEnemies(t),t>0?_.addObstacles(t/s.Game.rand(1,2)):_.addObstacles(s.Game.randTable([0,0,1,1,2,3,5]))},this.generateSpawner=function(){_.skin=d.SkinType.DUNGEON,_.buildEmptyRoom(),_.fixWalls(),_.addTorches(s.Game.randTable([0,0,0,1,1,2,2,3,4])),_.enemies.push(new X.Spawner(_,_.game,Math.floor(_.roomX+_.width/2),Math.floor(_.roomY+_.height/2)))},this.generateKeyRoom=function(){_.skin=d.SkinType.DUNGEON,_.buildEmptyRoom(),_.fixWalls(),_.addTorches(s.Game.randTable([0,0,0,1,1,2,2,3,4])),_.items.push(new y.GoldenKey(_,Math.floor(_.roomX+_.width/2),Math.floor(_.roomY+_.height/2)))},this.generateFountain=function(){_.skin=d.SkinType.DUNGEON,_.buildEmptyRoom(),_.fixWalls(),_.addTorches(s.Game.randTable([0,0,0,1,1,2,2,3,4]));for(var e=Math.floor(_.roomX+_.width/2),t=Math.floor(_.roomY+_.height/2),n=e-1;n<=e+1;n++)for(var r=t-1;r<=t+1;r++)_.levelArray[n][r]=new G.FountainTile(_,n,r,n-(e-1),r-(t-1));_.addPlants(s.Game.randTable([0,0,1,2]))},this.placeCoffin=function(e,t){_.levelArray[e][t]=new O.CoffinTile(_,e,t,0),_.levelArray[e][t+1]=new O.CoffinTile(_,e,t+1,1)},this.generateCoffin=function(){_.skin=d.SkinType.DUNGEON,_.buildEmptyRoom(),_.fixWalls(),_.addTorches(s.Game.randTable([0,0,0,1,1,2,2,3,4])),_.placeCoffin(Math.floor(_.roomX+_.width/2-2),Math.floor(_.roomY+_.height/2)),_.placeCoffin(Math.floor(_.roomX+_.width/2),Math.floor(_.roomY+_.height/2)),_.placeCoffin(Math.floor(_.roomX+_.width/2)+2,Math.floor(_.roomY+_.height/2))},this.generatePuzzle=function(){var e;_.skin=d.SkinType.DUNGEON,_.buildEmptyRoom();for(var t=_.roomX;t<_.roomX+_.width;t++){var n=_.roomY+Math.floor(_.height/2);t===_.roomX+Math.floor(_.width/2)?(e=new C.InsideLevelDoor(_,_.game,t,n+1),_.levelArray[t][n+1]=e):_.levelArray[t][n]=new a.Wall(_,t,n,0)}var r=s.Game.rand(_.roomX,_.roomX+_.width-1),o=s.Game.rand(_.roomY+Math.floor(_.height/2)+3,_.roomY+_.height-2);_.levelArray[r][o]=new A.Button(_,r,o,e);for(var i=_.getEmptyMiddleTiles().filter((function(e){return e.x>=_.roomX+1&&e.x<=_.roomX+_.width-2&&e.y>=_.roomY+Math.floor(_.height/2)+3&&e.y<=_.roomY+_.height-2})),l=s.Game.randTable([1,2,2,3,4]),u=0;u<l;u++){var c=i.splice(s.Game.rand(0,i.length-1),1)[0];_.enemies.push(new x.Crate(_,_.game,c.x,c.y))}_.fixWalls(),_.addPlants(s.Game.randTable([0,0,0,0,0,1,1,2,2,3,4]))},this.generateSpikeCorridor=function(){_.skin=d.SkinType.DUNGEON,_.buildEmptyRoom();for(var e=_.roomX;e<_.roomX+_.width;e++)for(var t=_.roomY+1;t<_.roomY+_.height-1;t++)_.levelArray[e][t]=new b.SpikeTrap(_,e,t,s.Game.rand(0,3));_.fixWalls(),_.addTorches(s.Game.randTable([0,0,0,1,1,2,2,3,4]))},this.generateTreasure=function(){_.skin=d.SkinType.DUNGEON,_.buildEmptyRoom(),_.addWallBlocks(),_.fixWalls(),_.addTorches(s.Game.randTable([0,1,1,2,2,3,4])),_.addChests(s.Game.randTable([3,4,4,4,4,4,4,5,5,5,6])),_.addPlants(s.Game.randTable([0,1,2,4,5,6]))},this.generateChessboard=function(){_.skin=d.SkinType.DUNGEON,_.buildEmptyRoom(),_.fixWalls()},this.generateCave=function(){_.skin=d.SkinType.CAVE;var e=s.Game.rand(1,36);_.buildEmptyRoom(),e<30&&_.addWallBlocks(),e<26&&_.addFingers(),e%4==0&&_.addChasms(),_.fixWalls(),e>15&&_.addSpikeTraps(s.Game.randTable([0,0,0,1,1,2,5]));var t=_.getEmptyTiles().length,n=Math.ceil(t*(.2*_.depth+.5)*s.Game.randTable([.03,.04,.06,.07,.08]));_.addEnemies(n),_.addResources(s.Game.randTable([1,2,2,3,4,4,5,6,6,7,7,7,8,8,9,10,11,12]))},this.generateUpLadder=function(){_.skin=d.SkinType.DUNGEON,_.buildEmptyRoom(),_.fixWalls(),_.addTorches(s.Game.randTable([0,0,0,1,1,2,2]));var e=Math.floor(_.roomX+_.width/2),t=Math.floor(_.roomY+_.height/2);_.upLadder=new M.UpLadder(_,_.game,e,t),_.levelArray[e][t]=_.upLadder},this.generateDownLadder=function(){_.skin=d.SkinType.DUNGEON,_.buildEmptyRoom(),_.fixWalls(),_.addTorches(s.Game.randTable([0,0,0,1,1,2,2]));var e=Math.floor(_.roomX+_.width/2),t=Math.floor(_.roomY+_.height/2);_.levelArray[e][t]=new P.DownLadder(_,_.game,e,t)},this.generateRopeHole=function(){_.skin=d.SkinType.DUNGEON,_.buildEmptyRoom(),_.fixWalls(),_.addTorches(s.Game.randTable([0,0,0,1,1,2,2]));var e=Math.floor(_.roomX+_.width/2),t=Math.floor(_.roomY+_.height/2),n=new P.DownLadder(_,_.game,e,t);n.isRope=!0,_.levelArray[e][t]=n},this.generateRopeCave=function(){_.skin=d.SkinType.CAVE,_.buildEmptyRoom(),_.fixWalls();var e=Math.floor(_.roomX+_.width/2),t=Math.floor(_.roomY+_.height/2);_.upLadder=new M.UpLadder(_,_.game,e,t),_.upLadder.isRope=!0,_.levelArray[e][t]=_.upLadder},this.generateShop=function(){_.skin=d.SkinType.DUNGEON,_.buildEmptyRoom(),_.fixWalls(),_.addTorches(2);var e=Math.floor(_.roomX+_.width/2),t=Math.floor(_.roomY+_.height/2);_.enemies.push(new Y.VendingMachine(_,_.game,e-2,t-1,new F.Shotgun(_,0,0))),_.enemies.push(new Y.VendingMachine(_,_.game,e+2,t-1,new W.Heart(_,0,0))),_.enemies.push(new Y.VendingMachine(_,_.game,e-2,t+2,new I.Armor(_,0,0))),_.enemies.push(new Y.VendingMachine(_,_.game,e+2,t+2,new U.Spear(_,0,0)))},this.addDoor=function(e,t){var n;switch(e){case 0:n=new u.Door(_,_.game,_.roomX,_.roomY,t);break;case 1:n=new u.Door(_,_.game,_.roomX+Math.floor(_.width/2),_.roomY,t);break;case 2:n=new u.Door(_,_.game,_.roomX+_.width-1,_.roomY,t);break;case 3:_.levelArray[_.roomX][_.roomY+_.height]=new l.Floor(_,_.roomX,_.roomY+_.height),n=new c.BottomDoor(_,_.game,_.roomX,_.roomY+_.height,t);break;case 4:_.levelArray[_.roomX+Math.floor(_.width/2)][_.roomY+_.height]=new l.Floor(_,_.roomX+Math.floor(_.width/2),_.roomY+_.height),n=new c.BottomDoor(_,_.game,_.roomX+Math.floor(_.width/2),_.roomY+_.height,t);break;case 5:_.levelArray[_.roomX+_.width-1][_.roomY+_.height]=new l.Floor(_,_.roomX+_.width-1,_.roomY+_.height),n=new c.BottomDoor(_,_.game,_.roomX+_.width-1,_.roomY+_.height,t);break;case 6:_.levelArray[_.roomX][_.roomY+1]=new l.Floor(_,_.roomX,_.roomY+1),n=new Z.SideDoor(_,_.game,_.roomX-1,_.roomY+1,t);break;case 7:_.levelArray[_.roomX][_.roomY+Math.floor(_.height/2)]=new l.Floor(_,_.roomX,_.roomY+Math.floor(_.height/2)),n=new Z.SideDoor(_,_.game,_.roomX-1,_.roomY+Math.floor(_.height/2),t);break;case 8:_.levelArray[_.roomX][_.roomY+_.height-1]=new l.Floor(_,_.roomX,_.roomY+_.height-1),n=new Z.SideDoor(_,_.game,_.roomX-1,_.roomY+_.height-1,t);break;case 9:_.levelArray[_.roomX+_.width-1][_.roomY+1]=new l.Floor(_,_.roomX+_.width-1,_.roomY+1),n=new Z.SideDoor(_,_.game,_.roomX+_.width,_.roomY+1,t);break;case 10:_.levelArray[_.roomX+_.width-1][_.roomY+Math.floor(_.height/2)]=new l.Floor(_,_.roomX+_.width-1,_.roomY+Math.floor(_.height/2)),n=new Z.SideDoor(_,_.game,_.roomX+_.width,_.roomY+Math.floor(_.height/2),t);break;case 11:_.levelArray[_.roomX+_.width-1][_.roomY+_.height-1]=new l.Floor(_,_.roomX+_.width-1,_.roomY+_.height-1),n=new Z.SideDoor(_,_.game,_.roomX+_.width,_.roomY+_.height-1,t)}return _.doors.push(n),_.levelArray[n.x][n.y]=n,n},this.exitLevel=function(){_.particles.splice(0,_.particles.length)},this.updateLevelTextColor=function(){i.LevelConstants.LEVEL_TEXT_COLOR="white"},this.enterLevel=function(){_.updateLevelTextColor(),_.game.player.moveSnap(_.roomX+Math.floor(_.width/2),_.roomY+_.height-1),_.updateLighting(),_.entered=!0,_.message=_.name},this.enterLevelThroughDoor=function(e,t){_.updateLevelTextColor(),e instanceof u.Door?(e.opened=!0,_.game.player.moveNoSmooth(e.x,e.y+1)):e instanceof c.BottomDoor?_.game.player.moveNoSmooth(e.x,e.y-1):e instanceof Z.SideDoor&&_.game.player.moveNoSmooth(e.x+t,e.y),_.updateLighting(),_.entered=!0,_.message=_.name},this.enterLevelThroughLadder=function(e){_.updateLevelTextColor(),_.game.player.moveSnap(e.x,e.y+1),_.updateLighting(),_.entered=!0,_.message=_.name},this.getEmptyMiddleTiles=function(){for(var e=[],t=_.roomX;t<_.roomX+_.width;t++)for(var n=_.roomY+2;n<_.roomY+_.height-1;n++)_.levelArray[t][n].isSolid()||_.levelArray[t][n]instanceof b.SpikeTrap||e.push(_.levelArray[t][n]);for(var r=function(t){e=e.filter((function(e){return e.x!==t.x||e.y!==t.y}))},o=0,a=_.enemies;o<a.length;o++)r(a[o]);return e},this.getEmptyTiles=function(){for(var e=[],t=_.roomX;t<_.roomX+_.width;t++)for(var n=_.roomY+1;n<_.roomY+_.height;n++)_.levelArray[t][n].isSolid()||_.levelArray[t][n]instanceof b.SpikeTrap||e.push(_.levelArray[t][n]);for(var r=function(t){e=e.filter((function(e){return e.x!==t.x||e.y!==t.y}))},o=0,a=_.enemies;o<a.length;o++)r(a[o]);return e},this.getTile=function(e,t){for(var n=0,r=_.levelArray;n<r.length;n++)for(var o=0,a=r[n];o<a.length;o++){var i=a[o];if(null!==i&&i.x===e&&i.y===t)return i}return null},this.fadeLighting=function(){for(var e=0;e<_.levelArray.length;e++)for(var t=0;t<_.levelArray[0].length;t++)Math.abs(_.softVis[e][t]-_.vis[e][t])>=.02&&(_.softVis[e][t]<_.vis[e][t]?_.softVis[e][t]+=.02:_.softVis[e][t]>_.vis[e][t]&&(_.softVis[e][t]-=.02))},this.updateLighting=function(){for(var e=[],t=0;t<_.levelArray.length;t++){e[t]=[];for(var n=0;n<_.levelArray[0].length;n++)e[t][n]=_.vis[t][n],_.vis[t][n]=1}for(var r=0;r<360;r+=i.LevelConstants.LIGHTING_ANGLE_STEP)_.castShadowsAtAngle(r,_.game.player.x+.5,_.game.player.y+.5,_.game.player.sightRadius-_.depth);for(var o=0,a=_.lightSources;o<a.length;o++){var l=a[o];for(r=0;r<360;r+=i.LevelConstants.LIGHTING_ANGLE_STEP)_.castShadowsAtAngle(r,l.x,l.y,l.r)}i.LevelConstants.SMOOTH_LIGHTING&&(_.vis=_.blur3x3(_.vis,[[1,2,1],[2,8,2],[1,2,1]]))},this.castShadowsAtAngle=function(e,t,n,r){for(var o=Math.cos(e*Math.PI/180),i=Math.sin(e*Math.PI/180),l=0;l<r;l++){if(Math.floor(t)<0||Math.floor(t)>=_.levelArray.length||Math.floor(n)<0||Math.floor(n)>=_.levelArray[0].length)return;var s=_.levelArray[Math.floor(t)][Math.floor(n)];if(s.isOpaque()||s instanceof a.Wall&&1===s.type)return;_.vis[Math.floor(t)][Math.floor(n)]=Math.min(_.vis[Math.floor(t)][Math.floor(n)],Math.min(l/r,1)),t+=o,n+=i}},this.blur3x3=function(e,t){for(var n=[],r=0;r<e.length;r++){n[r]=[];for(var o=0;o<e[0].length;o++)if(0!==e[r][o]){for(var a=0,i=0,l=-1;l<=1;l++)for(var s=-1;s<=1;s++)r+l>=0&&r+l<e.length&&o+s>=0&&o+s<e[0].length&&(a+=e[r+l][o+s]*t[l+1][s+1],i+=t[l+1][s+1]);n[r][o]=a/i}else n[r][o]=0}return n},this.catchUp=function(){_.turn===o.computerTurn&&_.computerTurn()},this.tick=function(){_.enemies=_.enemies.filter((function(e){return!e.dead})),_.updateLighting();for(var e=0,t=_.projectiles;e<t.length;e++)t[e].tick();for(var n=0;n<_.levelArray.length;n++)for(var r=0;r<_.levelArray[0].length;r++)_.levelArray[n][r].tick();_.turn=o.computerTurn,_.playerTurnTime=Date.now()},this.update=function(){_.turn==o.computerTurn&&Date.now()-_.playerTurnTime>=i.LevelConstants.COMPUTER_TURN_DELAY&&_.computerTurn()},this.computerTurn=function(){for(var e=0,t=_.enemies;e<t.length;e++)(c=t[e]).tick();for(var n=0,r=_.items;n<r.length;n++)r[n].tick();for(var a=0,i=_.projectiles;a<i.length;a++){var l=i[a];_.levelArray[l.x][l.y].isSolid()&&(l.dead=!0),l.x===_.game.player.x&&l.y===_.game.player.y&&l.hitPlayer(_.game.player);for(var s=0,u=_.enemies;s<u.length;s++){var c=u[s];l.x===c.x&&l.y===c.y&&l.hitEnemy(c)}}for(var h=0;h<_.levelArray.length;h++)for(var d=0;d<_.levelArray[0].length;d++)_.levelArray[h][d].tickEnd();_.game.player.finishTick(),_.turn=o.playerTurn},this.draw=function(){L.HitWarning.updateFrame(),_.fadeLighting();for(var e=_.roomX-1;e<_.roomX+_.width+1;e++)for(var t=_.roomY-1;t<_.roomY+_.height+1;t++)_.softVis[e][t]<1&&_.levelArray[e][t].draw()},this.drawEntitiesBehindPlayer=function(){for(var e=0;e<_.levelArray.length;e++)for(var t=0;t<_.levelArray[0].length;t++)_.softVis[e][t]<1&&_.levelArray[e][t].drawUnderPlayer();_.projectiles=_.projectiles.filter((function(e){return!e.dead})),_.particles=_.particles.filter((function(e){return!e.dead}));var n=new Array;(n=n.concat(_.enemies,_.projectiles,_.particles,_.items)).sort((function(e,t){return e.drawableY-t.drawableY==0?e instanceof f.Enemy?1:t instanceof f.Enemy?-1:0:e.drawableY-t.drawableY}));for(var r=0,o=n;r<o.length;r++){var a=o[r];a.drawableY<=_.game.player.y&&a.draw()}},this.drawEntitiesInFrontOfPlayer=function(){for(var e=0;e<_.levelArray.length;e++)for(var t=0;t<_.levelArray[0].length;t++)_.softVis[e][t]<1&&_.levelArray[e][t].drawAbovePlayer();var n=new Array;(n=n.concat(_.enemies,_.projectiles,_.particles,_.items)).sort((function(e,t){return e.drawableY-t.drawableY==0?e instanceof f.Enemy?1:t instanceof f.Enemy?-1:0:e.drawableY-t.drawableY}));for(var r=0,o=n;r<o.length;r++){var a=o[r];a.drawableY>_.game.player.y&&a.draw()}for(var i=0,l=_.items;i<l.length;i++)l[i].drawTopLayer()},this.drawShade=function(){var e=Math.max(0,Math.min(.8,2*_.depth/_.game.player.sightRadius));s.Game.ctx.globalAlpha=e,s.Game.ctx.fillStyle=_.shadeColor,s.Game.ctx.fillRect((_.roomX-i.LevelConstants.SCREEN_W)*g.GameConstants.TILESIZE,(_.roomY-i.LevelConstants.SCREEN_H)*g.GameConstants.TILESIZE,(_.width+2*i.LevelConstants.SCREEN_W)*g.GameConstants.TILESIZE,(_.height+2*i.LevelConstants.SCREEN_H)*g.GameConstants.TILESIZE),s.Game.ctx.globalAlpha=1,s.Game.ctx.globalCompositeOperation="source-over"},this.drawOverShade=function(){for(var e=0,t=_.enemies;e<t.length;e++)t[e].drawTopLayer();for(var n=0,r=_.projectiles;n<r.length;n++)r[n].drawTopLayer();for(var o=0;o<_.levelArray.length;o++)for(var a=0;a<_.levelArray[0].length;a++)_.levelArray[o][a].drawAboveShading()},this.drawTopLayer=function(){var e=s.Game.ctx.font;s.Game.ctx.font=g.GameConstants.SCRIPT_FONT_SIZE+"px Script",s.Game.ctx.fillStyle=i.LevelConstants.LEVEL_TEXT_COLOR,s.Game.fillText(_.message,g.GameConstants.WIDTH/2-s.Game.ctx.measureText(_.name).width/2,1),s.Game.ctx.font=e},this.game=e,this.x=t,this.y=n,this.width=h,this.height=p,this.type=m,this.depth=v,this.group=w,this.entered=!1,this.turn=o.playerTurn,this.playerTurnTime=Date.now(),this.items=Array(),this.projectiles=Array(),this.particles=Array(),this.doors=Array(),this.enemies=Array(),this.lightSources=Array(),this.levelArray=[];for(var T=0;T<h+6;T++)this.levelArray[T]=[];this.vis=[],this.softVis=[];for(var E=0;E<h+6;E++){this.vis[E]=[],this.softVis[E]=[];for(var S=0;S<p+6;S++)this.vis[E][S]=1,this.softVis[E][S]=1}switch(this.roomX=2,this.roomY=2,this.upLadder=null,this.name="",this.type){case r.DUNGEON:this.generateDungeon();break;case r.BIGDUNGEON:this.generateBigDungeon();break;case r.FOUNTAIN:this.generateFountain();break;case r.COFFIN:this.generateCoffin();break;case r.PUZZLE:this.generatePuzzle();break;case r.SPIKECORRIDOR:this.generateSpikeCorridor();break;case r.TREASURE:this.generateTreasure();break;case r.CHESSBOARD:this.generateChessboard();break;case r.KEYROOM:this.generateKeyRoom();break;case r.GRASS:this.generateDungeon();break;case r.BIGCAVE:this.generateCave();case r.CAVE:this.generateCave();break;case r.UPLADDER:this.generateUpLadder(),this.name="FLOOR "+-this.depth;break;case r.DOWNLADDER:this.generateDownLadder(),this.name="FLOOR "+-this.depth;break;case r.ROPEHOLE:this.generateRopeHole();break;case r.ROPECAVE:this.generateRopeCave();break;case r.SHOP:this.generateShop();break;case r.SPAWNER:this.generateSpawner()}}return e.prototype.pointInside=function(e,t,n,r,o,a){return!(e<n||e>=n+o||t<r||t>=r+a)},e.prototype.fixWalls=function(){for(var e=this.roomX;e<this.roomX+this.width;e++)this.levelArray[e][this.roomY+1]=new l.Floor(this,e,this.roomY+1),this.levelArray[e][this.roomY+this.height-1]=new l.Floor(this,e,this.roomY+this.height-1);for(e=0;e<this.levelArray.length;e++)for(var t=0;t<this.levelArray[0].length;t++)this.levelArray[e][t]instanceof a.Wall&&(this.levelArray[e][t+1]instanceof l.Floor||this.levelArray[e][t+1]instanceof v.SpawnFloor)&&(this.levelArray[e][t+2]instanceof l.Floor||this.levelArray[e][t+2]instanceof v.SpawnFloor?this.levelArray[e][t+1]=new h.WallSide(this,e,t+1):this.levelArray[e][t-1]instanceof a.Wall?this.levelArray[e][t]=new h.WallSide(this,e,t):this.levelArray[e][t]=new l.Floor(this,e,t))},e.prototype.buildEmptyRoom=function(){for(var e=0;e<this.width+6;e++)for(var t=0;t<this.height+6;t++)this.levelArray[e][t]=new a.Wall(this,e,t,1);for(e=0;e<this.width+6;e++)for(t=0;t<this.height+6;t++)this.pointInside(e,t,this.roomX,this.roomY,this.width,this.height)&&(this.levelArray[e][t]=new l.Floor(this,e,t));for(e=0;e<this.width+6;e++)for(t=0;t<this.height+6;t++)this.pointInside(e,t,this.roomX-1,this.roomY-1,this.width+2,this.height+2)&&(this.pointInside(e,t,this.roomX,this.roomY,this.width,this.height)||(this.levelArray[e][t]=new a.Wall(this,e,t,0)))},e.prototype.addWallBlocks=function(){for(var e=s.Game.randTable([0,1,1,2,2,2,2,3,3]),t=0;t<e;t++)for(var n=Math.min(s.Game.randTable([2,2,2,2,2,2,3,3,3,4,5,6,7,9]),this.width-2),r=Math.min(n+s.Game.rand(-1,1),this.height-3),o=s.Game.rand(this.roomX+1,this.roomX+this.width-n-2),i=s.Game.rand(this.roomY+2,this.roomY+this.height-r-2),l=o;l<o+n;l++)for(var u=i;u<i+r;u++)this.levelArray[l][u]=new a.Wall(this,l,u,0)},e.prototype.addFingers=function(){var e=s.Game.randTable([0,1,1,2,2,3,4,5]);s.Game.rand(1,13)>this.width&&(e+=.3*this.width);for(var t=0;t<e;t++){var n=0,r=0,o=0,i=0;if(0===s.Game.rand(0,1))if(o=s.Game.rand(1,this.width-1),i=1,0===s.Game.rand(0,1)){n=this.roomX,r=s.Game.rand(this.roomY+2,this.roomY+this.height-i-2);for(var u=n;u<n+o+1;u++)for(var c=r-2;c<r+i+2;c++)this.levelArray[u][c]=new l.Floor(this,u,c);for(u=n;u<n+o;u++)for(c=r;c<r+i;c++)this.levelArray[u][c]=new a.Wall(this,u,c,0)}else{for(n=this.roomX+this.width-o,r=s.Game.rand(this.roomY+2,this.roomY+this.height-i-2),u=n-1;u<n+o;u++)for(c=r-2;c<r+i+2;c++)this.levelArray[u][c]=new l.Floor(this,u,c);for(u=n;u<n+o;u++)for(c=r;c<r+i;c++)this.levelArray[u][c]=new a.Wall(this,u,c,0)}else if(o=1,i=s.Game.rand(1,this.height-4),0===s.Game.rand(0,1)){for(r=this.roomY+2,u=(n=s.Game.rand(this.roomX+2,this.roomX+this.width-3))-1;u<n+o+1;u++)for(c=r+1;c<r+i+2;c++)this.levelArray[u][c]=new l.Floor(this,u,c);for(u=n;u<n+o;u++)for(c=r;c<r+i;c++)this.levelArray[u][c]=new a.Wall(this,u,c,0)}else{for(r=this.roomY+this.height-i-1,u=(n=s.Game.rand(this.roomX+2,this.roomX+this.width-3))-1;u<n+o+1;u++)for(c=r-2;c<r+i;c++)this.levelArray[u][c]=new l.Floor(this,u,c);for(u=n;u<n+o;u++)for(c=r;c<r+i;c++)this.levelArray[u][c]=new a.Wall(this,u,c,0)}}},e.prototype.addTorches=function(e){for(var t=[],n=0;n<this.levelArray.length;n++)for(var r=0;r<this.levelArray[0].length;r++)this.levelArray[n][r]instanceof h.WallSide&&t.push(this.levelArray[n][r]);for(var o=0;o<e;o++){var a,i,l;if(0==t.length)return;i=(a=t.splice(s.Game.rand(0,t.length-1),1)[0]).x,l=a.y,this.levelArray[i][l]=new N.WallSideTorch(this,i,l)}},e.prototype.addChasms=function(){var e=s.Game.rand(2,4),t=s.Game.rand(2,4),n=this.roomX+1,r=this.roomX+this.width-e-1,o=this.roomY+2,a=this.roomY+this.height-t-1;if(!(r<n||a<o))for(var i=s.Game.rand(n,r),u=s.Game.rand(o,a),c=i-1;c<i+e+1;c++)for(var h=u-1;h<u+t+1;h++)this.levelArray[c][h]=c===i-1||c===i+e||h===u-1||h===u+t?new l.Floor(this,c,h):new j.Chasm(this,c,h,c===i,c===i+e-1,h===u,h===u+t-1)},e.prototype.addChests=function(e){for(var t=this.getEmptyMiddleTiles(),n=0;n<e;n++){var r,o,a;if(0==t.length)return;o=(r=t.splice(s.Game.rand(0,t.length-1),1)[0]).x,a=r.y,this.enemies.push(new m.Chest(this,this.game,o,a))}},e.prototype.addSpikeTraps=function(e){for(var t=this.getEmptyMiddleTiles(),n=0;n<e;n++){var r=t.splice(s.Game.rand(0,t.length-1),1)[0];if(0==t.length)return;var o=r.x,a=r.y;this.levelArray[o][a]=new b.SpikeTrap(this,o,a)}},e.prototype.addSpikes=function(e){for(var t=this.getEmptyMiddleTiles(),n=0;n<e;n++){var r=t.splice(s.Game.rand(0,t.length-1),1)[0];if(0==t.length)return;var o=r.x,a=r.y;this.levelArray[o][a]=new w.Spike(this,o,a)}},e.prototype.addEnemies=function(e){for(var t=this.getEmptyMiddleTiles(),n=0;n<e;n++){var r=t.splice(s.Game.rand(0,t.length-1),1)[0];if(0==t.length)return;var o=r.x,a=r.y;if(0!==this.depth)switch(Math.min(this.depth,s.Game.randTable([1,1,1,2,2,2,3,4,4]))){case 1:this.enemies.push(new p.KnightEnemy(this,this.game,o,a));break;case 2:var i=new T.SkullEnemy(this,this.game,o,a);i.skipNextTurns=1,this.enemies.push(i);break;case 3:this.enemies.push(new _.WizardEnemy(this,this.game,o,a));break;case 4:this.enemies.push(new X.Spawner(this,this.game,o,a));break;case 5:this.enemies.push(new H.ChargeEnemy(this,this.game,o,a))}}},e.prototype.addObstacles=function(e){for(var t=this.getEmptyMiddleTiles(),n=0;n<e;n++){var r=t.splice(s.Game.rand(0,t.length-1),1)[0];if(0==t.length)return;var o=r.x,a=r.y;switch(s.Game.randTable([1,1,2])){case 1:this.enemies.push(new x.Crate(this,this.game,o,a));break;case 2:this.enemies.push(new E.Barrel(this,this.game,o,a))}}},e.prototype.addPlants=function(e){for(var t=this.getEmptyMiddleTiles(),n=0;n<e;n++){var r=t.splice(s.Game.rand(0,t.length-1),1)[0];if(0==t.length)return;var o=r.x,a=r.y;this.enemies.push(new S.PottedPlant(this,this.game,o,a))}},e.prototype.addResources=function(e){for(var t=this.getEmptyMiddleTiles(),n=0;n<e;n++){var r=t.splice(s.Game.rand(0,t.length-1),1)[0];if(0==t.length)return;var o=r.x,a=r.y,i=Math.random();i<=(10-Math.pow(this.depth,3))/10?this.enemies.push(new k.CoalResource(this,this.game,o,a)):i<=(10-Math.pow(this.depth-2,3))/10?this.enemies.push(new R.GoldResource(this,this.game,o,a)):this.enemies.push(new D.EmeraldResource(this,this.game,o,a))}},e}();t.Level=V},5742:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LevelConstants=void 0;var n=function(){function e(){}return e.SCREEN_W=1,e.SCREEN_H=1,e.COMPUTER_TURN_DELAY=250,e.TURN_TIME=1e3,e.LEVEL_TRANSITION_TIME=300,e.LEVEL_TRANSITION_TIME_LADDER=1e3,e.ROOM_COUNT=15,e.HEALTH_BAR_FADEIN=100,e.HEALTH_BAR_FADEOUT=100,e.HEALTH_BAR_TOTALTIME=2500,e.SHADED_TILE_CUTOFF=1,e.SMOOTH_LIGHTING=!1,e.MIN_VISIBILITY=2,e.LIGHTING_ANGLE_STEP=5,e.LEVEL_TEXT_COLOR="white",e}();t.LevelConstants=n},569:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LevelGenerator=void 0;var r=n(2967),o=n(3161),a=[3,3,4,4,5,5,5,6,6,6,7,7,7,8,8,8,13],i=function(e,t,n){this.type=e,this.difficulty=t,this.children=n},l=function(){var e=this;this.collides=function(t){return!(e.x>t.x+t.w||e.x+e.w<t.x||e.y>=t.y+t.h||e.y+e.h<=t.y)},this.getPoints=function(){return[{x:e.x,y:e.y},{x:Math.floor(e.x+e.w/2),y:e.y},{x:e.x+e.w-1,y:e.y},{x:e.x,y:e.y+e.h},{x:Math.floor(e.x+e.w/2),y:e.y+e.h},{x:e.x+e.w-1,y:e.y+e.h},{x:e.x-1,y:e.y+1},{x:e.x-1,y:Math.floor(e.y+e.h/2)},{x:e.x-1,y:e.y+e.h-1},{x:e.x+e.w,y:e.y+1},{x:e.x+e.w,y:Math.floor(e.y+e.h/2)},{x:e.x+e.w,y:e.y+e.h-1}]},this.getDoors=function(){return e.doors},this.generateAroundPoint=function(t,n,r,o){e.x=0,e.y=0,r?(e.w=r,e.h=o):(e.w=a[Math.floor(Math.random()*a.length)],e.h=a[Math.floor(Math.random()*a.length)]);var i;i=0===n||1===n||2===n?3+Math.floor(3*Math.random()):3===n||4===n||5===n?Math.floor(3*Math.random()):6===n||7===n||8===n?9+Math.floor(3*Math.random()):6+Math.floor(3*Math.random());var l=e.getPoints()[i];return e.x+=t.x-l.x,e.y+=t.y-l.y,i},this.x=0,this.y=0,this.w=0,this.h=0,this.doneAdding=!1,this.doors=[null,null,null,null,null,null]};t.LevelGenerator=function(){var e=this;this.rooms=[],this.levels=[],this.upLadder=null,this.noCollisions=function(t){for(var n=0,r=e.rooms;n<r.length;n++){var o=r[n];if(t.collides(o))return!1}return!0},this.pickType=function(t){var n=o.RoomType.DUNGEON;switch(r.Game.rand(1,9)){case 1:n=o.RoomType.FOUNTAIN,(t.h<=5||t.w>9&&t.h>9)&&(n=e.pickType(t));break;case 2:n=o.RoomType.COFFIN,t.w<=5&&(n=e.pickType(t));break;case 3:n=o.RoomType.TREASURE;break;case 4:case 5:n=o.RoomType.GRASS}return n},this.shuffle=function(e){var t,n,r;for(r=e.length-1;r>0;r--)t=Math.floor(Math.random()*(r+1)),n=e[r],e[r]=e[t],e[t]=n;return e},this.addRooms=function(t,n,a){var i,s=e.shuffle([0,1,2,3,4,5,6,7,8,9,10,11]);n&&(i=n.getPoints());for(var u=0;u<s.length;u++)for(var c=s[u],h=0;h<20;h++){var d=new l;d.x=0,d.y=0;var p=r.Game.rand(1,12);if(n)switch(t.type){case o.RoomType.ROPECAVE:case o.RoomType.ROPEHOLE:p=d.generateAroundPoint(i[c],c,3,4);break;case o.RoomType.DUNGEON:p=d.generateAroundPoint(i[c],c,r.Game.randTable([5,5,5,5,5,6,6,6,6,6,7,7,7,7,9,9,10]),r.Game.randTable([5,5,5,5,5,6,6,6,6,6,7,7,7,7,9,9,10]));break;case o.RoomType.BIGDUNGEON:p=d.generateAroundPoint(i[c],c,r.Game.randTable([10,11,12,13]),r.Game.randTable([10,11,12,13]));break;case o.RoomType.BIGCAVE:p=d.generateAroundPoint(i[c],c,30,30);break;case o.RoomType.UPLADDER:case o.RoomType.DOWNLADDER:p=d.generateAroundPoint(i[c],c,5,5);break;case o.RoomType.SPAWNER:p=d.generateAroundPoint(i[c],c,r.Game.randTable([9,10,11]),r.Game.randTable([9,10,11]));break;case o.RoomType.PUZZLE:case o.RoomType.COFFIN:case o.RoomType.FOUNTAIN:p=d.generateAroundPoint(i[c],c,11,11);break;case o.RoomType.SPIKECORRIDOR:p=d.generateAroundPoint(i[c],c,r.Game.randTable([3,5]),r.Game.randTable([9,10,11]));break;default:p=d.generateAroundPoint(i[c],c)}else d.x=-2,d.y=-2,d.w=7,d.h=7,t.type===o.RoomType.UPLADDER?(d.w=5,d.h=5):t.type===o.RoomType.ROPECAVE&&(d.w=3,d.h=4);if(e.noCollisions(d)){var f=new o.Level(e.game,d.x,d.y,d.w,d.h,t.type,t.difficulty,e.group);if(f.upLadder&&(e.upLadder=f.upLadder),e.levels.push(f),a){var m=f.addDoor(p,null);m.linkedDoor=a.addDoor(c,m),d.doors[p]=m}e.rooms.push(d);for(var y=0,v=t.children;y<v.length;y++){var w=v[y];if(!e.addRooms(w,d,f))return!1}return!0}}return!1},this.generate=function(t,n,r){void 0===r&&(r=!1);var a,l=n;a=r?new i(o.RoomType.ROPECAVE,l,[new i(o.RoomType.BIGCAVE,l,[new i(o.RoomType.CAVE,l,[new i(o.RoomType.CAVE,l,[])]),new i(o.RoomType.CAVE,l,[new i(o.RoomType.CAVE,l,[])]),new i(o.RoomType.CAVE,l,[new i(o.RoomType.CAVE,l,[])]),new i(o.RoomType.CAVE,l,[])])]):0==l?new i(o.RoomType.SHOP,l,[new i(o.RoomType.DOWNLADDER,l,[])]):new i(o.RoomType.UPLADDER,l,[new i(o.RoomType.DUNGEON,l,[new i(o.RoomType.DUNGEON,l,[new i(o.RoomType.DUNGEON,l,[new i(o.RoomType.DUNGEON,l,[new i(o.RoomType.TREASURE,l,[])])])])]),new i(o.RoomType.DUNGEON,l,[new i(o.RoomType.DUNGEON,l,[new i(o.RoomType.DUNGEON,l,[new i(o.RoomType.DUNGEON,l,[new i(o.RoomType.DUNGEON,l,[new i(o.RoomType.DOWNLADDER,l,[])])])])])]),new i(o.RoomType.ROPEHOLE,l,[])]),e.game=t,e.game.levels.length>0?e.group=e.game.levels[e.game.levels.length-1].group+1:e.group=0;var s=!1;do{e.rooms.splice(0),e.levels.splice(0),s=e.addRooms(a,null,null)}while(!s);if(e.game.levels=e.game.levels.concat(e.levels),0!=l)return e.upLadder}}},5752:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LightSource=void 0;t.LightSource=function(e,t,n){this.x=e,this.y=t,this.r=n}},9232:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Map=void 0;var r=n(2967),o=n(988),a=n(3161);t.Map=function(e){var t=this;this.draw=function(){t.game.levels[0],r.Game.ctx.globalAlpha=.5,r.Game.ctx.fillStyle="white",r.Game.ctx.fillRect(0,0,o.GameConstants.WIDTH,o.GameConstants.HEIGHT),r.Game.ctx.translate(.5*o.GameConstants.WIDTH,.5*o.GameConstants.HEIGHT),r.Game.ctx.globalAlpha=1;for(var e=0,n=t.game.levels;e<n.length;e++){var i=n[e];if(t.game.level.group===i.group){r.Game.ctx.fillStyle="black",i.type===a.RoomType.UPLADDER&&(r.Game.ctx.fillStyle="#101460"),i.type===a.RoomType.DOWNLADDER&&(r.Game.ctx.fillStyle="#601410"),i.entered||(r.Game.ctx.fillStyle="#606060"),r.Game.ctx.fillRect(i.x,i.y+1,i.width,i.height-1);for(var l=0,s=i.doors;l<s.length;l++){var u=s[l];r.Game.ctx.fillStyle="black",i.entered||(r.Game.ctx.fillStyle="#606060"),r.Game.ctx.fillRect(i.x-i.roomX+u.x,i.y-i.roomY+u.y,1,1)}}}r.Game.ctx.fillStyle=o.GameConstants.RED,r.Game.ctx.fillRect(t.game.level.x-t.game.level.roomX+t.game.player.x,t.game.level.y-t.game.level.roomY+t.game.player.y,1,1),r.Game.ctx.setTransform(1,0,0,1,0,0)},this.game=e}},5440:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.DeathParticle=void 0;var a=n(2967),i=n(988),l=function(e){function t(t,n){var r=e.call(this)||this;return r.draw=function(){var e=Math.max(0,3*(r.frame-3)/i.GameConstants.TILESIZE),t=Math.round(r.frame);2==t||4==t||6==t?a.Game.drawMob(2,0,1,2,r.x,r.y-e,1,2):a.Game.drawFX(Math.round(r.frame),4,1,2,r.x,r.y-e,1,2),r.frame+=.3,r.frame>10&&(r.dead=!0)},r.x=t,r.y=n-1.5,r.dead=!1,r.frame=0,r}return o(t,e),t}(n(1670).Particle);t.DeathParticle=l},2621:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.GenericParticle=void 0;var a=n(1670),i=n(2967),l=n(988),s=function(e){function t(t,n,r,o,a,s,u,c,h,d,p,f,m,y){var v=e.call(this)||this;return v.render=function(){var e=l.GameConstants.TILESIZE,t=v.s*v.alpha*.5,n=i.Game.ctx.fillStyle;i.Game.ctx.fillStyle=v.color,i.Game.ctx.beginPath(),i.Game.ctx.arc(Math.round(v.x*e),Math.round((v.y-v.z)*e),Math.round(t*e),0,2*Math.PI,!1),i.Game.ctx.fill(),i.Game.ctx.fillStyle=n},v.draw=function(){v.targetX?v.x+=.1*(v.targetX-v.x):v.x+=v.dx,v.targetY?v.y+=.1*(v.targetY-v.y):v.y+=v.dy,v.targetZ?v.z+=.1*(v.targetZ-v.z):v.z+=v.dz,v.dx*=.97,v.dy*=.97,v.z<=0&&(v.z=0,v.dz*=-.8),v.dz-=.01,v.alpha<.2?v.alpha-=.007:v.alpha-=.02,v.alpha<=.1&&(v.dead=!0),v.expirationTimer--,v.expirationTimer<=0&&(v.dead=!0),v.dead||v.render()},v.level=t,v.x=n,v.y=r,v.z=o,v.s=a,v.dx=s,v.dy=u,v.dz=c,v.color=h,v.alpha=1,void 0!==d&&(v.delay=d),v.targetX=f,v.targetY=m,v.targetZ=y,v.expirationTimer=1e6,void 0!==p&&(v.expirationTimer=p),v}return o(t,e),t.shotgun=function(e,n,r,o,a,i){for(var l=0;l<4;l++)e.particles.push(new t(e,n,r,0,.5*Math.random()+.3,0,0,0,i,0,1e7,o+Math.random()-.5,a+Math.random()-.5,0))},t.spawnCluster=function(e,n,r,o){for(var a=0;a<4;a++)e.particles.push(new t(e,n+.05*Math.random()-.025,r+.05*Math.random()-.025,.5*Math.random(),.0625*(a+8),.025*(2*Math.random()-1),.025*(2*Math.random()-1),.2*(Math.random()-1),o,0))},t}(a.Particle);t.GenericParticle=s},1670:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Particle=void 0;var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t}(n(6779).Drawable);t.Particle=a},5554:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.SlashParticle=void 0;var a=n(2967),i=function(e){function t(t,n){var r=e.call(this)||this;return r.draw=function(){a.Game.drawFX(Math.round(r.frame),13,1,1,r.x,r.y,1,1),r.frame+=.5,r.frame>9&&(r.dead=!0)},r.x=t,r.y=n-.25,r.dead=!1,r.frame=0,r}return o(t,e),t}(n(1670).Particle);t.SlashParticle=i},4568:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.WizardTeleportParticle=void 0;var a=n(1670),i=n(2967),l=function(e){function t(t,n){var r=e.call(this)||this;return r.draw=function(){i.Game.drawFX(Math.floor(r.frame),3,1,1,r.x,r.y-r.z,1,1),r.z+=r.dz,r.dz*=.9,r.frame+=.25,r.frame>6&&(r.dead=!0)},r.x=t,r.y=n,r.dead=!1,r.frame=0,r.z=0,r.dz=.1,r}return o(t,e),t}(a.Particle);t.WizardTeleportParticle=l},663:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Player=void 0;var r,o=n(8835),a=n(988),i=n(2967),l=n(9143),s=n(5654),u=n(9039),c=n(7531),h=n(8791),d=n(5958),p=n(5742),f=n(9232),m=n(5554),y=n(3338),v=n(6882);!function(e){e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e[e.RIGHT=2]="RIGHT",e[e.LEFT=3]="LEFT"}(r||(r={}));t.Player=function(e,t,n){var w=this;this.tapListener=function(){w.inventory.open()},this.iListener=function(){w.inventory.open()},this.qListener=function(){w.inventory.isOpen&&w.inventory.drop()},this.leftListener=function(){w.inventory.isOpen?w.inventory.left():w.dead||w.game.levelState!==i.LevelState.IN_LEVEL||(w.tryMove(w.x-1,w.y),w.direction=r.LEFT)},this.rightListener=function(){w.inventory.isOpen?w.inventory.right():w.dead||w.game.levelState!==i.LevelState.IN_LEVEL||(w.tryMove(w.x+1,w.y),w.direction=r.RIGHT)},this.upListener=function(){w.inventory.isOpen?w.inventory.up():w.dead||w.game.levelState!==i.LevelState.IN_LEVEL||(w.tryMove(w.x,w.y-1),w.direction=r.UP)},this.downListener=function(){w.inventory.isOpen?w.inventory.down():w.dead||w.game.levelState!==i.LevelState.IN_LEVEL||(w.tryMove(w.x,w.y+1),w.direction=r.DOWN)},this.spaceListener=function(){w.inventory.isOpen?w.inventory.space():w.openVendingMachine&&w.openVendingMachine.space()},this.hit=function(){return 1},this.tryCollide=function(e,t,n){return!(t>=e.x+e.w||t+w.w<=e.x||n>=e.y+e.h||n+w.h<=e.y)},this.tryMove=function(e,t){if(w.game.level.catchUp(),!w.dead&&(!w.inventory.hasWeapon()||w.inventory.getWeapon().weaponMove(e,t))){for(var n=0,r=w.game.level.enemies;n<r.length;n++){var o=r[n];if(w.tryCollide(o,e,t))if(o.pushable){o.x,o.y;for(var a=e-w.x,i=t-w.y,c=e+a,p=t+i,f=!1,y=!1,g=[];;){f=!0;for(var _=0,T=w.game.level.enemies;_<T.length;_++)if((I=T[_]).x===c&&I.y===p){if(!I.chainPushable){y=!0,f=!0;break}f=!1,g.push(I);break}if(f)break;c+=a,p+=i}if(0!==g.length||!w.game.level.levelArray[c][p].canCrushEnemy()&&!y){d.Sound.push();for(var E=0,x=g;E<x.length;E++){var I;(I=x[E]).x+=a,I.y+=i,I.drawX=a,I.drawY=i,I.skipNextTurns=1}return(w.game.level.levelArray[c][p].canCrushEnemy()||y)&&g[g.length-1].killNoBones(),o.x+=a,o.y+=i,o.drawX=a,o.drawY=i,w.move(e,t),void w.game.level.tick()}if(o.destroyable)return o.kill(),d.Sound.hit(),w.drawX=.5*(w.x-o.x),w.drawY=.5*(w.y-o.y),w.game.level.particles.push(new m.SlashParticle(o.x,o.y)),w.game.level.tick(),void w.game.shakeScreen(10*w.drawX,10*w.drawY)}else if(!o.dead)return void(o.interactable&&o.interact())}var b=w.game.level.levelArray[e][t];b.isSolid()?b instanceof h.LockedDoor&&(w.drawX=.5*(w.x-e),w.drawY=.5*(w.y-t),b.unlock(w),w.game.level.tick()):(w.move(e,t),b.onCollide(w),b instanceof l.Door||b instanceof s.BottomDoor||b instanceof u.Trapdoor||b instanceof v.SideDoor||w.game.level.tick())}},this.hurt=function(e){d.Sound.hurt(),w.inventory.getArmor()&&w.inventory.getArmor().health>0?w.inventory.getArmor().hurt(e):(w.healthBar.hurt(),w.flashing=!0,w.health-=e,w.health<=0&&(w.health=0,w.dead=!0))},this.dashMove=function(e,t){w.x=e,w.y=t;for(var n=0,r=w.game.level.items;n<r.length;n++){var o=r[n];o.x===e&&o.y===t&&o.onPickup(w)}w.game.level.updateLighting()},this.doneMoving=function(){return Math.abs(w.drawX)<.01&&Math.abs(w.drawY)<.01},this.move=function(e,t){d.Sound.playerStoneFootstep(),w.openVendingMachine&&w.openVendingMachine.close(),w.drawX=e-w.x,w.drawY=t-w.y,w.x=e,w.y=t;for(var n=0,r=w.game.level.items;n<r.length;n++){var o=r[n];o.x===e&&o.y===t&&o.onPickup(w)}w.game.level.updateLighting()},this.moveNoSmooth=function(e,t){w.x=e,w.y=t},this.moveSnap=function(e,t){w.x=e,w.y=t,w.drawX=0,w.drawY=0},this.update=function(){},this.finishTick=function(){w.inventory.tick(),w.flashing=!1;var e=w.health-w.lastTickHealth;w.lastTickHealth=w.health,e<0&&(w.flashing=!0)},this.drawPlayerSprite=function(){w.frame+=.1,w.frame>=4&&(w.frame=0),i.Game.drawMob(1+Math.floor(w.frame),8+2*w.direction,1,2,w.x-w.drawX,w.y-1.5-w.drawY,1,2),w.inventory.getArmor()&&w.inventory.getArmor().health},this.draw=function(){w.flashingFrame+=12/a.GameConstants.FPS,w.dead||(i.Game.drawMob(0,0,1,1,w.x-w.drawX,w.y-w.drawY,1,1),w.flashing&&Math.floor(w.flashingFrame)%2!=0||w.drawPlayerSprite())},this.heartbeat=function(){w.guiHeartFrame=1},this.drawTopLayer=function(){w.healthBar.draw(w.health,w.maxHealth,w.x-w.drawX,w.y-w.drawY,!w.flashing||Math.floor(w.flashingFrame)%2==0)},this.drawGUI=function(){if(w.dead){i.Game.ctx.fillStyle=p.LevelConstants.LEVEL_TEXT_COLOR;var e="Game Over.";i.Game.ctx.fillText(e,a.GameConstants.WIDTH/2-i.Game.ctx.measureText(e).width/2,a.GameConstants.HEIGHT/2);var t="[refresh to restart]";i.Game.ctx.fillText(t,a.GameConstants.WIDTH/2-i.Game.ctx.measureText(t).width/2,a.GameConstants.HEIGHT/2+a.GameConstants.FONT_SIZE)}else{w.inventory.draw(),w.guiHeartFrame>0&&w.guiHeartFrame++,w.guiHeartFrame>5&&(w.guiHeartFrame=0);for(var n=0;n<w.maxHealth;n++){var r=w.guiHeartFrame>0?1:0;n>=Math.floor(w.health)?n==Math.floor(w.health)&&2*w.health%2==1?i.Game.drawFX(4,2,1,1,n,p.LevelConstants.SCREEN_H-1,1,1):i.Game.drawFX(3,2,1,1,n,p.LevelConstants.SCREEN_H-1,1,1):i.Game.drawFX(r,2,1,1,n,p.LevelConstants.SCREEN_H-1,1,1)}w.inventory.getArmor()&&w.inventory.getArmor().drawGUI(w.maxHealth)}(o.Input.isDown(o.Input.M)||o.Input.isTapHold)&&w.map.draw()},this.updateDrawXY=function(){w.drawX+=-.5*w.drawX,w.drawY+=-.5*w.drawY},this.game=e,this.x=t,this.y=n,this.w=1,this.h=1,this.frame=0,this.direction=r.UP,o.Input.iListener=this.iListener,o.Input.qListener=this.qListener,o.Input.leftListener=this.leftListener,o.Input.rightListener=this.rightListener,o.Input.upListener=this.upListener,o.Input.downListener=this.downListener,o.Input.spaceListener=this.spaceListener,o.Input.leftSwipeListener=this.leftListener,o.Input.rightSwipeListener=this.rightListener,o.Input.upSwipeListener=this.upListener,o.Input.downSwipeListener=this.downListener,o.Input.tapListener=this.tapListener,this.health=2,this.maxHealth=2,this.healthBar=new y.HealthBar,this.dead=!1,this.flashing=!1,this.flashingFrame=0,this.lastTickHealth=this.health,this.guiHeartFrame=0,this.inventory=new c.Inventory(e),this.missProb=.1,this.defaultSightRadius=6,this.sightRadius=this.defaultSightRadius,this.map=new f.Map(this.game)}},209:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.EnemySpawnAnimation=void 0;var a=n(5285),i=n(2967),l=n(2621),s=n(5958),u=function(e){function t(t,n,r,o,a,u){var c=e.call(this,r,o)||this;c.ANIM_COUNT=3,c.tick=function(){s.Sound.enemySpawn(),c.dead=!0,c.enemy.skipNextTurns=1,c.level.enemies.push(c.enemy),c.level.game.player.x===c.x&&c.level.game.player.y===c.y&&(c.level.game.player.hurt(.5),c.level.game.player.move(c.knockbackX,c.knockbackY)),l.GenericParticle.spawnCluster(c.level,c.x+.5,c.y+.5,"#ffffff"),l.GenericParticle.spawnCluster(c.level,c.x+.5,c.y+.5,"#ffffff")},c.drawTopLayer=function(){c.frame+=.25,c.frame>=8&&(c.frame=0);for(var e=0;e<c.ANIM_COUNT;e++)i.Game.drawFX(Math.floor(c.frame),26,1,2,c.x+Math.round(0)/16,c.y-1.5,1,2);Math.floor(4*c.frame)%2==0&&c.level.particles.push(new l.GenericParticle(c.level,c.x+.5+.05*Math.random()-.025,c.y+.05*Math.random()-.025,.25,.5*Math.random(),.025*(1*Math.random()-.5),.025*(1*Math.random()-.5),.2*(Math.random()-1),"#ffffff",0))},c.level=t,c.enemy=n,c.frame=0,c.f=[],c.xx=[],c.yy=[];for(var h=0;h<c.ANIM_COUNT;h++)c.f[h]=c.xx[h]=6.28*Math.random(),c.yy[h]=8*Math.random()-8;return c.knockbackX=a,c.knockbackY=u,c}return o(t,e),t}(a.Projectile);t.EnemySpawnAnimation=u},8084:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.HitWarning=void 0;var a=n(5285),i=n(2967),l=function(e){function t(n,r,o){var a=e.call(this,r,o)||this;return a.tick=function(){a.dead=!0},a.draw=function(){(a.x===a.game.player.x&&Math.abs(a.y-a.game.player.y)<=1||a.y===a.game.player.y&&Math.abs(a.x-a.game.player.x)<=1)&&i.Game.drawFX(18+Math.floor(t.frame),6,1,1,a.x,a.y,1,1)},a.drawTopLayer=function(){(a.x===a.game.player.x&&Math.abs(a.y-a.game.player.y)<=1||a.y===a.game.player.y&&Math.abs(a.x-a.game.player.x)<=1)&&i.Game.drawFX(18+Math.floor(t.frame),5,1,1,a.x,a.y,1,1)},a.game=n,a}return o(t,e),t.frame=0,t.updateFrame=function(){t.frame+=.125,t.frame>=4&&(t.frame=0)},t}(a.Projectile);t.HitWarning=l},5285:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Projectile=void 0;var a=function(e){function t(t,n){var r=e.call(this)||this;return r.hitPlayer=function(e){},r.hitEnemy=function(e){},r.tick=function(){},r.draw=function(){},r.drawTopLayer=function(){},r.x=t,r.y=n,r.dead=!1,r.drawableY=n,r}return o(t,e),t}(n(6779).Drawable);t.Projectile=a},5363:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.WizardFireball=void 0;var a=n(5285),i=n(2967),l=function(e){function t(t,n,r){var o=e.call(this,n,r)||this;return o.tick=function(){o.parent.dead&&(o.dead=!0),o.state++,2===o.state&&(o.frame=0,o.delay=i.Game.rand(0,10))},o.hitPlayer=function(e){2!==o.state||o.dead||e.hurt(1)},o.draw=function(){if(0===o.state)o.frame+=.25,o.frame>=4&&(o.frame=0),i.Game.drawFX(22+Math.floor(o.frame),7,1,1,o.x,o.y,1,1);else if(1===o.state)o.frame+=.25,o.frame>=4&&(o.frame=0),i.Game.drawFX(18+Math.floor(o.frame),7,1,1,o.x,o.y,1,1);else{if(o.delay>0)return void o.delay--;o.frame+=.3,o.frame>17&&(o.dead=!0),i.Game.drawFX(Math.floor(o.frame),6,1,2,o.x,o.y-1,1,2)}},o.parent=t,o.state=0,o.frame=0,o}return o(t,e),t}(a.Projectile);t.WizardFireball=l},5958:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Sound=void 0;var r=n(2967),o=function(){function e(){}return e.loadSounds=function(){e.playerStoneFootsteps=new Array,[1,2,3].forEach((function(t){return e.playerStoneFootsteps.push(new Audio("res/SFX/footsteps/stone/footstep"+t+".wav"))}));for(var t=0,n=e.playerStoneFootsteps;t<n.length;t++)n[t].volume=1;e.enemyFootsteps=new Array,[1,2,3,4,5].forEach((function(t){return e.enemyFootsteps.push(new Audio("res/SFX/footsteps/enemy/enemyfootstep"+t+".wav"))}));for(var r=0,o=e.enemyFootsteps;r<o.length;r++)o[r].volume=1;e.hitSounds=new Array,[1,2,3,4].forEach((function(t){return e.hitSounds.push(new Audio("res/SFX/attacks/swing"+t+".wav"))}));for(var a=0,i=e.hitSounds;a<i.length;a++)i[a].volume=1;e.enemySpawnSound=new Audio("res/SFX/attacks/enemyspawn.wav"),e.enemySpawnSound.volume=1,e.chestSounds=new Array,[1,2,3].forEach((function(t){return e.chestSounds.push(new Audio("res/SFX/chest/chest"+t+".wav"))}));for(var l=0,s=e.chestSounds;l<s.length;l++)s[l].volume=1;e.coinPickupSounds=new Array,[1,2,3,4].forEach((function(t){return e.coinPickupSounds.push(new Audio("res/SFX/items/coins"+t+".wav"))}));for(var u=0,c=e.coinPickupSounds;u<c.length;u++)c[u].volume=1;e.miningSounds=new Array,[1,2,3,4].forEach((function(t){return e.miningSounds.push(new Audio("res/SFX/resources/Pickaxe"+t+".wav"))}));for(var h=0,d=e.miningSounds;h<d.length;h++)d[h].volume=1;e.hurtSounds=new Array,[1].forEach((function(t){return e.hurtSounds.push(new Audio("res/SFX/attacks/hit.wav"))}));for(var p=0,f=e.hurtSounds;p<f.length;p++)f[p].volume=1;e.genericPickupSound=new Audio("res/SFX/items/pickup.wav"),e.genericPickupSound.volume=1,e.breakRockSound=new Audio("res/SFX/resources/rockbreak.wav"),e.breakRockSound.volume=1,e.pushSounds=new Array,[1,2].forEach((function(t){return e.pushSounds.push(new Audio("res/SFX/pushing/push"+t+".wav"))}));for(var m=0,y=e.pushSounds;m<y.length;m++)y[m].volume=1;e.powerupSound=new Audio("res/powerup.wav"),e.powerupSound.volume=.5,e.healSound=new Audio("res/heal.wav"),e.healSound.volume=.5,e.music=new Audio("res/bewitched.mp3")},e.playerStoneFootstep=function(){var t=r.Game.randTable(e.playerStoneFootsteps);t.play(),t.currentTime=0},e.enemyFootstep=function(){var t=r.Game.randTable(e.enemyFootsteps);t.play(),t.currentTime=0},e.hit=function(){var t=r.Game.randTable(e.hitSounds);t.play(),t.currentTime=0,(t=r.Game.randTable(e.hurtSounds)).volume=.5,t.play(),t.currentTime=0,t.volume=1},e.hurt=function(){var t=r.Game.randTable(e.hurtSounds);t.play(),t.currentTime=0},e.enemySpawn=function(){e.enemySpawnSound.play(),e.enemySpawnSound.currentTime=0},e.chest=function(){var t=r.Game.randTable(e.chestSounds);t.play(),t.currentTime=0},e.pickupCoin=function(){var t=r.Game.randTable(e.coinPickupSounds);t.play(),t.currentTime=0},e.mine=function(){var t=r.Game.randTable(e.miningSounds);t.play(),t.currentTime=0},e.breakRock=function(){e.breakRockSound.play(),e.breakRockSound.currentTime=0},e.powerup=function(){e.powerupSound.play(),e.powerupSound.currentTime=0},e.heal=function(){e.healSound.play(),e.healSound.currentTime=0},e.genericPickup=function(){e.genericPickupSound.play(),e.genericPickupSound.currentTime=0},e.push=function(){var t=r.Game.randTable(e.pushSounds);t.play(),t.currentTime=0},e.playMusic=function(){e.music.addEventListener("ended",(function(){e.music.currentTime=0,e.music.play()}),!1)},e}();t.Sound=o},5269:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Bones=void 0;var a=n(2967),i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.draw=function(){a.Game.drawTile(7,t.skin,1,1,t.x,t.y,1,1,t.level.shadeColor,t.shadeAmount())},t}return o(t,e),t}(n(9626).Floor);t.Bones=i},5654:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.BottomDoor=void 0;var a=n(2967),i=function(e){function t(t,n,r,o,i){var l=e.call(this,t,r,o)||this;return l.canCrushEnemy=function(){return!0},l.onCollide=function(e){l.game.changeLevelThroughDoor(l.linkedDoor)},l.drawAbovePlayer=function(){},l.drawAboveShading=function(){a.Game.drawFX(2,2,1,1,l.x,l.y-1.25+.125*Math.sin(.006*Date.now()),1,1)},l.game=n,l.linkedDoor=i,l}return o(t,e),t}(n(1384).Tile);t.BottomDoor=i},850:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Button=void 0;var a=n(2967),i=function(e){function t(t,n,r,o){var i=e.call(this,t,n,r)||this;return i.press=function(){i.pressed=!0,i.linkedDoor.opened=!0},i.unpress=function(){i.pressed=!1,i.linkedDoor.opened=!1},i.tickEnd=function(){i.unpress(),i.level.game.player.x===i.x&&i.level.game.player.y===i.y&&i.press();for(var e=0,t=i.level.enemies;e<t.length;e++){var n=t[e];n.x===i.x&&n.y===i.y&&i.press()}},i.draw=function(){a.Game.drawTile(1,0,1,1,i.x,i.y,1,1,i.level.shadeColor,i.shadeAmount()),i.pressed?a.Game.drawTile(18,0,1,1,i.x,i.y,i.w,i.h,i.level.shadeColor,i.shadeAmount()):a.Game.drawTile(17,0,1,1,i.x,i.y,i.w,i.h,i.level.shadeColor,i.shadeAmount())},i.w=1,i.h=1,i.pressed=!1,i.turnsSincePressed=1,i.linkedDoor=o,i}return o(t,e),t}(n(1384).Tile);t.Button=i},1902:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Chasm=void 0;var a=n(2967),i=function(e){function t(t,n,r,o,i,l,s){var u=e.call(this,t,n,r)||this;return u.isSolid=function(){return!0},u.canCrushEnemy=function(){return!0},u.draw=function(){u.topEdge&&a.Game.drawTile(22,0,1,2,u.x,u.y,1,2,u.level.shadeColor,u.shadeAmount())},u.drawUnderPlayer=function(){a.Game.drawTile(u.tileX,u.tileY,1,1,u.x,u.y,1,1,u.level.shadeColor,u.shadeAmount())},u.tileX=1===u.skin?24:20,u.tileY=1,o?u.tileX--:i&&u.tileX++,l?u.tileY--:s&&u.tileY++,u.topEdge=l,u}return o(t,e),t}(n(1384).Tile);t.Chasm=i},5990:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.CoffinTile=void 0;var a=n(2967),i=function(e){function t(t,n,r,o){var i=e.call(this,t,n,r)||this;return i.isSolid=function(){return!0},i.canCrushEnemy=function(){return!0},i.drawUnderPlayer=function(){0===i.subTileY?(a.Game.drawTile(0,5,1,1,i.x-1,i.y-1,1,1,i.level.shadeColor,i.shadeAmount()),a.Game.drawTile(1,5,1,1,i.x,i.y-1,1,1,i.level.shadeColor,i.shadeAmount()),a.Game.drawTile(2,5,1,1,i.x+1,i.y-1,1,1,i.level.shadeColor,i.shadeAmount()),a.Game.drawTile(0,6,1,1,i.x-1,i.y,1,1,i.level.shadeColor,i.shadeAmount()),a.Game.drawTile(1,6,1,1,i.x,i.y,1,1,i.level.shadeColor,i.shadeAmount()),a.Game.drawTile(2,6,1,1,i.x+1,i.y,1,1,i.level.shadeColor,i.shadeAmount())):(a.Game.drawTile(0,7,1,1,i.x-1,i.y,1,1,i.level.shadeColor,i.shadeAmount()),a.Game.drawTile(1,7,1,1,i.x,i.y,1,1,i.level.shadeColor,i.shadeAmount()),a.Game.drawTile(2,7,1,1,i.x+1,i.y,1,1,i.level.shadeColor,i.shadeAmount()))},i.subTileY=o,i}return o(t,e),t}(n(1384).Tile);t.CoffinTile=i},9143:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Door=void 0;var a=n(2967),i=function(e){function t(t,n,r,o,i){var l=e.call(this,t,r,o)||this;return l.canCrushEnemy=function(){return!0},l.onCollide=function(e){l.opened=!0,l.game.changeLevelThroughDoor(l.linkedDoor)},l.draw=function(){l.opened?a.Game.drawTile(6,l.skin,1,1,l.x,l.y,1,1,l.level.shadeColor,l.shadeAmount()):a.Game.drawTile(3,l.skin,1,1,l.x,l.y,1,1,l.level.shadeColor,l.shadeAmount())},l.drawAbovePlayer=function(){l.opened?a.Game.drawTile(14,0,1,1,l.x,l.y-1,1,1,l.level.shadeColor,l.shadeAmount()):a.Game.drawTile(13,0,1,1,l.x,l.y-1,1,1,l.level.shadeColor,l.shadeAmount())},l.drawAboveShading=function(){a.Game.drawFX(2,2,1,1,l.x,l.y-1.25+.125*Math.sin(.006*Date.now()),1,1)},l.game=n,l.linkedDoor=i,l.opened=!1,l}return o(t,e),t}(n(1384).Tile);t.Door=i},9382:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.DownLadder=void 0;var a=n(2967),i=function(e){function t(t,n,r,o){var i=e.call(this,t,r,o)||this;return i.isRope=!1,i.generate=function(){i.linkedLadder||(i.linkedLadder=i.game.levelgen.generate(i.game,i.level.depth+(i.isRope?0:1),i.isRope),i.linkedLadder.linkedLadder=i)},i.onCollide=function(e){i.game.changeLevelThroughLadder(i)},i.draw=function(){var e=4;i.isRope&&(e=16),a.Game.drawTile(1,i.skin,1,1,i.x,i.y,1,1,i.level.shadeColor,i.shadeAmount()),a.Game.drawTile(e,i.skin,1,1,i.x,i.y,1,1,i.level.shadeColor,i.shadeAmount())},i.drawAbovePlayer=function(){},i.game=n,i.linkedLadder=null,i}return o(t,e),t}(n(1384).Tile);t.DownLadder=i},9626:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Floor=void 0;var a=n(2967),i=n(1384),l=function(e){function t(t,n,r){var o=e.call(this,t,n,r)||this;return o.draw=function(){a.Game.drawTile(o.variation,o.skin,1,1,o.x,o.y,1,1,o.level.shadeColor,o.shadeAmount())},o.variation=1,o.skin==i.SkinType.DUNGEON&&(o.variation=a.Game.randTable([1,1,1,1,1,1,8,8,8,9,10,10,10,10,10,12])),o.skin==i.SkinType.CAVE&&(o.variation=a.Game.randTable([1,1,1,1,1,1,8,8,8,9,10,10,10,10,10,12])),o}return o(t,e),t}(i.Tile);t.Floor=l},8341:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.FountainTile=void 0;var a=n(2967),i=function(e){function t(t,n,r,o,i){var l=e.call(this,t,n,r)||this;return l.isSolid=function(){return!0},l.canCrushEnemy=function(){return!0},l.draw=function(){a.Game.drawTile(1,l.skin,1,1,l.x,l.y,1,1,l.level.shadeColor,l.shadeAmount()),a.Game.drawTile(l.subTileX,2+l.subTileY,1,1,l.x,l.y,1,1,l.level.shadeColor,l.shadeAmount())},l.subTileX=o,l.subTileY=i,l}return o(t,e),t}(n(1384).Tile);t.FountainTile=i},7149:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.InsideLevelDoor=void 0;var a=n(2967),i=function(e){function t(t,n,r,o){var i=e.call(this,t,r,o)||this;return i.isSolid=function(){return!i.opened},i.canCrushEnemy=function(){return!i.opened},i.isOpaque=function(){return!i.opened},i.draw=function(){a.Game.drawTile(1,0,1,1,i.x,i.y,1,1,i.level.shadeColor,i.shadeAmount()),i.opened?a.Game.drawTile(15,1,1,1,i.x,i.y,1,1,i.level.shadeColor,i.shadeAmount()):a.Game.drawTile(3,i.skin,1,1,i.x,i.y,1,1,i.level.shadeColor,i.shadeAmount())},i.drawAbovePlayer=function(){i.opened?a.Game.drawTile(14,0,1,1,i.x,i.y-1,1,1,i.level.shadeColor,i.shadeAmount()):a.Game.drawTile(13,0,1,1,i.x,i.y-1,1,1,i.level.shadeColor,i.shadeAmount())},i.game=n,i.opened=!1,i}return o(t,e),t}(n(1384).Tile);t.InsideLevelDoor=i},8791:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.LockedDoor=void 0;var a=n(2967),i=n(1785),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.unlock=function(e){var n=e.inventory.hasItem(i.Key);null!==n&&(e.inventory.items=e.inventory.items.filter((function(e){return e!==n})),t.level.levelArray[t.x][t.y]=t.unlockedDoor,t.level.doors.push(t.unlockedDoor))},t.isSolid=function(){return!0},t.canCrushEnemy=function(){return!0},t.isOpaque=function(){return!0},t.draw=function(){a.Game.drawTile(17,t.skin,1,1,t.x,t.y,1,1,t.level.shadeColor,t.shadeAmount())},t}return o(t,e),t}(n(1384).Tile);t.LockedDoor=l},6882:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.SideDoor=void 0;var a=n(2967),i=function(e){function t(t,n,r,o,i){var l=e.call(this,t,r,o)||this;return l.canCrushEnemy=function(){return!0},l.onCollide=function(e){l.opened=!0,l.game.changeLevelThroughDoor(l.linkedDoor,l.linkedDoor.level.x-l.level.x>0?1:-1)},l.draw=function(){a.Game.drawTile(0,l.skin,1,1,l.x,l.y-1,1,1,l.level.shadeColor,l.shadeAmount()),a.Game.drawTile(1,l.skin,1,1,l.x,l.y,1,1,l.level.shadeColor,l.shadeAmount())},l.drawAbovePlayer=function(){},l.drawAboveShading=function(){a.Game.drawFX(2,2,1,1,l.x,l.y-1.25+.125*Math.sin(.006*Date.now()),1,1)},l.game=n,l.linkedDoor=i,l.opened=!1,l}return o(t,e),t}(n(1384).Tile);t.SideDoor=i},953:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.SpawnFloor=void 0;var a=n(2967),i=function(e){function t(t,n,r){var o=e.call(this,t,n,r)||this;return o.draw=function(){a.Game.drawTile(o.variation,o.skin,1,1,o.x,o.y,o.w,o.h,o.level.shadeColor,o.shadeAmount())},o.w=1,o.h=1,o.variation=1,1==a.Game.rand(1,20)&&(o.variation=a.Game.randTable([8,9,10,12])),o}return o(t,e),t}(n(1384).Tile);t.SpawnFloor=i},5525:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Spike=void 0;var a=n(2967),i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onCollide=function(e){e.hurt(1)},t.draw=function(){a.Game.drawTile(11,0,1,1,t.x,t.y,1,1,t.level.shadeColor,t.shadeAmount())},t}return o(t,e),t}(n(1384).Tile);t.Spike=i},3280:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.SpikeTrap=void 0;var a=n(2967),i=n(1384),l=n(6061),s=n(6750),u=n(8084),c=function(e){function t(t,n,r,o){var i=e.call(this,t,n,r)||this;return i.tick=function(){i.tickCount++,i.tickCount>=4&&(i.tickCount=0),i.on=0===i.tickCount,i.on&&i.level.game.player.x===i.x&&i.level.game.player.y===i.y&&i.level.game.player.hurt(1),3===i.tickCount&&i.level.projectiles.push(new u.HitWarning(i.level.game,i.x,i.y))},i.tickEnd=function(){if(i.on)for(var e=0,t=i.level.enemies;e<t.length;e++){var n=t[e];n.x===i.x&&n.y===i.y&&n.hurt(1)}},i.onCollideEnemy=function(e){i.on&&!(e instanceof l.Crate||e instanceof s.Barrel)&&e.hurt(1)},i.draw=function(){a.Game.drawTile(1,i.skin,1,1,i.x,i.y,1,1,i.level.shadeColor,i.shadeAmount())},i.t=0,i.drawUnderPlayer=function(){var e=0;i.t++,i.on||3!==i.tickCount||(i.t%4==1&&(e=.0325),i.t%4==3&&(e=-.0325));var t=[0,1,2,3,3,4,2,0],n=6+t[Math.floor(i.frame)];(1===i.tickCount||0===i.tickCount&&0===t[Math.floor(i.frame)])&&(n=5),a.Game.drawObj(n,0,1,2,i.x+e,i.y-1,1,2,i.level.shadeColor,i.shadeAmount()),i.on&&i.frame<t.length-1&&(t[Math.floor(i.frame)]<3?i.frame+=.4:i.frame+=.2),i.on||(i.frame=0)},i.tickCount=o||0,i.on=!1,i.frame=0,i}return o(t,e),t}(i.Tile);t.SpikeTrap=c},1384:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.Tile=t.SkinType=void 0,(n=t.SkinType||(t.SkinType={}))[n.DUNGEON=0]="DUNGEON",n[n.CAVE=1]="CAVE";t.Tile=function(e,t,n){var r=this;this.shadeAmount=function(){return r.level.softVis[r.x][r.y]},this.isSolid=function(){return!1},this.canCrushEnemy=function(){return!1},this.isOpaque=function(){return!1},this.onCollide=function(e){},this.onCollideEnemy=function(e){},this.tick=function(){},this.tickEnd=function(){},this.draw=function(){},this.drawUnderPlayer=function(){},this.drawAbovePlayer=function(){},this.drawAboveShading=function(){},this.skin=e.skin,this.level=e,this.x=t,this.y=n}},9039:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Trapdoor=void 0;var a=n(2967),i=function(e){function t(t,n,r,o){var i=e.call(this,t,r,o)||this;return i.draw=function(){a.Game.drawTile(13,i.skin,1,1,i.x,i.y,1,1,i.level.shadeColor,i.shadeAmount())},i.onCollide=function(e){},i.game=n,i}return o(t,e),t}(n(1384).Tile);t.Trapdoor=i},6563:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.UpLadder=void 0;var a=n(2967),i=function(e){function t(t,n,r,o){var i=e.call(this,t,r,o)||this;return i.isRope=!1,i.onCollide=function(e){i.game.changeLevelThroughLadder(i)},i.draw=function(){var e=29,t=0;i.isRope&&(e=16,t=1),a.Game.drawTile(1,i.skin,1,1,i.x,i.y,1,1,i.level.shadeColor,i.shadeAmount()),i.isRope||a.Game.drawTile(e,t,1,1,i.x,i.y-1,1,1,i.level.shadeColor,i.shadeAmount()),a.Game.drawTile(e,t+1,1,1,i.x,i.y,1,1,i.level.shadeColor,i.shadeAmount())},i.drawAbovePlayer=function(){i.isRope&&a.Game.drawTile(16,1,1,1,i.x,i.y-1,1,1,i.level.shadeColor,i.shadeAmount())},i.game=n,i}return o(t,e),t}(n(1384).Tile);t.UpLadder=i},312:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Wall=void 0;var a=n(2967),i=function(e){function t(t,n,r,o){var i=e.call(this,t,n,r)||this;return i.isSolid=function(){return!0},i.canCrushEnemy=function(){return!0},i.isOpaque=function(){return!0},i.draw=function(){1===i.type&&a.Game.drawTile(5,i.skin,1,1,i.x,i.y,1,1,i.level.shadeColor,i.shadeAmount())},i.type=o,i}return o(t,e),t}(n(1384).Tile);t.Wall=i},9732:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.WallSide=void 0;var a=n(2967),i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isSolid=function(){return!0},t.canCrushEnemy=function(){return!0},t.isOpaque=function(){return!1},t.draw=function(){a.Game.drawTile(0,t.skin,1,1,t.x,t.y,1,1,t.level.shadeColor,t.shadeAmount())},t}return o(t,e),t}(n(1384).Tile);t.WallSide=i},3400:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.WallSideTorch=void 0;var a=n(2967),i=n(1384),l=n(5752),s=function(e){function t(t,n,r){var o=e.call(this,t,n,r)||this;return o.isSolid=function(){return!0},o.canCrushEnemy=function(){return!0},o.isOpaque=function(){return!1},o.draw=function(){o.frame+=.3,o.frame>=12&&(o.frame=0),a.Game.drawTile(0,o.skin,1,1,o.x,o.y,1,1,o.level.shadeColor,o.shadeAmount()),a.Game.drawFX(Math.floor(o.frame),32,1,2,o.x,o.y-1,1,2)},o.level.lightSources.push(new l.LightSource(o.x+.5,o.y+.5,3)),o.frame=12*Math.random(),o}return o(t,e),t}(i.Tile);t.WallSideTorch=s},6330:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Dagger=void 0;var a=n(2091),i=n(5958),l=n(5554),s=n(6061),u=n(6750),c=function(e){function t(t,n,r){var o=e.call(this,t,n,r)||this;return o.weaponMove=function(e,t){for(var n=!1,r=0,a=o.game.level.enemies;r<a.length;r++){var c=a[r];c.destroyable&&!(c instanceof s.Crate||c instanceof u.Barrel)&&c.x===e&&c.y===t&&(c.hurt(1),n=!0)}return n&&(i.Sound.hit(),o.game.player.drawX=.5*(o.game.player.x-e),o.game.player.drawY=.5*(o.game.player.y-t),o.game.level.particles.push(new l.SlashParticle(e,t)),o.game.level.tick(),o.game.shakeScreen(10*o.game.player.drawX,10*o.game.player.drawY)),!n},o.getDescription=function(){return"DAGGER\nDamage 1"},o.tileX=22,o.tileY=0,o}return o(t,e),t}(a.Weapon);t.Dagger=c},2920:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.DualDagger=void 0;var a=n(2091),i=n(5958),l=n(5554),s=n(6061),u=n(6750),c=function(e){function t(t,n,r){var o=e.call(this,t,n,r)||this;return o.tickInInventory=function(){o.firstAttack=!0},o.weaponMove=function(e,t){for(var n=!1,r=0,a=o.game.level.enemies;r<a.length;r++){var c=a[r];c.destroyable&&!(c instanceof s.Crate||c instanceof u.Barrel)&&c.x===e&&c.y===t&&(c.hurt(1),n=!0)}return n&&(i.Sound.hit(),o.game.player.drawX=.5*(o.game.player.x-e),o.game.player.drawY=.5*(o.game.player.y-t),o.game.level.particles.push(new l.SlashParticle(e,t)),o.firstAttack?o.game.level.enemies=o.game.level.enemies.filter((function(e){return!e.dead})):o.game.level.tick(),o.game.shakeScreen(10*o.game.player.drawX,10*o.game.player.drawY),o.firstAttack&&(o.firstAttack=!1)),!n},o.getDescription=function(){return"DUAL DAGGERS\nOne extra attack per turn"},o.tileX=23,o.tileY=0,o.firstAttack=!0,o}return o(t,e),t}(a.Weapon);t.DualDagger=c},1656:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Shotgun=void 0;var a=n(2091),i=n(5958),l=n(2621),s=function(e){function t(t,n,r){var o=e.call(this,t,n,r)||this;return o.weaponMove=function(e,t){var n=2*e-o.game.player.x,r=2*t-o.game.player.y,a=3*e-2*o.game.player.x,s=3*t-2*o.game.player.y,u=3;if(!o.game.level.tileInside(e,t)||o.game.level.levelArray[e][t].isSolid())return!0;!o.game.level.tileInside(n,r)||o.game.level.levelArray[n][r].isSolid()?u=1:o.game.level.tileInside(a,s)&&!o.game.level.levelArray[a][s].isSolid()||(u=2);for(var c=[],h=4,d=5,p=5,f=0,m=o.game.level.enemies;f<m.length;f++)if((T=m[f]).pushable){if(T.x===e&&T.y===t)return!0;T.x===n&&T.y===r&&u>=2&&(c.push({enemy:T,dist:2}),h=2),T.x===a&&T.y===s&&u>=3&&(c.push({enemy:T,dist:3}),h=Math.min(h,3))}else T.destroyable?(T.x===e&&T.y===t&&u>=1&&(d=1,c.push({enemy:T,dist:1})),T.x===n&&T.y===r&&u>=2&&(d=Math.min(d,2),c.push({enemy:T,dist:2})),T.x===a&&T.y===s&&u>=3&&(d=Math.min(d,3),c.push({enemy:T,dist:3}))):(T.x===e&&T.y===t&&u>=1&&(p=1),T.x===n&&T.y===r&&u>=2&&(p=Math.min(p,2)),T.x===a&&T.y===s&&u>=3&&(p=Math.min(p,3)));var y=a,v=s;if(p<d&&p<h)return!0;if(d<=h){for(var w=0,g=c;w<g.length;w++){var _=g[w],T=_.enemy;3===_.dist?T.hurt(.5):T.hurt(1)}i.Sound.hit(),o.game.player.drawX=.5*(o.game.player.x-e),o.game.player.drawY=.5*(o.game.player.y-t),l.GenericParticle.shotgun(o.game.level,o.game.player.x+.5,o.game.player.y,y+.5,v,"black"),l.GenericParticle.shotgun(o.game.level,o.game.player.x+.5,o.game.player.y,y+.5,v,"#ffddff");var E=new l.GenericParticle(o.game.level,.5*(e+o.game.player.x)+.5,.5*(t+o.game.player.y),0,1,0,0,0,"white",0);return E.expirationTimer=10,o.game.level.particles.push(E),o.game.level.tick(),o.game.shakeScreen(10*o.game.player.drawX,10*o.game.player.drawY),!1}return!0},o.getDescription=function(){return"SHOTGUN\nRange 3, penetration"},o.tileX=26,o.tileY=0,o}return o(t,e),t}(a.Weapon);t.Shotgun=s},3806:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Spear=void 0;var a=n(2091),i=n(5958),l=n(5554),s=n(6061),u=n(6750),c=function(e){function t(t,n,r){var o=e.call(this,t,n,r)||this;return o.weaponMove=function(e,t){for(var n=2*e-o.game.player.x,r=2*t-o.game.player.y,a=!1,c=[],h=0,d=o.game.level.enemies;h<d.length;h++)if((m=d[h]).destroyable){if(m.x===e&&m.y===t){if(m instanceof s.Crate||m instanceof u.Barrel)return!0;m.hurt(1),a=!0}m.x!==n||m.y!==r||o.game.level.levelArray[e][t].isSolid()||m instanceof s.Crate||m instanceof u.Barrel||c.push(m)}if(!a&&c.length>0){for(var p=0,f=c;p<f.length;p++){var m;(m=f[p]).hurt(1)}return i.Sound.hit(),o.game.player.drawX=.5*(o.game.player.x-e),o.game.player.drawY=.5*(o.game.player.y-t),o.game.level.particles.push(new l.SlashParticle(e,t)),o.game.level.particles.push(new l.SlashParticle(n,r)),o.game.level.tick(),o.game.shakeScreen(10*o.game.player.drawX,10*o.game.player.drawY),!1}return a&&(i.Sound.hit(),o.game.player.drawX=.5*(o.game.player.x-e),o.game.player.drawY=.5*(o.game.player.y-t),o.game.level.particles.push(new l.SlashParticle(e,t)),o.game.level.tick(),o.game.shakeScreen(10*o.game.player.drawX,10*o.game.player.drawY)),!a},o.getDescription=function(){return"SPEAR\nRange 2"},o.tileX=24,o.tileY=0,o}return o(t,e),t}(a.Weapon);t.Spear=c},2091:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Weapon=void 0;var a=function(e){function t(n,r,o){var a=e.call(this,n,r,o)||this;return a.coEquippable=function(e){return!(e instanceof t)},a.tick=function(){},a.weaponMove=function(e,t){return!0},n&&(a.game=n.game),a}return o(t,e),t}(n(8499).Equippable);t.Weapon=a}},t={};!function n(r){if(t[r])return t[r].exports;var o=t[r]={exports:{}};return e[r].call(o.exports,o,o.exports,n),o.exports}(2967)})();