(()=>{var e={3010:e=>{function t(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}e.exports=t,t.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},t.prototype.reset=function(){this.attempts=0},t.prototype.setMin=function(e){this.ms=e},t.prototype.setMax=function(e){this.max=e},t.prototype.setJitter=function(e){this.jitter=e}},3704:(e,t)=>{!function(e){"use strict";t.encode=function(t){var n,r=new Uint8Array(t),a=r.length,o="";for(n=0;n<a;n+=3)o+=e[r[n]>>2],o+=e[(3&r[n])<<4|r[n+1]>>4],o+=e[(15&r[n+1])<<2|r[n+2]>>6],o+=e[63&r[n+2]];return a%3==2?o=o.substring(0,o.length-1)+"=":a%3==1&&(o=o.substring(0,o.length-2)+"=="),o},t.decode=function(t){var n,r,a,o,i,s=.75*t.length,l=t.length,c=0;"="===t[t.length-1]&&(s--,"="===t[t.length-2]&&s--);var u=new ArrayBuffer(s),h=new Uint8Array(u);for(n=0;n<l;n+=4)r=e.indexOf(t[n]),a=e.indexOf(t[n+1]),o=e.indexOf(t[n+2]),i=e.indexOf(t[n+3]),h[c++]=r<<2|a>>4,h[c++]=(15&a)<<4|o>>2,h[c++]=(3&o)<<6|63&i;return u}}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},6077:e=>{var t=[].slice;e.exports=function(e,n){if("string"==typeof n&&(n=e[n]),"function"!=typeof n)throw new Error("bind() requires a function");var r=t.call(arguments,2);return function(){return n.apply(e,r.concat(t.call(arguments)))}}},8767:e=>{function t(e){if(e)return function(e){for(var n in t.prototype)e[n]=t.prototype[n];return e}(e)}e.exports=t,t.prototype.on=t.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},t.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},t.prototype.off=t.prototype.removeListener=t.prototype.removeAllListeners=t.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var a=0;a<r.length;a++)if((n=r[a])===t||n.fn===t){r.splice(a,1);break}return 0===r.length&&delete this._callbacks["$"+e],this},t.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(n){r=0;for(var a=(n=n.slice(0)).length;r<a;++r)n[r].apply(this,t)}return this},t.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},t.prototype.hasListeners=function(e){return!!this.listeners(e).length}},3549:e=>{e.exports="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")()},5983:(e,t,n)=>{const r=n(2192);e.exports=(e,t)=>new r(e,t),e.exports.Socket=r,e.exports.protocol=r.protocol,e.exports.Transport=n(6496),e.exports.transports=n(3352),e.exports.parser=n(9743)},2192:(e,t,n)=>{const r=n(3352),a=n(8767),o=n(4802)("engine.io-client:socket"),i=n(9743),s=n(4187),l=n(1830);class c extends a{constructor(e,t={}){super(),e&&"object"==typeof e&&(t=e,e=null),e?(e=s(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=s(t.host).host),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?443:80),this.transports=t.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,upgrade:!0,jsonp:!0,timestampParam:"t",policyPort:843,rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{}},t),this.opts.path=this.opts.path.replace(/\/$/,"")+"/","string"==typeof this.opts.query&&(this.opts.query=l.decode(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,this.open()}createTransport(e){o('creating transport "%s"',e);const t=function(e){const t={};for(let n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}(this.opts.query);t.EIO=i.protocol,t.transport=e,this.id&&(t.sid=this.id);const n=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return o("options: %j",n),new r[e](n)}open(){let e;if(this.opts.rememberUpgrade&&c.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){const e=this;return void setTimeout((function(){e.emit("error","No transports available")}),0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return o("error while creating transport: %s",e),this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}setTransport(e){o("setting transport %s",e.name);const t=this;this.transport&&(o("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",(function(){t.onDrain()})).on("packet",(function(e){t.onPacket(e)})).on("error",(function(e){t.onError(e)})).on("close",(function(){t.onClose("transport close")}))}probe(e){o('probing transport "%s"',e);let t=this.createTransport(e,{probe:1}),n=!1;const r=this;function a(){if(r.onlyBinaryUpgrades){const e=!this.supportsBinary&&r.transport.supportsBinary;n=n||e}n||(o('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",(function(a){if(!n)if("pong"===a.type&&"probe"===a.data){if(o('probe transport "%s" pong',e),r.upgrading=!0,r.emit("upgrading",t),!t)return;c.priorWebsocketSuccess="websocket"===t.name,o('pausing current transport "%s"',r.transport.name),r.transport.pause((function(){n||"closed"!==r.readyState&&(o("changing transport and sending upgrade packet"),p(),r.setTransport(t),t.send([{type:"upgrade"}]),r.emit("upgrade",t),t=null,r.upgrading=!1,r.flush())}))}else{o('probe transport "%s" failed',e);const n=new Error("probe error");n.transport=t.name,r.emit("upgradeError",n)}})))}function i(){n||(n=!0,p(),t.close(),t=null)}function s(n){const a=new Error("probe error: "+n);a.transport=t.name,i(),o('probe transport "%s" failed because of error: %s',e,n),r.emit("upgradeError",a)}function l(){s("transport closed")}function u(){s("socket closed")}function h(e){t&&e.name!==t.name&&(o('"%s" works - aborting "%s"',e.name,t.name),i())}function p(){t.removeListener("open",a),t.removeListener("error",s),t.removeListener("close",l),r.removeListener("close",u),r.removeListener("upgrading",h)}c.priorWebsocketSuccess=!1,t.once("open",a),t.once("error",s),t.once("close",l),this.once("close",u),this.once("upgrading",h),t.open()}onOpen(){if(o("socket open"),this.readyState="open",c.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade&&this.transport.pause){o("starting upgrade probes");let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(o('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emit("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else o('packet received with socket readyState "%s"',this.readyState)}onHandshake(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){clearTimeout(this.pingTimeoutTimer),this.pingTimeoutTimer=setTimeout((()=>{this.onClose("ping timeout")}),this.pingInterval+this.pingTimeout)}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()}flush(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(o("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))}write(e,t,n){return this.sendPacket("message",e,t,n),this}send(e,t,n){return this.sendPacket("message",e,t,n),this}sendPacket(e,t,n,r){if("function"==typeof t&&(r=t,t=void 0),"function"==typeof n&&(r=n,n=null),"closing"===this.readyState||"closed"===this.readyState)return;(n=n||{}).compress=!1!==n.compress;const a={type:e,data:t,options:n};this.emit("packetCreate",a),this.writeBuffer.push(a),r&&this.once("flush",r),this.flush()}close(){const e=this;function t(){e.onClose("forced close"),o("socket closing - telling transport to close"),e.transport.close()}function n(){e.removeListener("upgrade",n),e.removeListener("upgradeError",n),t()}function r(){e.once("upgrade",n),e.once("upgradeError",n)}return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(function(){this.upgrading?r():t()})):this.upgrading?r():t()),this}onError(e){o("socket error %j",e),c.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)}onClose(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){o('socket close with reason: "%s"',e);const n=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),n.writeBuffer=[],n.prevBufferLen=0}}filterUpgrades(e){const t=[];let n=0;const r=e.length;for(;n<r;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}}c.priorWebsocketSuccess=!1,c.protocol=i.protocol,e.exports=c},6496:(e,t,n)=>{const r=n(9743),a=n(8767);e.exports=class extends a{constructor(e){super(),this.opts=e,this.query=e.query,this.readyState="",this.socket=e.socket}onError(e,t){const n=new Error(e);return n.type="TransportError",n.description=t,this.emit("error",n),this}open(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){if("open"!==this.readyState)throw new Error("Transport not open");this.write(e)}onOpen(){this.readyState="open",this.writable=!0,this.emit("open")}onData(e){const t=r.decodePacket(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){this.emit("packet",e)}onClose(){this.readyState="closed",this.emit("close")}}},3352:(e,t,n)=>{const r=n(2777),a=n(3416),o=n(9785),i=n(4442);t.polling=function(e){let t,n=!1,i=!1;const s=!1!==e.jsonp;if("undefined"!=typeof location){const t="https:"===location.protocol;let r=location.port;r||(r=t?443:80),n=e.hostname!==location.hostname||r!==e.port,i=e.secure!==t}if(e.xdomain=n,e.xscheme=i,t=new r(e),"open"in t&&!e.forceJSONP)return new a(e);if(!s)throw new Error("JSONP disabled");return new o(e)},t.websocket=i},9785:(e,t,n)=>{const r=n(9015),a=n(3549),o=/\n/g,i=/\\n/g;let s;function l(){}e.exports=class extends r{constructor(e){super(e),this.query=this.query||{},s||(s=a.___eio=a.___eio||[]),this.index=s.length;const t=this;s.push((function(e){t.onData(e)})),this.query.j=this.index,"function"==typeof addEventListener&&addEventListener("beforeunload",(function(){t.script&&(t.script.onerror=l)}),!1)}get supportsBinary(){return!1}doClose(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),super.doClose()}doPoll(){const e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};const n=document.getElementsByTagName("script")[0];n?n.parentNode.insertBefore(t,n):(document.head||document.body).appendChild(t),this.script=t,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout((function(){const e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)}),100)}doWrite(e,t){const n=this;let r;if(!this.form){const e=document.createElement("form"),t=document.createElement("textarea"),n=this.iframeId="eio_iframe_"+this.index;e.className="socketio",e.style.position="absolute",e.style.top="-1000px",e.style.left="-1000px",e.target=n,e.method="POST",e.setAttribute("accept-charset","utf-8"),t.name="d",e.appendChild(t),document.body.appendChild(e),this.form=e,this.area=t}function a(){s(),t()}function s(){if(n.iframe)try{n.form.removeChild(n.iframe)}catch(e){n.onError("jsonp polling iframe removal error",e)}try{const e='<iframe src="javascript:0" name="'+n.iframeId+'">';r=document.createElement(e)}catch(e){r=document.createElement("iframe"),r.name=n.iframeId,r.src="javascript:0"}r.id=n.iframeId,n.form.appendChild(r),n.iframe=r}this.form.action=this.uri(),s(),e=e.replace(i,"\\\n"),this.area.value=e.replace(o,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===n.iframe.readyState&&a()}:this.iframe.onload=a}}},3416:(e,t,n)=>{const r=n(2777),a=n(9015),o=n(8767),{pick:i}=n(6839),s=n(3549),l=n(4802)("engine.io-client:polling-xhr");function c(){}const u=null!=new(n(2777))({xdomain:!1}).responseType;class h extends o{constructor(e,t){super(),this.opts=t,this.method=t.method||"GET",this.uri=e,this.async=!1!==t.async,this.data=void 0!==t.data?t.data:null,this.isBinary=t.isBinary,this.supportsBinary=t.supportsBinary,this.create()}create(){const e=i(this.opts,"agent","enablesXDR","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;const t=this.xhr=new r(e),n=this;try{l("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(let e in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(e)&&t.setRequestHeader(e,this.opts.extraHeaders[e])}}catch(e){console.log(e)}if("POST"===this.method)try{this.isBinary?t.setRequestHeader("Content-type","application/octet-stream"):t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{t.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),this.hasXDR()?(t.onload=function(){n.onLoad()},t.onerror=function(){n.onError(t.responseText)}):t.onreadystatechange=function(){if(2===t.readyState)try{const e=t.getResponseHeader("Content-Type");(n.supportsBinary&&"application/octet-stream"===e||"application/octet-stream; charset=UTF-8"===e)&&(t.responseType="arraybuffer")}catch(e){}4===t.readyState&&(200===t.status||1223===t.status?n.onLoad():setTimeout((function(){n.onError("number"==typeof t.status?t.status:0)}),0))},l("xhr data %s",this.data),t.send(this.data)}catch(e){return void setTimeout((function(){n.onError(e)}),0)}"undefined"!=typeof document&&(this.index=h.requestsCount++,h.requests[this.index]=this)}onSuccess(){this.emit("success"),this.cleanup()}onData(e){this.emit("data",e),this.onSuccess()}onError(e){this.emit("error",e),this.cleanup(!0)}cleanup(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=c:this.xhr.onreadystatechange=c,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete h.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;null!==e&&this.onData(e)}hasXDR(){return"undefined"!=typeof XDomainRequest&&!this.xs&&this.enablesXDR}abort(){this.cleanup()}}function p(){for(let e in h.requests)h.requests.hasOwnProperty(e)&&h.requests[e].abort()}h.requestsCount=0,h.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",p):"function"==typeof addEventListener&&addEventListener("onpagehide"in s?"pagehide":"unload",p,!1)),e.exports=class extends a{constructor(e){if(super(e),"undefined"!=typeof location){const t="https:"===location.protocol;let n=location.port;n||(n=t?443:80),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||n!==e.port,this.xs=e.secure!==t}const t=e&&e.forceBase64;this.supportsBinary=u&&!t}request(e={}){return Object.assign(e,{supportsBinary:this.supportsBinary,xd:this.xd,xs:this.xs},this.opts),new h(this.uri(),e)}doWrite(e,t){const n="string"!=typeof e&&void 0!==e,r=this.request({method:"POST",data:e,isBinary:n}),a=this;r.on("success",t),r.on("error",(function(e){a.onError("xhr post error",e)}))}doPoll(){l("xhr poll");const e=this.request(),t=this;e.on("data",(function(e){t.onData(e)})),e.on("error",(function(e){t.onError("xhr poll error",e)})),this.pollXhr=e}},e.exports.Request=h},9015:(e,t,n)=>{const r=n(6496),a=n(1830),o=n(9743),i=n(2281),s=n(4802)("engine.io-client:polling");e.exports=class extends r{get name(){return"polling"}doOpen(){this.poll()}pause(e){const t=this;function n(){s("paused"),t.readyState="paused",e()}if(this.readyState="pausing",this.polling||!this.writable){let e=0;this.polling&&(s("we are currently polling - waiting to pause"),e++,this.once("pollComplete",(function(){s("pre-pause polling complete"),--e||n()}))),this.writable||(s("we are currently writing - waiting to pause"),e++,this.once("drain",(function(){s("pre-pause writing complete"),--e||n()})))}else n()}poll(){s("polling"),this.polling=!0,this.doPoll(),this.emit("poll")}onData(e){const t=this;s("polling got data %s",e),o.decodePayload(e,this.socket.binaryType).forEach((function(e,n,r){if("opening"===t.readyState&&t.onOpen(),"close"===e.type)return t.onClose(),!1;t.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():s('ignoring poll - transport state "%s"',this.readyState))}doClose(){const e=this;function t(){s("writing close packet"),e.write([{type:"close"}])}"open"===this.readyState?(s("transport open - closing"),t()):(s("transport not open - deferring close"),this.once("open",t))}write(e){this.writable=!1,o.encodePayload(e,(e=>{this.doWrite(e,(()=>{this.writable=!0,this.emit("drain")}))}))}uri(){let e=this.query||{};const t=this.opts.secure?"https":"http";let n="";return!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=i()),this.supportsBinary||e.sid||(e.b64=1),e=a.encode(e),this.opts.port&&("https"===t&&443!==Number(this.opts.port)||"http"===t&&80!==Number(this.opts.port))&&(n=":"+this.opts.port),e.length&&(e="?"+e),t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+e}}},866:(e,t,n)=>{const r=n(3549);e.exports={WebSocket:r.WebSocket||r.MozWebSocket,usingBrowserWebSocket:!0,defaultBinaryType:"arraybuffer"}},4442:(e,t,n)=>{const r=n(6496),a=n(9743),o=n(1830),i=n(2281),{pick:s}=n(6839),{WebSocket:l,usingBrowserWebSocket:c,defaultBinaryType:u}=n(866),h=n(4802)("engine.io-client:websocket"),p="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class d extends r{constructor(e){super(e),e&&e.forceBase64&&(this.supportsBinary=!1),this.supportsBinary=!0}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols;let n;n=p?s(this.opts,"localAddress"):s(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress"),this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=c&&!p?t?new l(e,t):new l(e):new l(e,t,n)}catch(e){return this.emit("error",e)}this.ws.binaryType=this.socket.binaryType||u,this.addEventListeners()}addEventListeners(){const e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}}write(e){const t=this;this.writable=!1;let n=e.length,r=0;const o=n;for(;r<o;r++)!function(e){a.encodePacket(e,t.supportsBinary,(function(r){const a={};!c&&(e.options&&(a.compress=e.options.compress),t.opts.perMessageDeflate)&&("string"==typeof r?Buffer.byteLength(r):r.length)<t.opts.perMessageDeflate.threshold&&(a.compress=!1);try{c?t.ws.send(r):t.ws.send(r,a)}catch(e){h("websocket closed before onclose event")}--n||(t.emit("flush"),setTimeout((function(){t.writable=!0,t.emit("drain")}),0))}))}(e[r])}onClose(){r.prototype.onClose.call(this)}doClose(){void 0!==this.ws&&this.ws.close()}uri(){let e=this.query||{};const t=this.opts.secure?"wss":"ws";let n="";return this.opts.port&&("wss"===t&&443!==Number(this.opts.port)||"ws"===t&&80!==Number(this.opts.port))&&(n=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=i()),this.supportsBinary||(e.b64=1),e=o.encode(e),e.length&&(e="?"+e),t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+e}check(){return!(!l||"__initialize"in l&&this.name===d.prototype.name)}}e.exports=d},6839:e=>{e.exports.pick=(e,...t)=>t.reduce(((t,n)=>(t[n]=e[n],t)),{})},2777:(e,t,n)=>{const r=n(8058),a=n(3549);e.exports=function(e){const t=e.xdomain,n=e.xscheme,o=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!t||r))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!n&&o)return new XDomainRequest}catch(e){}if(!t)try{return new(a[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}},4802:(e,t,n)=>{t.log=function(...e){return"object"==typeof console&&console.log&&console.log(...e)},t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,a=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(r++,"%c"===e&&(a=r))})),t.splice(a,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=n(804)(t);const{formatters:r}=e.exports;r.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},804:(e,t,n)=>{e.exports=function(e){function t(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return r.colors[Math.abs(t)%r.colors.length]}function r(e){let n;function i(...e){if(!i.enabled)return;const t=i,a=Number(new Date),o=a-(n||a);t.diff=o,t.prev=n,t.curr=a,n=a,e[0]=r.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((n,a)=>{if("%%"===n)return n;s++;const o=r.formatters[a];if("function"==typeof o){const r=e[s];n=o.call(t,r),e.splice(s,1),s--}return n})),r.formatArgs.call(t,e),(t.log||r.log).apply(t,e)}return i.namespace=e,i.enabled=r.enabled(e),i.useColors=r.useColors(),i.color=t(e),i.destroy=a,i.extend=o,"function"==typeof r.init&&r.init(i),r.instances.push(i),i}function a(){const e=r.instances.indexOf(this);return-1!==e&&(r.instances.splice(e,1),!0)}function o(e,t){const n=r(this.namespace+(void 0===t?":":t)+e);return n.log=this.log,n}function i(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return r.debug=r,r.default=r,r.coerce=function(e){return e instanceof Error?e.stack||e.message:e},r.disable=function(){const e=[...r.names.map(i),...r.skips.map(i).map((e=>"-"+e))].join(",");return r.enable(""),e},r.enable=function(e){let t;r.save(e),r.names=[],r.skips=[];const n=("string"==typeof e?e:"").split(/[\s,]+/),a=n.length;for(t=0;t<a;t++)n[t]&&("-"===(e=n[t].replace(/\*/g,".*?"))[0]?r.skips.push(new RegExp("^"+e.substr(1)+"$")):r.names.push(new RegExp("^"+e+"$")));for(t=0;t<r.instances.length;t++){const e=r.instances[t];e.enabled=r.enabled(e.namespace)}},r.enabled=function(e){if("*"===e[e.length-1])return!0;let t,n;for(t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1},r.humanize=n(7824),Object.keys(e).forEach((t=>{r[t]=e[t]})),r.instances=[],r.names=[],r.skips=[],r.formatters={},r.selectColor=t,r.enable(r.load()),r}},1712:e=>{const t=Object.create(null);t.open="0",t.close="1",t.ping="2",t.pong="3",t.message="4",t.upgrade="5",t.noop="6";const n=Object.create(null);Object.keys(t).forEach((e=>{n[t[e]]=e})),e.exports={PACKET_TYPES:t,PACKET_TYPES_REVERSE:n,ERROR_PACKET:{type:"error",data:"parser error"}}},4965:(e,t,n)=>{const{PACKET_TYPES_REVERSE:r,ERROR_PACKET:a}=n(1712);let o;"function"==typeof ArrayBuffer&&(o=n(3704));const i=(e,t)=>{if(o){const n=o.decode(e);return s(n,t)}return{base64:!0,data:e}},s=(e,t)=>{switch(t){case"blob":return e instanceof ArrayBuffer?new Blob([e]):e;case"arraybuffer":default:return e}};e.exports=(e,t)=>{if("string"!=typeof e)return{type:"message",data:s(e,t)};const n=e.charAt(0);return"b"===n?{type:"message",data:i(e.substring(1),t)}:r[n]?e.length>1?{type:r[n],data:e.substring(1)}:{type:r[n]}:a}},2929:(e,t,n)=>{const{PACKET_TYPES:r}=n(1712),a="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),o="function"==typeof ArrayBuffer,i=(e,t)=>{const n=new FileReader;return n.onload=function(){const e=n.result.split(",")[1];t("b"+e)},n.readAsDataURL(e)};e.exports=({type:e,data:t},n,s)=>{return a&&t instanceof Blob?n?s(t):i(t,s):o&&(t instanceof ArrayBuffer||(l=t,"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(l):l&&l.buffer instanceof ArrayBuffer))?n?s(t instanceof ArrayBuffer?t:t.buffer):i(new Blob([t]),s):s(r[e]+(t||""));var l}},9743:(e,t,n)=>{const r=n(2929),a=n(4965),o=String.fromCharCode(30);e.exports={protocol:4,encodePacket:r,encodePayload:(e,t)=>{const n=e.length,a=new Array(n);let i=0;e.forEach(((e,s)=>{r(e,!1,(e=>{a[s]=e,++i===n&&t(a.join(o))}))}))},decodePacket:a,decodePayload:(e,t)=>{const n=e.split(o),r=[];for(let e=0;e<n.length;e++){const o=a(n[e],t);if(r.push(o),"error"===o.type)break}return r}}},8058:e=>{try{e.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){e.exports=!1}},7824:e=>{var t=1e3,n=60*t,r=60*n,a=24*r;function o(e,t,n,r){var a=t>=1.5*n;return Math.round(e/n)+" "+r+(a?"s":"")}e.exports=function(e,i){i=i||{};var s,l,c=typeof e;if("string"===c&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var o=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(o){var i=parseFloat(o[1]);switch((o[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*i;case"weeks":case"week":case"w":return 6048e5*i;case"days":case"day":case"d":return i*a;case"hours":case"hour":case"hrs":case"hr":case"h":return i*r;case"minutes":case"minute":case"mins":case"min":case"m":return i*n;case"seconds":case"second":case"secs":case"sec":case"s":return i*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return i;default:return}}}}(e);if("number"===c&&isFinite(e))return i.long?(s=e,(l=Math.abs(s))>=a?o(s,l,a,"day"):l>=r?o(s,l,r,"hour"):l>=n?o(s,l,n,"minute"):l>=t?o(s,l,t,"second"):s+" ms"):function(e){var o=Math.abs(e);return o>=a?Math.round(e/a)+"d":o>=r?Math.round(e/r)+"h":o>=n?Math.round(e/n)+"m":o>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},1830:(e,t)=>{t.encode=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t},t.decode=function(e){for(var t={},n=e.split("&"),r=0,a=n.length;r<a;r++){var o=n[r].split("=");t[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return t}},4187:e=>{var t=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,n=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];e.exports=function(e){var r,a,o=e,i=e.indexOf("["),s=e.indexOf("]");-1!=i&&-1!=s&&(e=e.substring(0,i)+e.substring(i,s).replace(/:/g,";")+e.substring(s,e.length));for(var l,c,u=t.exec(e||""),h={},p=14;p--;)h[n[p]]=u[p]||"";return-1!=i&&-1!=s&&(h.source=o,h.host=h.host.substring(1,h.host.length-1).replace(/;/g,":"),h.authority=h.authority.replace("[","").replace("]","").replace(/;/g,":"),h.ipv6uri=!0),h.pathNames=(r=h.path,a=r.replace(/\/{2,9}/g,"/").split("/"),"/"!=r.substr(0,1)&&0!==r.length||a.splice(0,1),"/"==r.substr(r.length-1,1)&&a.splice(a.length-1,1),a),h.queryKey=(l=h.query,c={},l.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,n){t&&(c[t]=n)})),c),h}},751:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Socket=t.io=t.Manager=t.protocol=void 0;const r=n(6744),a=n(7703),o=n(2277);Object.defineProperty(t,"Socket",{enumerable:!0,get:function(){return o.Socket}});const i=n(3669)("socket.io-client");e.exports=t=l;const s=t.managers={};function l(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};const n=r.url(e),o=n.source,l=n.id,c=n.path,u=s[l]&&c in s[l].nsps;let h;return t.forceNew||t["force new connection"]||!1===t.multiplex||u?(i("ignoring socket cache for %s",o),h=new a.Manager(o,t)):(s[l]||(i("new io instance for %s",o),s[l]=new a.Manager(o,t)),h=s[l]),n.query&&!t.query&&(t.query=n.query),h.socket(n.path,t)}t.io=l;var c=n(5485);Object.defineProperty(t,"protocol",{enumerable:!0,get:function(){return c.protocol}}),t.connect=l;var u=n(7703);Object.defineProperty(t,"Manager",{enumerable:!0,get:function(){return u.Manager}})},7703:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Manager=void 0;const r=n(5983),a=n(2277),o=n(8767),i=n(5485),s=n(5657),l=n(6077),c=n(3010),u=n(3669)("socket.io-client:manager");t.Manager=class extends o{constructor(e,t){super(),this.nsps={},this.subs=[],this.connecting=[],e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new c({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this._readyState="closed",this.uri=e;const n=t.parser||i;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this._autoConnect=!1!==t.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this)}randomizationFactor(e){return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this)}reconnectionDelayMax(e){return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(u("readyState %s",this._readyState),~this._readyState.indexOf("open"))return this;u("opening %s",this.uri),this.engine=r(this.uri,this.opts);const t=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const a=s.on(t,"open",(function(){n.onopen(),e&&e()})),o=s.on(t,"error",(t=>{u("error"),n.cleanup(),n._readyState="closed",super.emit("error",t),e?e(t):n.maybeReconnectOnOpen()}));if(!1!==this._timeout){const e=this._timeout;u("connect attempt will timeout after %d",e),0===e&&a.destroy();const n=setTimeout((()=>{u("connect attempt timed out after %d",e),a.destroy(),t.close(),t.emit("error",new Error("timeout"))}),e);this.subs.push({destroy:function(){clearTimeout(n)}})}return this.subs.push(a),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){u("open"),this.cleanup(),this._readyState="open",super.emit("open");const e=this.engine;this.subs.push(s.on(e,"data",l(this,"ondata"))),this.subs.push(s.on(e,"ping",l(this,"onping"))),this.subs.push(s.on(e,"error",l(this,"onerror"))),this.subs.push(s.on(e,"close",l(this,"onclose"))),this.subs.push(s.on(this.decoder,"decoded",l(this,"ondecoded")))}onping(){super.emit("ping")}ondata(e){this.decoder.add(e)}ondecoded(e){super.emit("packet",e)}onerror(e){u("error",e),super.emit("error",e)}socket(e,t){let n=this.nsps[e];if(!n){n=new a.Socket(this,e,t),this.nsps[e]=n;var r=this;n.on("connecting",o),this._autoConnect&&o()}function o(){~r.connecting.indexOf(n)||r.connecting.push(n)}return n}_destroy(e){const t=this.connecting.indexOf(e);~t&&this.connecting.splice(t,1),this.connecting.length||this._close()}_packet(e){u("writing packet %j",e),e.query&&0===e.type&&(e.nsp+="?"+e.query);const t=this.encoder.encode(e);for(let n=0;n<t.length;n++)this.engine.write(t[n],e.options)}cleanup(){u("cleanup");const e=this.subs.length;for(let t=0;t<e;t++)this.subs.shift().destroy();this.decoder.destroy()}_close(){u("disconnect"),this.skipReconnect=!0,this._reconnecting=!1,"opening"===this._readyState&&this.cleanup(),this.backoff.reset(),this._readyState="closed",this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e){u("onclose"),this.cleanup(),this.backoff.reset(),this._readyState="closed",super.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)u("reconnect failed"),this.backoff.reset(),super.emit("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();u("will wait %dms before reconnect attempt",t),this._reconnecting=!0;const n=setTimeout((()=>{e.skipReconnect||(u("attempting reconnect"),super.emit("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open((t=>{t?(u("reconnect attempt error"),e._reconnecting=!1,e.reconnect(),super.emit("reconnect_error",t)):(u("reconnect success"),e.onreconnect())})))}),t);this.subs.push({destroy:function(){clearTimeout(n)}})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),super.emit("reconnect",e)}}},5657:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.on=void 0,t.on=function(e,t,n){return e.on(t,n),{destroy:function(){e.removeListener(t,n)}}}},2277:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Socket=void 0;const r=n(5485),a=n(8767),o=n(5657),i=n(6077),s=n(3669)("socket.io-client:socket"),l={connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1};t.Socket=class extends a{constructor(e,t,n){super(),this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.flags={},this.io=e,this.nsp=t,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},n&&n.auth&&(this.auth=n.auth),this.io._autoConnect&&this.open()}subEvents(){if(this.subs)return;const e=this.io;this.subs=[o.on(e,"open",i(this,"onopen")),o.on(e,"packet",i(this,"onpacket")),o.on(e,"close",i(this,"onclose"))]}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(l.hasOwnProperty(e))throw new Error('"'+e+'" is a reserved event name');t.unshift(e);const n={type:r.PacketType.EVENT,data:t,options:{}};n.options.compress=!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(s("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),n.id=this.ids++);const a=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return!this.flags.volatile||a&&this.connected?this.connected?this.packet(n):this.sendBuffer.push(n):s("discard packet as the transport is not currently writable"),this.flags={},this}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){s("transport is open - connecting"),"function"==typeof this.auth?this.auth((e=>{this.packet({type:r.PacketType.CONNECT,data:e})})):this.packet({type:r.PacketType.CONNECT,data:this.auth})}onclose(e){s("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,super.emit("disconnect",e)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case r.PacketType.CONNECT:const t=e.data.sid;this.onconnect(t);break;case r.PacketType.EVENT:case r.PacketType.BINARY_EVENT:this.onevent(e);break;case r.PacketType.ACK:case r.PacketType.BINARY_ACK:this.onack(e);break;case r.PacketType.DISCONNECT:this.ondisconnect();break;case r.PacketType.CONNECT_ERROR:const n=new Error(e.data.message);n.data=e.data.data,super.emit("connect_error",n)}}onevent(e){const t=e.data||[];s("emitting event %j",t),null!=e.id&&(s("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?this.emitEvent(t):this.receiveBuffer.push(t)}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const n of t)n.apply(this,e)}super.emit.apply(this,e)}ack(e){const t=this;let n=!1;return function(...a){n||(n=!0,s("sending ack %j",a),t.packet({type:r.PacketType.ACK,id:e,data:a}))}}onack(e){const t=this.acks[e.id];"function"==typeof t?(s("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):s("bad ack %s",e.id)}onconnect(e){this.id=e,this.connected=!0,this.disconnected=!1,super.emit("connect"),this.emitBuffered()}emitBuffered(){for(let e=0;e<this.receiveBuffer.length;e++)this.emitEvent(this.receiveBuffer[e]);this.receiveBuffer=[];for(let e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]}ondisconnect(){s("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")}destroy(){if(this.subs){for(let e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io._destroy(this)}disconnect(){return this.connected&&(s("performing disconnect (%s)",this.nsp),this.packet({type:r.PacketType.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}}},6744:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.url=void 0;const r=n(4187),a=n(3669)("socket.io-client:url");t.url=function(e,t){let n=e;t=t||"undefined"!=typeof location&&location,null==e&&(e=t.protocol+"//"+t.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?t.protocol+e:t.host+e),/^(https?|wss?):\/\//.test(e)||(a("protocol-less url %s",e),e=void 0!==t?t.protocol+"//"+e:"https://"+e),a("parse %s",e),n=r(e)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const o=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+o+":"+n.port,n.href=n.protocol+"://"+o+(t&&t.port===n.port?"":":"+n.port),n}},3669:(e,t,n)=>{t.log=function(...e){return"object"==typeof console&&console.log&&console.log(...e)},t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,a=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(r++,"%c"===e&&(a=r))})),t.splice(a,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=n(9231)(t);const{formatters:r}=e.exports;r.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},9231:(e,t,n)=>{e.exports=function(e){function t(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return r.colors[Math.abs(t)%r.colors.length]}function r(e){let n;function i(...e){if(!i.enabled)return;const t=i,a=Number(new Date),o=a-(n||a);t.diff=o,t.prev=n,t.curr=a,n=a,e[0]=r.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((n,a)=>{if("%%"===n)return n;s++;const o=r.formatters[a];if("function"==typeof o){const r=e[s];n=o.call(t,r),e.splice(s,1),s--}return n})),r.formatArgs.call(t,e),(t.log||r.log).apply(t,e)}return i.namespace=e,i.enabled=r.enabled(e),i.useColors=r.useColors(),i.color=t(e),i.destroy=a,i.extend=o,"function"==typeof r.init&&r.init(i),r.instances.push(i),i}function a(){const e=r.instances.indexOf(this);return-1!==e&&(r.instances.splice(e,1),!0)}function o(e,t){const n=r(this.namespace+(void 0===t?":":t)+e);return n.log=this.log,n}function i(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return r.debug=r,r.default=r,r.coerce=function(e){return e instanceof Error?e.stack||e.message:e},r.disable=function(){const e=[...r.names.map(i),...r.skips.map(i).map((e=>"-"+e))].join(",");return r.enable(""),e},r.enable=function(e){let t;r.save(e),r.names=[],r.skips=[];const n=("string"==typeof e?e:"").split(/[\s,]+/),a=n.length;for(t=0;t<a;t++)n[t]&&("-"===(e=n[t].replace(/\*/g,".*?"))[0]?r.skips.push(new RegExp("^"+e.substr(1)+"$")):r.names.push(new RegExp("^"+e+"$")));for(t=0;t<r.instances.length;t++){const e=r.instances[t];e.enabled=r.enabled(e.namespace)}},r.enabled=function(e){if("*"===e[e.length-1])return!0;let t,n;for(t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1},r.humanize=n(7824),Object.keys(e).forEach((t=>{r[t]=e[t]})),r.instances=[],r.names=[],r.skips=[],r.formatters={},r.selectColor=t,r.enable(r.load()),r}},7719:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.reconstructPacket=t.deconstructPacket=void 0;const r=n(2986);function a(e,t){if(!e)return e;if(r.isBinary(e)){const n={_placeholder:!0,num:t.length};return t.push(e),n}if(Array.isArray(e)){const n=new Array(e.length);for(let r=0;r<e.length;r++)n[r]=a(e[r],t);return n}if("object"==typeof e&&!(e instanceof Date)){const n={};for(const r in e)e.hasOwnProperty(r)&&(n[r]=a(e[r],t));return n}return e}function o(e,t){if(!e)return e;if(e&&e._placeholder)return t[e.num];if(Array.isArray(e))for(let n=0;n<e.length;n++)e[n]=o(e[n],t);else if("object"==typeof e)for(const n in e)e.hasOwnProperty(n)&&(e[n]=o(e[n],t));return e}t.deconstructPacket=function(e){const t=[],n=e.data,r=e;return r.data=a(n,t),r.attachments=t.length,{packet:r,buffers:t}},t.reconstructPacket=function(e,t){return e.data=o(e.data,t),e.attachments=void 0,e}},5485:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Decoder=t.Encoder=t.PacketType=t.protocol=void 0;const r=n(8767),a=n(7719),o=n(2986),i=n(1618)("socket.io-parser");var s;t.protocol=5,function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(s=t.PacketType||(t.PacketType={})),t.Encoder=class{encode(e){return i("encoding packet %j",e),e.type!==s.EVENT&&e.type!==s.ACK||!o.hasBinary(e)?[this.encodeAsString(e)]:(e.type=e.type===s.EVENT?s.BINARY_EVENT:s.BINARY_ACK,this.encodeAsBinary(e))}encodeAsString(e){let t=""+e.type;return e.type!==s.BINARY_EVENT&&e.type!==s.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data)),i("encoded %j as %s",e,t),t}encodeAsBinary(e){const t=a.deconstructPacket(e),n=this.encodeAsString(t.packet),r=t.buffers;return r.unshift(n),r}};class l extends r{constructor(){super()}add(e){let t;if("string"==typeof e)t=this.decodeString(e),t.type===s.BINARY_EVENT||t.type===s.BINARY_ACK?(this.reconstructor=new c(t),0===t.attachments&&super.emit("decoded",t)):super.emit("decoded",t);else{if(!o.isBinary(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emit("decoded",t))}}decodeString(e){let t=0;const n={type:Number(e.charAt(0))};if(void 0===s[n.type])throw new Error("unknown packet type "+n.type);if(n.type===s.BINARY_EVENT||n.type===s.BINARY_ACK){const r=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);const a=e.substring(r,t);if(a!=Number(a)||"-"!==e.charAt(t))throw new Error("Illegal attachments");n.attachments=Number(a)}if("/"===e.charAt(t+1)){const r=t+1;for(;++t&&","!==e.charAt(t)&&t!==e.length;);n.nsp=e.substring(r,t)}else n.nsp="/";const r=e.charAt(t+1);if(""!==r&&Number(r)==r){const r=t+1;for(;++t;){const n=e.charAt(t);if(null==n||Number(n)!=n){--t;break}if(t===e.length)break}n.id=Number(e.substring(r,t+1))}if(e.charAt(++t)){const r=function(e){try{return JSON.parse(e)}catch(e){return!1}}(e.substr(t));if(!l.isPayloadValid(n.type,r))throw new Error("invalid payload");n.data=r}return i("decoded %s as %j",e,n),n}static isPayloadValid(e,t){switch(e){case s.CONNECT:return"object"==typeof t;case s.DISCONNECT:return void 0===t;case s.CONNECT_ERROR:return"string"==typeof t||"object"==typeof t;case s.EVENT:case s.BINARY_EVENT:return Array.isArray(t)&&"string"==typeof t[0];case s.ACK:case s.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}t.Decoder=l;class c{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const e=a.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}},2986:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hasBinary=t.isBinary=void 0;const n="function"==typeof ArrayBuffer,r=Object.prototype.toString,a="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===r.call(Blob),o="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===r.call(File);function i(e){return n&&(e instanceof ArrayBuffer||(e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer)(e))||a&&e instanceof Blob||o&&e instanceof File}t.isBinary=i,t.hasBinary=function e(t,n){if(!t||"object"!=typeof t)return!1;if(Array.isArray(t)){for(let n=0,r=t.length;n<r;n++)if(e(t[n]))return!0;return!1}if(i(t))return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return e(t.toJSON(),!0);for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&e(t[n]))return!0;return!1}},1618:(e,t,n)=>{t.log=function(...e){return"object"==typeof console&&console.log&&console.log(...e)},t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,a=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(r++,"%c"===e&&(a=r))})),t.splice(a,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=n(5224)(t);const{formatters:r}=e.exports;r.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},5224:(e,t,n)=>{e.exports=function(e){function t(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return r.colors[Math.abs(t)%r.colors.length]}function r(e){let n;function i(...e){if(!i.enabled)return;const t=i,a=Number(new Date),o=a-(n||a);t.diff=o,t.prev=n,t.curr=a,n=a,e[0]=r.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((n,a)=>{if("%%"===n)return n;s++;const o=r.formatters[a];if("function"==typeof o){const r=e[s];n=o.call(t,r),e.splice(s,1),s--}return n})),r.formatArgs.call(t,e),(t.log||r.log).apply(t,e)}return i.namespace=e,i.enabled=r.enabled(e),i.useColors=r.useColors(),i.color=t(e),i.destroy=a,i.extend=o,"function"==typeof r.init&&r.init(i),r.instances.push(i),i}function a(){const e=r.instances.indexOf(this);return-1!==e&&(r.instances.splice(e,1),!0)}function o(e,t){const n=r(this.namespace+(void 0===t?":":t)+e);return n.log=this.log,n}function i(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return r.debug=r,r.default=r,r.coerce=function(e){return e instanceof Error?e.stack||e.message:e},r.disable=function(){const e=[...r.names.map(i),...r.skips.map(i).map((e=>"-"+e))].join(",");return r.enable(""),e},r.enable=function(e){let t;r.save(e),r.names=[],r.skips=[];const n=("string"==typeof e?e:"").split(/[\s,]+/),a=n.length;for(t=0;t<a;t++)n[t]&&("-"===(e=n[t].replace(/\*/g,".*?"))[0]?r.skips.push(new RegExp("^"+e.substr(1)+"$")):r.names.push(new RegExp("^"+e+"$")));for(t=0;t<r.instances.length;t++){const e=r.instances[t];e.enabled=r.enabled(e.namespace)}},r.enabled=function(e){if("*"===e[e.length-1])return!0;let t,n;for(t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1},r.humanize=n(7824),Object.keys(e).forEach((t=>{r[t]=e[t]})),r.instances=[],r.names=[],r.skips=[],r.formatters={},r.selectColor=t,r.enable(r.load()),r}},291:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.astar=void 0,function(e){var t;!function(e){e[e.WALL=0]="WALL",e[e.OPEN=1]="OPEN"}(t=e.GraphNodeType||(e.GraphNodeType={}));var n=function(){function e(e){this.elements=e;for(var t,n,a=[],o=e.length,i=0;i<o;++i){n=(t=e[i]).length,a[i]=new Array(n);for(var s=0;s<n;++s)a[i][s]=new r(i,s,t[s])}this.nodes=a}return e.prototype.toString=function(){for(var e,t,n,r,a="\n",o=this.nodes,i=0,s=o.length;i<s;){for(e="",n=0,r=(t=o[i++]).length;n<r;)e+=t[n++].type+" ";a=a+e+"\n"}return a},e}();e.Graph=n;var r=function(){function e(e,t,n){this.data={},this.x=e,this.y=t,this.pos={x:e,y:t},this.type=n}return e.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},e.prototype.isWall=function(){return this.type==t.WALL},e}();e.GraphNode=r;var a=function(){function e(e){this.content=[],this.scoreFunction=e}return e.prototype.push=function(e){this.content.push(e),this.sinkDown(this.content.length-1)},e.prototype.pop=function(){var e=this.content[0],t=this.content.pop();return this.content.length>0&&(this.content[0]=t,this.bubbleUp(0)),e},e.prototype.remove=function(e){var t=this.content.indexOf(e),n=this.content.pop();t!==this.content.length-1&&(this.content[t]=n,this.scoreFunction(n)<this.scoreFunction(e)?this.sinkDown(t):this.bubbleUp(t))},e.prototype.size=function(){return this.content.length},e.prototype.rescoreElement=function(e){this.sinkDown(this.content.indexOf(e))},e.prototype.sinkDown=function(e){for(var t=this.content[e];e>0;){var n=(e+1>>1)-1,r=this.content[n];if(!(this.scoreFunction(t)<this.scoreFunction(r)))break;this.content[n]=t,this.content[e]=r,e=n}},e.prototype.bubbleUp=function(e){for(var t=this.content.length,n=this.content[e],r=this.scoreFunction(n);;){var a=e+1<<1,o=a-1,i=null;if(o<t){var s=this.content[o],l=this.scoreFunction(s);l<r&&(i=o)}if(a<t){var c=this.content[a];this.scoreFunction(c)<(null===i?r:l)&&(i=a)}if(null===i)break;this.content[e]=this.content[i],this.content[i]=n,e=i}},e}();e.BinaryHeap=a;var o=function(){function e(e,t,n){this.grid=[];for(var r=0,a=e.length;r<a;r++){this.grid[r]=[];for(var o=0,i=e[r].length;o<i;o++){var s=(l=e[r][o])?l.isSolid()?99999999:1:99999999;this.grid[r][o]={org:e[r][o],f:0,g:0,h:0,cost:s,visited:!1,closed:!1,pos:{x:r,y:o},parent:null}}}var l;if(void 0!==t)for(var c=0;c<t.length;c++)this.grid[t[c].x][t[c].y].cost=99999999}return e.prototype.heap=function(){return new a((function(e){return e.f}))},e.prototype._find=function(e){for(var t=0;t<this.grid.length;t++)for(var n=0;n<this.grid[t].length;n++)if(this.grid[t][n].org==e)return this.grid[t][n]},e.prototype._search=function(t,n,r,a){a=a||this.manhattan,r=!!r;var o,i,s=this.heap();if(o=void 0!==t.x&&void 0!==t.y?this.grid[t.x][t.y]:this._find(t),i=void 0!==n.x&&void 0!==n.y?this.grid[n.x][n.y]:this._find(n),0==e.NO_CHECK_START_POINT&&o.cost<=0)return[];for(s.push(o);s.size()>0;){var l=s.pop();if(l===i){for(var c=l,u=[];c.parent;)u.push(c),c=c.parent;return u.reverse()}l.closed=!0;for(var h=this.neighbors(l,r),p=0,d=h.length;p<d;p++){var f=h[p];if(!(f.closed||f.cost<=0)){var y=l.g+f.cost,m=f.visited;(!m||y<f.g)&&(f.visited=!0,f.parent=l,f.h=f.h||a(f.pos,i.pos),f.g=y,f.f=f.g+f.h,m?s.rescoreElement(f):s.push(f))}}}return[]},e.search=function(t,n,r,a,o,i){return new e(t,a)._search(n,r,o,i)},e.prototype.manhattan=function(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)},e.prototype.neighbors=function(e,t){var n=this.grid,r=[],a=e.pos.x,o=e.pos.y;return n[a-1]&&n[a-1][o]&&r.push(n[a-1][o]),n[a+1]&&n[a+1][o]&&r.push(n[a+1][o]),n[a]&&n[a][o-1]&&r.push(n[a][o-1]),n[a]&&n[a][o+1]&&r.push(n[a][o+1]),t&&(n[a-1]&&n[a-1][o-1]&&r.push(n[a-1][o-1]),n[a+1]&&n[a+1][o-1]&&r.push(n[a+1][o-1]),n[a-1]&&n[a-1][o+1]&&r.push(n[a-1][o+1]),n[a+1]&&n[a+1][o+1]&&r.push(n[a+1][o+1])),r},e.NO_CHECK_START_POINT=!1,e}();e.AStar=o}(t.astar||(t.astar={}))},6779:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Drawable=void 0;t.Drawable=function(){this.drawableY=0,this.draw=function(e){}}},6750:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Barrel=void 0;var o=n(1272),i=n(2967),s=n(2621),l=function(e){function t(t,n,r,a){var o=e.call(this,t,n,r,a)||this;return o.kill=function(){o.dead=!0,s.GenericParticle.spawnCluster(o.level,o.x+.5,o.y+.5,"#9badb7")},o.killNoBones=function(){o.kill()},o.draw=function(e){o.dead||i.Game.drawObj(o.tileX,o.tileY,1,2,o.x-o.drawX,o.y-1-o.drawY,1,2,o.level.shadeColor,o.shadeAmount())},o.drawTopLayer=function(e){o.drawableY=o.y,o.drawX+=-.5*o.drawX,o.drawY+=-.5*o.drawY},o.level=t,o.health=1,o.tileX=1,o.tileY=0,o.hasShadow=!1,o.pushable=!0,o}return a(t,e),t}(o.Enemy);t.Barrel=l},2221:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.BigSkullEnemy=void 0;var o=n(1272),i=n(2967),s=n(3205),l=n(2621),c=n(1978),u=n(5043),h=n(3806),p=n(988),d=n(5440),f=function(e){function t(t,n,r,a,f,y){var m=e.call(this,t,n,r,a)||this;for(m.REGEN_TICKS=5,m.addHitWarnings=function(){m.level.hitwarnings.push(new s.HitWarning(m.game,m.x-1,m.y)),m.level.hitwarnings.push(new s.HitWarning(m.game,m.x-1,m.y+1)),m.level.hitwarnings.push(new s.HitWarning(m.game,m.x+2,m.y)),m.level.hitwarnings.push(new s.HitWarning(m.game,m.x+2,m.y+1)),m.level.hitwarnings.push(new s.HitWarning(m.game,m.x,m.y-1)),m.level.hitwarnings.push(new s.HitWarning(m.game,m.x+1,m.y-1)),m.level.hitwarnings.push(new s.HitWarning(m.game,m.x,m.y+2)),m.level.hitwarnings.push(new s.HitWarning(m.game,m.x+1,m.y+2))},m.hit=function(){return 1},m.hurt=function(e,t){e&&(m.aggro=!0,m.targetPlayer=e,m.facePlayer(e),e===m.game.players[m.game.localPlayerID]&&(m.alertTicks=2)),m.ticksSinceFirstHit=0,m.health-=t,m.healthBar.hurt(),m.health<=0?m.kill():l.GenericParticle.spawnCluster(m.level,m.x+1,m.y+1,m.deathParticleColor)},m.killNoBones=function(){m.dead=!0,l.GenericParticle.spawnCluster(m.level,m.x+1,m.y+1,m.deathParticleColor),m.level.particles.push(new d.DeathParticle(m.x+.5,m.y+.5)),m.dropLoot()},m.tick=function(){if(!m.dead){if(m.skipNextTurns>0)return void m.skipNextTurns--;if(1==m.health)m.ticksSinceFirstHit++,m.ticksSinceFirstHit>=m.REGEN_TICKS&&(m.health++,m.ticksSinceFirstHit=0);else if(m.ticks++,m.seenPlayer){if(m.seenPlayer){if(m.level.playerTicked===m.targetPlayer){m.alertTicks=Math.max(0,m.alertTicks-1);var e=m.x,t=m.y,n=m.x,r=m.y;if(m.ticks%2==0?m.targetPlayer.x>=m.x+m.w?n++:m.targetPlayer.x<m.x?n--:m.targetPlayer.y>=m.y+m.h?r++:m.targetPlayer.y<m.y&&r--:m.targetPlayer.y>=m.y+m.h?r++:m.targetPlayer.y<m.y?r--:m.targetPlayer.x>=m.x+m.w?n++:m.targetPlayer.x<m.x&&n--,m.health>=3){var a=function(e,t,n){return e.x>=t&&e.x<t+m.w&&e.y>=n&&e.y<n+m.h};for(var i in m.game.players)m.game.levels[m.game.players[i].levelID]===m.level&&a(m.game.players[i],n,r)&&(m.game.players[i].hurt(m.hit()),m.drawX=.5*(m.x-m.game.players[i].x),m.drawY=.5*(m.y-m.game.players[i].y),m.game.players[i]===m.game.players[m.game.localPlayerID]&&m.game.shakeScreen(10*m.drawX,10*m.drawY))}m.tryMove(n,r),m.drawX=m.x-e,m.drawY=m.y-t,m.x>e?m.direction=o.EnemyDirection.RIGHT:m.x<e?m.direction=o.EnemyDirection.LEFT:m.y>t?m.direction=o.EnemyDirection.DOWN:m.y<t&&(m.direction=o.EnemyDirection.UP),m.health<m.maxHealth&&(m.ticksSinceFirstHit++,m.ticksSinceFirstHit>=m.REGEN_TICKS&&(m.health++,m.ticksSinceFirstHit=0)),m.health>=3&&m.addHitWarnings()}var s,l=-1!==Object.values(m.game.offlinePlayers).indexOf(m.targetPlayer);m.aggro&&!l||!1!==(s=m.nearestPlayer())&&(c=s[0],u=s[1],c<=4&&(l||c<m.playerDistance(m.targetPlayer))&&u!==m.targetPlayer&&(m.targetPlayer=u,m.facePlayer(u),u===m.game.players[m.game.localPlayerID]&&(m.alertTicks=1),m.health>=3&&m.addHitWarnings()))}}else if(!1!==(s=m.nearestPlayer())){var c=s[0],u=s[1];c<=4&&(m.targetPlayer=u,m.facePlayer(u),m.seenPlayer=!0,u===m.game.players[m.game.localPlayerID]&&(m.alertTicks=1),m.health>=3&&m.addHitWarnings())}}},m.draw=function(e){m.dead||(m.tileX=21,m.tileY=0,3===m.health?(m.tileX=21,m.tileY=4,m.ticksSinceFirstHit>=3&&(m.flashingFrame+=.1*e,Math.floor(m.flashingFrame)%2==0&&(m.tileY=0))):2===m.health?(m.tileX=21,m.tileY=8,m.ticksSinceFirstHit>=3&&(m.flashingFrame+=.1*e,Math.floor(m.flashingFrame)%2==0&&(m.tileY=4))):1===m.health&&(m.tileX=21,m.tileY=12,m.ticksSinceFirstHit>=3&&(m.flashingFrame+=.1*e,Math.floor(m.flashingFrame)%2==0&&(m.tileY=8))),m.frame+=.1*e,m.frame>=4&&(m.frame=0),m.hasShadow&&i.Game.drawMob(18,0,2,2,m.x-m.drawX,m.y-m.drawY,2,2,m.level.shadeColor,m.shadeAmount()),i.Game.drawMob(m.tileX+(20===m.tileX?2*Math.floor(m.frame):0),m.tileY,2,4,m.x-m.drawX,m.y-2.5-m.drawY,2,4,m.level.shadeColor,m.shadeAmount())),m.seenPlayer||m.drawSleepingZs(e,.5*p.GameConstants.TILESIZE,-1*p.GameConstants.TILESIZE),m.alertTicks>0&&m.drawExclamation(e,.5*p.GameConstants.TILESIZE,-1*p.GameConstants.TILESIZE)},m.drawTopLayer=function(e){m.drawableY=m.y,m.healthBar.draw(e,m.health,m.maxHealth,m.x+.5,m.y,!0),m.drawX+=-.5*m.drawX,m.drawY+=-.5*m.drawY},m.dropLoot=function(){for(var e=[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1}],t=0;t<m.drops.length;t++)m.drops[t].level=m.level,m.drops[t].x=m.x+e[t].x,m.drops[t].y=m.y+e[t].y,m.level.items.push(m.drops[t])},m.w=2,m.h=2,m.ticks=0,m.frame=0,m.health=4,m.maxHealth=4,m.tileX=21,m.tileY=0,m.seenPlayer=!1,m.aggro=!1,m.ticksSinceFirstHit=0,m.flashingFrame=0,m.deathParticleColor="#ffffff",m.chainPushable=!1,m.drops=[],y&&m.drops.push(y);m.drops.length<4;){var v=f();v<.005?m.drops.push(new h.Spear(m.level,0,0)):v<.04||v<.075||v<.1?m.drops.push(new u.RedGem(m.level,0,0)):m.drops.push(new c.Coin(m.level,0,0))}return m}return a(t,e),t}(o.Enemy);t.BigSkullEnemy=f},2725:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.ChargeEnemy=t.ChargeEnemyState=void 0;var o,i=n(1272),s=n(2967),l=n(3205),c=n(1978),u=n(9143),h=n(5654),p=n(2621),d=n(988);!function(e){e[e.IDLE=0]="IDLE",e[e.ALERTED=1]="ALERTED",e[e.CHARGING=2]="CHARGING"}(o=t.ChargeEnemyState||(t.ChargeEnemyState={}));var f=function(e){function t(t,n,r,a){var f=e.call(this,t,n,r,a)||this;return f.hit=function(){return 1},f.canMoveOver=function(e,t){for(var n=0,r=f.level.enemies;n<r.length;n++){var a=r[n];if(a!==f&&e===a.x&&t===a.y)return!1}var o=f.level.levelArray[e][t];return!(o.isSolid()||o instanceof u.Door||o instanceof h.BottomDoor)},f.tick=function(){if(!f.dead){if(f.skipNextTurns>0)return void f.skipNextTurns--;if(f.ticks++,f.state===o.IDLE){var e=!1,t=0,n=0;for(var r in f.game.players){if(f.x===f.game.players[r].x){n=f.y<f.game.players[r].y?1:-1;for(var a=f.y;a!==f.game.players[r].y;a+=n)f.canMoveOver(f.x,a)||(e=!0)}else if(f.y===f.game.players[r].y){t=f.x<f.game.players[r].x?1:-1;for(var s=f.x;s!==f.game.players[r].x;s+=t)f.canMoveOver(s,f.y)||(e=!0)}if((0!==t||0!==n)&&!e){for(f.state=o.ALERTED,f.targetX=f.x,f.targetY=f.y;f.canMoveOver(f.targetX+t,f.targetY+n);)f.targetX+=t,f.targetY+=n,(f.targetX===f.game.players[r].x&&f.targetY===f.game.players[r].y||f.targetX===f.game.players[r].x-1&&f.targetY===f.game.players[r].y||f.targetX===f.game.players[r].x+1&&f.targetY===f.game.players[r].y||f.targetX===f.game.players[r].x&&f.targetY===f.game.players[r].y-1||f.targetX===f.game.players[r].x&&f.targetY===f.game.players[r].y+1)&&f.level.hitwarnings.push(new l.HitWarning(f.game,f.targetX,f.targetY));f.visualTargetX=f.targetX+.5*t,f.visualTargetY=f.targetY+.5*n,1===n&&(f.visualTargetY+=.65),t>0?f.direction=i.EnemyDirection.RIGHT:t<0?f.direction=i.EnemyDirection.LEFT:n<0?f.direction=i.EnemyDirection.UP:n>0&&(f.direction=i.EnemyDirection.DOWN);break}}}else if(f.state===o.ALERTED){for(var r in f.state=o.CHARGING,f.trailFrame=0,f.game.players)(f.y===f.game.players[r].y&&(f.x<f.game.players[r].x&&f.game.players[r].x<=f.targetX||f.targetX<=f.game.players[r].x&&f.game.players[r].x<f.x)||f.x===f.game.players[r].x&&(f.y<f.game.players[r].y&&f.game.players[r].y<=f.targetY||f.targetY<=f.game.players[r].y&&f.game.players[r].y<f.y))&&f.game.players[r].hurt(f.hit());f.startX=f.x,f.startY=f.y,f.drawX=f.targetX-f.x,f.drawY=f.targetY-f.y,f.x=f.targetX,f.y=f.targetY}else f.state===o.CHARGING&&(f.state=o.IDLE)}},f.draw=function(e){if(!f.dead){if(f.frame+=.1*e,f.frame>=4&&(f.frame=0),(f.state===o.CHARGING&&Math.abs(f.drawX)>.1||Math.abs(f.drawY)>.1)&&(p.GenericParticle.spawnCluster(f.level,f.x-f.drawX+.5,f.y-f.drawY+.5,"black"),p.GenericParticle.spawnCluster(f.level,f.x-f.drawX+.5,f.y-f.drawY+.5,"white")),f.state===o.CHARGING){f.trailFrame+=.01*e;var t=f.trailFrame;t>=0&&t<=1&&(s.Game.ctx.strokeStyle="white",d.GameConstants.ALPHA_ENABLED&&(s.Game.ctx.globalAlpha=1-t),s.Game.ctx.lineWidth=.25*d.GameConstants.TILESIZE,s.Game.ctx.beginPath(),s.Game.ctx.moveTo((f.startX+.5)*d.GameConstants.TILESIZE,(f.startY+.5)*d.GameConstants.TILESIZE),s.Game.ctx.lineCap="round",s.Game.ctx.lineTo((f.x-f.drawX+.5)*d.GameConstants.TILESIZE,(f.y-f.drawY+.5)*d.GameConstants.TILESIZE),s.Game.ctx.stroke(),s.Game.ctx.globalAlpha=1)}f.hasShadow&&s.Game.drawMob(0,0,1,1,f.x-f.drawX,f.y-f.drawY,1,1,f.level.shadeColor,f.shadeAmount()),s.Game.drawMob(f.tileX+Math.floor(f.frame),f.tileY+2*f.direction,1,2,f.x-f.drawX,f.y-1.5-f.drawY,1,2,f.level.shadeColor,f.shadeAmount()),f.state===o.IDLE?f.drawSleepingZs(e):f.state===o.ALERTED&&f.drawExclamation(e)}},f.drawTopLayer=function(e){if(f.drawableY=f.y,f.healthBar.draw(e,f.health,f.maxHealth,f.x,f.y,!0),f.drawX+=-.5*f.drawX,f.drawY+=-.5*f.drawY,f.state===o.ALERTED&&(f.trailFrame+=.4*e,Math.floor(f.trailFrame)%2==0)){var t=(f.x+.5)*d.GameConstants.TILESIZE,n=(f.y-.25)*d.GameConstants.TILESIZE;f.direction===i.EnemyDirection.LEFT?t-=3:f.direction===i.EnemyDirection.RIGHT?t+=3:f.direction===i.EnemyDirection.DOWN?n+=2:f.direction===i.EnemyDirection.UP&&(n-=8),s.Game.ctx.strokeStyle="white",s.Game.ctx.lineWidth=.25*d.GameConstants.TILESIZE,s.Game.ctx.beginPath(),s.Game.ctx.moveTo(Math.round(t),Math.round(n)),s.Game.ctx.lineCap="round",s.Game.ctx.lineTo(Math.round((f.visualTargetX+.5)*d.GameConstants.TILESIZE),Math.round((f.visualTargetY-.25)*d.GameConstants.TILESIZE)),s.Game.ctx.stroke(),s.Game.ctx.globalAlpha=1}},f.dropLoot=function(){f.level.items.push(new c.Coin(f.level,f.x,f.y))},f.ticks=0,f.frame=0,f.health=1,f.maxHealth=1,f.tileX=13,f.tileY=8,f.trailFrame=0,f.alertTicks=0,f.deathParticleColor="#ffffff",f.state=o.IDLE,f}return a(t,e),t}(i.Enemy);t.ChargeEnemy=f},516:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Chest=void 0;var o=n(2967),i=n(1785),s=n(6309),l=n(8573),c=n(1272),u=n(7975),h=n(2621),p=n(1978),d=n(5958),f=function(e){function t(t,n,r,a,c){var f=e.call(this,t,n,r,a)||this;switch(f.kill=function(){f.level===f.game.level&&d.Sound.chest(),f.dead=!0,h.GenericParticle.spawnCluster(f.level,f.x+.5,f.y+.5,"#fbf236"),f.level.items.push(f.drop)},f.killNoBones=function(){f.kill()},f.draw=function(e){f.dead||o.Game.drawObj(f.tileX,f.tileY,1,2,f.x-f.drawX,f.y-1-f.drawY,1,2,f.level.shadeColor,f.shadeAmount())},f.drawTopLayer=function(e){f.drawableY=f.y},f.tileX=4,f.tileY=0,f.health=1,o.Game.randTable([1,1,1,2,2,3],c)){case 1:f.drop=new p.Coin(f.level,f.x,f.y);break;case 2:f.drop=new s.Heart(f.level,f.x,f.y);break;case 3:f.drop=new u.GreenGem(f.level,f.x,f.y);break;case 3:f.drop=new i.Key(f.level,f.x,f.y);break;case 4:f.drop=new l.Armor(f.level,f.x,f.y)}return f}return a(t,e),t}(c.Enemy);t.Chest=f},8365:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.CoalResource=void 0;var o=n(8576),i=n(2621),s=n(9809),l=n(5958),c=function(e){function t(t,n,r,a){var o=e.call(this,t,n,r,a)||this;return o.hurtCallback=function(){i.GenericParticle.spawnCluster(o.level,o.x+.5,o.y+.5,"#ffffff"),o.level===o.game.level&&l.Sound.mine()},o.kill=function(){o.level===o.game.level&&l.Sound.breakRock(),o.dead=!0,o.level.items.push(new s.Coal(o.level,o.x,o.y))},o.killNoBones=function(){o.kill()},o.drawTopLayer=function(e){o.drawableY=o.y},o.tileX=12,o.tileY=0,o.health=1,o}return a(t,e),t}(o.Resource);t.CoalResource=c},6061:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Crate=void 0;var o=n(1272),i=n(2967),s=n(2621),l=function(e){function t(t,n,r,a){var o=e.call(this,t,n,r,a)||this;return o.kill=function(){o.dead=!0,s.GenericParticle.spawnCluster(o.level,o.x+.5,o.y+.5,"#d9a066")},o.killNoBones=function(){o.kill()},o.draw=function(e){o.dead||i.Game.drawObj(o.tileX,o.tileY,1,2,o.x-o.drawX,o.y-1-o.drawY,1,2,o.level.shadeColor,o.shadeAmount())},o.drawTopLayer=function(e){o.drawableY=o.y,o.drawX+=-.5*o.drawX,o.drawY+=-.5*o.drawY},o.level=t,o.health=1,o.maxHealth=1,o.tileX=0,o.tileY=0,o.hasShadow=!1,o.pushable=!0,o}return a(t,e),t}(o.Enemy);t.Crate=l},9379:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.EmeraldResource=void 0;var o=n(7975),i=n(8576),s=n(2621),l=n(5958),c=function(e){function t(t,n,r,a){var i=e.call(this,t,n,r,a)||this;return i.hurtCallback=function(){s.GenericParticle.spawnCluster(i.level,i.x+.5,i.y+.5,"#fbf236"),i.level===i.game.level&&l.Sound.mine()},i.kill=function(){i.level===i.game.level&&l.Sound.breakRock(),i.dead=!0,i.level.items.push(new o.GreenGem(i.level,i.x,i.y))},i.killNoBones=function(){i.kill()},i.drawTopLayer=function(e){i.drawableY=i.y},i.tileX=14,i.tileY=0,i.health=3,i}return a(t,e),t}(i.Resource);t.EmeraldResource=c},1272:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Enemy=t.EnemyDirection=void 0;var o,i=n(2967),s=n(5269),l=n(5440),c=n(9626),u=n(2621),h=n(3338),p=n(6779),d=n(988);!function(e){e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e[e.RIGHT=2]="RIGHT",e[e.LEFT=3]="LEFT"}(o=t.EnemyDirection||(t.EnemyDirection={}));var f=function(e){function t(t,n,r,a){var p=e.call(this)||this;return p.sleepingZFrame=0,p.tryMove=function(e,t){for(var n,r,a,o=0,i=p.level.enemies;o<i.length;o++){var s=i[o];if(s!==p&&!((n=s).x>=e+p.w||n.x+n.w<=e||n.y>=t+p.h||n.y+n.h<=t))return}for(var l in p.game.players)if(r=p.game.players[l].x,a=p.game.players[l].y,r>=e&&r<e+p.w&&a>=t&&a<t+p.h)return;for(var c=[],u=0;u<p.w;u++)for(var h=0;h<p.h;h++){if(p.level.levelArray[e+u][t+h].isSolid())return;c.push(p.level.levelArray[e+u][t+h])}for(var d=0,f=c;d<f.length;d++)f[d].onCollideEnemy(p);p.x=e,p.y=t},p.hit=function(){return 0},p.hurtCallback=function(){},p.pointIn=function(e,t){return e>=p.x&&e<p.x+p.w&&t>=p.y&&t<p.y+p.h},p.hurt=function(e,t){p.healthBar.hurt(),p.health-=t,p.health<=0?p.kill():p.hurtCallback()},p.interact=function(e){},p.dropLoot=function(){},p.kill=function(){if(p.level.levelArray[p.x][p.y]instanceof c.Floor){var e=new s.Bones(p.level,p.x,p.y);e.skin=p.level.levelArray[p.x][p.y].skin,p.level.levelArray[p.x][p.y]=e}p.killNoBones()},p.killNoBones=function(){p.dead=!0,u.GenericParticle.spawnCluster(p.level,p.x+.5,p.y+.5,p.deathParticleColor),p.level.particles.push(new l.DeathParticle(p.x,p.y)),p.dropLoot()},p.shadeAmount=function(){return p.level.softVis[p.x][p.y]},p.doneMoving=function(){return Math.abs(p.drawX)<.01&&Math.abs(p.drawY)<.01},p.nearestPlayer=function(){var e=138291380921,t=e,n=null;for(var r in p.game.players)if(p.game.levels[p.game.players[r].levelID]===p.level){var a=p.playerDistance(p.game.players[r]);a<t&&(t=a,n=p.game.players[r])}return t!==e&&[t,n]},p.playerDistance=function(e){return Math.max(Math.abs(p.x-e.x),Math.abs(p.y-e.y))},p.facePlayer=function(e){var t=e.x-p.x,n=e.y-p.y;Math.abs(t)===Math.abs(n)||(Math.abs(t)>Math.abs(n)?(t>0&&(p.direction=o.RIGHT),t<0&&(p.direction=o.LEFT)):(n>0&&(p.direction=o.DOWN),n<0&&(p.direction=o.UP)))},p.draw=function(e){p.dead||(p.hasShadow&&i.Game.drawMob(0,0,1,1,p.x-p.drawX,p.y-p.drawY,1,1,p.level.shadeColor,p.shadeAmount()),i.Game.drawMob(p.tileX,p.tileY+2*p.direction,1,2,p.x-p.drawX,p.y-1.5-p.drawY,1,2,p.level.shadeColor,p.shadeAmount()))},p.tick=function(){},p.drawTopLayer=function(e){p.drawableY=p.y-p.drawY,p.healthBar.draw(e,p.health,p.maxHealth,p.x,p.y,!0),p.drawX+=-.5*p.drawX,p.drawY+=-.5*p.drawY},p.drawSleepingZs=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=0),p.sleepingZFrame+=e;var r=.01*p.sleepingZFrame;r-=Math.floor(r);for(var a=1;a>=0;a--){var o=7*(r+a),s=Math.min(1-(r+a)/2,2*(r+a)/2),l=0;0===a&&(l=1),r>=.33&&r<.66&&(l=a),r>=.33&&r<.66&&(l=a);var c=i.Game.measureText("Z").width;d.GameConstants.ALPHA_ENABLED&&(i.Game.ctx.globalAlpha=s),i.Game.fillTextOutline("Z",(p.x+.5)*d.GameConstants.TILESIZE-c/2+l+t,(p.y-.6)*d.GameConstants.TILESIZE-o+n,d.GameConstants.OUTLINE,"white"),i.Game.ctx.globalAlpha=1}},p.drawExclamation=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=0),p.exclamationFrame+=e;var r,a=[0,-1,-2,-3,-5,-7,-4];r=p.exclamationFrame>a.length?a[a.length-1]:a[p.exclamationFrame];var o=i.Game.measureText("!").width;i.Game.ctx.globalAlpha=1,!1!==r&&i.Game.fillTextOutline("!",(p.x+.5)*d.GameConstants.TILESIZE-o/2+t,(p.y-.75)*d.GameConstants.TILESIZE+r+n,d.GameConstants.OUTLINE,d.GameConstants.WARNING_RED)},p.level=t,p.x=r,p.y=a,p.w=1,p.h=1,p.game=n,p.drawX=0,p.drawY=0,p.health=1,p.maxHealth=1,p.tileX=0,p.tileY=0,p.hasShadow=!0,p.skipNextTurns=0,p.direction=o.DOWN,p.destroyable=!0,p.pushable=!1,p.chainPushable=!0,p.interactable=!1,p.deathParticleColor="#ff00ff",p.healthBar=new h.HealthBar,p.alertTicks=0,p.exclamationFrame=0,p}return a(t,e),t}(p.Drawable);t.Enemy=f},5377:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.GoldResource=void 0;var o=n(8576),i=n(2621),s=n(9825),l=n(5958),c=function(e){function t(t,n,r,a){var o=e.call(this,t,n,r,a)||this;return o.hurtCallback=function(){o.level===o.game.level&&l.Sound.mine()},o.kill=function(){o.level===o.game.level&&l.Sound.breakRock(),o.dead=!0,o.level.items.push(new s.Gold(o.level,o.x,o.y)),i.GenericParticle.spawnCluster(o.level,o.x+.5,o.y+.5,"#fbf236")},o.killNoBones=function(){o.kill()},o.drawTopLayer=function(e){o.drawableY=o.y},o.tileX=13,o.tileY=0,o.health=2,o}return a(t,e),t}(o.Resource);t.GoldResource=c},3441:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.KnightEnemy=void 0;var o=n(1272),i=n(2967),s=n(291),l=n(3205),c=n(3280),u=n(1978),h=n(2920),p=function(e){function t(t,n,r,a,p,d){var f=e.call(this,t,n,r,a)||this;if(f.hurt=function(e,t){e&&(f.aggro=!0,f.targetPlayer=e,f.facePlayer(e),e===f.game.players[f.game.localPlayerID]&&(f.alertTicks=2)),f.healthBar.hurt(),f.health-=t,f.health<=0?f.kill():f.hurtCallback()},f.hit=function(){return 1},f.tick=function(){if(!f.dead){if(f.skipNextTurns>0)return void f.skipNextTurns--;if(f.seenPlayer){if(f.seenPlayer){if(f.level.playerTicked===f.targetPlayer)if(f.alertTicks=Math.max(0,f.alertTicks-1),f.ticks++,f.ticks%2==1){for(var e=f.x,t=f.y,n=Array(),r=0,a=f.level.enemies;r<a.length;r++){var i=a[r];i!==f&&n.push({x:i.x,y:i.y})}for(var u=f.x-1;u<=f.x+1;u++)for(var h=f.y-1;h<=f.y+1;h++)f.level.levelArray[u][h]instanceof c.SpikeTrap&&f.level.levelArray[u][h].on&&n.push({x:u,y:h});for(var p=[],d=0;d<f.level.roomX+f.level.width;d++){p[d]=[];for(var y=0;y<f.level.roomY+f.level.height;y++)f.level.levelArray[d]&&f.level.levelArray[d][y]?p[d][y]=f.level.levelArray[d][y]:p[d][y]=!1}var m=s.astar.AStar.search(p,f,f.targetPlayer,n);if(m.length>0){var v=!1;for(var g in f.game.players)f.game.levels[f.game.players[g].levelID]===f.level&&f.game.players[g].x===m[0].pos.x&&f.game.players[g].y===m[0].pos.y&&(f.game.players[g].hurt(f.hit()),f.drawX=.5*(f.x-f.game.players[g].x),f.drawY=.5*(f.y-f.game.players[g].y),f.game.players[g]===f.game.players[f.game.localPlayerID]&&f.game.shakeScreen(10*f.drawX,10*f.drawY),v=!0);v||(f.tryMove(m[0].pos.x,m[0].pos.y),f.drawX=f.x-e,f.drawY=f.y-t,f.x>e?f.direction=o.EnemyDirection.RIGHT:f.x<e?f.direction=o.EnemyDirection.LEFT:f.y>t?f.direction=o.EnemyDirection.DOWN:f.y<t&&(f.direction=o.EnemyDirection.UP))}}else f.level.hitwarnings.push(new l.HitWarning(f.game,f.x-1,f.y)),f.level.hitwarnings.push(new l.HitWarning(f.game,f.x+1,f.y)),f.level.hitwarnings.push(new l.HitWarning(f.game,f.x,f.y-1)),f.level.hitwarnings.push(new l.HitWarning(f.game,f.x,f.y+1));var w=-1!==Object.values(f.game.offlinePlayers).indexOf(f.targetPlayer);if((!f.aggro||w)&&!1!==(E=f.nearestPlayer())){C=E[0];var _=E[1];C<=4&&(w||C<f.playerDistance(f.targetPlayer))&&_!==f.targetPlayer&&(f.targetPlayer=_,f.facePlayer(_),_===f.game.players[f.game.localPlayerID]&&(f.alertTicks=1),f.ticks%2==0&&(f.level.hitwarnings.push(new l.HitWarning(f.game,f.x-1,f.y)),f.level.hitwarnings.push(new l.HitWarning(f.game,f.x+1,f.y)),f.level.hitwarnings.push(new l.HitWarning(f.game,f.x,f.y-1)),f.level.hitwarnings.push(new l.HitWarning(f.game,f.x,f.y+1))))}}}else{var x=f.nearestPlayer();if(!1!==x){var C=x[0],E=x[1];C<4&&(f.seenPlayer=!0,f.targetPlayer=E,f.facePlayer(E),E===f.game.players[f.game.localPlayerID]&&(f.alertTicks=1),f.level.hitwarnings.push(new l.HitWarning(f.game,f.x-1,f.y)),f.level.hitwarnings.push(new l.HitWarning(f.game,f.x+1,f.y)),f.level.hitwarnings.push(new l.HitWarning(f.game,f.x,f.y-1)),f.level.hitwarnings.push(new l.HitWarning(f.game,f.x,f.y+1)))}}}},f.draw=function(e){f.dead||(f.ticks%2==0?(f.tileX=9,f.tileY=8):(f.tileX=4,f.tileY=0),f.frame+=.1*e,f.frame>=4&&(f.frame=0),f.hasShadow&&i.Game.drawMob(0,0,1,1,f.x-f.drawX,f.y-f.drawY,1,1,f.level.shadeColor,f.shadeAmount()),i.Game.drawMob(f.tileX+(4===f.tileX?0:Math.floor(f.frame)),f.tileY+2*f.direction,1,2,f.x-f.drawX,f.y-1.5-f.drawY+(4===f.tileX?.1875:0),1,2,f.level.shadeColor,f.shadeAmount())),f.seenPlayer||f.drawSleepingZs(e),f.alertTicks>0&&f.drawExclamation(e)},f.dropLoot=function(){f.drop.level=f.level,f.drop.x=f.x,f.drop.y=f.y,f.level.items.push(f.drop)},f.ticks=0,f.frame=0,f.health=2,f.maxHealth=2,f.tileX=9,f.tileY=8,f.seenPlayer=!1,f.aggro=!1,f.deathParticleColor="#ffffff",d)f.drop=d;else{var y=p();f.drop=y<.005?new h.DualDagger(f.level,0,0):new u.Coin(f.level,0,0)}return f}return a(t,e),t}(o.Enemy);t.KnightEnemy=p},9670:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.PottedPlant=void 0;var o=n(1272),i=n(2967),s=n(2621),l=function(e){function t(t,n,r,a){var o=e.call(this,t,n,r,a)||this;return o.kill=function(){o.dead=!0,s.GenericParticle.spawnCluster(o.level,o.x+.5,o.y+.5,"#ce736a")},o.killNoBones=function(){o.kill()},o.draw=function(e){o.dead||(o.drawX+=-.5*o.drawX,o.drawY+=-.5*o.drawY,i.Game.drawObj(o.tileX,o.tileY,1,2,o.x-o.drawX,o.y-1-o.drawY,1,2,o.level.shadeColor,o.shadeAmount()))},o.drawTopLayer=function(e){o.drawableY=o.y},o.level=t,o.health=1,o.tileX=3,o.tileY=0,o.hasShadow=!1,o.chainPushable=!1,o}return a(t,e),t}(o.Enemy);t.PottedPlant=l},8576:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Resource=void 0;var o=n(2967),i=function(e){function t(t,n,r,a){var i=e.call(this,t,n,r,a)||this;return i.kill=function(){i.dead=!0},i.killNoBones=function(){i.kill()},i.draw=function(e){i.dead||o.Game.drawObj(i.tileX,i.tileY,1,2,i.x-i.drawX,i.y-1-i.drawY,1,2,i.level.shadeColor,i.shadeAmount())},i.drawTopLayer=function(e){i.drawableY=i.y},i.tileX=12,i.tileY=0,i.health=1,i.chainPushable=!1,i}return a(t,e),t}(n(1272).Enemy);t.Resource=i},8498:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.SkullEnemy=void 0;var o=n(1272),i=n(2967),s=n(3205),l=n(2621),c=n(1978),u=n(5043),h=n(3806),p=n(291),d=n(3280),f=function(e){function t(t,n,r,a,f,y){var m=e.call(this,t,n,r,a)||this;if(m.REGEN_TICKS=5,m.hit=function(){return 1},m.hurt=function(e,t){e&&(m.aggro=!0,m.targetPlayer=e,m.facePlayer(e),e===m.game.players[m.game.localPlayerID]&&(m.alertTicks=2)),m.ticksSinceFirstHit=0,m.health-=t,m.healthBar.hurt(),m.health<=0?m.kill():l.GenericParticle.spawnCluster(m.level,m.x+.5,m.y+.5,m.deathParticleColor)},m.tick=function(){if(!m.dead){if(m.skipNextTurns>0)return void m.skipNextTurns--;if(m.health<=1)m.ticksSinceFirstHit++,m.ticksSinceFirstHit>=m.REGEN_TICKS&&(m.health=2);else if(m.ticks++,m.seenPlayer){if(m.seenPlayer){if(m.level.playerTicked===m.targetPlayer){m.alertTicks=Math.max(0,m.alertTicks-1);for(var e=m.x,t=m.y,n=Array(),r=0,a=m.level.enemies;r<a.length;r++){var i=a[r];i!==m&&n.push({x:i.x,y:i.y})}for(var l=m.x-1;l<=m.x+1;l++)for(var c=m.y-1;c<=m.y+1;c++)m.level.levelArray[l][c]instanceof d.SpikeTrap&&m.level.levelArray[l][c].on&&n.push({x:l,y:c});for(var u=[],h=0;h<m.level.roomX+m.level.width;h++){u[h]=[];for(var f=0;f<m.level.roomY+m.level.height;f++)m.level.levelArray[h]&&m.level.levelArray[h][f]?u[h][f]=m.level.levelArray[h][f]:u[h][f]=!1}var y=p.astar.AStar.search(u,m,m.targetPlayer,n);if(y.length>0){var v=y[0].pos.x,g=y[0].pos.y;for(var w in m.game.players)m.game.levels[m.game.players[w].levelID]===m.level&&m.game.players[w].x===v&&m.game.players[w].y===g&&(m.game.players[w].hurt(m.hit()),m.drawX=.5*(m.x-m.game.players[w].x),m.drawY=.5*(m.y-m.game.players[w].y),m.game.players[w]===m.game.players[m.game.localPlayerID]&&m.game.shakeScreen(10*m.drawX,10*m.drawY));m.tryMove(v,g),m.drawX=m.x-e,m.drawY=m.y-t,m.x>e?m.direction=o.EnemyDirection.RIGHT:m.x<e?m.direction=o.EnemyDirection.LEFT:m.y>t?m.direction=o.EnemyDirection.DOWN:m.y<t&&(m.direction=o.EnemyDirection.UP)}m.level.hitwarnings.push(new s.HitWarning(m.game,m.x-1,m.y)),m.level.hitwarnings.push(new s.HitWarning(m.game,m.x+1,m.y)),m.level.hitwarnings.push(new s.HitWarning(m.game,m.x,m.y-1)),m.level.hitwarnings.push(new s.HitWarning(m.game,m.x,m.y+1))}var _,x=-1!==Object.values(m.game.offlinePlayers).indexOf(m.targetPlayer);m.aggro&&!x||!1!==(_=m.nearestPlayer())&&(C=_[0],E=_[1],C<=4&&(x||C<m.playerDistance(m.targetPlayer))&&E!==m.targetPlayer&&(m.targetPlayer=E,m.facePlayer(E),E===m.game.players[m.game.localPlayerID]&&(m.alertTicks=1),m.level.hitwarnings.push(new s.HitWarning(m.game,m.x-1,m.y)),m.level.hitwarnings.push(new s.HitWarning(m.game,m.x+1,m.y)),m.level.hitwarnings.push(new s.HitWarning(m.game,m.x,m.y-1)),m.level.hitwarnings.push(new s.HitWarning(m.game,m.x,m.y+1))))}}else if(!1!==(_=m.nearestPlayer())){var C=_[0],E=_[1];C<=4&&(m.targetPlayer=E,m.facePlayer(E),m.seenPlayer=!0,E===m.game.players[m.game.localPlayerID]&&(m.alertTicks=1),m.level.hitwarnings.push(new s.HitWarning(m.game,m.x-1,m.y)),m.level.hitwarnings.push(new s.HitWarning(m.game,m.x+1,m.y)),m.level.hitwarnings.push(new s.HitWarning(m.game,m.x,m.y-1)),m.level.hitwarnings.push(new s.HitWarning(m.game,m.x,m.y+1)))}}},m.draw=function(e){m.dead||(m.tileX=5,m.tileY=8,m.health<=1&&(m.tileX=3,m.tileY=0,m.ticksSinceFirstHit>=3&&(m.flashingFrame+=.1*e,Math.floor(m.flashingFrame)%2==0&&(m.tileX=2))),m.frame+=.1*e,m.frame>=4&&(m.frame=0),m.hasShadow&&i.Game.drawMob(0,0,1,1,m.x-m.drawX,m.y-m.drawY,1,1,m.level.shadeColor,m.shadeAmount()),i.Game.drawMob(m.tileX+(5===m.tileX?Math.floor(m.frame):0),m.tileY+2*m.direction,1,2,m.x-m.drawX,m.y-1.5-m.drawY,1,2,m.level.shadeColor,m.shadeAmount())),m.seenPlayer||m.drawSleepingZs(e),m.alertTicks>0&&m.drawExclamation(e)},m.dropLoot=function(){m.drop.level=m.level,m.drop.x=m.x,m.drop.y=m.y,m.level.items.push(m.drop)},m.ticks=0,m.frame=0,m.health=2,m.maxHealth=2,m.tileX=5,m.tileY=8,m.seenPlayer=!1,m.aggro=!1,m.ticksSinceFirstHit=0,m.flashingFrame=0,m.deathParticleColor="#ffffff",y)m.drop=y;else{var v=f();m.drop=v<.005?new h.Spear(m.level,0,0):v<.04?new u.RedGem(m.level,0,0):new c.Coin(m.level,0,0)}return m}return a(t,e),t}(o.Enemy);t.SkullEnemy=f},3073:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.SlimeEnemy=void 0;var o=n(1272),i=n(2967),s=n(291),l=n(3205),c=n(3280),u=n(1978),h=n(988),p=function(e){function t(t,n,r,a,p,d){var f=e.call(this,t,n,r,a)||this;return f.hurt=function(e,t){e&&(f.aggro=!0,f.targetPlayer=e,f.facePlayer(e),e===f.game.players[f.game.localPlayerID]&&(f.alertTicks=2)),f.healthBar.hurt(),f.health-=t,f.health<=0?f.kill():f.hurtCallback()},f.hit=function(){return 1},f.tick=function(){if(!f.dead){if(f.skipNextTurns>0)return void f.skipNextTurns--;if(f.seenPlayer){if(f.seenPlayer){if(f.level.playerTicked===f.targetPlayer)if(f.alertTicks=Math.max(0,f.alertTicks-1),f.ticks++,f.ticks%2==1){for(var e=f.x,t=f.y,n=Array(),r=0,a=f.level.enemies;r<a.length;r++){var i=a[r];i!==f&&n.push({x:i.x,y:i.y})}for(var u=f.x-1;u<=f.x+1;u++)for(var h=f.y-1;h<=f.y+1;h++)f.level.levelArray[u][h]instanceof c.SpikeTrap&&f.level.levelArray[u][h].on&&n.push({x:u,y:h});for(var p=[],d=0;d<f.level.roomX+f.level.width;d++){p[d]=[];for(var y=0;y<f.level.roomY+f.level.height;y++)f.level.levelArray[d]&&f.level.levelArray[d][y]?p[d][y]=f.level.levelArray[d][y]:p[d][y]=!1}var m=s.astar.AStar.search(p,f,f.targetPlayer,n);if(m.length>0){var v=!1;for(var g in f.game.players)f.game.levels[f.game.players[g].levelID]===f.level&&f.game.players[g].x===m[0].pos.x&&f.game.players[g].y===m[0].pos.y&&(f.game.players[g].hurt(f.hit()),f.drawX=.5*(f.x-f.game.players[g].x),f.drawY=.5*(f.y-f.game.players[g].y),f.game.players[g]===f.game.players[f.game.localPlayerID]&&f.game.shakeScreen(10*f.drawX,10*f.drawY),v=!0);v||(f.tryMove(m[0].pos.x,m[0].pos.y),f.drawX=f.x-e,f.drawY=f.y-t,f.x>e?f.direction=o.EnemyDirection.RIGHT:f.x<e?f.direction=o.EnemyDirection.LEFT:f.y>t?f.direction=o.EnemyDirection.DOWN:f.y<t&&(f.direction=o.EnemyDirection.UP))}}else f.level.hitwarnings.push(new l.HitWarning(f.game,f.x-1,f.y)),f.level.hitwarnings.push(new l.HitWarning(f.game,f.x+1,f.y)),f.level.hitwarnings.push(new l.HitWarning(f.game,f.x,f.y-1)),f.level.hitwarnings.push(new l.HitWarning(f.game,f.x,f.y+1));var w=-1!==Object.values(f.game.offlinePlayers).indexOf(f.targetPlayer);if((!f.aggro||w)&&!1!==(E=f.nearestPlayer())){C=E[0];var _=E[1];C<=4&&(w||C<f.playerDistance(f.targetPlayer))&&_!==f.targetPlayer&&(f.targetPlayer=_,f.facePlayer(_),_===f.game.players[f.game.localPlayerID]&&(f.alertTicks=1),f.ticks%2==0&&(f.level.hitwarnings.push(new l.HitWarning(f.game,f.x-1,f.y)),f.level.hitwarnings.push(new l.HitWarning(f.game,f.x+1,f.y)),f.level.hitwarnings.push(new l.HitWarning(f.game,f.x,f.y-1)),f.level.hitwarnings.push(new l.HitWarning(f.game,f.x,f.y+1))))}}}else{var x=f.nearestPlayer();if(!1!==x){var C=x[0],E=x[1];C<4&&(f.seenPlayer=!0,f.targetPlayer=E,f.facePlayer(E),E===f.game.players[f.game.localPlayerID]&&(f.alertTicks=1),f.level.hitwarnings.push(new l.HitWarning(f.game,f.x-1,f.y)),f.level.hitwarnings.push(new l.HitWarning(f.game,f.x+1,f.y)),f.level.hitwarnings.push(new l.HitWarning(f.game,f.x,f.y-1)),f.level.hitwarnings.push(new l.HitWarning(f.game,f.x,f.y+1)))}}}},f.draw=function(e){f.dead||(f.ticks%2==0?(f.tileX=9,f.tileY=4):(f.tileX=8,f.tileY=4),f.frame+=.1*e,f.frame>=4&&(f.frame=0),f.hasShadow&&i.Game.drawMob(0,0,1,1,f.x-f.drawX,f.y-f.drawY,1,1,f.level.shadeColor,f.shadeAmount()),i.Game.drawMob(f.tileX,f.tileY+f.direction,1,1,f.x-f.drawX,f.y-f.drawY,1,1,f.level.shadeColor,f.shadeAmount())),f.seenPlayer||f.drawSleepingZs(e,0,.75*h.GameConstants.TILESIZE),f.alertTicks>0&&f.drawExclamation(e,0,.75*h.GameConstants.TILESIZE)},f.dropLoot=function(){f.drop.level=f.level,f.drop.x=f.x,f.drop.y=f.y,f.level.items.push(f.drop)},f.ticks=0,f.frame=0,f.health=1,f.maxHealth=1,f.tileX=8,f.tileY=4,f.seenPlayer=!1,f.aggro=!1,f.deathParticleColor="#ffffff",f.drop=d||new u.Coin(f.level,0,0),f}return a(t,e),t}(o.Enemy);t.SlimeEnemy=p},1241:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Spawner=void 0;var o=n(1272),i=n(2967),s=n(3205),l=n(8498),c=n(209),u=n(8414),h=n(3441),p=n(5397),d=function(e){function t(t,n,r,a,o){var d=e.call(this,t,n,r,a)||this;return d.hit=function(){return 1},d.tick=function(){if(!d.dead){if(d.skipNextTurns>0)return void d.skipNextTurns--;if(d.tileX=6,d.ticks%8==0){var e=d.level.getEmptyTiles().filter((function(e){return Math.abs(e.x-d.x)<=1&&Math.abs(e.y-d.y)<=1}));if(e.length>0){d.tileX=7;var t=i.Game.randTable(e,d.rand),n=void 0;switch(d.enemySpawnType){case 1:n=new h.KnightEnemy(d.level,d.game,t.x,t.y,d.rand);break;case 2:n=new l.SkullEnemy(d.level,d.game,t.x,t.y,d.rand);break;case 3:n=new p.WizardEnemy(d.level,d.game,t.x,t.y,d.rand)}d.level.projectiles.push(new c.EnemySpawnAnimation(d.level,n,t.x,t.y)),d.level.hitwarnings.push(new s.HitWarning(d.game,t.x,t.y))}}d.ticks++}},d.dropLoot=function(){d.level.items.push(new u.BlueGem(d.level,d.x,d.y))},d.ticks=0,d.health=4,d.maxHealth=4,d.tileX=6,d.tileY=4,d.seenPlayer=!0,d.enemySpawnType=2,d.deathParticleColor="#ffffff",d.rand=o,d}return a(t,e),t}(o.Enemy);t.Spawner=d},6945:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.VendingMachine=void 0;var o=n(2967),i=n(1272),s=n(1978),l=n(9809),c=n(7975),u=n(988),h=n(1656),p=n(8573),d=n(6309),f=n(3806),y=n(9825),m=n(8414),v=n(2920),g=n(282),w=n(5043),_="white",x=function(e){function t(t,n,r,a,i,x){var C=e.call(this,t,n,r,a)||this;if(C.open=!1,C.openTime=0,C.isInf=!1,C.quantity=1,C.buyAnimAmount=0,C.interact=function(e){(C.isInf||C.quantity>0)&&(C.open&&(C.playerOpened.openVendingMachine=null),C.open=!0,C.playerOpened=e,C.openTime=Date.now(),C.playerOpened.openVendingMachine&&C.playerOpened.openVendingMachine!==C&&C.playerOpened.openVendingMachine.close(),C.playerOpened.openVendingMachine=C)},C.close=function(){C.open=!1,C.playerOpened.openVendingMachine=null},C.space=function(){if(C.open){for(var e=0,t=C.costItems;e<t.length;e++){var n=t[e];if(!C.playerOpened.inventory.hasItemCount(n))return}for(var r=0,a=C.costItems;r<a.length;r++){var i=a[r];C.playerOpened.inventory.subtractItemCount(i)}var s=[C.x-1,C.x+1,C.x],l=[C.y,C.y,C.y+1],c=0;do{c=o.Game.rand(0,s.length-1,C.rand)}while(C.level.levelArray[s[c]][l[c]].isSolid()||C.level.enemies.some((function(e){return e.x===s[c]&&e.y===l[c]})));var u=new C.item.constructor;u=u.constructor(C.level,s[c],l[c]),C.level.items.push(u),C.isInf||(C.quantity--,C.quantity<=0&&C.close()),C.buyAnimAmount=.99,C.playerOpened===C.game.players[C.game.localPlayerID]&&C.game.shakeScreen(0,4)}},C.draw=function(e){var t=19;C.isInf||0!==C.quantity||(t=20),o.Game.drawObj(t,0,1,2,C.x,C.y-1,1,2,C.level.shadeColor,C.shadeAmount())},C.drawTopLayer=function(e){if(C.drawableY=C.y,C.open&&C.playerOpened===C.game.players[C.game.localPlayerID]){var t=Math.min(18,18*(Date.now()-C.openTime)/150),n=-2,r=(C.costItems.length+2)*(t+4+n)-n,a=t+4+n-n,i=(C.x+.5)*u.GameConstants.TILESIZE,s=(C.y-1.5)*u.GameConstants.TILESIZE;o.Game.ctx.fillStyle=_,o.Game.ctx.fillRect(Math.round(i-.5*r)-1,Math.round(s-.5*a)-1,Math.round(r+2),Math.round(a+2));for(var l=0;l<C.costItems.length+2;l++)o.Game.ctx.fillStyle="#292c36",o.Game.ctx.fillRect(Math.round(i-.5*r+l*(t+4+n)),Math.round(s-.5*a),Math.round(t+4),Math.round(t+4)),l!==C.costItems.length&&(o.Game.ctx.fillStyle="#5a595b",o.Game.ctx.fillRect(Math.round(i-.5*r+l*(t+4+n)+2),Math.round(s-.5*a+2),Math.round(t),Math.round(t)));if(Date.now()-C.openTime>=150)for(var c=0;c<C.costItems.length+2;c++){var h=Math.round(i-.5*r+c*(t+4+n)+2+Math.floor(.5*t)-.5*u.GameConstants.TILESIZE),p=Math.round(s-.5*a+2+Math.floor(.5*t)-.5*u.GameConstants.TILESIZE),d=h/u.GameConstants.TILESIZE,f=p/u.GameConstants.TILESIZE;if(c<C.costItems.length){var y=1;C.playerOpened.inventory.hasItemCount(C.costItems[c])||(y=.15),C.costItems[c].drawIcon(e,d,f,y)}else c===C.costItems.length?o.Game.drawFX(0,1,1,1,d,f,1,1):c===C.costItems.length+1&&C.item.drawIcon(e,d,f)}C.buyAnimAmount*=C.buyAnimAmount,u.GameConstants.ALPHA_ENABLED&&(o.Game.ctx.globalAlpha=C.buyAnimAmount),o.Game.ctx.fillStyle=_,o.Game.ctx.fillRect(Math.round(i-.5*r)-1,Math.round(s-.5*a)-1,Math.round(r+2),Math.round(a+2)),o.Game.ctx.globalAlpha=1}},C.rand=x,C.destroyable=!1,C.pushable=!1,C.chainPushable=!1,C.interactable=!0,C.costItems=[],C.item=i,C.item instanceof h.Shotgun)(T=new m.BlueGem(t,0,0)).stackCount=o.Game.randTable([5,5,6,7],C.rand),C.costItems=[T];else if(C.item instanceof d.Heart){var E=new s.Coin(t,0,0);E.stackCount=10,C.costItems=[E],C.isInf=!0}else if(C.item instanceof f.Spear)(T=new c.GreenGem(t,0,0)).stackCount=o.Game.randTable([5,5,6,7],C.rand),C.costItems=[T];else if(C.item instanceof p.Armor)(T=new y.Gold(t,0,0)).stackCount=o.Game.randTable([5,5,6,7],C.rand),C.costItems=[T];else if(C.item instanceof v.DualDagger)(T=new w.RedGem(t,0,0)).stackCount=o.Game.randTable([5,5,6,7],C.rand),C.costItems=[T];else if(C.item instanceof g.Lantern){var T;(T=new l.Coal(t,0,0)).stackCount=o.Game.randTable([25,26,27,28],C.rand),C.costItems=[T]}return C}return a(t,e),t}(i.Enemy);t.VendingMachine=x},5397:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.WizardEnemy=t.WizardState=void 0;var o,i=n(1272),s=n(2967),l=n(9626),c=n(5269),u=n(5440),h=n(4568),p=n(5363),d=n(1978),f=n(8414),y=n(792);!function(e){e[e.idle=0]="idle",e[e.attack=1]="attack",e[e.justAttacked=2]="justAttacked",e[e.teleport=3]="teleport"}(o=t.WizardState||(t.WizardState={}));var m=function(e){function t(t,n,r,a,i,m){var v=e.call(this,t,n,r,a)||this;return v.ATTACK_RADIUS=5,v.hit=function(){return 1},v.withinAttackingRangeOfPlayer=function(){var e=!1;for(var t in v.game.players)Math.pow(v.x-v.game.players[t].x,2)+Math.pow(v.y-v.game.players[t].y,2)<=Math.pow(v.ATTACK_RADIUS,2)&&(e=!0);return e},v.shuffle=function(e){var t,n,r;for(r=e.length-1;r>0;r--)t=Math.floor(y.Random.rand()*(r+1)),n=e[r],e[r]=e[t],e[t]=n;return e},v.tick=function(){if(!v.dead){if(v.skipNextTurns>0)return void v.skipNextTurns--;if(v.seenPlayer){if(v.seenPlayer)switch(v.alertTicks=Math.max(0,v.alertTicks-1),v.state){case o.attack:v.level.getTile(v.x-1,v.y)&&!v.level.levelArray[v.x-1][v.y].isSolid()&&(v.level.projectiles.push(new p.WizardFireball(v,v.x-1,v.y)),v.level.getTile(v.x-2,v.y)&&!v.level.levelArray[v.x-2][v.y].isSolid()&&v.level.projectiles.push(new p.WizardFireball(v,v.x-2,v.y))),v.level.getTile(v.x+1,v.y)&&!v.level.levelArray[v.x+1][v.y].isSolid()&&(v.level.projectiles.push(new p.WizardFireball(v,v.x+1,v.y)),v.level.getTile(v.x+2,v.y)&&!v.level.levelArray[v.x+2][v.y].isSolid()&&v.level.projectiles.push(new p.WizardFireball(v,v.x+2,v.y))),v.level.getTile(v.x,v.y-1)&&!v.level.levelArray[v.x][v.y-1].isSolid()&&(v.level.projectiles.push(new p.WizardFireball(v,v.x,v.y-1)),v.level.getTile(v.x,v.y-2)&&!v.level.levelArray[v.x][v.y-2].isSolid()&&v.level.projectiles.push(new p.WizardFireball(v,v.x,v.y-2))),v.level.getTile(v.x,v.y+1)&&!v.level.levelArray[v.x][v.y+1].isSolid()&&(v.level.projectiles.push(new p.WizardFireball(v,v.x,v.y+1)),v.level.getTile(v.x,v.y+2)&&!v.level.levelArray[v.x][v.y+2].isSolid()&&v.level.projectiles.push(new p.WizardFireball(v,v.x,v.y+2))),v.state=o.justAttacked;break;case o.justAttacked:v.state=o.idle;break;case o.teleport:var e=v.x,t=v.y,n=1e5,r=void 0,a=v.shuffle(v.level.getEmptyTiles()),i=s.Game.randTable([2,2,3,3,3,3,3],y.Random.rand),l=[];for(var c in v.game.players)l.push(c);for(var u=s.Game.randTable(l,y.Random.rand),d=0,f=a;d<f.length;d++){var m=f[d],g=Math.abs(m.x-v.game.players[u].x)+Math.abs(m.y-v.game.players[u].y);Math.abs(g-i)<Math.abs(n-i)&&(n=g,r=m)}v.tryMove(r.x,r.y),v.drawX=v.x-e,v.drawY=v.y-t,v.frame=0,v.level.particles.push(new h.WizardTeleportParticle(e,t)),v.withinAttackingRangeOfPlayer()?v.state=o.attack:v.state=o.idle;break;case o.idle:v.state=o.teleport}}else{var w=v.nearestPlayer();if(!1!==w){var _=w[0];w[1],_<=4&&(v.seenPlayer=!0,v.alertTicks=1)}}}},v.draw=function(e){v.dead||(v.state===o.attack?v.tileX=7:v.tileX=6,v.hasShadow&&s.Game.drawMob(0,0,1,1,v.x-v.drawX,v.y-v.drawY,1,1,v.level.shadeColor,v.shadeAmount()),v.frame>=0?(s.Game.drawMob(Math.floor(v.frame)+6,2,1,2,v.x,v.y-1.5,1,2,v.level.shadeColor,v.shadeAmount()),v.frame+=.4*e,v.frame>11&&(v.frame=-1)):s.Game.drawMob(v.tileX,v.tileY,1,2,v.x-v.drawX,v.y-1.5-v.drawY,1,2,v.level.shadeColor,v.shadeAmount()),v.seenPlayer||v.drawSleepingZs(e),v.alertTicks>0&&v.drawExclamation(e))},v.kill=function(){if(v.level.levelArray[v.x][v.y]instanceof l.Floor){var e=new c.Bones(v.level,v.x,v.y);e.skin=v.level.levelArray[v.x][v.y].skin,v.level.levelArray[v.x][v.y]=e}v.dead=!0,v.level.particles.push(new u.DeathParticle(v.x,v.y)),v.dropLoot()},v.dropLoot=function(){v.drop.level=v.level,v.drop.x=v.x,v.drop.y=v.y,v.level.items.push(v.drop)},v.ticks=0,v.health=1,v.tileX=6,v.tileY=0,v.frame=0,v.state=o.attack,v.seenPlayer=!1,v.alertTicks=0,v.deathParticleColor="#ffffff",v.rand=i,m?v.drop=m:v.rand()<.02?v.drop=new f.BlueGem(v.level,v.x,v.y):v.drop=new d.Coin(v.level,v.x,v.y),v}return a(t,e),t}(i.Enemy);t.WizardEnemy=m},8232:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.ZombieEnemy=void 0;var o=n(1272),i=n(2967),s=n(3205),l=n(2621),c=n(1978),u=n(2920),h=n(7975),p=n(792),d=n(291),f=n(3280),y=function(e){function t(t,n,r,a,y,m){var v=e.call(this,t,n,r,a)||this;if(v.hit=function(){return 1},v.hurt=function(e,t){e&&(v.aggro=!0,v.targetPlayer=e,v.facePlayer(e),e===v.game.players[v.game.localPlayerID]&&(v.alertTicks=2)),v.health-=t,v.healthBar.hurt(),v.health<=0?v.kill():l.GenericParticle.spawnCluster(v.level,v.x+.5,v.y+.5,v.deathParticleColor)},v.tick=function(){if(!v.dead){if(v.skipNextTurns>0)return void v.skipNextTurns--;if(v.ticks++,v.seenPlayer){if(v.seenPlayer){if(v.level.playerTicked===v.targetPlayer){v.alertTicks=Math.max(0,v.alertTicks-1);for(var e=v.x,t=v.y,n=Array(),r=0,a=v.level.enemies;r<a.length;r++){var i=a[r];i!==v&&n.push({x:i.x,y:i.y})}for(var l=v.x-1;l<=v.x+1;l++)for(var c=v.y-1;c<=v.y+1;c++)v.level.levelArray[l][c]instanceof f.SpikeTrap&&v.level.levelArray[l][c].on&&n.push({x:l,y:c});for(var u=[],h=0;h<v.level.roomX+v.level.width;h++){u[h]=[];for(var p=0;p<v.level.roomY+v.level.height;p++)v.level.levelArray[h]&&v.level.levelArray[h][p]?u[h][p]=v.level.levelArray[h][p]:u[h][p]=!1}var y=d.astar.AStar.search(u,v,v.targetPlayer,n);if(y.length>0){var m=y[0].pos.x,g=y[0].pos.y;for(var w in v.game.players)v.game.levels[v.game.players[w].levelID]===v.level&&v.game.players[w].x===m&&v.game.players[w].y===g&&(v.game.players[w].hurt(v.hit()),v.drawX=.5*(v.x-v.game.players[w].x),v.drawY=.5*(v.y-v.game.players[w].y),v.game.players[w]===v.game.players[v.game.localPlayerID]&&v.game.shakeScreen(10*v.drawX,10*v.drawY));v.tryMove(m,g),v.drawX=v.x-e,v.drawY=v.y-t,v.x>e?v.direction=o.EnemyDirection.RIGHT:v.x<e?v.direction=o.EnemyDirection.LEFT:v.y>t?v.direction=o.EnemyDirection.DOWN:v.y<t&&(v.direction=o.EnemyDirection.UP)}v.level.hitwarnings.push(new s.HitWarning(v.game,v.x-1,v.y)),v.level.hitwarnings.push(new s.HitWarning(v.game,v.x+1,v.y)),v.level.hitwarnings.push(new s.HitWarning(v.game,v.x,v.y-1)),v.level.hitwarnings.push(new s.HitWarning(v.game,v.x,v.y+1))}var _,x=-1!==Object.values(v.game.offlinePlayers).indexOf(v.targetPlayer);v.aggro&&!x||!1!==(_=v.nearestPlayer())&&(C=_[0],E=_[1],C<=4&&(x||C<v.playerDistance(v.targetPlayer))&&E!==v.targetPlayer&&(v.targetPlayer=E,v.facePlayer(E),E===v.game.players[v.game.localPlayerID]&&(v.alertTicks=1),v.level.hitwarnings.push(new s.HitWarning(v.game,v.x-1,v.y)),v.level.hitwarnings.push(new s.HitWarning(v.game,v.x+1,v.y)),v.level.hitwarnings.push(new s.HitWarning(v.game,v.x,v.y-1)),v.level.hitwarnings.push(new s.HitWarning(v.game,v.x,v.y+1))))}}else if(!1!==(_=v.nearestPlayer())){var C=_[0],E=_[1];C<=4&&(v.targetPlayer=E,v.facePlayer(E),v.seenPlayer=!0,E===v.game.players[v.game.localPlayerID]&&(v.alertTicks=1),v.level.hitwarnings.push(new s.HitWarning(v.game,v.x-1,v.y)),v.level.hitwarnings.push(new s.HitWarning(v.game,v.x+1,v.y)),v.level.hitwarnings.push(new s.HitWarning(v.game,v.x,v.y-1)),v.level.hitwarnings.push(new s.HitWarning(v.game,v.x,v.y+1)))}}},v.draw=function(e){v.dead||(v.frame+=.1*e,v.frame>=4&&(v.frame=0),v.hasShadow&&i.Game.drawMob(0,0,1,1,v.x-v.drawX,v.y-v.drawY,1,1,v.level.shadeColor,v.shadeAmount()),i.Game.drawMob(v.tileX+Math.floor(v.frame),v.tileY+2*v.direction,1,2,v.x-v.drawX,v.y-1.5-v.drawY,1,2,v.level.shadeColor,v.shadeAmount())),v.seenPlayer||v.drawSleepingZs(e),v.alertTicks>0&&v.drawExclamation(e)},v.dropLoot=function(){v.drop.level=v.level,v.drop.x=v.x,v.drop.y=v.y,v.level.items.push(v.drop)},v.ticks=0,v.frame=0,v.health=1,v.maxHealth=1,v.tileX=17,v.tileY=8,v.seenPlayer=!1,v.aggro=!1,v.deathParticleColor="#ffffff",m)v.drop=m;else{var g=p.Random.rand();v.drop=g<.005?new u.DualDagger(v.level,0,0):g<.04?new h.GreenGem(v.level,0,0):new c.Coin(v.level,0,0)}return v}return a(t,e),t}(o.Enemy);t.ZombieEnemy=y},2967:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Game=t.MenuState=t.ChatMessage=t.LevelState=void 0;var r,a=n(988),o=n(663),i=n(5958),s=n(5742),l=n(5654),c=n(8835),u=n(9382),h=n(6882),p=n(751),d=n(9784),f=n(9713),y=n(1790),m=n(792);!function(e){e[e.IN_LEVEL=0]="IN_LEVEL",e[e.TRANSITIONING=1]="TRANSITIONING",e[e.TRANSITIONING_LADDER=2]="TRANSITIONING_LADDER"}(r=t.LevelState||(t.LevelState={}));var v,g=function(e){this.message=e,this.timestamp=Date.now()};t.ChatMessage=g,function(e){e[e.LOADING=0]="LOADING",e[e.LOGIN_USERNAME=1]="LOGIN_USERNAME",e[e.LOGIN_PASSWORD=2]="LOGIN_PASSWORD",e[e.SELECT_WORLD=3]="SELECT_WORLD",e[e.IN_GAME=4]="IN_GAME"}(v=t.MenuState||(t.MenuState={}));var w,_=[],x=function(){function e(){var t=this;this.input_history=[],this.mostRecentInputReceived=!0,this.loginMessage="",this.keyDownListener=function(e){if(t.menuState===v.LOGIN_USERNAME)t.usernameTextBox.handleKeyPress(e);else if(t.menuState===v.LOGIN_PASSWORD)t.passwordTextBox.handleKeyPress(e);else if(t.menuState===v.SELECT_WORLD)switch(e){case"ArrowUp":t.selectedWorldCode=Math.max(0,t.selectedWorldCode-1);break;case"ArrowDown":t.selectedWorldCode=Math.min(t.worldCodes.length+1,t.selectedWorldCode+1);break;case"Enter":0===t.selectedWorldCode?t.socket.emit("get available worlds"):1===t.selectedWorldCode?t.socket.emit("join new world"):t.worldCodes[t.selectedWorldCode-2]&&t.socket.emit("join world",t.worldCodes[t.selectedWorldCode-2])}else if(t.menuState===v.IN_GAME)if(t.chatOpen)t.chatTextBox.handleKeyPress(e);else switch(e.toUpperCase()){case"C":t.chatOpen=!0;break;case"/":t.chatOpen=!0,t.chatTextBox.clear(),t.chatTextBox.handleKeyPress(e);break;case"A":case"ARROWLEFT":t.players[t.localPlayerID].inputHandler(c.InputEnum.LEFT);break;case"D":case"ARROWRIGHT":t.players[t.localPlayerID].inputHandler(c.InputEnum.RIGHT);break;case"W":case"ARROWUP":t.players[t.localPlayerID].inputHandler(c.InputEnum.UP);break;case"S":case"ARROWDOWN":t.players[t.localPlayerID].inputHandler(c.InputEnum.DOWN);break;case" ":t.players[t.localPlayerID].inputHandler(c.InputEnum.SPACE);break;case"I":t.players[t.localPlayerID].inputHandler(c.InputEnum.I);break;case"Q":t.players[t.localPlayerID].inputHandler(c.InputEnum.Q)}},this.sendInput=function(e){t.mostRecentInputReceived&&(t.mostRecentInputReceived=!1,t.socket.emit("input",t.localPlayerID,e,m.Random.state))},this.changeLevel=function(e,n){e.levelID=t.levels.indexOf(n),t.players[t.localPlayerID]===e&&(t.level=n),n.enterLevel(e)},this.changeLevelThroughLadder=function(e,n){e.levelID=t.levels.indexOf(n.linkedLevel),n instanceof u.DownLadder&&n.generate(),t.players[t.localPlayerID]===e?(t.levelState=r.TRANSITIONING_LADDER,t.transitionStartTime=Date.now(),t.transitioningLadder=n):n.linkedLevel.enterLevel(e,n.linkedLevel)},this.changeLevelThroughDoor=function(e,n,o){if(e.levelID=t.levels.indexOf(n.level),t.players[t.localPlayerID]===e){t.levelState=r.TRANSITIONING,t.transitionStartTime=Date.now();var i=t.players[t.localPlayerID].x,s=t.players[t.localPlayerID].y;t.prevLevel=t.level,t.level=n.level,n.level.enterLevelThroughDoor(e,n,o),t.transitionX=(t.players[t.localPlayerID].x-i)*a.GameConstants.TILESIZE,t.transitionY=(t.players[t.localPlayerID].y-s)*a.GameConstants.TILESIZE,t.upwardTransition=!1,t.sideTransition=!1,t.sideTransitionDirection=o,n instanceof h.SideDoor?t.sideTransition=!0:n instanceof l.BottomDoor&&(t.upwardTransition=!0)}else n.level.enterLevelThroughDoor(e,n,o)},this.run=function(e){t.previousFrameTimestamp||(t.previousFrameTimestamp=e-1e3/a.GameConstants.FPS);for(var n=60*(e-t.previousFrameTimestamp)/1e3;_.length>0&&_[0]<=e-1e3;)_.shift();_.push(e),w=_.length,t.update(),t.draw(n),window.requestAnimationFrame(t.run),t.previousFrameTimestamp=e},this.update=function(){if(c.Input.checkIsTapHold(),0!==c.Input.lastPressTime&&Date.now()-c.Input.lastPressTime>a.GameConstants.KEY_REPEAT_TIME&&c.Input.onKeydown({repeat:!1,code:c.Input.lastPressKeyCode}),t.menuState===v.IN_GAME)for(var e in t.levelState===r.TRANSITIONING&&Date.now()-t.transitionStartTime>=s.LevelConstants.LEVEL_TRANSITION_TIME&&(t.levelState=r.IN_LEVEL),t.levelState===r.TRANSITIONING_LADDER&&Date.now()-t.transitionStartTime>=s.LevelConstants.LEVEL_TRANSITION_TIME_LADDER&&(t.levelState=r.IN_LEVEL),t.players)if(t.players[e].update(),t.levels[t.players[e].levelID].update(),t.players[e].dead)for(var n in t.players)t.players[n].dead=!0},this.lerp=function(e,t,n){return(1-n)*e+n*t},this.onResize=function(){var t=Math.floor(window.innerWidth/a.GameConstants.DEFAULTWIDTH),n=Math.floor(window.innerHeight/a.GameConstants.DEFAULTHEIGHT);e.scale=Math.min(t,n),0===e.scale&&(t=window.innerWidth/a.GameConstants.DEFAULTWIDTH,n=window.innerHeight/a.GameConstants.DEFAULTHEIGHT),e.scale=Math.min(t,n),s.LevelConstants.SCREEN_W=Math.floor(window.innerWidth/e.scale/a.GameConstants.TILESIZE),s.LevelConstants.SCREEN_H=Math.floor(window.innerHeight/e.scale/a.GameConstants.TILESIZE),a.GameConstants.WIDTH=s.LevelConstants.SCREEN_W*a.GameConstants.TILESIZE,a.GameConstants.HEIGHT=s.LevelConstants.SCREEN_H*a.GameConstants.TILESIZE,e.ctx.canvas.setAttribute("width",""+a.GameConstants.WIDTH),e.ctx.canvas.setAttribute("height",""+a.GameConstants.HEIGHT),e.ctx.canvas.setAttribute("style","width: "+a.GameConstants.WIDTH*e.scale+"px; height: "+a.GameConstants.HEIGHT*e.scale+"px;\n    display: block;\n    margin: 0 auto;\n  \n    image-rendering: optimizeSpeed; /* Older versions of FF          */\n    image-rendering: -moz-crisp-edges; /* FF 6.0+                       */\n    image-rendering: -webkit-optimize-contrast; /* Safari                        */\n    image-rendering: -o-crisp-edges; /* OS X & Windows Opera (12.02+) */\n    image-rendering: pixelated; /* Awesome future-browsers       */\n  \n    -ms-interpolation-mode: nearest-neighbor;")},this.shakeScreen=function(e,n){t.screenShakeX=e,t.screenShakeY=n},this.draw=function(n){if(e.ctx.globalAlpha=1,e.ctx.fillStyle="black",t.menuState===v.IN_GAME&&(e.ctx.fillStyle=t.level.shadeColor),e.ctx.fillRect(0,0,a.GameConstants.WIDTH,a.GameConstants.HEIGHT),t.menuState===v.LOADING){e.ctx.fillStyle="white";var o="loading...";e.fillText(o,.5*a.GameConstants.WIDTH-.5*e.measureText(o).width,.5*a.GameConstants.HEIGHT-.5*e.letter_height)}else if(t.menuState===v.LOGIN_USERNAME){e.ctx.fillStyle="white",e.fillText(t.loginMessage,.5*a.GameConstants.WIDTH-.5*e.measureText(t.loginMessage).width,.5*a.GameConstants.HEIGHT-3*e.letter_height);var i="username: ",l=i+t.usernameTextBox.text;e.fillText(l,.5*a.GameConstants.WIDTH-.5*e.measureText(l).width,.5*a.GameConstants.HEIGHT-.5*e.letter_height);var c=e.measureText(l.substring(0,i.length+t.usernameTextBox.cursor)).width;e.ctx.fillRect(Math.round(.5*a.GameConstants.WIDTH-.5*e.measureText(l).width+c),Math.round(.5*a.GameConstants.HEIGHT-.5*e.letter_height),1,e.letter_height);for(var u=i="password: ",h=0,p=t.passwordTextBox.text;h<p.length;h++){var d=p[h];u+="-"}e.fillText(u,.5*a.GameConstants.WIDTH-.5*e.measureText(u).width,.5*a.GameConstants.HEIGHT+.5*e.letter_height)}else if(t.menuState===v.LOGIN_PASSWORD){e.ctx.fillStyle="white",e.fillText(t.loginMessage,.5*a.GameConstants.WIDTH-.5*e.measureText(t.loginMessage).width,.5*a.GameConstants.HEIGHT-3*e.letter_height);var f="username: ";l=f+t.usernameTextBox.text,e.fillText(l,.5*a.GameConstants.WIDTH-.5*e.measureText(l).width,.5*a.GameConstants.HEIGHT-.5*e.letter_height),u=f="password: ";for(var y=0,m=t.passwordTextBox.text;y<m.length;y++)d=m[y],u+="-";e.fillText(u,.5*a.GameConstants.WIDTH-.5*e.measureText(u).width,.5*a.GameConstants.HEIGHT+.5*e.letter_height),c=e.measureText(u.substring(0,f.length+t.passwordTextBox.cursor)).width,e.ctx.fillRect(Math.round(.5*a.GameConstants.WIDTH-.5*e.measureText(u).width+c),Math.round(.5*a.GameConstants.HEIGHT+.5*e.letter_height),1,e.letter_height)}else if(t.menuState===v.SELECT_WORLD){var g=["refresh","new world"];for((g=g.concat(t.worldCodes))[t.selectedWorldCode]="[ "+g[t.selectedWorldCode]+" ]",d=0;d<g.length;d++){var _=d-t.selectedWorldCode,x=e.letter_height+2;e.ctx.fillStyle="grey",0===_&&(e.ctx.fillStyle="white"),e.fillText(g[d],.5*a.GameConstants.WIDTH-.5*e.measureText(g[d]).width,.5*a.GameConstants.HEIGHT-.5*e.letter_height+_*x)}}else if(t.menuState===v.IN_GAME){if(t.levelState===r.TRANSITIONING){var C=Math.floor(t.lerp((Date.now()-t.transitionStartTime)/s.LevelConstants.LEVEL_TRANSITION_TIME,0,-t.transitionX)),E=Math.floor(t.lerp((Date.now()-t.transitionStartTime)/s.LevelConstants.LEVEL_TRANSITION_TIME,0,-t.transitionY)),T=C-t.transitionX,b=E-t.transitionY,I=(t.players[t.localPlayerID].x-t.players[t.localPlayerID].drawX+.5)*a.GameConstants.TILESIZE,P=(t.players[t.localPlayerID].y-t.players[t.localPlayerID].drawY+.5)*a.GameConstants.TILESIZE;e.ctx.translate(-Math.round(I+T-.5*a.GameConstants.WIDTH),-Math.round(P+b-.5*a.GameConstants.HEIGHT));var O=Math.floor(t.lerp((Date.now()-t.transitionStartTime)/s.LevelConstants.LEVEL_TRANSITION_TIME,0,a.GameConstants.TILESIZE)),S=T,k=b;t.sideTransition?t.sideTransitionDirection>0?(C+=O,S+=O+a.GameConstants.TILESIZE):(C-=O,S-=O+a.GameConstants.TILESIZE):t.upwardTransition?(E-=O,k-=O+a.GameConstants.TILESIZE):(E+=O,k+=O+a.GameConstants.TILESIZE);var A=Math.floor(7*(Date.now()-t.transitionStartTime)/s.LevelConstants.LEVEL_TRANSITION_TIME);e.ctx.translate(C,E),t.prevLevel.draw(n),t.prevLevel.drawEntities(n);for(var G=t.prevLevel.roomX-1;G<=t.prevLevel.roomX+t.prevLevel.width;G++)for(var D=t.prevLevel.roomY-1;D<=t.prevLevel.roomY+t.prevLevel.height;D++)e.drawFX(7-A,10,1,1,G,D,1,1);for(e.ctx.translate(-C,-E),e.ctx.translate(S,k),t.level.draw(n),t.level.drawEntities(n,!0),G=t.level.roomX-1;G<=t.level.roomX+t.level.width;G++)for(D=t.level.roomY-1;D<=t.level.roomY+t.level.height;D++)e.drawFX(A,10,1,1,G,D,1,1);for(var d in e.ctx.translate(-S,-k),e.ctx.translate(T,b),t.players[t.localPlayerID].draw(n),e.ctx.translate(-T,-b),e.ctx.translate(S,k),t.level.drawShade(n),t.level.drawOverShade(n),e.ctx.translate(-S,-k),e.ctx.translate(Math.round(I+T-.5*a.GameConstants.WIDTH),Math.round(P+b-.5*a.GameConstants.HEIGHT)),t.players[t.localPlayerID].drawGUI(n),t.players)t.players[d].updateDrawXY(n)}else if(t.levelState===r.TRANSITIONING_LADDER){if(I=(t.players[t.localPlayerID].x-t.players[t.localPlayerID].drawX+.5)*a.GameConstants.TILESIZE,P=(t.players[t.localPlayerID].y-t.players[t.localPlayerID].drawY+.5)*a.GameConstants.TILESIZE,e.ctx.translate(-Math.round(I-.5*a.GameConstants.WIDTH),-Math.round(P-.5*a.GameConstants.HEIGHT)),(A=Math.floor(20*(Date.now()-t.transitionStartTime)/s.LevelConstants.LEVEL_TRANSITION_TIME_LADDER))<7)for(t.level.draw(n),t.level.drawEntities(n),t.level.drawShade(n),t.level.drawOverShade(n),G=t.level.roomX-1;G<=t.level.roomX+t.level.width;G++)for(D=t.level.roomY-1;D<=t.level.roomY+t.level.height;D++)e.drawFX(7-A,10,1,1,G,D,1,1);else if(A>=13)for(t.transitioningLadder&&(t.prevLevel=t.level,t.level.exitLevel(),t.level=t.transitioningLadder.linkedLevel,t.level.enterLevel(t.players[t.localPlayerID]),t.transitioningLadder=null),t.level.draw(n),t.level.drawEntities(n),t.level.drawShade(n),t.level.drawOverShade(n),G=t.level.roomX-1;G<=t.level.roomX+t.level.width;G++)for(D=t.level.roomY-1;D<=t.level.roomY+t.level.height;D++)e.drawFX(A-13,10,1,1,G,D,1,1);for(var d in e.ctx.translate(Math.round(I-.5*a.GameConstants.WIDTH),Math.round(P-.5*a.GameConstants.HEIGHT)),t.players[t.localPlayerID].drawGUI(n),t.players)t.players[d].updateDrawXY(n)}else{t.screenShakeX*=-.8,t.screenShakeY*=-.8;var L=t.players[t.localPlayerID].drawX,M=t.players[t.localPlayerID].drawY,R=Math.round((t.players[t.localPlayerID].x-L+.5)*a.GameConstants.TILESIZE-.5*a.GameConstants.WIDTH-t.screenShakeX),F=Math.round((t.players[t.localPlayerID].y-M+.5)*a.GameConstants.TILESIZE-.5*a.GameConstants.HEIGHT-t.screenShakeY);for(var d in e.ctx.translate(-R,-F),t.level.draw(n),t.level.drawEntities(n),t.level.drawShade(n),t.level.drawOverShade(n),t.players[t.localPlayerID].drawTopLayer(n),e.ctx.translate(R,F),t.level.drawTopLayer(n),t.players[t.localPlayerID].drawGUI(n),t.players)t.players[d].updateDrawXY(n)}var H=a.GameConstants.HEIGHT-e.letter_height-14;for(t.chatOpen&&(e.ctx.fillStyle="black",a.GameConstants.ALPHA_ENABLED&&(e.ctx.globalAlpha=.75),e.ctx.fillRect(0,0,a.GameConstants.WIDTH,a.GameConstants.HEIGHT),e.ctx.globalAlpha=1,e.ctx.fillStyle="white",e.fillText(t.chatTextBox.text,10,H),c=e.measureText(t.chatTextBox.text.substring(0,t.chatTextBox.cursor)).width,e.ctx.fillRect(10+c,H,1,e.letter_height)),d=0;d<t.chat.length;d++){e.ctx.fillStyle="white","/"===t.chat[d][0]&&(e.ctx.fillStyle=a.GameConstants.GREEN),D=H-(t.chat.length-1-d)*(e.letter_height+1),t.chatOpen&&(D-=e.letter_height+1);var N=Date.now()-t.chat[d].timestamp;t.chatOpen?e.ctx.globalAlpha=1:N<=a.GameConstants.CHAT_APPEAR_TIME?a.GameConstants.ALPHA_ENABLED&&(e.ctx.globalAlpha=.5):N<=a.GameConstants.CHAT_APPEAR_TIME+a.GameConstants.CHAT_FADE_TIME?a.GameConstants.ALPHA_ENABLED&&(e.ctx.globalAlpha=.5*(1-(N-a.GameConstants.CHAT_APPEAR_TIME)/a.GameConstants.CHAT_FADE_TIME)):e.ctx.globalAlpha=0,e.fillText(t.chat[d].message,10,D)}}a.GameConstants.ALPHA_ENABLED&&(e.ctx.globalAlpha=.1),e.ctx.fillStyle=s.LevelConstants.LEVEL_TEXT_COLOR,e.fillText(a.GameConstants.VERSION,a.GameConstants.WIDTH-e.measureText(a.GameConstants.VERSION).width-1,1),e.ctx.globalAlpha=1,a.GameConstants.ALPHA_ENABLED&&(e.ctx.globalAlpha=.1),e.ctx.fillStyle=s.LevelConstants.LEVEL_TEXT_COLOR,e.fillText(w+"fps",1,1),e.ctx.globalAlpha=1},window.addEventListener("load",(function(){t.socket=p.io(d.ServerAddress.address,{transports:["websocket"]}),t.socket.on("new connect",(function(){t.menuState!==v.LOADING&&(t.loginMessage="disconnected"),t.menuState=v.LOGIN_USERNAME})),t.socket.on("unrecognized session",(function(){t.loginMessage="unrecognized session",t.menuState=v.LOGIN_USERNAME})),t.socket.on("incorrect password",(function(){t.passwordTextBox.clear(),t.loginMessage="incorrect password, try again",t.menuState=v.LOGIN_USERNAME})),t.socket.on("login already active",(function(){t.usernameTextBox.clear(),t.passwordTextBox.clear(),t.loginMessage="account currently logged in",t.menuState=v.LOGIN_USERNAME})),t.socket.on("logged in",(function(){t.socket.emit("get available worlds"),t.menuState=v.SELECT_WORLD})),t.socket.on("world codes",(function(e){t.worldCodes=e,t.selectedWorldCode=0})),t.socket.on("welcome",(function(e,n){t.players={},t.offlinePlayers={},y.loadGameState(t,e,n),t.chatOpen=!1,t.screenShakeX=0,t.screenShakeY=0,t.menuState=v.IN_GAME,t.levelState=r.IN_LEVEL})),t.socket.on("get state",(function(){t.socket.emit("game state",y.createGameState(t))})),t.socket.on("input",(function(e,n,r){switch(m.Random.state!==r&&(t.chat.push(new g("RAND STATES OUT OF SYNC")),t.chat.push(new g("Received "+r)),t.chat.push(new g("Current "+m.Random.state))),t.input_history.push(e+", "+function(e){return e===c.InputEnum.I?"I":e===c.InputEnum.Q?"Q":e===c.InputEnum.LEFT?"LEFT":e===c.InputEnum.RIGHT?"RIGHT":e===c.InputEnum.UP?"UP":e===c.InputEnum.DOWN?"DOWN":e===c.InputEnum.SPACE?"SPACE":void 0}(n)),e in t.players||e in t.offlinePlayers||(t.players[t.localPlayerID]=new o.Player(t,0,0,!0),t.players[t.localPlayerID].levelID=t.levelgen.currentFloorFirstLevelID,t.players[t.localPlayerID].x=t.levels[t.levelgen.currentFloorFirstLevelID].roomX+Math.floor(t.levels[t.levelgen.currentFloorFirstLevelID].width/2),t.players[t.localPlayerID].y=t.levels[t.levelgen.currentFloorFirstLevelID].roomY+Math.floor(t.levels[t.levelgen.currentFloorFirstLevelID].height/2)),e in t.offlinePlayers&&(t.players[e]=t.offlinePlayers[e],delete t.offlinePlayers[e]),n){case c.InputEnum.I:t.players[e].iListener();break;case c.InputEnum.Q:t.players[e].qListener();break;case c.InputEnum.LEFT:t.players[e].leftListener(!1);break;case c.InputEnum.RIGHT:t.players[e].rightListener(!1);break;case c.InputEnum.UP:t.players[e].upListener(!1);break;case c.InputEnum.DOWN:t.players[e].downListener(!1);break;case c.InputEnum.SPACE:t.players[e].spaceListener()}e===t.localPlayerID&&(t.mostRecentInputReceived=!0)})),t.socket.on("chat message",(function(e){t.chat.push(new g(e))})),t.socket.on("player joined",(function(e){e in t.offlinePlayers?(t.players[e]=t.offlinePlayers[e],delete t.offlinePlayers[e]):e in t.players||(t.players[e]=new o.Player(t,0,0,!1),t.players[e].levelID=t.levelgen.currentFloorFirstLevelID,t.players[e].x=t.levels[t.levelgen.currentFloorFirstLevelID].roomX+Math.floor(t.levels[t.levelgen.currentFloorFirstLevelID].width/2),t.players[e].y=t.levels[t.levelgen.currentFloorFirstLevelID].roomY+Math.floor(t.levels[t.levelgen.currentFloorFirstLevelID].height/2))})),t.socket.on("player left",(function(e){t.offlinePlayers[e]=t.players[e],delete t.players[e]}));var n=document.getElementById("gameCanvas");e.ctx=n.getContext("2d",{alpha:!1}),t.chat=[],t.chatTextBox=new f.TextBox,t.chatTextBox.setEnterCallback((function(){if(t.chatTextBox.text.length>0){if(t.socket.emit("chat message",t.chatTextBox.text),"/logout"===t.chatTextBox.text)t.socket.emit("game state",y.createGameState(t)),t.socket.emit("logout"),t.menuState=v.LOGIN_USERNAME,t.usernameTextBox.clear(),t.passwordTextBox.clear(),t.levels=[],t.players={},t.offlinePlayers={};else if("/leave"===t.chatTextBox.text)t.socket.emit("game state",y.createGameState(t)),t.socket.emit("leave world"),t.socket.emit("get available worlds"),t.menuState=v.SELECT_WORLD,t.levels=[],t.players={},t.offlinePlayers={};else if("/save"===t.chatTextBox.text)t.socket.emit("game state",y.createGameState(t));else if("/r"===t.chatTextBox.text)console.log(m.Random.state);else if("/i"===t.chatTextBox.text)for(var e=0;e<t.input_history.length;e++)console.log(e+": "+t.input_history[e]);else"/invite "===t.chatTextBox.text.substring(0,8)&&t.socket.emit("invite",t.chatTextBox.text.substring(8));t.chatTextBox.clear()}else t.chatOpen=!1})),t.chatTextBox.setEscapeCallback((function(){t.chatOpen=!1})),t.chatOpen=!1,t.usernameTextBox=new f.TextBox,t.usernameTextBox.allowedCharacters="abcdefghijklmnopqrstuvwxyz1234567890 ,.!?:'()[]%-",t.usernameTextBox.setEnterCallback((function(){t.usernameTextBox.text.length<1?t.loginMessage="username too short":(t.loginMessage="",t.menuState=v.LOGIN_PASSWORD)})),t.passwordTextBox=new f.TextBox,t.passwordTextBox.allowedCharacters="abcdefghijklmnopqrstuvwxyz1234567890 ,.!?:'()[]%-",t.passwordTextBox.setEnterCallback((function(){t.passwordTextBox.text.length<8?t.loginMessage="password too short":(t.localPlayerID=t.usernameTextBox.text,t.socket.emit("login",t.localPlayerID,t.passwordTextBox.text))})),t.worldCodes=[],t.selectedWorldCode=0,e.shade_canvases={},e.text_rendering_canvases={},e.tileset=new Image,e.tileset.src="res/tileset.png",e.objset=new Image,e.objset.src="res/objset.png",e.mobset=new Image,e.mobset.src="res/mobset.png",e.itemset=new Image,e.itemset.src="res/itemset.png",e.fxset=new Image,e.fxset.src="res/fxset.png",e.fontsheet=new Image,e.fontsheet.src="res/font.png",e.scale=1,i.Sound.loadSounds(),i.Sound.playMusic(),document.addEventListener("touchstart",(function(e){e.target==n&&e.preventDefault()}),!1),document.addEventListener("touchend",(function(e){e.target==n&&e.preventDefault()}),!1),document.addEventListener("touchmove",(function(e){e.target==n&&e.preventDefault()}),!1),document.addEventListener("touchstart",c.Input.handleTouchStart,{passive:!1}),document.addEventListener("touchmove",c.Input.handleTouchMove,{passive:!1}),document.addEventListener("touchend",c.Input.handleTouchEnd,{passive:!1}),c.Input.keyDownListener=function(e){t.keyDownListener(e)},t.menuState=v.LOADING,window.requestAnimationFrame(t.run),t.onResize(),window.addEventListener("resize",t.onResize)}))}return e.letters="abcdefghijklmnopqrstuvwxyz1234567890,.!?:'()[]%-/",e.letter_widths=[4,4,4,4,3,3,4,4,1,4,4,3,5,5,4,4,4,4,4,3,4,5,5,5,5,3,3,4,4,4,4,4,4,4,4,4,2,1,1,4,1,1,2,2,2,2,5,3,3],e.letter_height=6,e.letter_positions=[],e.rand=function(e,t,n){return t<e?e:Math.floor(n()*(t-e+1)+e)},e.randTable=function(t,n){return t[e.rand(0,t.length-1,n)]},e.measureText=function(t){for(var n=0,r=0,a=t.toLowerCase();r<a.length;r++){var o=a[r];if(" "===o)n+=4;else for(var i=0;i<e.letters.length;i++)e.letters[i]===o&&(n+=e.letter_widths[i]+1)}return{width:n,height:e.letter_height}},e.fillText=function(t,n,r,a){if(n=Math.round(n),r=Math.round(r),0===e.letter_positions.length)for(var o=0;o<e.letter_widths.length;o++)0===o?e.letter_positions[0]=0:e.letter_positions[o]=e.letter_positions[o-1]+e.letter_widths[o-1]+2;else{var i=e.measureText(t);if(i.width>0){var s=t+e.ctx.fillStyle;if(e.text_rendering_canvases[s])e.ctx.drawImage(e.text_rendering_canvases[s],n,r);else{e.text_rendering_canvases[s]=document.createElement("canvas"),e.text_rendering_canvases[s].width=i.width,e.text_rendering_canvases[s].height=i.height;for(var l=e.text_rendering_canvases[s].getContext("2d"),c=0,u=0,h=t.toLowerCase();u<h.length;u++){var p=h[u];if(" "===p)c+=4;else for(o=0;o<e.letters.length;o++)e.letters[o]===p&&(l.drawImage(e.fontsheet,e.letter_positions[o]+1,0,e.letter_widths[o],e.letter_height,c,0,e.letter_widths[o],e.letter_height),c+=e.letter_widths[o]+1)}l.fillStyle=e.ctx.fillStyle,l.globalCompositeOperation="source-in",l.fillRect(0,0,e.text_rendering_canvases[s].width,e.text_rendering_canvases[s].height),e.ctx.drawImage(e.text_rendering_canvases[s],n,r)}}}},e.fillTextOutline=function(t,n,r,a,o){e.ctx.fillStyle=a;for(var i=-1;i<=1;i++)for(var s=-1;s<=1;s++)e.fillText(t,n+i,r+s);e.ctx.fillStyle=o,e.fillText(t,n,r)},e.drawHelper=function(t,n,r,o,i,s,l,c,u,h,p){void 0===h&&(h="black"),void 0===p&&(p=0);var d=function(e,t,n,r,a,o){return e.src+","+t+","+n+","+r+","+a+","+o}(t,n,r,o,i,p=Math.round(p*a.GameConstants.SHADE_LEVELS)/a.GameConstants.SHADE_LEVELS);if(!e.shade_canvases[d]){e.shade_canvases[d]=document.createElement("canvas"),e.shade_canvases[d].width=Math.round(o*a.GameConstants.TILESIZE),e.shade_canvases[d].height=Math.round(i*a.GameConstants.TILESIZE);var f=e.shade_canvases[d].getContext("2d");f.clearRect(0,0,e.shade_canvases[d].width,e.shade_canvases[d].height),f.globalCompositeOperation="source-over",f.drawImage(t,Math.round(n*a.GameConstants.TILESIZE),Math.round(r*a.GameConstants.TILESIZE),Math.round(o*a.GameConstants.TILESIZE),Math.round(i*a.GameConstants.TILESIZE),0,0,Math.round(o*a.GameConstants.TILESIZE),Math.round(i*a.GameConstants.TILESIZE)),f.globalAlpha=p,f.fillStyle=h,f.fillRect(0,0,e.shade_canvases[d].width,e.shade_canvases[d].height),f.globalAlpha=1,f.globalCompositeOperation="destination-in",f.drawImage(t,Math.round(n*a.GameConstants.TILESIZE),Math.round(r*a.GameConstants.TILESIZE),Math.round(o*a.GameConstants.TILESIZE),Math.round(i*a.GameConstants.TILESIZE),0,0,Math.round(o*a.GameConstants.TILESIZE),Math.round(i*a.GameConstants.TILESIZE))}e.ctx.drawImage(e.shade_canvases[d],Math.round(s*a.GameConstants.TILESIZE),Math.round(l*a.GameConstants.TILESIZE),Math.round(c*a.GameConstants.TILESIZE),Math.round(u*a.GameConstants.TILESIZE))},e.drawTile=function(t,n,r,a,o,i,s,l,c,u){void 0===c&&(c="black"),void 0===u&&(u=0),e.drawHelper(e.tileset,t,n,r,a,o,i,s,l,c,u)},e.drawObj=function(t,n,r,a,o,i,s,l,c,u){void 0===c&&(c="black"),void 0===u&&(u=0),e.drawHelper(e.objset,t,n,r,a,o,i,s,l,c,u)},e.drawMob=function(t,n,r,a,o,i,s,l,c,u){void 0===c&&(c="black"),void 0===u&&(u=0),e.drawHelper(e.mobset,t,n,r,a,o,i,s,l,c,u)},e.drawItem=function(t,n,r,a,o,i,s,l,c,u){void 0===c&&(c="black"),void 0===u&&(u=0),e.drawHelper(e.itemset,t,n,r,a,o,i,s,l,c,u)},e.drawFX=function(t,n,r,a,o,i,s,l,c,u){void 0===c&&(c="black"),void 0===u&&(u=0),e.drawHelper(e.fxset,t,n,r,a,o,i,s,l,c,u)},e}();t.Game=x,new x},988:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GameConstants=void 0;var r=n(5742),a=function(){function e(){}return e.VERSION="v0.6.3",e.FPS=60,e.ALPHA_ENABLED=!0,e.SHADE_LEVELS=10,e.TILESIZE=16,e.SCALE=2,e.SWIPE_THRESH=Math.pow(50,2),e.KEY_REPEAT_TIME=300,e.CHAT_APPEAR_TIME=1e4,e.CHAT_FADE_TIME=1e3,e.DEFAULTWIDTH=8.5*e.TILESIZE,e.DEFAULTHEIGHT=8.5*e.TILESIZE,e.WIDTH=r.LevelConstants.SCREEN_W*e.TILESIZE,e.HEIGHT=r.LevelConstants.SCREEN_H*e.TILESIZE,e.scrolling=!0,e.SCRIPT_FONT_SIZE=16,e.FONT_SIZE=10,e.BIG_FONT_SIZE=20,e.RED="#ac3232",e.WARNING_RED="#ff0000",e.GREEN="#6abe30",e.ARMOR_GREY="#9badb7",e.OUTLINE="#222034",e.HIT_ENEMY_TEXT_COLOR="#76428a",e.HEALTH_BUFF_COLOR="#d77bba",e.MISS_COLOR="#639bff",e}();t.GameConstants=a},1790:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadGameState=t.createGameState=t.GameState=t.PlayerState=t.InventoryState=t.ItemState=t.ItemType=t.LevelState=t.EnemyState=t.EnemyType=t.ProjectileState=t.ProjectileType=t.HitWarningState=void 0;var r=n(6750),a=n(2221),o=n(2725),i=n(516),s=n(8365),l=n(6061),c=n(9379),u=n(5377),h=n(3441),p=n(9670),d=n(8498),f=n(3073),y=n(1241),m=n(6945),v=n(5397),g=n(8232),w=n(3205),_=n(8573),x=n(8414),C=n(1173),E=n(9809),T=n(1978),b=n(8499),I=n(9825),P=n(1348),O=n(7975),S=n(6309),k=n(1785),A=n(282),G=n(5043),D=n(5895),L=n(569),M=n(663),R=n(209),F=n(5363),H=n(792),N=n(6330),j=n(2920),X=n(1656),Y=n(3806),B=function(e){this.x=e.x,this.y=e.y,this.dead=e.dead};t.HitWarningState=B;var W,U=function(e,t){var n=new w.HitWarning(t,e.x,e.y);return n.dead=e.dead,n};!function(e){e[e.SPAWN=0]="SPAWN",e[e.WIZARD=1]="WIZARD"}(W=t.ProjectileType||(t.ProjectileType={}));var q=function(e,t){this.x=e.x,this.y=e.y,this.dead=e.dead,e instanceof R.EnemySpawnAnimation&&(this.type=W.SPAWN,this.levelID=t.levels.indexOf(e.level),this.enemySpawn=new K(e.enemy,t)),e instanceof F.WizardFireball&&(this.type=W.WIZARD,this.wizardState=e.state,this.levelID=t.levels.indexOf(e.parent.level),this.wizardParentID=e.parent.level.enemies.indexOf(e.parent))};t.ProjectileState=q;var Z,V=function(e,t){if(e.type===W.SPAWN){var n=t.levels[e.levelID],r=z(e.enemySpawn,t);return(a=new R.EnemySpawnAnimation(n,r,e.x,e.y)).dead=e.dead,a}if(e.type===W.WIZARD){var a,o=t.levels[e.levelID].enemies[e.wizardParentID];(a=new F.WizardFireball(o,e.x,e.y)).state=e.wizardState}};!function(e){e[e.BARREL=0]="BARREL",e[e.BIGSKULL=1]="BIGSKULL",e[e.CHARGE=2]="CHARGE",e[e.CHEST=3]="CHEST",e[e.COAL=4]="COAL",e[e.CRATE=5]="CRATE",e[e.EMERALD=6]="EMERALD",e[e.GOLD=7]="GOLD",e[e.KNIGHT=8]="KNIGHT",e[e.PLANT=9]="PLANT",e[e.SKULL=10]="SKULL",e[e.SLIME=11]="SLIME",e[e.SPAWNER=12]="SPAWNER",e[e.VENDINGMACHINE=13]="VENDINGMACHINE",e[e.WIZARD=14]="WIZARD",e[e.ZOMBIE=15]="ZOMBIE"}(Z=t.EnemyType||(t.EnemyType={}));var K=function(e,t){if(this.levelID=t.levels.indexOf(e.level),this.x=e.x,this.y=e.y,this.health=e.health,this.direction=e.direction,this.dead=e.dead,this.skipNextTurns=e.skipNextTurns,this.hasDrop=!1,e.drop&&(this.hasDrop=!0,this.drop=new ee(e.drop,t)),this.alertTicks=e.alertTicks,e instanceof r.Barrel&&(this.type=Z.BARREL),e instanceof a.BigSkullEnemy){this.type=Z.BIGSKULL,this.ticks=e.ticks,this.ticksSinceFirstHit=e.ticksSinceFirstHit,this.seenPlayer=e.seenPlayer,e.seenPlayer&&(this.targetPlayerID=Object.keys(t.players).find((function(n){return t.players[n]===e.targetPlayer})),this.targetPlayerID||(this.targetPlayerID=Object.keys(t.offlinePlayers).find((function(n){return t.offlinePlayers[n]===e.targetPlayer})))),this.drops=[];for(var n=0,w=e.drops;n<w.length;n++){var _=w[n];this.drops.push(new ee(_,t))}}if(e instanceof o.ChargeEnemy&&(this.type=Z.CHARGE,this.ticks=e.ticks,this.chargeEnemyState=e.state,this.startX=e.startX,this.startY=e.startY,this.targetX=e.targetX,this.targetY=e.targetY,this.visualTargetX=e.visualTargetX,this.visualTargetY=e.visualTargetY),e instanceof i.Chest&&(this.type=Z.CHEST),e instanceof s.CoalResource&&(this.type=Z.COAL),e instanceof l.Crate&&(this.type=Z.CRATE),e instanceof c.EmeraldResource&&(this.type=Z.EMERALD),e instanceof u.GoldResource&&(this.type=Z.GOLD),e instanceof h.KnightEnemy&&(this.type=Z.KNIGHT,this.ticks=e.ticks,this.seenPlayer=e.seenPlayer,e.seenPlayer&&(this.targetPlayerID=Object.keys(t.players).find((function(n){return t.players[n]===e.targetPlayer})),this.targetPlayerID||(this.targetPlayerID=Object.keys(t.offlinePlayers).find((function(n){return t.offlinePlayers[n]===e.targetPlayer}))))),e instanceof p.PottedPlant&&(this.type=Z.PLANT),e instanceof d.SkullEnemy&&(this.type=Z.SKULL,this.ticks=e.ticks,this.ticksSinceFirstHit=e.ticksSinceFirstHit,this.seenPlayer=e.seenPlayer,e.seenPlayer&&(this.targetPlayerID=Object.keys(t.players).find((function(n){return t.players[n]===e.targetPlayer})),this.targetPlayerID||(this.targetPlayerID=Object.keys(t.offlinePlayers).find((function(n){return t.offlinePlayers[n]===e.targetPlayer}))))),e instanceof f.SlimeEnemy&&(this.type=Z.SLIME,this.ticks=e.ticks,this.seenPlayer=e.seenPlayer,e.seenPlayer&&(this.targetPlayerID=Object.keys(t.players).find((function(n){return t.players[n]===e.targetPlayer})),this.targetPlayerID||(this.targetPlayerID=Object.keys(t.offlinePlayers).find((function(n){return t.offlinePlayers[n]===e.targetPlayer}))))),e instanceof y.Spawner&&(this.type=Z.SPAWNER,this.ticks=e.ticks,this.seenPlayer=e.seenPlayer,this.enemySpawnType=e.enemySpawnType),e instanceof m.VendingMachine){this.type=Z.VENDINGMACHINE,this.isPlayerOpened=!1,e.playerOpened&&(this.isPlayerOpened=!0,this.playerOpenedID=Object.keys(t.players).find((function(n){return t.players[n]===e.playerOpened})),this.playerOpenedID||(this.playerOpenedID=Object.keys(t.offlinePlayers).find((function(n){return t.offlinePlayers[n]===e.playerOpened})))),this.open=e.open,this.costItems=[];for(var x=0,C=e.costItems;x<C.length;x++){var E=C[x];this.costItems.push(new ee(E,t))}this.item=new ee(e.item,t),this.isInf=e.isInf,this.quantity=e.quantity}e instanceof v.WizardEnemy&&(this.type=Z.WIZARD,this.ticks=e.ticks,this.wizardState=e.state,this.seenPlayer=e.seenPlayer),e instanceof g.ZombieEnemy&&(this.type=Z.ZOMBIE,this.ticks=e.ticks,this.seenPlayer=e.seenPlayer,e.seenPlayer&&(this.targetPlayerID=Object.keys(t.players).find((function(n){return t.players[n]===e.targetPlayer})),this.targetPlayerID||(this.targetPlayerID=Object.keys(t.offlinePlayers).find((function(n){return t.offlinePlayers[n]===e.targetPlayer})))))};t.EnemyState=K;var z=function(e,t){var n,w=t.levels[e.levelID];if(e.type===Z.BARREL&&(n=new r.Barrel(w,t,e.x,e.y)),e.type===Z.BIGSKULL){(n=new a.BigSkullEnemy(w,t,e.x,e.y,H.Random.rand)).ticks=e.ticks,n.ticksSinceFirstHit=e.ticksSinceFirstHit,n.seenPlayer=e.seenPlayer,e.seenPlayer&&(n.targetPlayer=t.players[e.targetPlayerID],n.targetPlayer||(n.targetPlayer=t.offlinePlayers[e.targetPlayerID])),n.drops=[];for(var _=0,x=e.drops;_<x.length;_++){var C=x[_];n.drops.push(te(C,t))}}if(e.type===Z.CHARGE&&((n=new o.ChargeEnemy(w,t,e.x,e.y)).ticks=e.ticks,n.state=e.chargeEnemyState,n.startX=e.startX,n.startY=e.startY,n.targetX=e.targetX,n.targetY=e.targetY,n.visualTargetX=e.visualTargetX,n.visualTargetY=e.visualTargetY),e.type===Z.CHEST&&(n=new i.Chest(w,t,e.x,e.y,H.Random.rand)),e.type===Z.COAL&&(n=new s.CoalResource(w,t,e.x,e.y)),e.type===Z.CRATE&&(n=new l.Crate(w,t,e.x,e.y)),e.type===Z.EMERALD&&(n=new c.EmeraldResource(w,t,e.x,e.y)),e.type===Z.GOLD&&(n=new u.GoldResource(w,t,e.x,e.y)),e.type===Z.KNIGHT&&((n=new h.KnightEnemy(w,t,e.x,e.y,H.Random.rand)).ticks=e.ticks,n.seenPlayer=e.seenPlayer,e.seenPlayer&&(n.targetPlayer=t.players[e.targetPlayerID],n.targetPlayer||(n.targetPlayer=t.offlinePlayers[e.targetPlayerID]))),e.type===Z.PLANT&&(n=new p.PottedPlant(w,t,e.x,e.y)),e.type===Z.SKULL&&((n=new d.SkullEnemy(w,t,e.x,e.y,H.Random.rand)).ticks=e.ticks,n.ticksSinceFirstHit=e.ticksSinceFirstHit,n.seenPlayer=e.seenPlayer,e.seenPlayer&&(n.targetPlayer=t.players[e.targetPlayerID],n.targetPlayer||(n.targetPlayer=t.offlinePlayers[e.targetPlayerID]))),e.type===Z.SLIME&&((n=new f.SlimeEnemy(w,t,e.x,e.y,H.Random.rand)).ticks=e.ticks,n.seenPlayer=e.seenPlayer,e.seenPlayer&&(n.targetPlayer=t.players[e.targetPlayerID],n.targetPlayer||(n.targetPlayer=t.offlinePlayers[e.targetPlayerID]))),e.type===Z.SPAWNER&&((n=new y.Spawner(w,t,e.x,e.y,H.Random.rand)).ticks=e.ticks,n.seenPlayer=e.seenPlayer,n.enemySpawnType=e.enemySpawnType),e.type===Z.VENDINGMACHINE){var E=te(e.item,t);n=new m.VendingMachine(w,t,e.x,e.y,E,H.Random.rand),e.isPlayerOpened&&(n.playerOpened=t.players[e.playerOpenedID],n.playerOpened||(n.playerOpened=t.offlinePlayers[e.playerOpenedID])),n.open=e.open,n.costItems=[];for(var T=0,b=e.costItems;T<b.length;T++){var I=b[T];n.costItems.push(te(I,t))}n.isInf=e.isInf,n.quantity=e.quantity}return e.type===Z.WIZARD&&((n=new v.WizardEnemy(w,t,e.x,e.y,H.Random.rand)).ticks=e.ticks,n.state=e.wizardState,n.seenPlayer=e.seenPlayer),e.type===Z.ZOMBIE&&((n=new g.ZombieEnemy(w,t,e.x,e.y,H.Random.rand)).ticks=e.ticks,n.seenPlayer=e.seenPlayer,e.seenPlayer&&(n.targetPlayer=t.players[e.targetPlayerID],n.targetPlayer||(n.targetPlayer=t.offlinePlayers[e.targetPlayerID]))),n.x=e.x,n.y=e.y,n.health=e.health,n.direction=e.direction,n.dead=e.dead,n.skipNextTurns=e.skipNextTurns,e.hasDrop&&(n.drop=te(e.drop,t)),n.alertTicks=e.alertTicks,n},$=function(e,t){this.levelID=t.levels.indexOf(e),this.entered=e.entered,this.enemies=[],this.items=[],this.projectiles=[],this.hitwarnings=[];for(var n=0,r=e.enemies;n<r.length;n++){var a=r[n];this.enemies.push(new K(a,t))}for(var o=0,i=e.items;o<i.length;o++){var s=i[o];this.items.push(new ee(s,t))}for(var l=0,c=e.projectiles;l<c.length;l++){var u=c[l];this.projectiles.push(new q(u,t))}for(var h=0,p=e.hitwarnings;h<p.length;h++){var d=p[h];this.hitwarnings.push(new B(d))}};t.LevelState=$;var J,Q=function(e,t,n){e.entered=t.entered,e.enemies=[],e.items=[],e.projectiles=[],e.hitwarnings=[];for(var r=0,a=t.enemies;r<a.length;r++){var o=a[r];e.enemies.push(z(o,n))}for(var i=0,s=t.items;i<s.length;i++){var l=s[i];e.items.push(te(l,n))}for(var c=0,u=t.projectiles;c<u.length;c++){var h=u[c];e.projectiles.push(V(h,n))}for(var p=0,d=t.hitwarnings;p<d.length;p++){var f=d[p];e.hitwarnings.push(U(f,n))}};!function(e){e[e.ARMOR=0]="ARMOR",e[e.BLUEGEM=1]="BLUEGEM",e[e.CANDLE=2]="CANDLE",e[e.COAL=3]="COAL",e[e.COIN=4]="COIN",e[e.GOLD=5]="GOLD",e[e.GOLDENKEY=6]="GOLDENKEY",e[e.GREENGEM=7]="GREENGEM",e[e.HEART=8]="HEART",e[e.KEY=9]="KEY",e[e.LANTERN=10]="LANTERN",e[e.REDGEM=11]="REDGEM",e[e.TORCH=12]="TORCH",e[e.DAGGER=13]="DAGGER",e[e.DUALDAGGER=14]="DUALDAGGER",e[e.SHOTGUN=15]="SHOTGUN",e[e.SPEAR=16]="SPEAR"}(J=t.ItemType||(t.ItemType={}));var ee=function(e,t){e instanceof _.Armor&&(this.type=J.ARMOR),e instanceof x.BlueGem&&(this.type=J.BLUEGEM),e instanceof C.Candle&&(this.type=J.CANDLE),e instanceof E.Coal&&(this.type=J.COAL),e instanceof T.Coin&&(this.type=J.COIN),e instanceof I.Gold&&(this.type=J.GOLD),e instanceof P.GoldenKey&&(this.type=J.GOLDENKEY),e instanceof O.GreenGem&&(this.type=J.GREENGEM),e instanceof S.Heart&&(this.type=J.HEART),e instanceof k.Key&&(this.type=J.KEY),e instanceof A.Lantern&&(this.type=J.LANTERN),e instanceof G.RedGem&&(this.type=J.REDGEM),e instanceof D.Torch&&(this.type=J.TORCH),e instanceof N.Dagger&&(this.type=J.DAGGER),e instanceof j.DualDagger&&(this.type=J.DUALDAGGER),e instanceof X.Shotgun&&(this.type=J.SHOTGUN),e instanceof Y.Spear&&(this.type=J.SPEAR),this.equipped=e instanceof b.Equippable&&e.equipped,this.x=e.x,this.y=e.y,this.levelID=t.levels.indexOf(e.level),-1===this.levelID&&(this.levelID=0),this.stackCount=e.stackCount,this.pickedUp=e.pickedUp};t.ItemState=ee;var te=function(e,t,n){var r,a=t.levels[e.levelID];return e.type===J.ARMOR&&(r=new _.Armor(a,e.x,e.y)),e.type===J.BLUEGEM&&(r=new x.BlueGem(a,e.x,e.y)),e.type===J.CANDLE&&(r=new C.Candle(a,e.x,e.y)),e.type===J.COAL&&(r=new E.Coal(a,e.x,e.y)),e.type===J.COIN&&(r=new T.Coin(a,e.x,e.y)),e.type===J.GOLD&&(r=new I.Gold(a,e.x,e.y)),e.type===J.GOLDENKEY&&(r=new P.GoldenKey(a,e.x,e.y)),e.type===J.GREENGEM&&(r=new O.GreenGem(a,e.x,e.y)),e.type===J.HEART&&(r=new S.Heart(a,e.x,e.y)),e.type===J.KEY&&(r=new k.Key(a,e.x,e.y)),e.type===J.LANTERN&&(r=new A.Lantern(a,e.x,e.y)),e.type===J.REDGEM&&(r=new G.RedGem(a,e.x,e.y)),e.type===J.TORCH&&(r=new D.Torch(a,e.x,e.y)),e.type===J.DAGGER&&(r=new N.Dagger(a,e.x,e.y)),e.type===J.DUALDAGGER&&(r=new j.DualDagger(a,e.x,e.y)),e.type===J.SHOTGUN&&(r=new X.Shotgun(a,e.x,e.y)),e.type===J.SPEAR&&(r=new Y.Spear(a,e.x,e.y)),e.equipped&&(r.equipped=!0),r instanceof b.Equippable&&r.setWielder(n),r.stackCount=e.stackCount,r.pickedUp=e.pickedUp,r},ne=function(e,t){this.isOpen=e.isOpen,this.cols=e.cols,this.rows=e.rows,this.equipAnimAmount=e.equipAnimAmount.map((function(e){return e})),this.isWeaponEquipped=!1,e.weapon&&(this.isWeaponEquipped=!0,this.weaponI=e.items.indexOf(e.weapon)),this.coins=e.coins,this.selX=e.selX,this.selY=e.selY,this.items=Array();for(var n=0,r=e.items;n<r.length;n++){var a=r[n];this.items.push(new ee(a,t))}};t.InventoryState=ne;var re=function(e,t){this.x=e.x,this.y=e.y,this.dead=e.dead,this.levelID=e.levelID,this.direction=e.direction,this.health=e.health,this.maxHealth=e.maxHealth,this.lastTickHealth=e.lastTickHealth,this.inventory=new ne(e.inventory,t),this.hasOpenVendingMachine=!1,e.openVendingMachine&&(this.hasOpenVendingMachine=!0,this.openVendingMachineLevelID=t.levels.indexOf(e.openVendingMachine.level),this.openVendingMachineID=e.openVendingMachine.level.enemies.indexOf(e.openVendingMachine)),this.sightRadius=e.sightRadius};t.PlayerState=re;var ae=function(e,t,n){var r=new M.Player(n,t.x,t.y,e===n.localPlayerID);return r.dead=t.dead,r.levelID=t.levelID,r.levelID<n.levelgen.currentFloorFirstLevelID&&(r.levelID=n.levelgen.currentFloorFirstLevelID,r.x=n.levels[r.levelID].roomX+Math.floor(n.levels[r.levelID].width/2),r.y=n.levels[r.levelID].roomY+Math.floor(n.levels[r.levelID].height/2)),r.direction=t.direction,r.health=t.health,r.maxHealth=t.maxHealth,r.lastTickHealth=t.lastTickHealth,function(e,t,n){e.clear(),e.isOpen=t.isOpen,e.cols=t.cols,e.rows=t.rows,e.selX=t.selX,e.selY=t.selY,e.equipAnimAmount=t.equipAnimAmount.map((function(e){return e})),e.coins=t.coins;for(var r=0,a=t.items;r<a.length;r++){var o=a[r];e.items.push(te(o,n,e.player))}t.isWeaponEquipped&&(e.weapon=e.items[t.weaponI])}(r.inventory,t.inventory,n),t.hasOpenVendingMachine&&(r.openVendingMachine=n.levels[t.openVendingMachineLevelID].enemies[t.openVendingMachineID]),r.sightRadius=t.sightRadius,r},oe=function(){this.seed=0,this.randomState=0,this.depth=0,this.players={},this.offlinePlayers={},this.levels=[]};t.GameState=oe,t.createGameState=function(e){var t=new oe;for(var n in t.seed=e.levelgen.seed,t.randomState=H.Random.state,t.depth=e.levelgen.depthReached,e.players)t.players[n]=new re(e.players[n],e);for(var n in e.offlinePlayers)t.offlinePlayers[n]=new re(e.offlinePlayers[n],e);for(var r=0,a=e.levels;r<a.length;r++){var o=a[r];o.catchUp(),t.levels.push(new $(o,e))}return t},t.loadGameState=function(e,t,n){if(e.levels=Array(),e.levelgen=new L.LevelGenerator,e.levelgen.setSeed(n.seed),n.init_state&&(n.depth=0),e.levelgen.generateFirstNFloors(e,n.depth),n.init_state)e.players[e.localPlayerID]=new M.Player(e,0,0,!0),e.level=e.levels[e.players[e.localPlayerID].levelID],e.level.enterLevel(e.players[e.localPlayerID]);else{if(n.players)for(var r in n.players)t.includes(r)?e.players[r]=ae(r,n.players[r],e):e.offlinePlayers[r]=ae(r,n.players[r],e);if(n.offlinePlayers)for(var r in n.offlinePlayers)r===e.localPlayerID||t.includes(r)?e.players[r]=ae(r,n.offlinePlayers[r],e):e.offlinePlayers[r]=ae(r,n.offlinePlayers[r],e);for(var a=0,o=n.levels;a<o.length;a++){var i=o[a];for(r=0;r<e.levels.length;r++)r===i.levelID&&Q(e.levels[r],i,e)}e.localPlayerID in n.players||e.localPlayerID in n.offlinePlayers?e.level=e.levels[e.players[e.localPlayerID].levelID]:(e.players[e.localPlayerID]=new M.Player(e,0,0,!0),e.players[e.localPlayerID].levelID=e.levelgen.currentFloorFirstLevelID,e.players[e.localPlayerID].x=e.levels[e.levelgen.currentFloorFirstLevelID].roomX+Math.floor(e.levels[e.levelgen.currentFloorFirstLevelID].width/2),e.players[e.localPlayerID].y=e.levels[e.levelgen.currentFloorFirstLevelID].roomY+Math.floor(e.levels[e.levelgen.currentFloorFirstLevelID].height/2),e.level=e.levels[e.levelgen.currentFloorFirstLevelID],e.level.enterLevel(e.players[e.localPlayerID]))}H.Random.setState(n.randomState),e.level.updateLighting(),e.chat=[]}},3338:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HealthBar=void 0;var r=n(2967),a=n(5742);t.HealthBar=function(){var e=this;this.hurt=function(){e.hurtTimer=Date.now()},this.draw=function(t,n,o,i,s,l){var c=Date.now()-e.hurtTimer;if(c<=a.LevelConstants.HEALTH_BAR_TOTALTIME)for(var u=Math.floor(n),h=Math.ceil(n-u),p=Math.round(Math.min(9,Math.min(.05*(a.LevelConstants.HEALTH_BAR_TOTALTIME-c),.05*c))),d=Math.round(16*Math.min(.5,Math.min(.003*(a.LevelConstants.HEALTH_BAR_TOTALTIME-c),.003*c)))/16,f=.5+-(p*(o-1)+8)/16/2,y=0;y<Math.ceil(.5*o);y++){var m;m=l?y<u?0:y<u+h?.5:1:1.5;var v=p*y/16+f;r.Game.drawFX(m,8,.5,.5,i+v,s-1-d/2,.5,d),v+=9/16;var g=o-y-1;if(g!==y){var w;w=l?g<u?0:g<u+h?.5:1:1.5;var _=p*g/16+f;r.Game.drawFX(w,8,.5,.5,i+_,s-1-d/2,.5,d),_+=9/16}}},this.hurtTimer=0}},3205:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.HitWarning=void 0;var o=n(2967),i=function(e){function t(n,r,a){var i=e.call(this)||this;return i.tick=function(){i.dead=!0},i.draw=function(e){(i.x===i.game.players[i.game.localPlayerID].x&&Math.abs(i.y-i.game.players[i.game.localPlayerID].y)<=1||i.y===i.game.players[i.game.localPlayerID].y&&Math.abs(i.x-i.game.players[i.game.localPlayerID].x)<=1)&&o.Game.drawFX(18+Math.floor(t.frame),6,1,1,i.x,i.y,1,1)},i.drawTopLayer=function(e){i.drawableY=i.y,(i.x===i.game.players[i.game.localPlayerID].x&&Math.abs(i.y-i.game.players[i.game.localPlayerID].y)<=1||i.y===i.game.players[i.game.localPlayerID].y&&Math.abs(i.x-i.game.players[i.game.localPlayerID].x)<=1)&&o.Game.drawFX(18+Math.floor(t.frame),5,1,1,i.x,i.y,1,1)},i.x=r,i.y=a,i.dead=!1,i.game=n,i}return a(t,e),t.frame=0,t.updateFrame=function(e){t.frame+=.125*e,t.frame>=4&&(t.frame=0)},t}(n(6779).Drawable);t.HitWarning=i},8835:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Input=t.InputEnum=void 0;var r,a=n(988),o=n(2967);(r=t.InputEnum||(t.InputEnum={}))[r.I=0]="I",r[r.M=1]="M",r[r.M_UP=2]="M_UP",r[r.Q=3]="Q",r[r.LEFT=4]="LEFT",r[r.RIGHT=5]="RIGHT",r[r.UP=6]="UP",r[r.DOWN=7]="DOWN",r[r.SPACE=8]="SPACE",t.Input={_pressed:{},isTapHold:!1,tapStartTime:null,IS_TAP_HOLD_THRESH:300,keyDownListener:function(e){},iListener:function(){},mListener:function(){},mUpListener:function(){},qListener:function(){},leftListener:function(){},rightListener:function(){},upListener:function(){},downListener:function(){},aListener:function(){t.Input.leftListener()},dListener:function(){t.Input.rightListener()},wListener:function(){t.Input.upListener()},sListener:function(){t.Input.downListener()},spaceListener:function(){},leftSwipeListener:function(){},rightSwipeListener:function(){},upSwipeListener:function(){},downSwipeListener:function(){},tapListener:function(){},mouseLeftClickListeners:[],mouseLeftClickListener:function(e,n){for(var r=0;r<t.Input.mouseLeftClickListeners.length;r++)t.Input.mouseLeftClickListeners[r](e,n)},mouseX:0,mouseY:0,lastPressTime:0,lastPressKeyCode:"",SPACE:"Space",LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown",W:"KeyW",A:"KeyA",S:"KeyS",D:"KeyD",M:"KeyM",N:"KeyN",I:"KeyI",Q:"KeyQ",isDown:function(e){return this._pressed[e]},onKeydown:function(e){if(e.key&&t.Input.keyDownListener(e.key),e.cancelable&&"F12"!=e.key&&"F5"!=e.key&&e.preventDefault(),!e.repeat)switch(t.Input.lastPressTime=Date.now(),t.Input.lastPressKeyCode=e.code,t.Input._pressed[e.code]=!0,e.code){case t.Input.LEFT:t.Input.leftListener();break;case t.Input.A:t.Input.aListener();break;case t.Input.RIGHT:t.Input.rightListener();break;case t.Input.D:t.Input.dListener();break;case t.Input.UP:t.Input.upListener();break;case t.Input.W:t.Input.wListener();break;case t.Input.DOWN:t.Input.downListener();break;case t.Input.S:t.Input.sListener();break;case t.Input.SPACE:t.Input.spaceListener();break;case t.Input.M:t.Input.mListener();break;case t.Input.I:t.Input.iListener();break;case t.Input.Q:t.Input.qListener()}},onKeyup:function(e){delete this._pressed[e.code],e.code===this.lastPressKeyCode&&(this.lastPressTime=0,this.lastPressKeyCode=0),e.code===t.Input.M&&t.Input.mUpListener()},mouseClickListener:function(e){if(0===e.button){var n=window.document.getElementById("gameCanvas").getBoundingClientRect(),r=e.clientX-n.left,a=e.clientY-n.top;t.Input.mouseLeftClickListener(Math.floor(r/o.Game.scale),Math.floor(a/o.Game.scale))}},updateMousePos:function(e){var n=window.document.getElementById("gameCanvas").getBoundingClientRect(),r=e.clientX-n.left,a=e.clientY-n.top;t.Input.mouseX=Math.floor(r/o.Game.scale),t.Input.mouseY=Math.floor(a/o.Game.scale)},getTouches:function(e){return e.touches||e.originalEvent.touches},xDown:null,yDown:null,currentX:0,currentY:0,swiped:!1,handleTouchStart:function(e){e.preventDefault();var n=t.Input.getTouches(e)[0];t.Input.xDown=n.clientX,t.Input.yDown=n.clientY,t.Input.currentX=n.clientX,t.Input.currentY=n.clientY,t.Input.tapStartTime=Date.now(),t.Input.updateMousePos({clientX:t.Input.currentX,clientY:t.Input.currentY}),t.Input.swiped=!1},handleTouchMove:function(e){if(e.preventDefault(),t.Input.currentX=e.touches[0].clientX,t.Input.currentY=e.touches[0].clientY,t.Input.updateMousePos({clientX:t.Input.currentX,clientY:t.Input.currentY}),!t.Input.swiped){var n=t.Input.xDown-t.Input.currentX,r=t.Input.yDown-t.Input.currentY;Math.pow(n,2)+Math.pow(r,2)>=a.GameConstants.SWIPE_THRESH&&(Math.abs(n)>Math.abs(r)?(n>0?t.Input.leftSwipeListener():t.Input.rightSwipeListener(),t.Input.swiped=!0):(r>0?t.Input.upSwipeListener():t.Input.downSwipeListener(),t.Input.swiped=!0))}},handleTouchEnd:function(e){e.preventDefault(),t.Input.isTapHold||t.Input.swiped||t.Input.tapListener(),t.Input.isTapHold=!1,t.Input.tapStartTime=null,t.Input.swiped||(t.Input.mouseClickListener({button:0,clientX:t.Input.currentX,clientY:t.Input.currentY}),t.Input.updateMousePos({clientX:0,clientY:0}))},checkIsTapHold:function(){null!==t.Input.tapStartTime&&Date.now()>=t.Input.tapStartTime+t.Input.IS_TAP_HOLD_THRESH&&(t.Input.isTapHold=!0)}},window.addEventListener("keyup",(function(e){t.Input.onKeyup(e)}),!1),window.addEventListener("keydown",(function(e){t.Input.onKeydown(e)}),!1),window.document.getElementById("gameCanvas").addEventListener("click",(function(e){return t.Input.mouseClickListener(e)}),!1),window.document.getElementById("gameCanvas").addEventListener("mousemove",(function(e){return t.Input.updateMousePos(e)}))},7531:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Inventory=void 0;var r=n(5742),a=n(2967),o=n(988),i=n(8499),s=n(8573),l=n(1978),c=n(2091),u=n(6330),h=n(1802),p=n(5895),d="#5a595b",f="#292c36",y="#85a8e6";t.Inventory=function(e,t){var n=this;this.rows=2,this.cols=5,this.selX=0,this.selY=0,this.clear=function(){n.items=[];for(var e=0;e<n.rows*n.cols;e++)n.equipAnimAmount[e]=0},this.open=function(){n.isOpen=!n.isOpen,n.isOpen&&(n.openTime=Date.now())},this.close=function(){n.isOpen=!1},this.left=function(){n.selX--,n.selX<0&&(n.selX=0)},this.right=function(){n.selX++,n.selX>n.cols-1&&(n.selX=n.cols-1)},this.up=function(){n.selY--,n.selY<0&&(n.selY=0)},this.down=function(){n.selY++,n.selY>n.rows-1&&(n.selY=n.rows-1)},this.space=function(){var e=n.selX+n.selY*n.cols;if(n.items[e]instanceof h.Usable&&(n.items[e].onUse(n.player),n.items.splice(e,1)),n.items[e]instanceof i.Equippable){var t=n.items[e];if(t.toggleEquip(),t instanceof c.Weapon&&(t.equipped?n.weapon=t:n.weapon=null),t.equipped)for(var r=0,a=n.items;r<a.length;r++){var o=a[r];o instanceof i.Equippable&&o!==t&&!t.coEquippable(o)&&(o.equipped=!1)}}},this.drop=function(){var e=n.selX+n.selY*n.cols;e<n.items.length&&(n.items[e]instanceof i.Equippable&&(n.items[e].equipped=!1),n.items[e].level=n.game.levels[n.player.levelID],n.items[e].x=n.player.x,n.items[e].y=n.player.y,n.items[e].pickedUp=!1,n.equipAnimAmount[e]=0,n.game.levels[n.player.levelID].items.push(n.items[e]),n.items.splice(e,1))},this.hasItem=function(e){for(var t=0,r=n.items;t<r.length;t++){var a=r[t];if(a instanceof e)return a}return null},this.hasItemCount=function(e){if(e instanceof l.Coin)return n.coinCount()>=e.stackCount;for(var t=0,r=n.items;t<r.length;t++){var a=r[t];if(a.constructor===e.constructor&&a.stackCount>=e.stackCount)return!0}return!1},this.subtractItemCount=function(e){if(e instanceof l.Coin)n.subtractCoins(e.stackCount);else for(var t=0,r=n.items;t<r.length;t++){var a=r[t];a.constructor===e.constructor&&(a.stackCount-=e.stackCount,a.stackCount<=0&&n.items.splice(n.items.indexOf(a),1))}},this.coinCount=function(){return n.coins},this.subtractCoins=function(e){n.coins-=e,n.coins<0&&(n.coins=0)},this.addCoins=function(e){n.coins+=e},this.isFull=function(){return n.items.length>=n.rows*n.cols},this.addItem=function(e){if(e instanceof l.Coin)return n.coins+=1,!0;if(e instanceof i.Equippable&&e.setWielder(n.player),e.stackable)for(var t=0,r=n.items;t<r.length;t++){var a=r[t];if(a.constructor===e.constructor)return a.stackCount+=e.stackCount,!0}return!n.isFull()&&(n.items.push(e),!0)},this.removeItem=function(e){var t=n.items.indexOf(e);-1!==t&&n.items.splice(t,1)},this.getArmor=function(){for(var e=0,t=n.items;e<t.length;e++){var r=t[e];if(r instanceof s.Armor&&r.equipped)return r}return null},this.hasWeapon=function(){return null!==n.weapon},this.getWeapon=function(){return n.weapon},this.tick=function(){for(var e=0,t=n.items;e<t.length;e++)t[e].tickInInventory()},this.textWrap=function(e,t,n,r){for(var o=e.split(" "),i="";o.length>0;)a.Game.measureText(i+o[0]).width>r?(a.Game.fillText(i,t,n),i="",n+=8):(""!==i&&(i+=" "),i+=o[0],o.splice(0,1));return" "!==i&&(a.Game.fillText(i,t,n),n+=8),n},this.drawCoins=function(e){var t=r.LevelConstants.SCREEN_W-1,i=r.LevelConstants.SCREEN_H-1;a.Game.drawItem(19,0,1,2,t,i-1,1,2);var s=""+n.coins,l=4-a.Game.measureText(s).width;a.Game.fillTextOutline(s,t*o.GameConstants.TILESIZE+l,i*o.GameConstants.TILESIZE-1,o.GameConstants.OUTLINE,"white")},this.pointInside=function(e,t){var r=Math.min(18,18*(Date.now()-n.openTime)/100),a=(Math.round(.5*Math.sin(.01*Date.now())+.5),n.cols*(r+4+-2)- -2),i=n.rows*(r+4+-2)- -2;return e>=Math.round(.5*o.GameConstants.WIDTH-.5*a)-1&&e<=Math.round(.5*o.GameConstants.WIDTH-.5*a)-1+Math.round(a+2)&&t>=Math.round(.5*o.GameConstants.HEIGHT-.5*i)-1&&t<=Math.round(.5*o.GameConstants.HEIGHT-.5*i)-1+Math.round(i+2)},this.draw=function(e){if(n.drawCoins(e),n.isOpen){for(var t=0;t<n.equipAnimAmount.length;t++)n.items[t]instanceof i.Equippable?n.items[t].equipped?n.equipAnimAmount[t]+=.2*(1-n.equipAnimAmount[t]):n.equipAnimAmount[t]+=.2*(0-n.equipAnimAmount[t]):n.equipAnimAmount[t]=0;a.Game.ctx.fillStyle="rgb(0, 0, 0, 0.8)",a.Game.ctx.fillRect(0,0,o.GameConstants.WIDTH,o.GameConstants.HEIGHT),a.Game.ctx.globalAlpha=1;var r=Math.min(18,18*(Date.now()-n.openTime)/100),s=-2,l=3+Math.round(.5*Math.sin(.01*Date.now())+.5),c=n.cols*(r+4+s)-s,u=n.rows*(r+4+s)-s;a.Game.ctx.fillStyle="white",a.Game.ctx.fillRect(Math.round(.5*o.GameConstants.WIDTH-.5*c)-1,Math.round(.5*o.GameConstants.HEIGHT-.5*u)-1,Math.round(c+2),Math.round(u+2)),a.Game.ctx.fillRect(Math.round(.5*o.GameConstants.WIDTH-.5*c+n.selX*(r+4+s))-l-1,Math.round(.5*o.GameConstants.HEIGHT-.5*u+n.selY*(r+4+s))-l-1,Math.round(r+4+2*l)+2,Math.round(r+4+2*l)+2);for(var p=0;p<n.cols;p++)for(var m=0;m<n.rows;m++){a.Game.ctx.fillStyle=f,a.Game.ctx.fillRect(Math.round(.5*o.GameConstants.WIDTH-.5*c+p*(r+4+s)),Math.round(.5*o.GameConstants.HEIGHT-.5*u+m*(r+4+s)),Math.round(r+4),Math.round(r+4)),a.Game.ctx.fillStyle=d,a.Game.ctx.fillRect(Math.round(.5*o.GameConstants.WIDTH-.5*c+p*(r+4+s)+2),Math.round(.5*o.GameConstants.HEIGHT-.5*u+m*(r+4+s)+2),Math.round(r),Math.round(r));var v=p+m*n.cols;a.Game.ctx.fillStyle=y;var g=r*(1-n.equipAnimAmount[v]);a.Game.ctx.fillRect(Math.round(.5*o.GameConstants.WIDTH-.5*c+p*(r+4+s)+2),Math.round(.5*o.GameConstants.HEIGHT-.5*u+m*(r+4+s)+2+g),Math.round(r),Math.round(r-g))}if(Date.now()-n.openTime>=100){for(var w=0;w<n.items.length;w++){p=w%n.cols,m=Math.floor(w/n.cols);var _=Math.round(.5*o.GameConstants.WIDTH-.5*c+p*(r+4+s)+2+Math.floor(.5*r)-.5*o.GameConstants.TILESIZE),x=Math.round(.5*o.GameConstants.HEIGHT-.5*u+m*(r+4+s)+2+Math.floor(.5*r)-.5*o.GameConstants.TILESIZE),C=_/o.GameConstants.TILESIZE,E=x/o.GameConstants.TILESIZE;n.items[w].drawIcon(e,C,E)}a.Game.ctx.fillStyle=f,a.Game.ctx.fillRect(Math.round(.5*o.GameConstants.WIDTH-.5*c+n.selX*(r+4+s))-l,Math.round(.5*o.GameConstants.HEIGHT-.5*u+n.selY*(r+4+s))-l,Math.round(r+4+2*l),Math.round(r+4+2*l)),a.Game.ctx.fillStyle=d,a.Game.ctx.fillRect(Math.round(.5*o.GameConstants.WIDTH-.5*c+n.selX*(r+4+s)+2-l),Math.round(.5*o.GameConstants.HEIGHT-.5*u+n.selY*(r+4+s)+2-l),Math.round(r+2*l),Math.round(r+2*l));var T=n.selX+n.selY*n.cols;a.Game.ctx.fillStyle=y,g=(r+2*l)*(1-n.equipAnimAmount[T]),a.Game.ctx.fillRect(Math.round(.5*o.GameConstants.WIDTH-.5*c+n.selX*(r+4+s)+2-l),Math.round(.5*o.GameConstants.HEIGHT-.5*u+n.selY*(r+4+s)+2-l+g),Math.round(r+2*l),Math.round(r+2*l-g));var b=Math.round(.5*o.GameConstants.WIDTH-.5*c+n.selX*(r+4+s)+2+Math.floor(.5*r)-.5*o.GameConstants.TILESIZE),I=Math.round(.5*o.GameConstants.HEIGHT-.5*u+n.selY*(r+4+s)+2+Math.floor(.5*r)-.5*o.GameConstants.TILESIZE),P=b/o.GameConstants.TILESIZE,O=I/o.GameConstants.TILESIZE;T<n.items.length&&n.items[T].drawIcon(e,P,O)}var S=n.selX+n.selY*n.cols;if(S<n.items.length){a.Game.ctx.fillStyle="white";var k="";n.items[S]instanceof i.Equippable&&(k="[SPACE] to equip",n.items[S].equipped&&(k="[SPACE] to unequip")),n.items[S]instanceof h.Usable&&(k="[SPACE] to use"),a.Game.ctx.fillStyle="white";var A=a.Game.measureText(k).width;a.Game.fillText(k,.5*(o.GameConstants.WIDTH-A),5);for(var G=n.items[S].getDescription().split("\n"),D=Math.round(.5*o.GameConstants.HEIGHT-.5*u+n.rows*(r+4+s)+2+5),L=0;L<G.length;L++)D=n.textWrap(G[L],5,D,o.GameConstants.WIDTH-10)}}},this.game=e,this.player=t,this.items=new Array,this.equipAnimAmount=[];for(var m=0;m<this.rows*this.cols;m++)this.equipAnimAmount[m]=0;this.coins=0,this.openTime=Date.now(),this.weapon=null;var v=function(e){e instanceof i.Equippable&&e.setWielder(n.player),e instanceof c.Weapon&&(e.toggleEquip(),n.weapon=e),n.addItem(e)};v(new u.Dagger({game:this.game},0,0)),v(new p.Torch({game:this.game},0,0))}},8573:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Armor=void 0;var o=n(2967),i=n(5742),s=function(e){function t(n,r,a){var s=e.call(this,n,r,a)||this;return s.RECHARGE_TURNS=15,s.coEquippable=function(e){return!(e instanceof t)},s.getDescription=function(){return"ENCHANTED ARMOR\nA magic suit of armor. Absorbs one hit and regenerates after "+s.RECHARGE_TURNS+" turns."},s.tickInInventory=function(){s.rechargeTurnCounter>0&&(s.rechargeTurnCounter--,0===s.rechargeTurnCounter&&(s.rechargeTurnCounter=-1,s.health=1))},s.hurt=function(e){s.health<=0||(s.health-=e,s.rechargeTurnCounter=s.RECHARGE_TURNS+1)},s.drawGUI=function(e,t){-1===s.rechargeTurnCounter?o.Game.drawFX(5,2,1,1,t,i.LevelConstants.SCREEN_H-1,1,1):1-s.rechargeTurnCounter/s.RECHARGE_TURNS<.5?o.Game.drawFX(7,2,1,1,t,i.LevelConstants.SCREEN_H-1,1,1):o.Game.drawFX(8,2,1,1,t,i.LevelConstants.SCREEN_H-1,1,1)},s.health=1,s.rechargeTurnCounter=-1,s.tileX=5,s.tileY=0,s}return a(t,e),t}(n(8499).Equippable);t.Armor=s},8414:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.BlueGem=void 0;var o=function(e){function t(t,n,r){var a=e.call(this,t,n,r)||this;return a.getDescription=function(){return"ZIRCON"},a.tileX=13,a.tileY=0,a.stackable=!0,a}return a(t,e),t}(n(5234).Item);t.BlueGem=o},1173:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Candle=void 0;var o=n(8499),i=n(5895),s=n(282),l=function(e){function t(n,r,a){var o=e.call(this,n,r,a)||this;return o.coEquippable=function(e){return!(e instanceof t||e instanceof i.Torch||e instanceof s.Lantern)},o.toggleEquip=function(){o.equipped=!o.equipped,o.equipped?o.wielder.sightRadius=9:o.wielder.sightRadius=o.wielder.defaultSightRadius},o.getDescription=function(){return"CANDLE"},o.tileX=27,o.tileY=0,o}return a(t,e),t}(o.Equippable);t.Candle=l},9809:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Coal=void 0;var o=function(e){function t(t,n,r){var a=e.call(this,t,n,r)||this;return a.getDescription=function(){return"COAL\nA lump of coal."},a.tileX=17,a.tileY=0,a.stackable=!0,a}return a(t,e),t}(n(5234).Item);t.Coal=o},1978:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Coin=void 0;var o=n(5234),i=n(5958),s=function(e){function t(t,n,r){var a=e.call(this,t,n,r)||this;return a.pickupSound=function(){a.level===a.level.game.level&&i.Sound.pickupCoin()},a.tileX=19,a.tileY=0,a.stackable=!0,a}return a(t,e),t}(o.Item);t.Coin=s},8499:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Equippable=void 0;var o=n(5234),i=n(2967),s=function(e){function t(t,n,r){var a=e.call(this,t,n,r)||this;return a.setWielder=function(e){a.wielder=e},a.coEquippable=function(e){return!0},a.toggleEquip=function(){a.equipped=!a.equipped},a.drawEquipped=function(e,t,n){i.Game.drawItem(a.tileX,a.tileY,1,2,t,n-1,a.w,a.h)},a.equipped=!1,a}return a(t,e),t}(o.Item);t.Equippable=s},9825:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Gold=void 0;var o=function(e){function t(t,n,r){var a=e.call(this,t,n,r)||this;return a.getDescription=function(){return"GOLD\nA nugget of gold."},a.tileX=18,a.tileY=0,a.stackable=!0,a}return a(t,e),t}(n(5234).Item);t.Gold=o},1348:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.GoldenKey=void 0;var o=function(e){function t(t,n,r){var a=e.call(this,t,n,r)||this;return a.getDescription=function(){return"GOLD KEY\nA heavy gold key."},a.tileX=6,a.tileY=0,a}return a(t,e),t}(n(8499).Equippable);t.GoldenKey=o},7975:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.GreenGem=void 0;var o=function(e){function t(t,n,r){var a=e.call(this,t,n,r)||this;return a.getDescription=function(){return"PERIDOT"},a.tileX=11,a.tileY=0,a.stackable=!0,a}return a(t,e),t}(n(5234).Item);t.GreenGem=o},6309:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Heart=void 0;var o=n(5958),i=function(e){function t(t,n,r){var a=e.call(this,t,n,r)||this;return a.onUse=function(e){e.health=Math.min(e.maxHealth,e.health+1),a.level.game.levels[e.levelID]===a.level.game.level&&o.Sound.heal(),a.level.items=a.level.items.filter((function(e){return e!==a}))},a.getDescription=function(){return"HEALTH POTION\nRestores 1 heart"},a.tileX=8,a.tileY=0,a.offsetY=0,a}return a(t,e),t}(n(1802).Usable);t.Heart=i},5234:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Item=void 0;var o=n(2967),i=n(988),s=n(5958),l=function(e){function t(t,n,r){var a=e.call(this)||this;return a.tick=function(){},a.tickInInventory=function(){},a.getDescription=function(){return""},a.pickupSound=function(){a.level===a.level.game.level&&s.Sound.genericPickup()},a.onPickup=function(e){a.pickedUp||(a.pickedUp=e.inventory.addItem(a),a.pickedUp&&a.pickupSound())},a.shadeAmount=function(){return a.level.softVis[a.x][a.y]},a.draw=function(e){a.pickedUp||(a.drawableY=a.y,a.scaleFactor<1?a.scaleFactor+=.04:a.scaleFactor=1,o.Game.drawItem(0,0,1,1,a.x,a.y,1,1),a.frame+=e*(2*Math.PI)/60,o.Game.drawItem(a.tileX,a.tileY,1,2,a.x+a.w*(-.5*a.scaleFactor+.5),a.y+.07*Math.sin(a.frame)-1+a.offsetY+a.h*(-.5*a.scaleFactor+.5),a.w*a.scaleFactor,a.h*a.scaleFactor,a.level.shadeColor,a.shadeAmount()))},a.drawTopLayer=function(e){a.pickedUp&&(a.y-=.125,a.alpha-=.03,a.y<-1&&(a.level.items=a.level.items.filter((function(e){return e!==a}))),i.GameConstants.ALPHA_ENABLED&&(o.Game.ctx.globalAlpha=Math.max(0,a.alpha)),o.Game.drawItem(a.tileX,a.tileY,1,2,a.x,a.y-1,a.w,a.h),o.Game.ctx.globalAlpha=1)},a.drawIcon=function(e,t,n,r){void 0===r&&(r=1),i.GameConstants.ALPHA_ENABLED&&(o.Game.ctx.globalAlpha=r),o.Game.drawItem(a.tileX,a.tileY,1,2,t,n-1,a.w,a.h),o.Game.ctx.globalAlpha=1;var s=a.stackCount<=1?"":""+a.stackCount,l=16-o.Game.measureText(s).width;o.Game.fillTextOutline(s,t*i.GameConstants.TILESIZE+l,n*i.GameConstants.TILESIZE+10,i.GameConstants.OUTLINE,"white")},a.level=t,a.x=n,a.y=r,a.drawableY=r,a.w=1,a.h=2,a.tileX=0,a.tileY=0,a.frame=0,a.stackable=!1,a.stackCount=1,a.pickedUp=!1,a.alpha=1,a.scaleFactor=.2,a.offsetY=-.25,a}return a(t,e),t}(n(6779).Drawable);t.Item=l},1785:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Key=void 0;var o=function(e){function t(t,n,r){var a=e.call(this,t,n,r)||this;return a.getDescription=function(){return"KEY\nAn iron key."},a.tileX=1,a.tileY=0,a}return a(t,e),t}(n(8499).Equippable);t.Key=o},282:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Lantern=void 0;var o=n(8499),i=n(1173),s=n(5895),l=function(e){function t(n,r,a){var o=e.call(this,n,r,a)||this;return o.coEquippable=function(e){return!(e instanceof i.Candle||e instanceof s.Torch||e instanceof t)},o.toggleEquip=function(){o.equipped=!o.equipped,o.equipped?o.wielder.sightRadius=20:o.wielder.sightRadius=o.wielder.defaultSightRadius},o.getDescription=function(){return"LANTERN"},o.tileX=29,o.tileY=0,o}return a(t,e),t}(o.Equippable);t.Lantern=l},5043:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.RedGem=void 0;var o=function(e){function t(t,n,r){var a=e.call(this,t,n,r)||this;return a.getDescription=function(){return"GARNET"},a.tileX=12,a.tileY=0,a.stackable=!0,a}return a(t,e),t}(n(5234).Item);t.RedGem=o},5895:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Torch=void 0;var o=n(8499),i=n(1173),s=n(282),l=function(e){function t(n,r,a){var o=e.call(this,n,r,a)||this;return o.coEquippable=function(e){return!(e instanceof i.Candle||e instanceof t||e instanceof s.Lantern)},o.toggleEquip=function(){o.equipped=!o.equipped,o.equipped?o.wielder.sightRadius=12:o.wielder.sightRadius=o.wielder.defaultSightRadius},o.getDescription=function(){return"TORCH"},o.tileX=28,o.tileY=0,o}return a(t,e),t}(o.Equippable);t.Torch=l},1802:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Usable=void 0;var o=n(5234),i=n(5958),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onUse=function(e){e.health=Math.min(e.maxHealth,e.health+1),e.game.levels[e.levelID]===e.game.level&&i.Sound.heal()},t}return a(t,e),t}(o.Item);t.Usable=s},3161:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Level=t.TurnState=t.RoomType=void 0;var r,a,o=n(312),i=n(5742),s=n(9626),l=n(2967),c=n(9143),u=n(5654),h=n(1384),p=n(3441),d=n(1272),f=n(516),y=n(1348),m=n(953),v=n(5525),g=n(988),w=n(5397),_=n(8498),x=n(6750),C=n(6061),E=n(8573),T=n(3280),b=n(8341),I=n(5990),P=n(9670),O=n(7149),S=n(850),k=n(3205),A=n(6563),G=n(9382),D=n(8365),L=n(5377),M=n(9379),R=n(1902),F=n(1241),H=n(6945),N=n(7933),j=n(2725),X=n(1656),Y=n(6309),B=n(3806),W=n(6882),U=n(663),q=n(3073),Z=n(8232),V=n(2221),K=n(792),z=n(282),$=n(2920);!function(e){e[e.START=0]="START",e[e.DUNGEON=1]="DUNGEON",e[e.BOSS=2]="BOSS",e[e.BIGDUNGEON=3]="BIGDUNGEON",e[e.TREASURE=4]="TREASURE",e[e.FOUNTAIN=5]="FOUNTAIN",e[e.COFFIN=6]="COFFIN",e[e.GRASS=7]="GRASS",e[e.PUZZLE=8]="PUZZLE",e[e.KEYROOM=9]="KEYROOM",e[e.CHESSBOARD=10]="CHESSBOARD",e[e.MAZE=11]="MAZE",e[e.CORRIDOR=12]="CORRIDOR",e[e.SPIKECORRIDOR=13]="SPIKECORRIDOR",e[e.UPLADDER=14]="UPLADDER",e[e.DOWNLADDER=15]="DOWNLADDER",e[e.SHOP=16]="SHOP",e[e.BIGCAVE=17]="BIGCAVE",e[e.CAVE=18]="CAVE",e[e.SPAWNER=19]="SPAWNER",e[e.ROPEHOLE=20]="ROPEHOLE",e[e.ROPECAVE=21]="ROPECAVE"}(r=t.RoomType||(t.RoomType={})),function(e){e[e.playerTurn=0]="playerTurn",e[e.computerTurn=1]="computerTurn"}(a=t.TurnState||(t.TurnState={}));var J=function(){function e(e,t,n,p,f,v,w,_,x){var P=this;void 0===x&&(x=K.Random.rand),this.shadeColor="black",this.tileInside=function(e,t){return P.pointInside(e,t,P.roomX,P.roomY,P.width,P.height)},this.populateEmpty=function(e){P.addTorches(l.Game.randTable([0,0,0,1,1,2,2,3,4],e),e)},this.populateDungeon=function(e){var t=l.Game.rand(1,36,e);t<30&&P.addWallBlocks(e),t<26&&P.addFingers(e),t%4==0&&P.addChasms(e),P.addTorches(l.Game.randTable([0,0,0,1,1,2,2,3,4],e),e),t>15&&P.addSpikeTraps(l.Game.randTable([0,0,0,1,1,2,5],e),e);var n=P.getEmptyTiles().length,r=Math.floor(.35*n*e()),a=Math.ceil(r*e()),o=r-a;P.addPlants(a,e),P.addObstacles(o,e);var i=Math.ceil((n-r)*Math.min(.01*P.depth+.1,.35));P.addEnemies(i,e),t<=4&&P.addVendingMachine(e)},this.populateBoss=function(e){P.addTorches(l.Game.randTable([0,0,0,1,1,2,2,3,4],e),e),P.addSpikeTraps(l.Game.randTable([0,0,0,1,1,2,5],e),e);var t=P.getEmptyTiles().length,n=Math.floor(.2*t),r=Math.floor(n*e()),a=n-r;P.addPlants(r,e),P.addObstacles(a,e);var o=Math.ceil((t-n)*Math.min(.05*P.depth+.2,.5));P.addEnemies(o,e)},this.populateBigDungeon=function(e){1===l.Game.rand(1,4,e)&&P.addChasms(e),P.addTorches(l.Game.randTable([0,0,0,1,1,2,2,3,4],e),e),1===l.Game.rand(1,4,e)&&P.addPlants(l.Game.randTable([0,0,0,0,0,1,1,2,2,3,4],e),e),1===l.Game.rand(1,3,e)&&P.addSpikeTraps(l.Game.randTable([3,5,7,8],e),e);var t=P.getEmptyTiles().length,n=Math.ceil(t*(.5*P.depth+.5)*l.Game.randTable([.05,.05,.06,.07,.1],e));P.addEnemies(n,e),n>0?P.addObstacles(n/l.Game.rand(1,2,e),e):P.addObstacles(l.Game.randTable([0,0,1,1,2,3,5],e),e)},this.populateSpawner=function(e){P.addTorches(l.Game.randTable([0,0,0,1,1,2,2,3,4],e),e),P.enemies.push(new F.Spawner(P,P.game,Math.floor(P.roomX+P.width/2),Math.floor(P.roomY+P.height/2),e))},this.populateKeyRoom=function(e){P.addTorches(l.Game.randTable([0,0,0,1,1,2,2,3,4],e),e),P.items.push(new y.GoldenKey(P,Math.floor(P.roomX+P.width/2),Math.floor(P.roomY+P.height/2)))},this.populateFountain=function(e){P.addTorches(l.Game.randTable([0,0,0,1,1,2,2,3,4],e),e);for(var t=Math.floor(P.roomX+P.width/2),n=Math.floor(P.roomY+P.height/2),r=t-1;r<=t+1;r++)for(var a=n-1;a<=n+1;a++)P.levelArray[r][a]=new b.FountainTile(P,r,a,r-(t-1),a-(n-1));P.addPlants(l.Game.randTable([0,0,1,2],e),e)},this.placeCoffin=function(e,t){P.levelArray[e][t]=new I.CoffinTile(P,e,t,0),P.levelArray[e][t+1]=new I.CoffinTile(P,e,t+1,1)},this.populateCoffin=function(e){P.addTorches(l.Game.randTable([0,0,0,1,1,2,2,3,4],e),e),P.placeCoffin(Math.floor(P.roomX+P.width/2-2),Math.floor(P.roomY+P.height/2)),P.placeCoffin(Math.floor(P.roomX+P.width/2),Math.floor(P.roomY+P.height/2)),P.placeCoffin(Math.floor(P.roomX+P.width/2)+2,Math.floor(P.roomY+P.height/2))},this.populatePuzzle=function(e){for(var t,n=P.roomX;n<P.roomX+P.width;n++){var r=P.roomY+Math.floor(P.height/2);n===P.roomX+Math.floor(P.width/2)?(t=new O.InsideLevelDoor(P,P.game,n,r+1),P.levelArray[n][r+1]=t):P.levelArray[n][r]=new o.Wall(P,n,r)}var a=l.Game.rand(P.roomX,P.roomX+P.width-1,e),i=l.Game.rand(P.roomY+Math.floor(P.height/2)+3,P.roomY+P.height-2,e);P.levelArray[a][i]=new S.Button(P,a,i,t);for(var s=P.getEmptyTiles().filter((function(e){return e.x>=P.roomX+1&&e.x<=P.roomX+P.width-2&&e.y>=P.roomY+Math.floor(P.height/2)+3&&e.y<=P.roomY+P.height-2})),c=l.Game.randTable([1,2,2,3,4],e),u=0;u<c;u++){var h=s.splice(l.Game.rand(0,s.length-1,e),1)[0];P.enemies.push(new C.Crate(P,P.game,h.x,h.y))}P.addPlants(l.Game.randTable([0,0,0,0,0,1,1,2,2,3,4],e),e)},this.populateSpikeCorridor=function(e){for(var t=P.roomX;t<P.roomX+P.width;t++)for(var n=P.roomY+1;n<P.roomY+P.height-1;n++)P.levelArray[t][n]=new T.SpikeTrap(P,t,n,l.Game.rand(0,3,e));P.addTorches(l.Game.randTable([0,0,0,1,1,2,2,3,4],e),e)},this.populateTreasure=function(e){P.addTorches(l.Game.randTable([0,1,1,2,2,3,4],e),e),P.addChests(l.Game.randTable([4,4,5,5,5,6,8],e),e),P.addPlants(l.Game.randTable([0,1,2,4,5,6],e),e)},this.populateChessboard=function(e){},this.populateCave=function(e){var t=l.Game.rand(1,36,e);P.addWallBlocks(e),t>15&&P.addSpikeTraps(l.Game.randTable([0,0,0,1,1,2,5],e),e);var n=P.getEmptyTiles().length,r=Math.ceil(n*l.Game.randTable([.25,.3,.35],e));P.addEnemies(r,e),P.addResources((n-r)*l.Game.randTable([.5,.6,.7,.8],e),e)},this.populateUpLadder=function(e){P.addTorches(l.Game.randTable([0,0,0,1,1,2,2],e),e),Math.floor(P.roomX+P.width/2),Math.floor(P.roomY+P.height/2)},this.populateDownLadder=function(e){P.addTorches(l.Game.randTable([0,0,0,1,1,2,2],e),e);var t=Math.floor(P.roomX+P.width/2),n=Math.floor(P.roomY+P.height/2);P.levelArray[t][n]=new G.DownLadder(P,P.game,t,n)},this.populateRopeHole=function(e){P.addTorches(l.Game.randTable([0,0,0,1,1,2,2],e),e);var t=Math.floor(P.roomX+P.width/2),n=Math.floor(P.roomY+P.height/2),r=new G.DownLadder(P,P.game,t,n);r.isRope=!0,P.levelArray[t][n]=r},this.populateRopeCave=function(e){var t=Math.floor(P.roomX+P.width/2),n=Math.floor(P.roomY+P.height/2),r=new A.UpLadder(P,P.game,t,n);r.isRope=!0,P.levelArray[t][n]=r},this.populateShop=function(e){P.addTorches(2,e);var t=Math.floor(P.roomX+P.width/2),n=Math.floor(P.roomY+P.height/2);P.enemies.push(new H.VendingMachine(P,P.game,t-2,n-1,new X.Shotgun(P,0,0),e)),P.enemies.push(new H.VendingMachine(P,P.game,t+2,n-1,new Y.Heart(P,0,0),e)),P.enemies.push(new H.VendingMachine(P,P.game,t-2,n+2,new E.Armor(P,0,0),e)),P.enemies.push(new H.VendingMachine(P,P.game,t+2,n+2,new B.Spear(P,0,0),e))},this.populate=function(e){switch(P.name="",P.type){case r.START:P.populateEmpty(e),P.name="FLOOR "+-P.depth;break;case r.BOSS:P.populateBoss(e),P.name="BOSS";break;case r.DUNGEON:P.populateDungeon(e);break;case r.BIGDUNGEON:P.populateBigDungeon(e);break;case r.FOUNTAIN:P.populateFountain(e);break;case r.COFFIN:P.populateCoffin(e);break;case r.PUZZLE:P.populatePuzzle(e);break;case r.SPIKECORRIDOR:P.populateSpikeCorridor(e);break;case r.TREASURE:P.populateTreasure(e);break;case r.CHESSBOARD:P.populateChessboard(e);break;case r.KEYROOM:P.populateKeyRoom(e);break;case r.GRASS:P.populateDungeon(e);break;case r.BIGCAVE:P.populateCave(e);case r.CAVE:P.populateCave(e);break;case r.UPLADDER:P.populateUpLadder(e),P.name="FLOOR "+-P.depth;break;case r.DOWNLADDER:P.populateDownLadder(e),P.name="FLOOR "+-P.depth;break;case r.ROPEHOLE:P.populateRopeHole(e);break;case r.ROPECAVE:P.populateRopeCave(e);break;case r.SHOP:P.populateShop(e);break;case r.SPAWNER:P.populateSpawner(e)}P.message=P.name},this.addDoor=function(e,t){var n;return e===P.roomX?(n=new W.SideDoor(P,P.game,e,t),P.levelArray[e+1][t]=new m.SpawnFloor(P,e+1,t)):e===P.roomX+P.width-1?(n=new W.SideDoor(P,P.game,e,t),P.levelArray[e-1][t]=new m.SpawnFloor(P,e-1,t)):t===P.roomY?(n=new c.Door(P,P.game,e,t),P.levelArray[e][t+1]=new m.SpawnFloor(P,e,t+1)):t===P.roomY+P.height-1&&(n=new u.BottomDoor(P,P.game,e,t),P.levelArray[e][t-1]=new m.SpawnFloor(P,e,t-1)),P.doors.push(n),null==P.levelArray[n.x]&&(console.log("UNDEFINED at "+n.x+" levelArray.length was "+P.levelArray.length),console.log("location "+location),console.log(P.roomX,P.roomY),console.log(P.width,P.height)),P.levelArray[n.x][n.y]=n,n},this.exitLevel=function(){P.particles.splice(0,P.particles.length)},this.enterLevel=function(e){e.moveSnap(P.roomX+Math.floor(P.width/2),P.roomY+Math.floor(P.height/2)),P.updateLighting(),P.entered=!0,P.message=P.name},this.enterLevelThroughDoor=function(e,t,n){t instanceof c.Door?(t.opened=!0,e.moveNoSmooth(t.x,t.y+1)):t instanceof u.BottomDoor?e.moveNoSmooth(t.x,t.y-1):t instanceof W.SideDoor&&e.moveNoSmooth(t.x+n,t.y),P.updateLighting(),P.entered=!0,P.message=P.name},this.enterLevelThroughLadder=function(e,t){e.moveSnap(t.x,t.y+1),P.updateLighting(),P.entered=!0,P.message=P.name},this.getEmptyTiles=function(){for(var e=[],t=P.roomX+1;t<P.roomX+P.width-1;t++)for(var n=P.roomY+1;n<P.roomY+P.height-1;n++)P.levelArray[t][n].isSolid()||P.levelArray[t][n]instanceof T.SpikeTrap||P.levelArray[t][n]instanceof m.SpawnFloor||e.push(P.levelArray[t][n]);for(var r=function(t){e=e.filter((function(e){return!t.pointIn(e.x,e.y)}))},a=0,o=P.enemies;a<o.length;a++)r(o[a]);return e},this.getTile=function(e,t){return P.levelArray[e]?P.levelArray[e][t]:void 0},this.fadeLighting=function(){for(var e=P.roomX;e<P.roomX+P.width;e++)for(var t=P.roomY;t<P.roomY+P.height;t++)Math.abs(P.softVis[e][t]-P.vis[e][t])>=.02&&(P.softVis[e][t]<P.vis[e][t]?P.softVis[e][t]+=.02:P.softVis[e][t]>P.vis[e][t]&&(P.softVis[e][t]-=.02))},this.updateLighting=function(){for(var e=[],t=P.roomX;t<P.roomX+P.width;t++){e[t]=[];for(var n=P.roomY;n<P.roomY+P.height;n++)e[t][n]=P.vis[t][n],P.vis[t][n]=1}for(var r in P.game.players)if(P===P.game.levels[P.game.players[r].levelID])for(var a=0;a<360;a+=i.LevelConstants.LIGHTING_ANGLE_STEP)P.castShadowsAtAngle(a,P.game.players[r].x+.5,P.game.players[r].y+.5,P.game.players[r].sightRadius-P.depth);for(var o=0,s=P.lightSources;o<s.length;o++){var l=s[o];for(a=0;a<360;a+=i.LevelConstants.LIGHTING_ANGLE_STEP)P.castShadowsAtAngle(a,l.x,l.y,l.r)}i.LevelConstants.SMOOTH_LIGHTING&&(P.vis=P.blur3x3(P.vis,[[1,2,1],[2,8,2],[1,2,1]]))},this.castShadowsAtAngle=function(e,t,n,r){for(var a=Math.cos(e*Math.PI/180),o=Math.sin(e*Math.PI/180),i=!1,s=0;s<r;s++){if(Math.floor(t)<P.roomX||Math.floor(t)>=P.roomX+P.width||Math.floor(n)<P.roomY||Math.floor(n)>=P.roomY+P.height)return;if(P.levelArray[Math.floor(t)][Math.floor(n)].isOpaque())s>0&&(i=!0);else if(i)return;P.vis[Math.floor(t)][Math.floor(n)]=Math.min(P.vis[Math.floor(t)][Math.floor(n)],Math.min(s/r,1)),t+=a,n+=o}},this.blur3x3=function(e,t){for(var n=[],r=0;r<e.length;r++){n[r]=[];for(var a=0;a<e[0].length;a++)if(0!==e[r][a]){for(var o=0,i=0,s=-1;s<=1;s++)for(var l=-1;l<=1;l++)r+s>=0&&r+s<e.length&&a+l>=0&&a+l<e[0].length&&(o+=e[r+s][a+l]*t[s+1][l+1],i+=t[s+1][l+1]);n[r][a]=o/i}else n[r][a]=0}return n},this.catchUp=function(){P.turn===a.computerTurn&&P.computerTurn()},this.tick=function(e){P.enemies=P.enemies.filter((function(e){return!e.dead})),P.updateLighting();for(var t=0,n=P.hitwarnings;t<n.length;t++)n[t].tick();for(var r=0,o=P.projectiles;r<o.length;r++)o[r].tick();for(var i=P.roomX;i<P.roomX+P.width;i++)for(var s=P.roomY;s<P.roomY+P.height;s++)P.levelArray[i][s].tick();P.turn=a.computerTurn,P.playerTurnTime=Date.now(),P.playerTicked=e},this.update=function(){P.turn==a.computerTurn&&Date.now()-P.playerTurnTime>=i.LevelConstants.COMPUTER_TURN_DELAY&&P.computerTurn()},this.computerTurn=function(){for(var e=0,t=P.enemies;e<t.length;e++)(f=t[e]).tick();P.enemies=P.enemies.filter((function(e){return!e.dead}));for(var n=0,r=P.items;n<r.length;n++)(h=r[n]).tick();for(var o=0,i=P.hitwarnings;o<i.length;o++){var s=i[o];P.levelArray[s.x][s.y].isSolid()&&(s.dead=!0)}for(var l=0,c=P.projectiles;l<c.length;l++){var u=c[l];for(var h in P.levelArray[u.x][u.y].isSolid()&&(u.dead=!0),P.game.players)P.game.levels[P.game.players[h].levelID]===P&&u.x===P.game.players[h].x&&u.y===P.game.players[h].y&&u.hitPlayer(P.game.players[h]);for(var p=0,d=P.enemies;p<d.length;p++){var f=d[p];u.x===f.x&&u.y===f.y&&u.hitEnemy(f)}}for(var y=P.roomX;y<P.roomX+P.width;y++)for(var m=P.roomY;m<P.roomY+P.height;m++)P.levelArray[y][m].tickEnd();P.enemies=P.enemies.filter((function(e){return!e.dead})),P.playerTicked.finishTick(),P.turn=a.playerTurn},this.draw=function(e){k.HitWarning.updateFrame(e),P.fadeLighting()},this.drawEntities=function(e,t){for(var n=[],r=P.roomX;r<P.roomX+P.width;r++)for(var a=P.roomY;a<P.roomY+P.height;a++)P.softVis[r][a]<1&&P.levelArray[r][a].drawUnderPlayer(e),n.push(P.levelArray[r][a]);P.projectiles=P.projectiles.filter((function(e){return!e.dead})),P.hitwarnings=P.hitwarnings.filter((function(e){return!e.dead})),P.particles=P.particles.filter((function(e){return!e.dead}));var o=new Array;for(var i in o=o.concat(n,P.enemies,P.hitwarnings,P.projectiles,P.particles,P.items),P.game.players)P.game.levels[P.game.players[i].levelID]===P&&(t&&P.game.players[i]===P.game.players[P.game.localPlayerID]||o.push(P.game.players[i]));o.sort((function(e,t){return e instanceof s.Floor?-1:t instanceof s.Floor?1:Math.abs(e.drawableY-t.drawableY)<.1?e instanceof U.Player?1:t instanceof U.Player?-1:e instanceof d.Enemy?1:t instanceof d.Enemy?-1:0:e.drawableY-t.drawableY}));for(var l=0,c=o;l<c.length;l++)c[l].draw(e);for(r=P.roomX;r<P.roomX+P.width;r++)for(a=P.roomY;a<P.roomY+P.height;a++)P.softVis[r][a]<1&&P.levelArray[r][a].drawAbovePlayer(e);for(var u=0,h=P.items;u<h.length;u++)(i=h[u]).drawTopLayer(e)},this.drawShade=function(e){var t=0;for(var n in P.game.players)P.game.levels[P.game.players[n].levelID]===P&&P.game.players[n].sightRadius>t&&(t=P.game.players[n].sightRadius);var r=Math.max(0,Math.min(.8,2*P.depth/t));g.GameConstants.ALPHA_ENABLED&&(l.Game.ctx.globalAlpha=r,l.Game.ctx.fillStyle=P.shadeColor,l.Game.ctx.fillRect((P.roomX-i.LevelConstants.SCREEN_W)*g.GameConstants.TILESIZE,(P.roomY-i.LevelConstants.SCREEN_H)*g.GameConstants.TILESIZE,(P.width+2*i.LevelConstants.SCREEN_W)*g.GameConstants.TILESIZE,(P.height+2*i.LevelConstants.SCREEN_H)*g.GameConstants.TILESIZE),l.Game.ctx.globalAlpha=1,l.Game.ctx.globalCompositeOperation="source-over")},this.drawOverShade=function(e){for(var t=0,n=P.enemies;t<n.length;t++)n[t].drawTopLayer(e);for(var r=0,a=P.projectiles;r<a.length;r++)a[r].drawTopLayer(e);for(var o=0,i=P.hitwarnings;o<i.length;o++)i[o].drawTopLayer(e);for(var s=P.roomX;s<P.roomX+P.width;s++)for(var l=P.roomY;l<P.roomY+P.height;l++)P.levelArray[s][l].drawAboveShading(e)},this.drawTopLayer=function(e){var t=l.Game.ctx.font;l.Game.ctx.font=g.GameConstants.SCRIPT_FONT_SIZE+"px Script",l.Game.ctx.fillStyle=i.LevelConstants.LEVEL_TEXT_COLOR,l.Game.fillText(P.message,g.GameConstants.WIDTH/2-l.Game.measureText(P.name).width/2,5),l.Game.ctx.font=t},this.game=e,this.roomX=t,this.roomY=n,this.width=p,this.height=f,this.type=v,this.depth=w,this.mapGroup=_,this.entered=!1,this.turn=a.playerTurn,this.playerTurnTime=Date.now(),this.items=Array(),this.projectiles=Array(),this.hitwarnings=Array(),this.particles=Array(),this.doors=Array(),this.enemies=Array(),this.lightSources=Array(),this.levelArray=[];for(var D=this.roomX;D<this.roomX+this.width;D++)this.levelArray[D]=[];this.vis=[],this.softVis=[];for(var L=this.roomX;L<this.roomX+this.width;L++){this.vis[L]=[],this.softVis[L]=[];for(var M=this.roomY;M<this.roomY+this.height;M++)this.vis[L][M]=1,this.softVis[L][M]=1}this.skin=h.SkinType.DUNGEON,this.type!==r.ROPECAVE&&this.type!==r.CAVE||(this.skin=h.SkinType.CAVE),this.buildEmptyRoom()}return e.prototype.pointInside=function(e,t,n,r,a,o){return!(e<n||e>=n+a||t<r||t>=r+o)},e.prototype.buildEmptyRoom=function(){for(var e=this.roomX;e<this.roomX+this.width;e++)for(var t=this.roomY;t<this.roomY+this.height;t++)this.pointInside(e,t,this.roomX+1,this.roomY+1,this.width-2,this.height-2)?this.levelArray[e][t]=new s.Floor(this,e,t):this.levelArray[e][t]=new o.Wall(this,e,t)},e.prototype.addWallBlocks=function(e){var t=l.Game.randTable([0,0,1,1,2,2,2,2,3],e);this.width>8&&e()>.5&&(t*=4);for(var n=0;n<t;n++)for(var r=Math.min(l.Game.randTable([2,2,2,2,2,2,3,3,3,4,5],e),this.width-4),a=Math.min(r+l.Game.rand(-2,2,e),this.height-4),i=l.Game.rand(this.roomX+2,this.roomX+this.width-r-2,e),s=l.Game.rand(this.roomY+2,this.roomY+this.height-a-2,e),c=i;c<i+r;c++)for(var u=s;u<s+a;u++)this.levelArray[c][u]=new o.Wall(this,c,u)},e.prototype.addFingers=function(e){},e.prototype.addTorches=function(e,t){for(var n=[],r=this.roomX+1;r<this.roomX+this.width-2;r++)for(var a=this.roomY;a<this.roomY+this.height-1;a++)this.levelArray[r][a]instanceof o.Wall&&!(this.levelArray[r][a+1]instanceof o.Wall)&&n.push(this.levelArray[r][a]);for(var i=0;i<e;i++){var s,c,u;if(0==n.length)return;c=(s=n.splice(l.Game.rand(0,n.length-1,t),1)[0]).x,u=s.y,this.levelArray[c][u]=new N.WallTorch(this,c,u)}},e.prototype.addChasms=function(e){var t=l.Game.rand(2,4,e),n=l.Game.rand(2,4,e),r=this.roomX+2,a=this.roomX+this.width-t-2,o=this.roomY+2,i=this.roomY+this.height-n-2;if(!(a<r||i<o))for(var c=l.Game.rand(r,a,e),u=l.Game.rand(o,i,e),h=c-1;h<c+t+1;h++)for(var p=u-1;p<u+n+1;p++)this.levelArray[h][p]=h===c-1||h===c+t||p===u-1||p===u+n?new s.Floor(this,h,p):new R.Chasm(this,h,p,h===c,h===c+t-1,p===u,p===u+n-1)},e.prototype.addChests=function(e,t){for(var n=this.getEmptyTiles(),r=0;r<e;r++){var a,o,i;if(0==n.length)return;o=(a=n.splice(l.Game.rand(0,n.length-1,t),1)[0]).x,i=a.y,this.enemies.push(new f.Chest(this,this.game,o,i,t))}},e.prototype.addSpikeTraps=function(e,t){for(var n=this.getEmptyTiles(),r=0;r<e;r++){var a=n.splice(l.Game.rand(0,n.length-1,t),1)[0];if(0==n.length)return;var o=a.x,i=a.y;this.levelArray[o][i]=new T.SpikeTrap(this,o,i)}},e.prototype.addSpikes=function(e,t){for(var n=this.getEmptyTiles(),r=0;r<e;r++){var a=n.splice(l.Game.rand(0,n.length-1,t),1)[0];if(0==n.length)return;var o=a.x,i=a.y;this.levelArray[o][i]=new v.Spike(this,o,i)}},e.prototype.addEnemies=function(e,t){for(var n=this,r=this.getEmptyTiles(),a=function(a){var i=r.splice(l.Game.rand(0,r.length-1,t),1)[0];if(0==r.length)return{value:void 0};var c=i.x,u=i.y,h={0:[1,2],1:[1,2,3],2:[1,2,3,4,5],3:[1,2,3,4,5,6,7,8]},d=Math.min(o.depth,4);if(h[d]&&h[d].length>0){var f=function(t){for(var r=function(r){for(var a=function(t){for(var a=0,o=n.enemies;a<o.length;a++)if(o[a],!n.getEmptyTiles().some((function(e){return e.x===c+r&&e.y===u+t})))return e++,{value:!1}},o=0;o<t.h;o++){var i=a(o);if("object"==typeof i)return i}},a=0;a<t.w;a++){var o=r(a);if("object"==typeof o)return o.value}return n.enemies.push(t),!0};switch(l.Game.randTable(h[d],t)){case 1:f(new q.SlimeEnemy(o,o.game,c,u,t));break;case 2:f(new p.KnightEnemy(o,o.game,c,u,t));break;case 3:f(new Z.ZombieEnemy(o,o.game,c,u,t));break;case 4:f(new _.SkullEnemy(o,o.game,c,u,t));break;case 5:f(new w.WizardEnemy(o,o.game,c,u,t));break;case 6:f(new j.ChargeEnemy(o,o.game,c,u));break;case 7:f(new F.Spawner(o,o.game,c,u,t));break;case 8:if(f(new V.BigSkullEnemy(o,o.game,c,u,t)))for(var y=0;y<2;y++)for(var m=0;m<2;m++)o.levelArray[c+y][u+m]=new s.Floor(o,c+y,u+m)}}},o=this,i=0;i<e;i++){var c=a();if("object"==typeof c)return c.value}},e.prototype.addObstacles=function(e,t){for(var n=this.getEmptyTiles(),r=0;r<e;r++){var a=n.splice(l.Game.rand(0,n.length-1,t),1)[0];if(0==n.length)return;var o=a.x,i=a.y;switch(l.Game.randTable([1,1,2],t)){case 1:this.enemies.push(new C.Crate(this,this.game,o,i));break;case 2:this.enemies.push(new x.Barrel(this,this.game,o,i))}}},e.prototype.addPlants=function(e,t){for(var n=this.getEmptyTiles(),r=0;r<e;r++){var a=n.splice(l.Game.rand(0,n.length-1,t),1)[0];if(0==n.length)return;var o=a.x,i=a.y;this.enemies.push(new P.PottedPlant(this,this.game,o,i))}},e.prototype.addResources=function(e,t){for(var n=this.getEmptyTiles(),r=0;r<e;r++){var a=n.splice(l.Game.rand(0,n.length-1,t),1)[0];if(0==n.length)return;var o=a.x,i=a.y,s=t();s<=(10-Math.pow(this.depth,3))/10?this.enemies.push(new D.CoalResource(this,this.game,o,i)):s<=(10-Math.pow(this.depth-2,3))/10?this.enemies.push(new L.GoldResource(this,this.game,o,i)):this.enemies.push(new M.EmeraldResource(this,this.game,o,i))}},e.prototype.addVendingMachine=function(e){var t=this.getEmptyTiles().sort((function(){return.5-K.Random.rand()}))[0],n=t.x,r=t.y;switch(l.Game.randTable([1,1,1,1,2,3,4,5,6],e)){case 1:this.enemies.push(new H.VendingMachine(this,this.game,n,r,new Y.Heart(this,0,0),e));break;case 2:this.enemies.push(new H.VendingMachine(this,this.game,n,r,new z.Lantern(this,0,0),e));break;case 3:this.enemies.push(new H.VendingMachine(this,this.game,n,r,new E.Armor(this,0,0),e));break;case 4:this.enemies.push(new H.VendingMachine(this,this.game,n,r,new $.DualDagger(this,0,0),e));break;case 5:this.enemies.push(new H.VendingMachine(this,this.game,n,r,new B.Spear(this,0,0),e));break;case 6:this.enemies.push(new H.VendingMachine(this,this.game,n,r,new X.Shotgun(this,0,0),e))}},e}();t.Level=J},5742:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LevelConstants=void 0;var n=function(){function e(){}return e.SCREEN_W=1,e.SCREEN_H=1,e.COMPUTER_TURN_DELAY=250,e.TURN_TIME=1e3,e.LEVEL_TRANSITION_TIME=300,e.LEVEL_TRANSITION_TIME_LADDER=1e3,e.ROOM_COUNT=15,e.HEALTH_BAR_FADEIN=100,e.HEALTH_BAR_FADEOUT=100,e.HEALTH_BAR_TOTALTIME=2500,e.SHADED_TILE_CUTOFF=1,e.SMOOTH_LIGHTING=!1,e.MIN_VISIBILITY=2,e.LIGHTING_ANGLE_STEP=5,e.LEVEL_TEXT_COLOR="white",e}();t.LevelConstants=n},569:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LevelGenerator=void 0;var r=n(2967),a=n(3161),o=n(792),i=n(9382),s=function(e,t,n){this.x=e,this.y=t,this.other=n},l=function e(t,n,r,i){var s=this;this.split=function(){var t=function(){return.6*(o.Random.rand()-.5)+.5};if(s.w>s.h){var n=Math.floor(t()*s.w),r=s.w-n-1;return n<3||r<3?[s]:[new e(s.x,s.y,n,s.h),new e(s.x+n+1,s.y,r,s.h)]}var a=Math.floor(t()*s.h),i=s.h-a-1;return a<3||i<3?[s]:[new e(s.x,s.y,s.w,a),new e(s.x,s.y+a+1,s.w,i)]},this.point_in=function(e,t){return e>=s.x&&e<s.x+s.w&&t>=s.y&&t<s.y+s.h},this.point_next_to=function(e,t){return e>=s.x-1&&e<s.x+s.w+1&&t>=s.y&&t<s.y+s.h||e>=s.x&&e<s.x+s.w&&t>=s.y-1&&t<s.y+s.h+1},this.area=function(){return s.w*s.h},this.overlaps=function(e){return e.x<s.x+s.w+1&&e.x+e.w>s.x-1&&e.y<s.y+s.h+1&&e.y+e.h>s.y-1},this.get_branch_point=function(){for(var e=[],t=s.x;t<s.x+s.w;t++)e.push({x:t,y:s.y-1}),e.push({x:t,y:s.y+s.h});for(var n=s.y;n<s.y+s.h;n++)e.push({x:s.x-1,y:n}),e.push({x:s.x+s.w,y:n});return(e=e.filter((function(e){return!s.connections.some((function(t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)<=1}))}))).sort((function(){return.5-o.Random.rand()})),e[0]},this.x=t,this.y=n,this.w=r,this.h=i,this.type=a.RoomType.DUNGEON,this.connections=[],this.distance=1e3},c=function(e,t){for(var n=function(n){o.Random.rand()<t&&(e=(e=e.filter((function(e){return e!==n}))).concat(n.split()))},r=0,a=e;r<a.length;r++)n(a[r]);return e},u=function(e,t,n,r){for(var a=0;a<n;a++){t[a]=[];for(var o=0;o<r;o++){t[a][o]=!1;for(var i=0,s=e;i<s.length;i++){var l=s[i];l.point_in(a,o)&&(t[a][o]=l)}}}return t},h=function(e,t){for(var n=[new l(0,0,e,t)],i=[],h=0;h<3;h++)n=c(n,.75);for(h=0;h<3;h++)n=c(n,1);for(h=0;h<3;h++)n=c(n,.5);n=function(e,t,n){for(var r=function(r){0!==r.x&&0!==r.y&&r.x+r.w!==t&&r.y+r.h!==n||(e=e.filter((function(e){return e!=r})))},a=0,o=e;a<o.length;a++)r(o[a]);return e}(n,e,t),i=u(n,i,e,t),n.sort((function(e,t){return e.area()-t.area()}));var p=n[0];p.type=a.RoomType.START,n[n.length-1].type=a.RoomType.BOSS;for(var d=[p],f=[p],y=!1;f.length>0&&!y;){var m=f[0];f.splice(0,1);for(var v=0,g=Math.floor(2*o.Random.rand()+1),w=0;v<g&&w<100;){for(var _=m.get_branch_point(),x=0,C=n;x<C.length;x++)if((N=C[x])!==m&&-1===d.indexOf(N)&&N.point_next_to(_.x,_.y)){m.connections.push(new s(_.x,_.y,N)),N.connections.push(new s(_.x,_.y,m)),f.push(N),d.push(N),v++,N.type===a.RoomType.BOSS&&(y=!0);break}w++}}for(var E=function(e){0===e.connections.length&&(n=n.filter((function(t){return t!==e})))},T=0,b=n;T<b.length;T++)E(b[T]);if(i=u(n,i,e,t),0===n.length)return[];var I=Math.floor(4*o.Random.rand()+4),P=function(e){for(var t=Math.floor(o.Random.rand()*n.length),r=n[t],a=!1,i=0,l=n.filter((function(e){return!r.connections.some((function(t){return t.other===e}))}));!a&&i<100;){for(var c=r.get_branch_point(),u=0,h=l;u<h.length;u++){var p=h[u];if(p!==r&&p.point_next_to(c.x,c.y)){r.connections.push(new s(c.x,c.y,p)),p.connections.push(new s(c.x,c.y,r)),a=!0;break}}i++}};for(h=0;h<I;h++)P();if(!n.some((function(e){return e.type===a.RoomType.BOSS})))return[];for(var O=n.find((function(e){return e.type===a.RoomType.BOSS})),S=!1,k=function(e){var t=new l(r.Game.rand(O.x-1,O.x+O.w-2,o.Random.rand),O.y-4,3,3);if(t.type=a.RoomType.DOWNLADDER,!n.some((function(e){return e.overlaps(t)})))return S=!0,n.push(t),t.connections.push(new s(t.x+1,t.y+3,O)),O.connections.push(new s(t.x+1,t.y+3,t)),"break"},A=0;A<100&&"break"!==k();A++);if(!S)return[];f=[p];var G=[];for(p.distance=0;f.length>0;){m=f[0],f.splice(0,1),G.push(m);for(var D=0,L=m.connections;D<L.length;D++){var M=L[D].other;M.distance=Math.min(M.distance,m.distance+1),-1===G.indexOf(M)&&f.push(M)}}for(var R=!1,F=0,H=n;F<H.length;F++){var N;(N=H[F]).type===a.RoomType.DUNGEON&&(N.distance>4&&N.area()<=30&&o.Random.rand()<.1?N.type=a.RoomType.TREASURE:!R&&N.distance>3&&N.area()<=20&&o.Random.rand()<.5&&(N.type=a.RoomType.ROPEHOLE,R=!0))}return n},p=function(e,t,n){for(var r=[new l(0,0,e,t)],i=[],h=0;h<3;h++)r=c(r,.75);for(h=0;h<3;h++)r=c(r,1);for(h=0;h<3;h++)r=c(r,.5);i=u(r,i,e,t),r.sort((function(e,t){return e.area()-t.area()}));var p=r[0];for(p.type=a.RoomType.ROPECAVE,h=1;h<r.length;h++)r[h].type=a.RoomType.CAVE;for(var d=[p],f=[p];f.length>0&&d.length<n;){var y=f[0];f.splice(0,1);for(var m=0,v=Math.floor(2*o.Random.rand()+1),g=0;m<v&&g<100&&d.length<n;){for(var w=y.get_branch_point(),_=0,x=r;_<x.length;_++){var C=x[_];if(C!==y&&-1===d.indexOf(C)&&C.point_next_to(w.x,w.y)){y.connections.push(new s(w.x,w.y,C)),C.connections.push(new s(w.x,w.y,y)),f.push(C),d.push(C),m++;break}}g++}}for(var E=function(e){0===e.connections.length&&(r=r.filter((function(t){return t!==e})))},T=0,b=r;T<b.length;T++)E(b[T]);if(i=u(r,i,e,t),0===r.length)return[];var I=Math.floor(4*o.Random.rand()+4),P=function(e){for(var t=Math.floor(o.Random.rand()*r.length),n=r[t],a=!1,i=0,l=r.filter((function(e){return!n.connections.some((function(t){return t.other===e}))}));!a&&i<100;){for(var c=n.get_branch_point(),u=0,h=l;u<h.length;u++){var p=h[u];if(p!==n&&p.point_next_to(c.x,c.y)){n.connections.push(new s(c.x,c.y,p)),p.connections.push(new s(c.x,c.y,n)),a=!0;break}}i++}};for(h=0;h<I;h++)P();f=[p];var O=[];for(p.distance=0;f.length>0;){y=f[0],f.splice(0,1),O.push(y);for(var S=0,k=y.connections;S<k.length;S++){var A=k[S].other;A.distance=Math.min(A.distance,y.distance+1),-1===O.indexOf(A)&&f.push(A)}}return r};t.LevelGenerator=function(){var e=this;this.depthReached=0,this.currentFloorFirstLevelID=0,this.getLevels=function(t,n,r){for(var i=[],s=0;s<t.length;s++){var l=new a.Level(e.game,t[s].x-1,t[s].y-1,t[s].w+2,t[s].h+2,t[s].type,n,r,o.Random.rand);i.push(l)}var c=[];for(s=0;s<t.length;s++)for(var u=function(e){var t=i[s].addDoor(e.x,e.y),n=c.find((function(e){return e.x===t.x&&e.y===t.y}));n&&(n.link(t),t.link(n)),c.push(t)},h=0,p=t[s].connections;h<p.length;h++)u(p[h]);for(var d=0,f=i;d<f.length;d++)(l=f[d]).populate(o.Random.rand);return i},this.setSeed=function(t){e.seed=t},this.generate=function(t,n,r){void 0===r&&(r=!1),console.assert(r||0===e.depthReached||n===e.depthReached+1),e.depthReached=n,o.Random.setState(e.seed+n),e.game=t;var s,l=0;e.game.levels.length>0&&(l=e.game.levels[e.game.levels.length-1].mapGroup+1),s=r?function(e,t){for(var n,r=!1;!r;)r=!0,(n=p(20,20,5)).length<5&&(r=!1);return n}():function(e,t){for(var n,r=!1,o=0;!(r||(r=!0,(n=h(35,35)).length<6&&(r=!1),n.some((function(e){return e.type===a.RoomType.BOSS}))?n.find((function(e){return e.type===a.RoomType.BOSS})).distance<3&&(r=!1):r=!1,++o>100)););return n}();var c=e.getLevels(s,n,l),u=e.game.levels.length;r||(e.currentFloorFirstLevelID=u),e.game.levels=e.game.levels.concat(c);for(var d=u;d<u+c.length;d++){var f=!1;if(e.game.levels[d].type===a.RoomType.ROPEHOLE)for(var y=e.game.levels[d].roomX;y<e.game.levels[d].roomX+e.game.levels[d].width;y++)for(var m=e.game.levels[d].roomY;m<e.game.levels[d].roomY+e.game.levels[d].height;m++){var v=e.game.levels[d].levelArray[y][m];v instanceof i.DownLadder&&v.isRope&&(v.generate(),f=!0)}if(f)break}return r?c.find((function(e){return e.type===a.RoomType.ROPECAVE})):c.find((function(e){return e.type===a.RoomType.START}))},this.generateFirstNFloors=function(t,n){e.generate(t,0,!1);for(var r=0;r<n;r++)for(var o=!1,s=e.game.levels.length-1;s>=0;s--){if(e.game.levels[s].type===a.RoomType.DOWNLADDER)for(var l=e.game.levels[s].roomX;l<e.game.levels[s].roomX+e.game.levels[s].width;l++)for(var c=e.game.levels[s].roomY;c<e.game.levels[s].roomY+e.game.levels[s].height;c++){var u=e.game.levels[s].levelArray[l][c];u instanceof i.DownLadder&&(u.generate(),o=!0)}if(o)break}}}},5752:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LightSource=void 0;t.LightSource=function(e,t,n){this.x=e,this.y=t,this.r=n}},9232:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Map=void 0;var r=n(2967),a=n(988),o=n(3161);t.Map=function(e){var t=this;this.draw=function(e){a.GameConstants.ALPHA_ENABLED&&(r.Game.ctx.globalAlpha=.5),r.Game.ctx.fillStyle="white",r.Game.ctx.fillRect(0,0,a.GameConstants.WIDTH,a.GameConstants.HEIGHT),r.Game.ctx.translate(.5*a.GameConstants.WIDTH-t.game.level.roomX-Math.floor(.5*t.game.level.width),.5*a.GameConstants.HEIGHT-t.game.level.roomY-Math.floor(.5*t.game.level.height)),r.Game.ctx.globalAlpha=1;for(var n=0,i=t.game.levels;n<i.length;n++){var s=i[n];if(t.game.level.mapGroup===s.mapGroup&&s.entered){r.Game.ctx.fillStyle="black",s.type===o.RoomType.UPLADDER&&(r.Game.ctx.fillStyle="#101460"),s.type===o.RoomType.DOWNLADDER&&(r.Game.ctx.fillStyle="#601410"),r.Game.ctx.fillRect(s.roomX+1,s.roomY+1,s.width-2,s.height-2);for(var l=0,c=s.doors;l<c.length;l++){var u=c[l];r.Game.ctx.fillStyle="black",r.Game.ctx.fillRect(u.x,u.y,1,1)}}}for(var h in r.Game.ctx.fillStyle=a.GameConstants.RED,t.game.players)t.game.levels[t.game.players[h].levelID].mapGroup===t.game.level.mapGroup&&r.Game.ctx.fillRect(t.game.players[h].x,t.game.players[h].y,1,1);r.Game.ctx.setTransform(1,0,0,1,0,0)},this.game=e}},5440:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.DeathParticle=void 0;var o=n(2967),i=n(988),s=function(e){function t(t,n){var r=e.call(this)||this;return r.draw=function(e){var t=Math.max(0,3*(r.frame-3)/i.GameConstants.TILESIZE),n=Math.round(r.frame);2==n||4==n||6==n?o.Game.drawMob(2,0,1,2,r.x,r.y-t,1,2):o.Game.drawFX(Math.round(r.frame),4,1,2,r.x,r.y-t,1,2),r.frame+=.3*e,r.frame>10&&(r.dead=!0)},r.x=t,r.y=n-1.5,r.dead=!1,r.frame=0,r}return a(t,e),t}(n(1670).Particle);t.DeathParticle=s},2621:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.GenericParticle=void 0;var o=n(1670),i=n(2967),s=n(988),l=function(e){function t(t,n,r,a,o,l,c,u,h,p,d,f,y,m){var v=e.call(this)||this;return v.render=function(){var e=s.GameConstants.TILESIZE,t=v.s*v.alpha*.5,n=i.Game.ctx.fillStyle;i.Game.ctx.fillStyle=v.color,i.Game.ctx.beginPath(),i.Game.ctx.arc(Math.round(v.x*e),Math.round((v.y-v.z)*e),Math.round(t*e),0,2*Math.PI,!1),i.Game.ctx.fill(),i.Game.ctx.fillStyle=n},v.draw=function(e){v.targetX?v.x+=.1*(v.targetX-v.x):v.x+=v.dx,v.targetY?v.y+=.1*(v.targetY-v.y):v.y+=v.dy,v.targetZ?v.z+=.1*(v.targetZ-v.z):v.z+=v.dz,v.dx*=.97,v.dy*=.97,v.z<=0&&(v.z=0,v.dz*=-.8),v.dz-=.01,v.alpha<.2?v.alpha-=.007:v.alpha-=.02,v.alpha<=.1&&(v.dead=!0),v.expirationTimer--,v.expirationTimer<=0&&(v.dead=!0),v.dead||(v.drawableY=v.y,v.render())},v.level=t,v.x=n,v.y=r,v.z=a,v.s=o,v.dx=l,v.dy=c,v.dz=u,v.color=h,v.alpha=1,void 0!==p&&(v.delay=p),v.targetX=f,v.targetY=y,v.targetZ=m,v.expirationTimer=1e6,void 0!==d&&(v.expirationTimer=d),v}return a(t,e),t.shotgun=function(e,n,r,a,o,i){for(var s=0;s<4;s++)e.particles.push(new t(e,n,r,0,.5*Math.random()+.3,0,0,0,i,0,1e7,a+Math.random()-.5,o+Math.random()-.5,0))},t.spawnCluster=function(e,n,r,a){for(var o=0;o<4;o++)e.particles.push(new t(e,n+.05*Math.random()-.025,r+.05*Math.random()-.025,.5*Math.random(),.0625*(o+8),.025*(2*Math.random()-1),.025*(2*Math.random()-1),.2*(Math.random()-1),a,0))},t}(o.Particle);t.GenericParticle=l},1670:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Particle=void 0;var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t}(n(6779).Drawable);t.Particle=o},5554:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.SlashParticle=void 0;var o=n(2967),i=function(e){function t(t,n){var r=e.call(this)||this;return r.draw=function(e){o.Game.drawFX(Math.round(r.frame),13,1,1,r.x,r.y,1,1),r.frame+=.5*e,r.frame>9&&(r.dead=!0)},r.x=t,r.y=n-.25,r.dead=!1,r.frame=0,r}return a(t,e),t}(n(1670).Particle);t.SlashParticle=i},4568:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.WizardTeleportParticle=void 0;var o=n(1670),i=n(2967),s=function(e){function t(t,n){var r=e.call(this)||this;return r.draw=function(e){i.Game.drawFX(Math.floor(r.frame),3,1,1,r.x,r.y-r.z,1,1),r.z+=r.dz,r.dz*=.9,r.frame+=.25*e,r.frame>6&&(r.dead=!0)},r.x=t,r.y=n,r.dead=!1,r.frame=0,r.z=0,r.dz=.1,r}return a(t,e),t}(o.Particle);t.WizardTeleportParticle=s},663:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Player=t.PlayerDirection=void 0;var o,i=n(8835),s=n(988),l=n(2967),c=n(9143),u=n(5654),h=n(9039),p=n(7531),d=n(8791),f=n(5958),y=n(5742),m=n(9232),v=n(5554),g=n(3338),w=n(6882),_=n(6779);!function(e){e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e[e.RIGHT=2]="RIGHT",e[e.LEFT=3]="LEFT"}(o=t.PlayerDirection||(t.PlayerDirection={}));var x=function(e){function t(t,n,r,a){var _=e.call(this)||this;return _.inputHandler=function(e){switch(e){case i.InputEnum.LEFT:case i.InputEnum.RIGHT:case i.InputEnum.UP:case i.InputEnum.DOWN:_.ignoreDirectionInput()||_.game.sendInput(e);break;case i.InputEnum.I:case i.InputEnum.Q:case i.InputEnum.SPACE:_.game.sendInput(e)}},_.tapListener=function(){_.inventory.open()},_.iListener=function(){_.inventory.open()},_.qListener=function(){_.inventory.isOpen&&_.inventory.drop()},_.ignoreDirectionInput=function(){return!_.inventory.isOpen&&(_.dead||_.game.levelState!==l.LevelState.IN_LEVEL)},_.leftListener=function(e){return _.inventory.isOpen?(_.inventory.left(),!0):!(_.dead||e&&_.game.levelState!==l.LevelState.IN_LEVEL||(_.left(),0))},_.rightListener=function(e){return _.inventory.isOpen?(_.inventory.right(),!0):!(_.dead||e&&_.game.levelState!==l.LevelState.IN_LEVEL||(_.right(),0))},_.upListener=function(e){return _.inventory.isOpen?(_.inventory.up(),!0):!(_.dead||e&&_.game.levelState!==l.LevelState.IN_LEVEL||(_.up(),0))},_.downListener=function(e){return _.inventory.isOpen?(_.inventory.down(),!0):!(_.dead||e&&_.game.levelState!==l.LevelState.IN_LEVEL||(_.down(),0))},_.spaceListener=function(){_.inventory.isOpen?_.inventory.space():_.openVendingMachine&&_.openVendingMachine.space()},_.left=function(){_.tryMove(_.x-1,_.y),_.direction=o.LEFT},_.right=function(){_.tryMove(_.x+1,_.y),_.direction=o.RIGHT},_.up=function(){_.tryMove(_.x,_.y-1),_.direction=o.UP},_.down=function(){_.tryMove(_.x,_.y+1),_.direction=o.DOWN},_.hit=function(){return 1},_.tryCollide=function(e,t,n){return!(t>=e.x+e.w||t+_.w<=e.x||n>=e.y+e.h||n+_.h<=e.y)},_.tryMove=function(e,t){if(_.game.levels[_.levelID].catchUp(),!_.dead&&(!_.inventory.hasWeapon()||_.inventory.getWeapon().weaponMove(e,t))){for(var n=0,r=_.game.levels[_.levelID].enemies;n<r.length;n++){var a=r[n];if(_.tryCollide(a,e,t))if(a.pushable){for(var o=e-_.x,i=t-_.y,s=e+o,l=t+i,p=!1,y=!1,m=[];;){p=!0;for(var g=0,x=_.game.levels[_.levelID].enemies;g<x.length;g++)if((T=x[g]).pointIn(s,l)){if(!T.chainPushable){y=!0,p=!0;break}p=!1,m.push(T);break}if(p)break;s+=o*m[m.length-1].w,l+=i*m[m.length-1].h}if(0!==m.length||!_.game.levels[_.levelID].levelArray[s][l].canCrushEnemy()&&!y){_.game.levels[_.levelID]===_.game.level&&f.Sound.push();for(var C=0,E=m;C<E.length;C++){var T;(T=E[C]).x+=o,T.y+=i,T.drawX=o,T.drawY=i,T.skipNextTurns=1}return(_.game.levels[_.levelID].levelArray[s][l].canCrushEnemy()||y)&&(m[m.length-1].killNoBones(),_.game.levels[_.levelID]===_.game.level&&f.Sound.hit()),a.x+=o,a.y+=i,a.drawX=o,a.drawY=i,_.move(e,t),void _.game.levels[_.levelID].tick(_)}if(a.destroyable)return a.kill(),_.game.levels[_.levelID]===_.game.level&&f.Sound.hit(),_.drawX=.5*(_.x-a.x),_.drawY=.5*(_.y-a.y),_.game.levels[_.levelID].particles.push(new v.SlashParticle(a.x,a.y)),_.game.levels[_.levelID].tick(_),void _.game.shakeScreen(10*_.drawX,10*_.drawY)}else if(!a.dead)return void(a.interactable&&a.interact(_))}var b=_.game.levels[_.levelID].levelArray[e][t];b.isSolid()?b instanceof d.LockedDoor&&(_.drawX=.5*(_.x-e),_.drawY=.5*(_.y-t),b.unlock(_)):(_.move(e,t),b.onCollide(_),b instanceof c.Door||b instanceof u.BottomDoor||b instanceof h.Trapdoor||b instanceof w.SideDoor||_.game.levels[_.levelID].tick(_))}},_.hurt=function(e){_.game.levels[_.levelID]===_.game.level&&f.Sound.hurt(),_.inventory.getArmor()&&_.inventory.getArmor().health>0?_.inventory.getArmor().hurt(e):(_.healthBar.hurt(),_.flashing=!0,_.health-=e,_.health<=0&&(_.health=0,_.dead=!0))},_.dashMove=function(e,t){_.x=e,_.y=t;for(var n=0,r=_.game.levels[_.levelID].items;n<r.length;n++){var a=r[n];a.x===e&&a.y===t&&a.onPickup(_)}_.game.levels[_.levelID].updateLighting()},_.doneMoving=function(){return Math.abs(_.drawX)<.01&&Math.abs(_.drawY)<.01},_.move=function(e,t){_.game.levels[_.levelID]===_.game.level&&f.Sound.playerStoneFootstep(),_.openVendingMachine&&_.openVendingMachine.close(),_.drawX=e-_.x,_.drawY=t-_.y,_.x=e,_.y=t;for(var n=0,r=_.game.levels[_.levelID].items;n<r.length;n++){var a=r[n];a.x===e&&a.y===t&&a.onPickup(_)}_.game.levels[_.levelID].updateLighting()},_.moveNoSmooth=function(e,t){_.x=e,_.y=t},_.moveSnap=function(e,t){_.x=e,_.y=t,_.drawX=0,_.drawY=0},_.update=function(){},_.finishTick=function(){_.inventory.tick(),_.flashing=!1;var e=_.health-_.lastTickHealth;_.lastTickHealth=_.health,e<0&&(_.flashing=!0)},_.drawPlayerSprite=function(e){_.frame+=.1*e,_.frame>=4&&(_.frame=0),l.Game.drawMob(1+Math.floor(_.frame),8+2*_.direction,1,2,_.x-_.drawX,_.y-1.5-_.drawY,1,2),_.inventory.getArmor()&&_.inventory.getArmor().health},_.draw=function(e){_.drawableY=_.y,_.flashingFrame+=12*e/s.GameConstants.FPS,_.dead||(l.Game.drawMob(0,0,1,1,_.x-_.drawX,_.y-_.drawY,1,1),_.flashing&&Math.floor(_.flashingFrame)%2!=0||_.drawPlayerSprite(e))},_.heartbeat=function(){_.guiHeartFrame=1},_.drawTopLayer=function(e){_.healthBar.draw(e,_.health,_.maxHealth,_.x-_.drawX,_.y-_.drawY,!_.flashing||Math.floor(_.flashingFrame)%2==0)},_.drawGUI=function(e){if(_.dead){l.Game.ctx.fillStyle=y.LevelConstants.LEVEL_TEXT_COLOR;var t="Game Over";l.Game.fillText(t,s.GameConstants.WIDTH/2-l.Game.measureText(t).width/2,s.GameConstants.HEIGHT/2-l.Game.letter_height+2)}else{_.inventory.draw(e),_.guiHeartFrame>0&&(_.guiHeartFrame+=e),_.guiHeartFrame>5&&(_.guiHeartFrame=0);for(var n=0;n<_.maxHealth;n++){var r=_.guiHeartFrame>0?1:0;n>=Math.floor(_.health)?n==Math.floor(_.health)&&2*_.health%2==1?l.Game.drawFX(4,2,1,1,n,y.LevelConstants.SCREEN_H-1,1,1):l.Game.drawFX(3,2,1,1,n,y.LevelConstants.SCREEN_H-1,1,1):l.Game.drawFX(r,2,1,1,n,y.LevelConstants.SCREEN_H-1,1,1)}_.inventory.getArmor()&&_.inventory.getArmor().drawGUI(e,_.maxHealth)}!i.Input.isDown(i.Input.M)&&!i.Input.isTapHold||_.game.chatOpen||_.map.draw(e)},_.updateDrawXY=function(e){_.drawX+=-.5*_.drawX,_.drawY+=-.5*_.drawY},_.game=t,_.levelID=0,_.x=n,_.y=r,_.w=1,_.h=1,_.drawX=0,_.drawY=0,_.frame=0,_.direction=o.UP,_.isLocalPlayer=a,a&&(i.Input.leftSwipeListener=function(){return _.inputHandler(i.InputEnum.LEFT)},i.Input.rightSwipeListener=function(){return _.inputHandler(i.InputEnum.RIGHT)},i.Input.upSwipeListener=function(){return _.inputHandler(i.InputEnum.UP)},i.Input.downSwipeListener=function(){return _.inputHandler(i.InputEnum.DOWN)},i.Input.tapListener=function(){_.inventory.isOpen&&_.inventory.pointInside(i.Input.mouseX,i.Input.mouseY)?_.inputHandler(i.InputEnum.SPACE):_.inputHandler(i.InputEnum.I)}),_.health=2,_.maxHealth=2,_.healthBar=new g.HealthBar,_.dead=!1,_.flashing=!1,_.flashingFrame=0,_.lastTickHealth=_.health,_.guiHeartFrame=0,_.inventory=new p.Inventory(t,_),_.missProb=.1,_.defaultSightRadius=6,_.sightRadius=_.defaultSightRadius,_.map=new m.Map(_.game),_}return a(t,e),t}(_.Drawable);t.Player=x},209:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.EnemySpawnAnimation=void 0;var o=n(5285),i=n(2967),s=n(2621),l=n(5958),c=n(3205),u=function(e){function t(t,n,r,a){var o=e.call(this,r,a)||this;return o.ANIM_COUNT=3,o.tick=function(){o.level===o.level.game.level&&l.Sound.enemySpawn();var e=!1;for(var t in o.level.game.players)o.level.game.players[t].x===o.x&&o.level.game.players[t].y===o.y&&(o.level.game.players[t].hurt(.5),e=!0);e?o.level.hitwarnings.push(new c.HitWarning(o.level.game,o.x,o.y)):(o.dead=!0,o.enemy.skipNextTurns=1,o.level.enemies.push(o.enemy),s.GenericParticle.spawnCluster(o.level,o.x+.5,o.y+.5,"#ffffff"),s.GenericParticle.spawnCluster(o.level,o.x+.5,o.y+.5,"#ffffff"))},o.drawTopLayer=function(e){o.frame+=.25*e,o.frame>=8&&(o.frame=0);for(var t=0;t<o.ANIM_COUNT;t++)i.Game.drawFX(Math.floor(o.frame),26,1,2,o.x+Math.round(0)/16,o.y-1.5,1,2);Math.floor(4*o.frame)%2==0&&o.level.particles.push(new s.GenericParticle(o.level,o.x+.5+.05*Math.random()-.025,o.y+.05*Math.random()-.025,.25,.5*Math.random(),.025*(1*Math.random()-.5),.025*(1*Math.random()-.5),.2*(Math.random()-1),"#ffffff",0))},o.level=t,o.enemy=n,o.frame=0,o}return a(t,e),t}(o.Projectile);t.EnemySpawnAnimation=u},5285:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Projectile=void 0;var o=function(e){function t(t,n){var r=e.call(this)||this;return r.hitPlayer=function(e){},r.hitEnemy=function(e){},r.tick=function(){},r.draw=function(e){},r.drawTopLayer=function(e){},r.x=t,r.y=n,r.dead=!1,r.drawableY=n,r}return a(t,e),t}(n(6779).Drawable);t.Projectile=o},5363:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.WizardFireball=void 0;var o=n(5285),i=n(2967),s=n(3205),l=function(e){function t(t,n,r){var a=e.call(this,n,r)||this;return a.tick=function(){a.parent.dead&&(a.dead=!0),a.state++,1===a.state&&a.parent.level.hitwarnings.push(new s.HitWarning(a.parent.game,a.x,a.y)),2===a.state&&(a.frame=0,a.delay=i.Game.rand(0,10,Math.random))},a.hitPlayer=function(e){2!==a.state||a.dead||e.hurt(1)},a.draw=function(e){if(0===a.state)a.frame+=.25*e,a.frame>=4&&(a.frame=0),i.Game.drawFX(22+Math.floor(a.frame),7,1,1,a.x,a.y,1,1);else if(1===a.state)a.frame+=.25*e,a.frame>=4&&(a.frame=0),i.Game.drawFX(18+Math.floor(a.frame),7,1,1,a.x,a.y,1,1);else{if(a.delay>0)return void a.delay--;a.frame+=.3*e,a.frame>17&&(a.dead=!0),i.Game.drawFX(Math.floor(a.frame),6,1,2,a.x,a.y-1,1,2)}},a.parent=t,a.state=0,a.frame=0,a}return a(t,e),t}(o.Projectile);t.WizardFireball=l},792:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Random=void 0;var n=function(){function e(){}return e.setState=function(t){e.state=t},e.rand=function(){return e.state^=e.state<<21,e.state^=e.state>>>35,e.state^=e.state<<4,(e.state>>>0)/4294967296},e}();t.Random=n},9784:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ServerAddress=void 0,t.ServerAddress={address:"witch-roguelike-server.herokuapp.com"}},5958:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Sound=void 0;var r=n(2967),a=function(){function e(){}return e.loadSounds=function(){e.playerStoneFootsteps=new Array,[1,2,3].forEach((function(t){return e.playerStoneFootsteps.push(new Audio("res/SFX/footsteps/stone/footstep"+t+".wav"))}));for(var t=0,n=e.playerStoneFootsteps;t<n.length;t++)n[t].volume=1;e.enemyFootsteps=new Array,[1,2,3,4,5].forEach((function(t){return e.enemyFootsteps.push(new Audio("res/SFX/footsteps/enemy/enemyfootstep"+t+".wav"))}));for(var r=0,a=e.enemyFootsteps;r<a.length;r++)a[r].volume=1;e.hitSounds=new Array,[1,2,3,4].forEach((function(t){return e.hitSounds.push(new Audio("res/SFX/attacks/swing"+t+".wav"))}));for(var o=0,i=e.hitSounds;o<i.length;o++)i[o].volume=1;e.enemySpawnSound=new Audio("res/SFX/attacks/enemyspawn.wav"),e.enemySpawnSound.volume=1,e.chestSounds=new Array,[1,2,3].forEach((function(t){return e.chestSounds.push(new Audio("res/SFX/chest/chest"+t+".wav"))}));for(var s=0,l=e.chestSounds;s<l.length;s++)l[s].volume=1;e.coinPickupSounds=new Array,[1,2,3,4].forEach((function(t){return e.coinPickupSounds.push(new Audio("res/SFX/items/coins"+t+".wav"))}));for(var c=0,u=e.coinPickupSounds;c<u.length;c++)u[c].volume=1;e.miningSounds=new Array,[1,2,3,4].forEach((function(t){return e.miningSounds.push(new Audio("res/SFX/resources/Pickaxe"+t+".wav"))}));for(var h=0,p=e.miningSounds;h<p.length;h++)p[h].volume=1;e.hurtSounds=new Array,[1].forEach((function(t){return e.hurtSounds.push(new Audio("res/SFX/attacks/hit.wav"))}));for(var d=0,f=e.hurtSounds;d<f.length;d++)f[d].volume=1;e.genericPickupSound=new Audio("res/SFX/items/pickup.wav"),e.genericPickupSound.volume=1,e.breakRockSound=new Audio("res/SFX/resources/rockbreak.wav"),e.breakRockSound.volume=1,e.pushSounds=new Array,[1,2].forEach((function(t){return e.pushSounds.push(new Audio("res/SFX/pushing/push"+t+".wav"))}));for(var y=0,m=e.pushSounds;y<m.length;y++)m[y].volume=1;e.healSound=new Audio("res/SFX/items/powerup1.wav"),e.healSound.volume=.5,e.music=new Audio("res/bewitched.mp3")},e.playerStoneFootstep=function(){var t=r.Game.randTable(e.playerStoneFootsteps,Math.random);t.play(),t.currentTime=0},e.enemyFootstep=function(){var t=r.Game.randTable(e.enemyFootsteps,Math.random);t.play(),t.currentTime=0},e.hit=function(){var t=r.Game.randTable(e.hitSounds,Math.random);t.play(),t.currentTime=0,(t=r.Game.randTable(e.hurtSounds,Math.random)).volume=.5,t.play(),t.currentTime=0,t.volume=1},e.hurt=function(){var t=r.Game.randTable(e.hurtSounds,Math.random);t.play(),t.currentTime=0},e.enemySpawn=function(){e.enemySpawnSound.play(),e.enemySpawnSound.currentTime=0},e.chest=function(){var t=r.Game.randTable(e.chestSounds,Math.random);t.play(),t.currentTime=0},e.pickupCoin=function(){var t=r.Game.randTable(e.coinPickupSounds,Math.random);t.play(),t.currentTime=0},e.mine=function(){var t=r.Game.randTable(e.miningSounds,Math.random);t.play(),t.currentTime=0},e.breakRock=function(){e.breakRockSound.play(),e.breakRockSound.currentTime=0},e.heal=function(){e.healSound.play(),e.healSound.currentTime=0},e.genericPickup=function(){e.genericPickupSound.play(),e.genericPickupSound.currentTime=0},e.push=function(){var t=r.Game.randTable(e.pushSounds,Math.random);t.play(),t.currentTime=0},e.playMusic=function(){e.music.addEventListener("ended",(function(){e.music.currentTime=0,e.music.play()}),!1)},e}();t.Sound=a},9713:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextBox=void 0;t.TextBox=function(){var e=this;this.allowedCharacters="all",this.setEnterCallback=function(t){e.enterCallback=t},this.setEscapeCallback=function(t){e.escapeCallback=t},this.clear=function(){e.text="",e.cursor=0},this.handleKeyPress=function(t){if(1===t.length)t=t.toLowerCase(),("all"===e.allowedCharacters||e.allowedCharacters.includes(t))&&(e.text=e.text.substring(0,e.cursor)+t+e.text.substring(e.cursor,e.text.length),e.cursor+=1);else switch(t){case"Backspace":e.text=e.text.substring(0,e.cursor-1)+e.text.substring(e.cursor,e.text.length),e.cursor=Math.max(0,e.cursor-1);break;case"Delete":e.text=e.text.substring(0,e.cursor)+e.text.substring(e.cursor+1,e.text.length);break;case"ArrowLeft":e.cursor=Math.max(0,e.cursor-1);break;case"ArrowRight":e.cursor=Math.min(e.text.length,e.cursor+1);break;case"Enter":e.enterCallback();break;case"Escape":e.escapeCallback()}},this.text="",this.cursor=0,this.enterCallback=function(){},this.escapeCallback=function(){}}},5269:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Bones=void 0;var o=n(2967),i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.draw=function(e){o.Game.drawTile(7,t.skin,1,1,t.x,t.y,1,1,t.level.shadeColor,t.shadeAmount())},t}return a(t,e),t}(n(9626).Floor);t.Bones=i},5654:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.BottomDoor=void 0;var o=n(2967),i=function(e){function t(t,n,r,a){var i=e.call(this,t,r,a)||this;return i.link=function(e){i.linkedDoor=e},i.canCrushEnemy=function(){return!0},i.onCollide=function(e){i.game.changeLevelThroughDoor(e,i.linkedDoor)},i.drawAbovePlayer=function(e){},i.drawAboveShading=function(e){o.Game.drawFX(2,2,1,1,i.x,i.y-1.25+.125*Math.sin(.006*Date.now()),1,1)},i.game=n,i}return a(t,e),t}(n(1384).Tile);t.BottomDoor=i},850:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Button=void 0;var o=n(2967),i=function(e){function t(t,n,r,a){var i=e.call(this,t,n,r)||this;return i.press=function(){i.pressed=!0,i.linkedDoor.opened=!0},i.unpress=function(){i.pressed=!1,i.linkedDoor.opened=!1},i.tickEnd=function(){for(var e in i.unpress(),i.level.game.players)i.level.game.players[e].x===i.x&&i.level.game.players[e].y===i.y&&i.press();for(var t=0,n=i.level.enemies;t<n.length;t++){var r=n[t];r.x===i.x&&r.y===i.y&&i.press()}},i.draw=function(e){o.Game.drawTile(1,0,1,1,i.x,i.y,1,1,i.level.shadeColor,i.shadeAmount()),i.pressed?o.Game.drawTile(18,0,1,1,i.x,i.y,i.w,i.h,i.level.shadeColor,i.shadeAmount()):o.Game.drawTile(17,0,1,1,i.x,i.y,i.w,i.h,i.level.shadeColor,i.shadeAmount())},i.w=1,i.h=1,i.pressed=!1,i.turnsSincePressed=1,i.linkedDoor=a,i}return a(t,e),t}(n(1384).Tile);t.Button=i},1902:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Chasm=void 0;var o=n(2967),i=function(e){function t(t,n,r,a,i,s,l){var c=e.call(this,t,n,r)||this;return c.isSolid=function(){return!0},c.canCrushEnemy=function(){return!0},c.draw=function(e){c.topEdge&&o.Game.drawTile(22,0,1,2,c.x,c.y,1,2,c.level.shadeColor,c.shadeAmount()),o.Game.drawTile(c.tileX,c.tileY,1,1,c.x,c.y,1,1,c.level.shadeColor,c.shadeAmount())},c.tileX=1===c.skin?24:20,c.tileY=1,a?c.tileX--:i&&c.tileX++,s?c.tileY--:l&&c.tileY++,c.topEdge=s,c}return a(t,e),t}(n(1384).Tile);t.Chasm=i},5990:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.CoffinTile=void 0;var o=n(2967),i=function(e){function t(t,n,r,a){var i=e.call(this,t,n,r)||this;return i.isSolid=function(){return!0},i.canCrushEnemy=function(){return!0},i.draw=function(e){0===i.subTileY?(o.Game.drawTile(0,5,1,1,i.x-1,i.y-1,1,1,i.level.shadeColor,i.shadeAmount()),o.Game.drawTile(1,5,1,1,i.x,i.y-1,1,1,i.level.shadeColor,i.shadeAmount()),o.Game.drawTile(2,5,1,1,i.x+1,i.y-1,1,1,i.level.shadeColor,i.shadeAmount()),o.Game.drawTile(0,6,1,1,i.x-1,i.y,1,1,i.level.shadeColor,i.shadeAmount()),o.Game.drawTile(1,6,1,1,i.x,i.y,1,1,i.level.shadeColor,i.shadeAmount()),o.Game.drawTile(2,6,1,1,i.x+1,i.y,1,1,i.level.shadeColor,i.shadeAmount())):(o.Game.drawTile(0,7,1,1,i.x-1,i.y,1,1,i.level.shadeColor,i.shadeAmount()),o.Game.drawTile(1,7,1,1,i.x,i.y,1,1,i.level.shadeColor,i.shadeAmount()),o.Game.drawTile(2,7,1,1,i.x+1,i.y,1,1,i.level.shadeColor,i.shadeAmount()))},i.subTileY=a,i}return a(t,e),t}(n(1384).Tile);t.CoffinTile=i},9143:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Door=void 0;var o=n(2967),i=function(e){function t(t,n,r,a){var i=e.call(this,t,r,a)||this;return i.link=function(e){i.linkedDoor=e},i.canCrushEnemy=function(){return!0},i.onCollide=function(e){i.opened=!0,i.game.changeLevelThroughDoor(e,i.linkedDoor)},i.draw=function(e){i.opened?o.Game.drawTile(6,i.skin,1,1,i.x,i.y,1,1,i.level.shadeColor,i.shadeAmount()):o.Game.drawTile(3,i.skin,1,1,i.x,i.y,1,1,i.level.shadeColor,i.shadeAmount())},i.drawAbovePlayer=function(e){i.opened?o.Game.drawTile(14,0,1,1,i.x,i.y-1,1,1,i.level.shadeColor,i.shadeAmount()):o.Game.drawTile(13,0,1,1,i.x,i.y-1,1,1,i.level.shadeColor,i.shadeAmount())},i.drawAboveShading=function(e){o.Game.drawFX(2,2,1,1,i.x,i.y-1.25+.125*Math.sin(.006*Date.now()),1,1)},i.game=n,i.opened=!1,i}return a(t,e),t}(n(1384).Tile);t.Door=i},9382:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.DownLadder=void 0;var o=n(2967),i=n(1384),s=n(6563),l=function(e){function t(t,n,r,a){var i=e.call(this,t,r,a)||this;return i.isRope=!1,i.generate=function(){if(!i.linkedLevel){i.linkedLevel=i.game.levelgen.generate(i.game,i.level.depth+(i.isRope?0:1),i.isRope);for(var e=i.linkedLevel.roomX;e<i.linkedLevel.roomX+i.linkedLevel.width;e++)for(var t=i.linkedLevel.roomY;t<i.linkedLevel.roomY+i.linkedLevel.height;t++){var n=i.linkedLevel.levelArray[e][t];n instanceof s.UpLadder&&n.isRope&&(n.linkedLevel=i.level)}}},i.onCollide=function(e){if(i.isRope)i.game.changeLevelThroughLadder(e,i);else{var t=!0;for(var n in i.game.players)i.game.levels[i.game.players[n].levelID]===i.level&&i.game.players[n].x===i.x&&i.game.players[n].y===i.y||(t=!1);if(t)for(var n in i.generate(),i.game.players)i.game.changeLevelThroughLadder(i.game.players[n],i);else e===i.game.players[i.game.localPlayerID]&&i.game.chat.push(new o.ChatMessage("all players must be present"))}},i.draw=function(e){var t=4;i.isRope&&(t=16),o.Game.drawTile(1,i.skin,1,1,i.x,i.y,1,1,i.level.shadeColor,i.shadeAmount()),o.Game.drawTile(t,i.skin,1,1,i.x,i.y,1,1,i.level.shadeColor,i.shadeAmount())},i.drawAbovePlayer=function(e){},i.game=n,i.linkedLevel=null,i}return a(t,e),t}(i.Tile);t.DownLadder=l},9626:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Floor=void 0;var o=n(2967),i=n(1384),s=function(e){function t(t,n,r){var a=e.call(this,t,n,r)||this;return a.draw=function(e){o.Game.drawTile(a.variation,a.skin,1,1,a.x,a.y,1,1,a.level.shadeColor,a.shadeAmount())},a.variation=1,a.skin==i.SkinType.DUNGEON&&(a.variation=o.Game.randTable([1,1,1,1,1,1,8,8,8,9,10,10,10,10,10,12],Math.random)),a.skin==i.SkinType.CAVE&&(a.variation=o.Game.randTable([1,1,1,1,1,1,8,8,8,9,10,10,10,10,10,12],Math.random)),a}return a(t,e),t}(i.Tile);t.Floor=s},8341:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.FountainTile=void 0;var o=n(2967),i=function(e){function t(t,n,r,a,i){var s=e.call(this,t,n,r)||this;return s.isSolid=function(){return!0},s.canCrushEnemy=function(){return!0},s.draw=function(e){o.Game.drawTile(1,s.skin,1,1,s.x,s.y,1,1,s.level.shadeColor,s.shadeAmount()),o.Game.drawTile(s.subTileX,2+s.subTileY,1,1,s.x,s.y,1,1,s.level.shadeColor,s.shadeAmount())},s.subTileX=a,s.subTileY=i,s}return a(t,e),t}(n(1384).Tile);t.FountainTile=i},7149:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.InsideLevelDoor=void 0;var o=n(2967),i=function(e){function t(t,n,r,a){var i=e.call(this,t,r,a)||this;return i.isSolid=function(){return!i.opened},i.canCrushEnemy=function(){return!i.opened},i.isOpaque=function(){return!i.opened},i.draw=function(e){o.Game.drawTile(1,0,1,1,i.x,i.y,1,1,i.level.shadeColor,i.shadeAmount()),i.opened?o.Game.drawTile(15,1,1,1,i.x,i.y,1,1,i.level.shadeColor,i.shadeAmount()):o.Game.drawTile(3,i.skin,1,1,i.x,i.y,1,1,i.level.shadeColor,i.shadeAmount())},i.drawAbovePlayer=function(e){i.opened?o.Game.drawTile(14,0,1,1,i.x,i.y-1,1,1,i.level.shadeColor,i.shadeAmount()):o.Game.drawTile(13,0,1,1,i.x,i.y-1,1,1,i.level.shadeColor,i.shadeAmount())},i.game=n,i.opened=!1,i}return a(t,e),t}(n(1384).Tile);t.InsideLevelDoor=i},8791:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.LockedDoor=void 0;var o=n(2967),i=n(1785),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.unlock=function(e){var n=e.inventory.hasItem(i.Key);null!==n&&(e.inventory.removeItem(n),t.level.levelArray[t.x][t.y]=t.unlockedDoor,t.level.doors.push(t.unlockedDoor))},t.isSolid=function(){return!0},t.canCrushEnemy=function(){return!0},t.isOpaque=function(){return!0},t.draw=function(e){o.Game.drawTile(17,t.skin,1,1,t.x,t.y,1,1,t.level.shadeColor,t.shadeAmount())},t}return a(t,e),t}(n(1384).Tile);t.LockedDoor=s},6882:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.SideDoor=void 0;var o=n(2967),i=function(e){function t(t,n,r,a){var i=e.call(this,t,r,a)||this;return i.link=function(e){i.linkedDoor=e},i.canCrushEnemy=function(){return!0},i.onCollide=function(e){i.opened=!0,i.game.changeLevelThroughDoor(e,i.linkedDoor,i.linkedDoor.level.roomX-i.level.roomX>0?1:-1)},i.draw=function(e){o.Game.drawTile(1,i.skin,1,1,i.x,i.y,1,1,i.level.shadeColor,i.shadeAmount())},i.drawAbovePlayer=function(e){},i.drawAboveShading=function(e){o.Game.drawFX(2,2,1,1,i.x,i.y-1.25+.125*Math.sin(.006*Date.now()),1,1)},i.game=n,i.opened=!1,i}return a(t,e),t}(n(1384).Tile);t.SideDoor=i},953:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.SpawnFloor=void 0;var o=n(2967),i=n(1384),s=function(e){function t(t,n,r){var a=e.call(this,t,n,r)||this;return a.draw=function(e){o.Game.drawTile(a.variation,a.skin,1,1,a.x,a.y,1,1,a.level.shadeColor,a.shadeAmount())},a.variation=1,a.skin==i.SkinType.DUNGEON&&(a.variation=o.Game.randTable([1,1,1,1,1,1,8,8,8,9,10,10,10,10,10,12],Math.random)),a.skin==i.SkinType.CAVE&&(a.variation=o.Game.randTable([1,1,1,1,1,1,8,8,8,9,10,10,10,10,10,12],Math.random)),a}return a(t,e),t}(i.Tile);t.SpawnFloor=s},5525:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Spike=void 0;var o=n(2967),i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onCollide=function(e){e.hurt(1)},t.draw=function(e){o.Game.drawTile(11,0,1,1,t.x,t.y,1,1,t.level.shadeColor,t.shadeAmount())},t}return a(t,e),t}(n(1384).Tile);t.Spike=i},3280:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.SpikeTrap=void 0;var o=n(2967),i=n(1384),s=n(6061),l=n(6750),c=n(3205),u=function(e){function t(t,n,r,a){var i=e.call(this,t,n,r)||this;return i.tick=function(){if(i.tickCount++,i.tickCount>=4&&(i.tickCount=0),i.on=0===i.tickCount,i.on)for(var e in i.level.game.players)i.level===i.level.game.levels[i.level.game.players[e].levelID]&&i.level.game.players[e].x===i.x&&i.level.game.players[e].y===i.y&&i.level.game.players[e].hurt(1);3===i.tickCount&&i.level.hitwarnings.push(new c.HitWarning(i.level.game,i.x,i.y))},i.tickEnd=function(){if(i.on)for(var e=0,t=i.level.enemies;e<t.length;e++){var n=t[e];n.x===i.x&&n.y===i.y&&n.hurt(null,1)}},i.onCollideEnemy=function(e){i.on&&!(e instanceof s.Crate||e instanceof l.Barrel)&&e.hurt(null,1)},i.draw=function(e){o.Game.drawTile(1,i.skin,1,1,i.x,i.y,1,1,i.level.shadeColor,i.shadeAmount());var t=0;i.t++,i.on||3!==i.tickCount||(i.t%4==1&&(t=.0325),i.t%4==3&&(t=-.0325));var n=[0,1,2,3,3,4,2,0],r=6+n[Math.floor(i.frame)];(1===i.tickCount||0===i.tickCount&&0===n[Math.floor(i.frame)])&&(r=5),o.Game.drawObj(r,0,1,2,i.x+t,i.y-1,1,2,i.level.shadeColor,i.shadeAmount()),i.on&&i.frame<n.length-1&&(n[Math.floor(i.frame)]<3?i.frame+=.4*e:i.frame+=.2*e),i.on||(i.frame=0)},i.tickCount=a||0,i.on=!1,i.frame=0,i.t=0,i}return a(t,e),t}(i.Tile);t.SpikeTrap=u},1384:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Tile=t.SkinType=void 0;var o,i=n(6779);(o=t.SkinType||(t.SkinType={}))[o.DUNGEON=0]="DUNGEON",o[o.CAVE=1]="CAVE";var s=function(e){function t(t,n,r){var a=e.call(this)||this;return a.shadeAmount=function(){return a.level.softVis[a.x][a.y]},a.isSolid=function(){return!1},a.canCrushEnemy=function(){return!1},a.isOpaque=function(){return!1},a.onCollide=function(e){},a.onCollideEnemy=function(e){},a.tick=function(){},a.tickEnd=function(){},a.draw=function(e){},a.drawUnderPlayer=function(e){},a.drawAbovePlayer=function(e){},a.drawAboveShading=function(e){},a.skin=t.skin,a.level=t,a.x=n,a.y=r,a.drawableY=r,a}return a(t,e),t}(i.Drawable);t.Tile=s},9039:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Trapdoor=void 0;var o=n(2967),i=function(e){function t(t,n,r,a){var i=e.call(this,t,r,a)||this;return i.draw=function(e){o.Game.drawTile(13,i.skin,1,1,i.x,i.y,1,1,i.level.shadeColor,i.shadeAmount())},i.onCollide=function(e){},i.game=n,i}return a(t,e),t}(n(1384).Tile);t.Trapdoor=i},6563:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.UpLadder=void 0;var o=n(2967),i=function(e){function t(t,n,r,a){var i=e.call(this,t,r,a)||this;return i.isRope=!1,i.onCollide=function(e){i.game.changeLevelThroughLadder(e,i)},i.draw=function(e){var t=29,n=0;i.isRope&&(t=16,n=1),o.Game.drawTile(1,i.skin,1,1,i.x,i.y,1,1,i.level.shadeColor,i.shadeAmount()),i.isRope||o.Game.drawTile(t,n,1,1,i.x,i.y-1,1,1,i.level.shadeColor,i.shadeAmount()),o.Game.drawTile(t,n+1,1,1,i.x,i.y,1,1,i.level.shadeColor,i.shadeAmount())},i.drawAbovePlayer=function(e){i.isRope&&o.Game.drawTile(16,1,1,1,i.x,i.y-1,1,1,i.level.shadeColor,i.shadeAmount())},i.game=n,i}return a(t,e),t}(n(1384).Tile);t.UpLadder=i},312:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Wall=void 0;var o=n(2967),i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isSolid=function(){return!0},t.canCrushEnemy=function(){return!0},t.isOpaque=function(){return!0},t.draw=function(e){t.y<t.level.roomY+t.level.height-1&&o.Game.drawTile(0,t.skin,1,1,t.x,t.y,1,1,t.level.shadeColor,t.level.softVis[t.x][t.y+1]),o.Game.drawTile(2,t.skin,1,1,t.x,t.y-.5,1,1,t.level.shadeColor,t.shadeAmount())},t}return a(t,e),t}(n(1384).Tile);t.Wall=i},7933:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.WallTorch=void 0;var o=n(2967),i=n(1384),s=n(5752),l=function(e){function t(t,n,r){var a=e.call(this,t,n,r)||this;return a.isSolid=function(){return!0},a.canCrushEnemy=function(){return!0},a.isOpaque=function(){return!0},a.draw=function(e){a.frame+=.3*e,a.frame>=12&&(a.frame=0),o.Game.drawTile(0,a.skin,1,1,a.x,a.y,1,1,a.level.shadeColor,a.shadeAmount()),o.Game.drawTile(2,a.skin,1,1,a.x,a.y-.5,1,1,a.level.shadeColor,a.shadeAmount()),o.Game.drawFX(Math.floor(a.frame),32,1,2,a.x,a.y-1,1,2)},a.level.lightSources.push(new s.LightSource(a.x+.5,a.y+.5,3)),a.frame=12*Math.random(),a}return a(t,e),t}(i.Tile);t.WallTorch=l},6330:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Dagger=void 0;var o=n(2091),i=n(5958),s=n(5554),l=n(6061),c=n(6750),u=function(e){function t(t,n,r){var a=e.call(this,t,n,r)||this;return a.weaponMove=function(e,t){for(var n=!1,r=0,o=a.game.levels[a.wielder.levelID].enemies;r<o.length;r++){var u=o[r];u.destroyable&&!(u instanceof l.Crate||u instanceof c.Barrel)&&u.pointIn(e,t)&&(u.hurt(a.wielder,1),n=!0)}return n&&(a.wielder.game.levels[a.wielder.levelID]===a.wielder.game.level&&i.Sound.hit(),a.wielder.drawX=.5*(a.wielder.x-e),a.wielder.drawY=.5*(a.wielder.y-t),a.game.levels[a.wielder.levelID].particles.push(new s.SlashParticle(e,t)),a.game.levels[a.wielder.levelID].tick(a.wielder),a.wielder===a.game.players[a.game.localPlayerID]&&a.game.shakeScreen(10*a.wielder.drawX,10*a.wielder.drawY)),!n},a.getDescription=function(){return"DAGGER\nDamage 1"},a.tileX=22,a.tileY=0,a}return a(t,e),t}(o.Weapon);t.Dagger=u},2920:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.DualDagger=void 0;var o=n(2091),i=n(5958),s=n(5554),l=n(6061),c=n(6750),u=function(e){function t(t,n,r){var a=e.call(this,t,n,r)||this;return a.tickInInventory=function(){a.firstAttack=!0},a.weaponMove=function(e,t){for(var n=!1,r=0,o=a.game.levels[a.wielder.levelID].enemies;r<o.length;r++){var u=o[r];u.destroyable&&!(u instanceof l.Crate||u instanceof c.Barrel)&&u.pointIn(e,t)&&(u.hurt(a.wielder,1),n=!0)}return n&&(a.wielder.game.levels[a.wielder.levelID]===a.wielder.game.level&&i.Sound.hit(),a.wielder.drawX=.5*(a.wielder.x-e),a.wielder.drawY=.5*(a.wielder.y-t),a.game.levels[a.wielder.levelID].particles.push(new s.SlashParticle(e,t)),a.firstAttack?a.game.levels[a.wielder.levelID].enemies=a.game.levels[a.wielder.levelID].enemies.filter((function(e){return!e.dead})):a.game.levels[a.wielder.levelID].tick(a.wielder),a.wielder===a.game.players[a.game.localPlayerID]&&a.game.shakeScreen(10*a.wielder.drawX,10*a.wielder.drawY),a.firstAttack&&(a.firstAttack=!1)),!n},a.getDescription=function(){return"DUAL DAGGERS\nOne extra attack per turn"},a.tileX=23,a.tileY=0,a.firstAttack=!0,a}return a(t,e),t}(o.Weapon);t.DualDagger=u},1656:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Shotgun=void 0;var o=n(2091),i=n(5958),s=n(2621),l=function(e){function t(t,n,r){var a=e.call(this,t,n,r)||this;return a.weaponMove=function(e,t){var n=2*e-a.wielder.x,r=2*t-a.wielder.y,o=3*e-2*a.wielder.x,l=3*t-2*a.wielder.y,c=3;if(!a.game.levels[a.wielder.levelID].tileInside(e,t)||a.game.levels[a.wielder.levelID].levelArray[e][t].isSolid())return!0;!a.game.levels[a.wielder.levelID].tileInside(n,r)||a.game.levels[a.wielder.levelID].levelArray[n][r].isSolid()?c=1:a.game.levels[a.wielder.levelID].tileInside(o,l)&&!a.game.levels[a.wielder.levelID].levelArray[o][l].isSolid()||(c=2);for(var u=[],h=4,p=5,d=5,f=0,y=a.game.levels[a.wielder.levelID].enemies;f<y.length;f++)if((x=y[f]).pushable){if(x.pointIn(e,t))return!0;x.pointIn(n,r)&&c>=2&&(u.push({enemy:x,dist:2}),h=2),x.pointIn(o,l)&&c>=3&&(u.push({enemy:x,dist:3}),h=Math.min(h,3))}else x.destroyable?(x.pointIn(e,t)&&c>=1&&(p=1,u.push({enemy:x,dist:1})),x.pointIn(n,r)&&c>=2&&(p=Math.min(p,2),u.push({enemy:x,dist:2})),x.pointIn(o,l)&&c>=3&&(p=Math.min(p,3),u.push({enemy:x,dist:3}))):(x.pointIn(e,t)&&c>=1&&(d=1),x.pointIn(n,r)&&c>=2&&(d=Math.min(d,2)),x.pointIn(o,l)&&c>=3&&(d=Math.min(d,3)));var m=o,v=l;if(d<p&&d<h)return!0;if(p<=h){for(var g=0,w=u;g<w.length;g++){var _=w[g],x=_.enemy;3===_.dist?x.hurt(a.wielder,.5):x.hurt(a.wielder,1)}a.wielder.game.levels[a.wielder.levelID]===a.wielder.game.level&&i.Sound.hit(),a.wielder.drawX=.5*(a.wielder.x-e),a.wielder.drawY=.5*(a.wielder.y-t),s.GenericParticle.shotgun(a.game.levels[a.wielder.levelID],a.wielder.x+.5,a.wielder.y,m+.5,v,"black"),s.GenericParticle.shotgun(a.game.levels[a.wielder.levelID],a.wielder.x+.5,a.wielder.y,m+.5,v,"#ffddff");var C=new s.GenericParticle(a.game.levels[a.wielder.levelID],.5*(e+a.wielder.x)+.5,.5*(t+a.wielder.y),0,1,0,0,0,"white",0);return C.expirationTimer=10,a.game.levels[a.wielder.levelID].particles.push(C),a.game.levels[a.wielder.levelID].tick(a.wielder),a.wielder===a.game.players[a.game.localPlayerID]&&a.game.shakeScreen(10*a.wielder.drawX,10*a.wielder.drawY),!1}return!0},a.getDescription=function(){return"SHOTGUN\nRange 3, penetration"},a.tileX=26,a.tileY=0,a}return a(t,e),t}(o.Weapon);t.Shotgun=l},3806:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Spear=void 0;var o=n(2091),i=n(5958),s=n(5554),l=n(6061),c=n(6750),u=function(e){function t(t,n,r){var a=e.call(this,t,n,r)||this;return a.weaponMove=function(e,t){for(var n=2*e-a.wielder.x,r=2*t-a.wielder.y,o=!1,u=[],h=0,p=a.game.levels[a.wielder.levelID].enemies;h<p.length;h++)if((y=p[h]).destroyable){if(y.pointIn(e,t)){if(y instanceof l.Crate||y instanceof c.Barrel)return!0;y.hurt(a.wielder,1),o=!0}y.pointIn(n,r)&&!a.game.levels[a.wielder.levelID].levelArray[e][t].isSolid()&&(y instanceof l.Crate||y instanceof c.Barrel||u.push(y))}if(!o&&u.length>0){for(var d=0,f=u;d<f.length;d++){var y;(y=f[d]).hurt(a.wielder,1)}return a.wielder.game.level===a.wielder.game.levels[a.wielder.levelID]&&i.Sound.hit(),a.wielder.drawX=.5*(a.wielder.x-e),a.wielder.drawY=.5*(a.wielder.y-t),a.game.levels[a.wielder.levelID].particles.push(new s.SlashParticle(e,t)),a.game.levels[a.wielder.levelID].particles.push(new s.SlashParticle(n,r)),a.game.levels[a.wielder.levelID].tick(a.wielder),a.wielder===a.game.players[a.game.localPlayerID]&&a.game.shakeScreen(10*a.wielder.drawX,10*a.wielder.drawY),!1}return o&&(a.wielder.game.level===a.wielder.game.levels[a.wielder.levelID]&&i.Sound.hit(),a.wielder.drawX=.5*(a.wielder.x-e),a.wielder.drawY=.5*(a.wielder.y-t),a.game.levels[a.wielder.levelID].particles.push(new s.SlashParticle(e,t)),a.game.levels[a.wielder.levelID].tick(a.wielder),a.wielder===a.game.players[a.game.localPlayerID]&&a.game.shakeScreen(10*a.wielder.drawX,10*a.wielder.drawY)),!o},a.getDescription=function(){return"SPEAR\nRange 2"},a.tileX=24,a.tileY=0,a}return a(t,e),t}(o.Weapon);t.Spear=u},2091:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Weapon=void 0;var o=function(e){function t(n,r,a){var o=e.call(this,n,r,a)||this;return o.coEquippable=function(e){return!(e instanceof t)},o.tick=function(){},o.weaponMove=function(e,t){return!0},n&&(o.game=n.game),o}return a(t,e),t}(n(8499).Equippable);t.Weapon=o},2281:e=>{"use strict";var t,n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),r={},a=0,o=0;function i(e){var t="";do{t=n[e%64]+t,e=Math.floor(e/64)}while(e>0);return t}function s(){var e=i(+new Date);return e!==t?(a=0,t=e):e+"."+i(a++)}for(;o<64;o++)r[n[o]]=o;s.encode=i,s.decode=function(e){var t=0;for(o=0;o<e.length;o++)t=64*t+r[e.charAt(o)];return t},e.exports=s}},t={};!function n(r){if(t[r])return t[r].exports;var a=t[r]={exports:{}};return e[r].call(a.exports,a,a.exports,n),a.exports}(2967)})();